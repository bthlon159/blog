<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.48" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://www.cxlsn.cn/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html"><meta property="og:site_name" content="MyBlog"><meta property="og:title" content="第 3 章 常用 Java 虚拟机参数"><meta property="og:type" content="article"><meta property="og:image" content="https://www.cxlsn.cn/"><meta property="og:updated_time" content="2022-08-06T09:11:40.000Z"><meta property="og:locale" content="zh-CN"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="第 3 章 常用 Java 虚拟机参数"><meta property="article:modified_time" content="2022-08-06T09:11:40.000Z"><title>第 3 章 常用 Java 虚拟机参数 | MyBlog</title><meta name="description" content="MyBlog">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.09a441ee.css">
    <link rel="modulepreload" href="/assets/app.0d56c066.js"><link rel="modulepreload" href="/assets/第3章常用Java虚拟机参数.html.65784af7.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/assets/第3章常用Java虚拟机参数.html.10cb1042.js"><link rel="prefetch" href="/assets/index.html.18f6ed2e.js"><link rel="prefetch" href="/assets/home.html.32fca429.js"><link rel="prefetch" href="/assets/slide.html.a293c482.js"><link rel="prefetch" href="/assets/index.html.bcf51f43.js"><link rel="prefetch" href="/assets/index.html.3768ee5f.js"><link rel="prefetch" href="/assets/index.html.b7a9ea16.js"><link rel="prefetch" href="/assets/第10章 异常.html.33f3792f.js"><link rel="prefetch" href="/assets/第11章 并发.html.41f89aa7.js"><link rel="prefetch" href="/assets/第12章 序列化.html.08c4c0cc.js"><link rel="prefetch" href="/assets/第2章 创建和销毁对象.html.1b6f55e3.js"><link rel="prefetch" href="/assets/第3章 对于所有对象都通用的方法.html.e81922f0.js"><link rel="prefetch" href="/assets/第4章 类和接口.html.bbf64366.js"><link rel="prefetch" href="/assets/第5章 泛型.html.053306ed.js"><link rel="prefetch" href="/assets/第6章 枚举和注解.html.cb21ea0d.js"><link rel="prefetch" href="/assets/第7章 Lambda和Stream.html.664c81b8.js"><link rel="prefetch" href="/assets/第8章 方法.html.bfc52ab1.js"><link rel="prefetch" href="/assets/第9章 通用编程.html.6a1d88a2.js"><link rel="prefetch" href="/assets/index.html.153be5a1.js"><link rel="prefetch" href="/assets/index.html.4b079bc8.js"><link rel="prefetch" href="/assets/第1章Java多线程技能.html.f4c43a60.js"><link rel="prefetch" href="/assets/第2章对象及变量的并发访问.html.24971a2d.js"><link rel="prefetch" href="/assets/第3章线程间通信.html.e9963ba8.js"><link rel="prefetch" href="/assets/第4章锁的使用.html.bc309d92.js"><link rel="prefetch" href="/assets/第5章定时器.html.aaf2b6ee.js"><link rel="prefetch" href="/assets/第6章单例模式与多线程.html.a87eb20f.js"><link rel="prefetch" href="/assets/第7章拾遗增补.html.2cbb6898.js"><link rel="prefetch" href="/assets/第8章并发集合框架.html.1739cc6b.js"><link rel="prefetch" href="/assets/第9章线程池ThreadPoolExecutor的使用.html.186199c8.js"><link rel="prefetch" href="/assets/index.html.62274579.js"><link rel="prefetch" href="/assets/第1章多线程基础.html.afd475cd.js"><link rel="prefetch" href="/assets/第2章Atomic类.html.06be1f5d.js"><link rel="prefetch" href="/assets/第3章Lock与Condition.html.ab9d71ca.js"><link rel="prefetch" href="/assets/第4章同步工具类.html.c3382339.js"><link rel="prefetch" href="/assets/第5章并发容器.html.ef80cb1d.js"><link rel="prefetch" href="/assets/第6章线程池与Future.html.e4a6ecca.js"><link rel="prefetch" href="/assets/第7章ForkJoinPool.html.98e49c17.js"><link rel="prefetch" href="/assets/第8章CompletableFuture.html.f7a413b4.js"><link rel="prefetch" href="/assets/index.html.12f0ee52.js"><link rel="prefetch" href="/assets/第10章Java并发包中线程同步器原理剖析.html.b977fee1.js"><link rel="prefetch" href="/assets/第11章并发编程实践.html.623c5cbb.js"><link rel="prefetch" href="/assets/第1章并发编程线程基础.html.3967f815.js"><link rel="prefetch" href="/assets/第2章并发编程的其他基础知识.html.1c7f7072.js"><link rel="prefetch" href="/assets/第3章Java并发包中ThreadLocalRandom类原理剖析.html.8f28f52d.js"><link rel="prefetch" href="/assets/第4章Java并发包中原子操作类原理剖析.html.2e32d2f3.js"><link rel="prefetch" href="/assets/第5章Java并发包中并发List源码剖析.html.4b8c96f3.js"><link rel="prefetch" href="/assets/第6章Java并发包中锁原理剖析.html.57b14c73.js"><link rel="prefetch" href="/assets/第7章Java并发包中并发队列原理剖析.html.21d8c694.js"><link rel="prefetch" href="/assets/第8章Java并发包中线程池ThreadPoolExecutor原理探究.html.44cbbd21.js"><link rel="prefetch" href="/assets/第9章Java并发包中ScheduledThreadPoolExecutor原理探究.html.b4fa44fb.js"><link rel="prefetch" href="/assets/index.html.e5d1d6c3.js"><link rel="prefetch" href="/assets/第10章 Map和Set.html.a55e5985.js"><link rel="prefetch" href="/assets/第11章 堆与优先级列表.html.e280a8e4.js"><link rel="prefetch" href="/assets/第12章 通用容器和总结.html.7f8f71e8.js"><link rel="prefetch" href="/assets/第13章 文件基本技术.html.5f4b89df.js"><link rel="prefetch" href="/assets/第14章 文件高级技术.html.8c6479e2.js"><link rel="prefetch" href="/assets/第15章 并发基础知识.html.5cb53a4c.js"><link rel="prefetch" href="/assets/第16章 并发包的基石.html.142bea88.js"><link rel="prefetch" href="/assets/第17章 并发容器.html.3acbf1e5.js"><link rel="prefetch" href="/assets/第18章 异步任务执行服务.html.1b161f70.js"><link rel="prefetch" href="/assets/第19章 同步和协作工具类.html.addf5980.js"><link rel="prefetch" href="/assets/第1章 编程基础.html.baf9d7d3.js"><link rel="prefetch" href="/assets/第20章 并发总结.html.0b3bb480.js"><link rel="prefetch" href="/assets/第21章 反射.html.af2446cd.js"><link rel="prefetch" href="/assets/第22章 注解.html.d1e27bc4.js"><link rel="prefetch" href="/assets/第23章 动态代理.html.7995d8c2.js"><link rel="prefetch" href="/assets/第24章 类加载机制.html.b0642f1c.js"><link rel="prefetch" href="/assets/第25章 正则表达式.html.8b5d5322.js"><link rel="prefetch" href="/assets/第26章 函数式编程.html.7b517aff.js"><link rel="prefetch" href="/assets/第2章 理解数据背后的二进制.html.94e4cb31.js"><link rel="prefetch" href="/assets/第3章 类的基础.html.5639d229.js"><link rel="prefetch" href="/assets/第4章 类的继承.html.2f958e91.js"><link rel="prefetch" href="/assets/第5章 类的继承.html.7d7e56a6.js"><link rel="prefetch" href="/assets/第6章 异常.html.adb3eef3.js"><link rel="prefetch" href="/assets/第7章 常用基础类.html.17e1b88d.js"><link rel="prefetch" href="/assets/第8章 泛型.html.9d1aa562.js"><link rel="prefetch" href="/assets/第9章 列表和队列.html.1b223279.js"><link rel="prefetch" href="/assets/index.html.213dbe07.js"><link rel="prefetch" href="/assets/第10章Executor框架.html.2d819cce.js"><link rel="prefetch" href="/assets/第11章Java并发编程实践.html.e045243d.js"><link rel="prefetch" href="/assets/第1章并发编程的挑战.html.f2cf1cf0.js"><link rel="prefetch" href="/assets/第2章Java并发机制的底层实现原理.html.84620d72.js"><link rel="prefetch" href="/assets/第3章Java内存模型.html.57e9f10a.js"><link rel="prefetch" href="/assets/第4章Java并发编程基础.html.e1837d6e.js"><link rel="prefetch" href="/assets/第5章Java中的锁.html.509db6c5.js"><link rel="prefetch" href="/assets/第6章Java并发容器和框架.html.fab16b37.js"><link rel="prefetch" href="/assets/第7章Java中的13个原子操作类.html.8a2e8902.js"><link rel="prefetch" href="/assets/第8章Java中的并发工具类.html.ede4146b.js"><link rel="prefetch" href="/assets/第9章Java中的线程池.html.e7e64f52.js"><link rel="prefetch" href="/assets/index.html.ccabe8d8.js"><link rel="prefetch" href="/assets/第10章避免活跃性危险.html.288ef3a6.js"><link rel="prefetch" href="/assets/第11章性能与可伸缩性.html.66974eb6.js"><link rel="prefetch" href="/assets/第12章并发程序的测试.html.064eea71.js"><link rel="prefetch" href="/assets/第13章显式锁.html.bf44c451.js"><link rel="prefetch" href="/assets/第14章构建自定义的同步工具.html.23a2e0be.js"><link rel="prefetch" href="/assets/第15章原子变量与非阻塞同步机制.html.06dd6e43.js"><link rel="prefetch" href="/assets/第16章Java内存模型简介.html.977d59cd.js"><link rel="prefetch" href="/assets/第1章简介.html.90b5e48c.js"><link rel="prefetch" href="/assets/第2章线程安全.html.2501a94b.js"><link rel="prefetch" href="/assets/第3章对象的共享.html.faeb65aa.js"><link rel="prefetch" href="/assets/第4章对象的组合.html.1fe1b50c.js"><link rel="prefetch" href="/assets/第5章基础构建模块.html.1fe6799b.js"><link rel="prefetch" href="/assets/第6章任务执行.html.70613e72.js"><link rel="prefetch" href="/assets/第7章取消与关闭.html.1e1c2d49.js"><link rel="prefetch" href="/assets/第8章线程池的使用.html.72ef0a90.js"><link rel="prefetch" href="/assets/第9章图形用户界面应用程序.html.11c377b5.js"><link rel="prefetch" href="/assets/001-two-sum.html.a3f3595a.js"><link rel="prefetch" href="/assets/002-add-two-numbers.html.e7703c4f.js"><link rel="prefetch" href="/assets/003-longest-substring-without-repeating-characters.html.0c6329c6.js"><link rel="prefetch" href="/assets/index.html.d8ad8d07.js"><link rel="prefetch" href="/assets/index.html.5a513471.js"><link rel="prefetch" href="/assets/第10章前端编译与优化.html.2a6b1789.js"><link rel="prefetch" href="/assets/第11章后端编译与优化.html.59704c7c.js"><link rel="prefetch" href="/assets/第12章Java内存模型与线程.html.deaa5ea6.js"><link rel="prefetch" href="/assets/第13章线程安全与锁优化.html.fd873e3a.js"><link rel="prefetch" href="/assets/第1章走近Java.html.0897d78c.js"><link rel="prefetch" href="/assets/第2章Java内存区域与内存溢出异常.html.0978cdd4.js"><link rel="prefetch" href="/assets/第3章垃圾收集器与内存分配策略.html.a47791fa.js"><link rel="prefetch" href="/assets/第4章虚拟机性能监控、故障处理工具.html.61f80277.js"><link rel="prefetch" href="/assets/第5章调优案例分析与实战.html.7a5b7c4c.js"><link rel="prefetch" href="/assets/第6章类文件结构.html.3e8cd2c6.js"><link rel="prefetch" href="/assets/第7章虚拟机类加载机制.html.3af5a31c.js"><link rel="prefetch" href="/assets/第8章虚拟机字节码执行引擎.html.dc5c593e.js"><link rel="prefetch" href="/assets/第9章类加载及执行子系统的案例与实战.html.c3e2fd28.js"><link rel="prefetch" href="/assets/index.html.c2e9c36e.js"><link rel="prefetch" href="/assets/第1章走入并行世界.html.bf2758d5.js"><link rel="prefetch" href="/assets/第2章Java并行程序基础.html.8a27b9a6.js"><link rel="prefetch" href="/assets/第3章JDK并发包.html.55a5bb57.js"><link rel="prefetch" href="/assets/第4章锁的优化及注意事项.html.0ac6ac12.js"><link rel="prefetch" href="/assets/第5章并行模式与算法.html.6e857f15.js"><link rel="prefetch" href="/assets/第6章Java8910与并发.html.61173fb4.js"><link rel="prefetch" href="/assets/第7章使用Akka构建高并发程序.html.610f0e53.js"><link rel="prefetch" href="/assets/第8章并行程序调试.html.dcf9af72.js"><link rel="prefetch" href="/assets/第9章多线程优化示例—Jetty核心代码分析.html.1b25b9bb.js"><link rel="prefetch" href="/assets/index.html.8c841845.js"><link rel="prefetch" href="/assets/第10章Class装载系统.html.800b1d8e.js"><link rel="prefetch" href="/assets/第11章字节码执行.html.fd59242f.js"><link rel="prefetch" href="/assets/第1章初探Java虚拟机.html.80ec8c68.js"><link rel="prefetch" href="/assets/第2章认识Java虚拟机的基本结构.html.bbf499e1.js"><link rel="prefetch" href="/assets/第4章垃圾回收的概念与算法.html.90d52151.js"><link rel="prefetch" href="/assets/第5章垃圾收集器和内存分配.html.98dc8566.js"><link rel="prefetch" href="/assets/第6章性能监控工具.html.d9178ab7.js"><link rel="prefetch" href="/assets/第7章分析Java堆.html.76f053df.js"><link rel="prefetch" href="/assets/第8章锁与并发.html.c6edc3b8.js"><link rel="prefetch" href="/assets/第9章Class文件结构.html.ce3b9ffe.js"><link rel="prefetch" href="/assets/404.html.a61819a1.js"><link rel="prefetch" href="/assets/index.html.196bf7d0.js"><link rel="prefetch" href="/assets/index.html.6474b04a.js"><link rel="prefetch" href="/assets/index.html.12d9ea9f.js"><link rel="prefetch" href="/assets/index.html.8cf1d97b.js"><link rel="prefetch" href="/assets/index.html.b1d72dff.js"><link rel="prefetch" href="/assets/index.html.6a433ed8.js"><link rel="prefetch" href="/assets/index.html.292db8d2.js"><link rel="prefetch" href="/assets/index.html.db46c28d.js"><link rel="prefetch" href="/assets/home.html.b3222fa8.js"><link rel="prefetch" href="/assets/slide.html.3b4fa46d.js"><link rel="prefetch" href="/assets/index.html.eab01647.js"><link rel="prefetch" href="/assets/index.html.f6997ce1.js"><link rel="prefetch" href="/assets/index.html.4f492e58.js"><link rel="prefetch" href="/assets/第10章 异常.html.b369a82a.js"><link rel="prefetch" href="/assets/第11章 并发.html.1e83a7e7.js"><link rel="prefetch" href="/assets/第12章 序列化.html.934b2280.js"><link rel="prefetch" href="/assets/第2章 创建和销毁对象.html.bf39597f.js"><link rel="prefetch" href="/assets/第3章 对于所有对象都通用的方法.html.c2f582c1.js"><link rel="prefetch" href="/assets/第4章 类和接口.html.d616fa92.js"><link rel="prefetch" href="/assets/第5章 泛型.html.fe9bf71e.js"><link rel="prefetch" href="/assets/第6章 枚举和注解.html.b0c192a2.js"><link rel="prefetch" href="/assets/第7章 Lambda和Stream.html.11e132a3.js"><link rel="prefetch" href="/assets/第8章 方法.html.0f5952cd.js"><link rel="prefetch" href="/assets/第9章 通用编程.html.a9158c44.js"><link rel="prefetch" href="/assets/index.html.66d9275e.js"><link rel="prefetch" href="/assets/index.html.e1e195ac.js"><link rel="prefetch" href="/assets/第1章Java多线程技能.html.d201a503.js"><link rel="prefetch" href="/assets/第2章对象及变量的并发访问.html.8eff37f9.js"><link rel="prefetch" href="/assets/第3章线程间通信.html.96ad7aa4.js"><link rel="prefetch" href="/assets/第4章锁的使用.html.0b108a46.js"><link rel="prefetch" href="/assets/第5章定时器.html.079d1655.js"><link rel="prefetch" href="/assets/第6章单例模式与多线程.html.dd40cab9.js"><link rel="prefetch" href="/assets/第7章拾遗增补.html.c98b6afc.js"><link rel="prefetch" href="/assets/第8章并发集合框架.html.c47636a0.js"><link rel="prefetch" href="/assets/第9章线程池ThreadPoolExecutor的使用.html.fdd06e63.js"><link rel="prefetch" href="/assets/index.html.970ebb57.js"><link rel="prefetch" href="/assets/第1章多线程基础.html.f6e06884.js"><link rel="prefetch" href="/assets/第2章Atomic类.html.5c9a96af.js"><link rel="prefetch" href="/assets/第3章Lock与Condition.html.dd94c834.js"><link rel="prefetch" href="/assets/第4章同步工具类.html.f32cb37a.js"><link rel="prefetch" href="/assets/第5章并发容器.html.11ef3b3d.js"><link rel="prefetch" href="/assets/第6章线程池与Future.html.f2664d19.js"><link rel="prefetch" href="/assets/第7章ForkJoinPool.html.5b09c440.js"><link rel="prefetch" href="/assets/第8章CompletableFuture.html.00ddc982.js"><link rel="prefetch" href="/assets/index.html.05f6dacd.js"><link rel="prefetch" href="/assets/第10章Java并发包中线程同步器原理剖析.html.22c349a1.js"><link rel="prefetch" href="/assets/第11章并发编程实践.html.5db30ba4.js"><link rel="prefetch" href="/assets/第1章并发编程线程基础.html.59828def.js"><link rel="prefetch" href="/assets/第2章并发编程的其他基础知识.html.95634460.js"><link rel="prefetch" href="/assets/第3章Java并发包中ThreadLocalRandom类原理剖析.html.5e3f88be.js"><link rel="prefetch" href="/assets/第4章Java并发包中原子操作类原理剖析.html.aa40f522.js"><link rel="prefetch" href="/assets/第5章Java并发包中并发List源码剖析.html.19da87be.js"><link rel="prefetch" href="/assets/第6章Java并发包中锁原理剖析.html.e64d1f1d.js"><link rel="prefetch" href="/assets/第7章Java并发包中并发队列原理剖析.html.05c55f53.js"><link rel="prefetch" href="/assets/第8章Java并发包中线程池ThreadPoolExecutor原理探究.html.355c02bf.js"><link rel="prefetch" href="/assets/第9章Java并发包中ScheduledThreadPoolExecutor原理探究.html.bc89022d.js"><link rel="prefetch" href="/assets/index.html.0812d30d.js"><link rel="prefetch" href="/assets/第10章 Map和Set.html.d15ebc0a.js"><link rel="prefetch" href="/assets/第11章 堆与优先级列表.html.22879ed0.js"><link rel="prefetch" href="/assets/第12章 通用容器和总结.html.af4e25e8.js"><link rel="prefetch" href="/assets/第13章 文件基本技术.html.e9de4ab6.js"><link rel="prefetch" href="/assets/第14章 文件高级技术.html.6944682e.js"><link rel="prefetch" href="/assets/第15章 并发基础知识.html.fbf03dc9.js"><link rel="prefetch" href="/assets/第16章 并发包的基石.html.f5fbd049.js"><link rel="prefetch" href="/assets/第17章 并发容器.html.d522da1e.js"><link rel="prefetch" href="/assets/第18章 异步任务执行服务.html.76e9a36e.js"><link rel="prefetch" href="/assets/第19章 同步和协作工具类.html.669856bd.js"><link rel="prefetch" href="/assets/第1章 编程基础.html.3f747685.js"><link rel="prefetch" href="/assets/第20章 并发总结.html.1e326470.js"><link rel="prefetch" href="/assets/第21章 反射.html.25579869.js"><link rel="prefetch" href="/assets/第22章 注解.html.10b1af26.js"><link rel="prefetch" href="/assets/第23章 动态代理.html.76b2167b.js"><link rel="prefetch" href="/assets/第24章 类加载机制.html.2dc4cd09.js"><link rel="prefetch" href="/assets/第25章 正则表达式.html.d3486e09.js"><link rel="prefetch" href="/assets/第26章 函数式编程.html.dd3f8bd7.js"><link rel="prefetch" href="/assets/第2章 理解数据背后的二进制.html.3d5eaefa.js"><link rel="prefetch" href="/assets/第3章 类的基础.html.c86161b4.js"><link rel="prefetch" href="/assets/第4章 类的继承.html.2bce738f.js"><link rel="prefetch" href="/assets/第5章 类的继承.html.ad950d91.js"><link rel="prefetch" href="/assets/第6章 异常.html.09ddca79.js"><link rel="prefetch" href="/assets/第7章 常用基础类.html.12c88740.js"><link rel="prefetch" href="/assets/第8章 泛型.html.81d0949a.js"><link rel="prefetch" href="/assets/第9章 列表和队列.html.38c68a48.js"><link rel="prefetch" href="/assets/index.html.bf5d33db.js"><link rel="prefetch" href="/assets/第10章Executor框架.html.a7e672e0.js"><link rel="prefetch" href="/assets/第11章Java并发编程实践.html.debb41c7.js"><link rel="prefetch" href="/assets/第1章并发编程的挑战.html.1b00855d.js"><link rel="prefetch" href="/assets/第2章Java并发机制的底层实现原理.html.f005f932.js"><link rel="prefetch" href="/assets/第3章Java内存模型.html.6ec525fb.js"><link rel="prefetch" href="/assets/第4章Java并发编程基础.html.bd275d3c.js"><link rel="prefetch" href="/assets/第5章Java中的锁.html.83cc4dba.js"><link rel="prefetch" href="/assets/第6章Java并发容器和框架.html.8a83a2ef.js"><link rel="prefetch" href="/assets/第7章Java中的13个原子操作类.html.2c3c8029.js"><link rel="prefetch" href="/assets/第8章Java中的并发工具类.html.61794c87.js"><link rel="prefetch" href="/assets/第9章Java中的线程池.html.9434f936.js"><link rel="prefetch" href="/assets/index.html.93c2aee6.js"><link rel="prefetch" href="/assets/第10章避免活跃性危险.html.e7ea1e3a.js"><link rel="prefetch" href="/assets/第11章性能与可伸缩性.html.42d4a3a1.js"><link rel="prefetch" href="/assets/第12章并发程序的测试.html.690d2aba.js"><link rel="prefetch" href="/assets/第13章显式锁.html.1171f97b.js"><link rel="prefetch" href="/assets/第14章构建自定义的同步工具.html.6c72f888.js"><link rel="prefetch" href="/assets/第15章原子变量与非阻塞同步机制.html.9de6dd1b.js"><link rel="prefetch" href="/assets/第16章Java内存模型简介.html.847d1584.js"><link rel="prefetch" href="/assets/第1章简介.html.5ff3b256.js"><link rel="prefetch" href="/assets/第2章线程安全.html.34a72eca.js"><link rel="prefetch" href="/assets/第3章对象的共享.html.088b59e3.js"><link rel="prefetch" href="/assets/第4章对象的组合.html.420592f2.js"><link rel="prefetch" href="/assets/第5章基础构建模块.html.b697dc08.js"><link rel="prefetch" href="/assets/第6章任务执行.html.d2692cee.js"><link rel="prefetch" href="/assets/第7章取消与关闭.html.1033df86.js"><link rel="prefetch" href="/assets/第8章线程池的使用.html.5655d9dd.js"><link rel="prefetch" href="/assets/第9章图形用户界面应用程序.html.2c9a92f0.js"><link rel="prefetch" href="/assets/001-two-sum.html.bd5b42b8.js"><link rel="prefetch" href="/assets/002-add-two-numbers.html.1cd12f58.js"><link rel="prefetch" href="/assets/003-longest-substring-without-repeating-characters.html.3f87474a.js"><link rel="prefetch" href="/assets/index.html.346ee126.js"><link rel="prefetch" href="/assets/index.html.bddb9164.js"><link rel="prefetch" href="/assets/第10章前端编译与优化.html.27f33bd6.js"><link rel="prefetch" href="/assets/第11章后端编译与优化.html.2d98e937.js"><link rel="prefetch" href="/assets/第12章Java内存模型与线程.html.e5d51c84.js"><link rel="prefetch" href="/assets/第13章线程安全与锁优化.html.2e377ef2.js"><link rel="prefetch" href="/assets/第1章走近Java.html.7c41e7a9.js"><link rel="prefetch" href="/assets/第2章Java内存区域与内存溢出异常.html.82365a5f.js"><link rel="prefetch" href="/assets/第3章垃圾收集器与内存分配策略.html.1360e884.js"><link rel="prefetch" href="/assets/第4章虚拟机性能监控、故障处理工具.html.0a90211f.js"><link rel="prefetch" href="/assets/第5章调优案例分析与实战.html.e7e286da.js"><link rel="prefetch" href="/assets/第6章类文件结构.html.9f84d086.js"><link rel="prefetch" href="/assets/第7章虚拟机类加载机制.html.31c0a6a3.js"><link rel="prefetch" href="/assets/第8章虚拟机字节码执行引擎.html.6f40ca25.js"><link rel="prefetch" href="/assets/第9章类加载及执行子系统的案例与实战.html.5bf71bd8.js"><link rel="prefetch" href="/assets/index.html.18e34f59.js"><link rel="prefetch" href="/assets/第1章走入并行世界.html.d4a7a8b1.js"><link rel="prefetch" href="/assets/第2章Java并行程序基础.html.79f6e18f.js"><link rel="prefetch" href="/assets/第3章JDK并发包.html.df0acd9f.js"><link rel="prefetch" href="/assets/第4章锁的优化及注意事项.html.5a2b559c.js"><link rel="prefetch" href="/assets/第5章并行模式与算法.html.c0ec6141.js"><link rel="prefetch" href="/assets/第6章Java8910与并发.html.9a2cc047.js"><link rel="prefetch" href="/assets/第7章使用Akka构建高并发程序.html.e1442a98.js"><link rel="prefetch" href="/assets/第8章并行程序调试.html.ddf890de.js"><link rel="prefetch" href="/assets/第9章多线程优化示例—Jetty核心代码分析.html.0ab5a261.js"><link rel="prefetch" href="/assets/index.html.9735d51d.js"><link rel="prefetch" href="/assets/第10章Class装载系统.html.50bb638d.js"><link rel="prefetch" href="/assets/第11章字节码执行.html.f0a2e1fd.js"><link rel="prefetch" href="/assets/第1章初探Java虚拟机.html.0a668344.js"><link rel="prefetch" href="/assets/第2章认识Java虚拟机的基本结构.html.1777df39.js"><link rel="prefetch" href="/assets/第4章垃圾回收的概念与算法.html.d6231456.js"><link rel="prefetch" href="/assets/第5章垃圾收集器和内存分配.html.6446a277.js"><link rel="prefetch" href="/assets/第6章性能监控工具.html.e9ce7787.js"><link rel="prefetch" href="/assets/第7章分析Java堆.html.ee273e82.js"><link rel="prefetch" href="/assets/第8章锁与并发.html.7624390a.js"><link rel="prefetch" href="/assets/第9章Class文件结构.html.f4c2ac9f.js"><link rel="prefetch" href="/assets/404.html.36540b0d.js"><link rel="prefetch" href="/assets/index.html.583c479d.js"><link rel="prefetch" href="/assets/index.html.c407fe6a.js"><link rel="prefetch" href="/assets/index.html.99a8f87f.js"><link rel="prefetch" href="/assets/index.html.7587b161.js"><link rel="prefetch" href="/assets/index.html.f6866d7d.js"><link rel="prefetch" href="/assets/index.html.a985c72b.js"><link rel="prefetch" href="/assets/index.html.4c96ae2e.js"><link rel="prefetch" href="/assets/404.629f43ab.js"><link rel="prefetch" href="/assets/Layout.26a2a4c9.js"><link rel="prefetch" href="/assets/Slide.b01858c1.js"><link rel="prefetch" href="/assets/Blog.ac038c81.js"><link rel="prefetch" href="/assets/auto.esm.52abc6cc.js"><link rel="prefetch" href="/assets/index.147398ee.js"><link rel="prefetch" href="/assets/index.e1c5a3de.js"><link rel="prefetch" href="/assets/mermaid.esm.min.e741c6cd.js"><link rel="prefetch" href="/assets/highlight.esm.9b852bc5.js"><link rel="prefetch" href="/assets/markdown.esm.77e8db25.js"><link rel="prefetch" href="/assets/math.esm.cb9d4be3.js"><link rel="prefetch" href="/assets/notes.esm.62c5f19d.js"><link rel="prefetch" href="/assets/reveal.esm.41ec5d7f.js"><link rel="prefetch" href="/assets/search.esm.04894411.js"><link rel="prefetch" href="/assets/zoom.esm.78977eba.js"><link rel="prefetch" href="/assets/photoswipe.esm.2debdee5.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="MyBlog"><!----><span class="site-name hide-in-pad">MyBlog</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="读书笔记"><span class="title"><span class="icon iconfont icon-note" style=""></span>读书笔记</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/reading-notes/Effective%20Java" class="nav-link" aria-label="Effective Java"><!---->Effective Java<!----></a></li><li class="dropdown-item"><a href="/reading-notes/Java%E7%BC%96%E7%A8%8B%E7%9A%84%E9%80%BB%E8%BE%91" class="nav-link" aria-label="Java 编程的逻辑"><!---->Java 编程的逻辑<!----></a></li><li class="dropdown-item"><a href="/reading-notes/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98" class="nav-link" aria-label="Java 并发编程实战"><!---->Java 并发编程实战<!----></a></li><li class="dropdown-item"><a href="/reading-notes/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF" class="nav-link" aria-label="Java 多线程编程核心技术"><!---->Java 多线程编程核心技术<!----></a></li><li class="dropdown-item"><a href="/reading-notes/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B9%8B%E7%BE%8E" class="nav-link" aria-label="Java 并发编程之美"><!---->Java 并发编程之美<!----></a></li><li class="dropdown-item"><a href="/reading-notes/Java%E5%B9%B6%E5%8F%91%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%9AJDK%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90" class="nav-link" aria-label="Java 并发实现原理：JDK 源码剖析"><!---->Java 并发实现原理：JDK 源码剖析<!----></a></li><li class="dropdown-item"><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E9%AB%98%E5%B9%B6%E5%8F%91%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1" class="nav-link" aria-label="实战 Java 高并发程序设计"><!---->实战 Java 高并发程序设计<!----></a></li><li class="dropdown-item"><a href="/reading-notes/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E8%89%BA%E6%9C%AF" class="nav-link" aria-label="Java 并发编程的艺术"><!---->Java 并发编程的艺术<!----></a></li><li class="dropdown-item"><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" class="nav-link active" aria-label="实战 Java 虚拟机：JVM 故障诊断与性能优化"><!---->实战 Java 虚拟机：JVM 故障诊断与性能优化<!----></a></li><li class="dropdown-item"><a href="/reading-notes/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" class="nav-link" aria-label="深入理解 Java 虚拟机：JVM 高级特性与最佳实践"><!---->深入理解 Java 虚拟机：JVM 高级特性与最佳实践<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="leetcode"><span class="title"><span class="icon iconfont icon-note" style=""></span>leetcode</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/leetcode/Top100" class="nav-link" aria-label="Top 100"><!---->Top 100<!----></a></li></ul></button></div></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://gitee.com/anansneaker/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="Gitee"><svg xmlns="http://www.w3.org/2000/svg" class="icon gitee-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="gitee icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm242.97-533.34H482.39a23.7 23.7 0 0 0-23.7 23.7l-.03 59.28c0 13.08 10.59 23.7 23.7 23.7h165.96a23.7 23.7 0 0 1 23.7 23.7v11.85a71.1 71.1 0 0 1-71.1 71.1H375.71a23.7 23.7 0 0 1-23.7-23.7V423.11a71.1 71.1 0 0 1 71.1-71.1h331.8a23.7 23.7 0 0 0 23.7-23.7l.06-59.25a23.73 23.73 0 0 0-23.7-23.73H423.11a177.78 177.78 0 0 0-177.78 177.75v331.83c0 13.08 10.62 23.7 23.7 23.7h349.62a159.99 159.99 0 0 0 159.99-159.99V482.33a23.7 23.7 0 0 0-23.7-23.7z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><p class="sidebar-heading active"><span class="icon iconfont icon-note" style=""></span><span class="title">读书笔记</span><!----></p><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Effective Java</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java 编程的逻辑</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java 并发编程实战</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java多线程编程核心技术</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java 并发编程之美</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java 并发实现原理：JDK 源码剖析</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">实战 Java 高并发程序设计</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java 并发编程的艺术</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">实战 Java 虚拟机：JVM 故障诊断与性能优化</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC1%E7%AB%A0%E5%88%9D%E6%8E%A2Java%E8%99%9A%E6%8B%9F%E6%9C%BA.html" class="nav-link sidebar-link sidebar-page" aria-label="第 1 章 初探 Java 虚拟机"><!---->第 1 章 初探 Java 虚拟机<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC2%E7%AB%A0%E8%AE%A4%E8%AF%86Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84.html" class="nav-link sidebar-link sidebar-page" aria-label="第 2 章 认识 Java 虚拟机的基本结构"><!---->第 2 章 认识 Java 虚拟机的基本结构<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="第 3 章 常用 Java 虚拟机参数"><!---->第 3 章 常用 Java 虚拟机参数<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-1-一切运行都有迹可循-掌握跟踪调试参数" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.1 一切运行都有迹可循：掌握跟踪调试参数"><!---->3.1 一切运行都有迹可循：掌握跟踪调试参数<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-1-1-跟踪垃圾回收—读懂虚拟机日志" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.1.1 跟踪垃圾回收—读懂虚拟机日志"><!---->3.1.1 跟踪垃圾回收—读懂虚拟机日志<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-1-2-类加载-卸载的跟踪" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.1.2 类加载 / 卸载的跟踪"><!---->3.1.2 类加载 / 卸载的跟踪<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-1-3-查看系统参数" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.1.3 查看系统参数"><!---->3.1.3 查看系统参数<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-2-让性能飞起来-学习堆的配置参数" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.2 让性能飞起来：学习堆的配置参数"><!---->3.2 让性能飞起来：学习堆的配置参数<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-2-1-最大堆和初始堆的设置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.2.1 最大堆和初始堆的设置"><!---->3.2.1 最大堆和初始堆的设置<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-2-2-新生代的配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.2.2 新生代的配置"><!---->3.2.2 新生代的配置<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-2-3-堆溢出处理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.2.3 堆溢出处理"><!---->3.2.3 堆溢出处理<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-3-别让性能有缺口-了解非堆内存的参数配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3 别让性能有缺口：了解非堆内存的参数配置"><!---->3.3 别让性能有缺口：了解非堆内存的参数配置<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-3-1-方法区配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3.1 方法区配置"><!---->3.3.1 方法区配置<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-3-2-栈配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3.2 栈配置"><!---->3.3.2 栈配置<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-3-3-直接内存配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3.3 直接内存配置"><!---->3.3.3 直接内存配置<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-4-client-和-server-二选一-虚拟机的工作模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.4 Client 和 Server 二选一：虚拟机的工作模式"><!---->3.4 Client 和 Server 二选一：虚拟机的工作模式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-5-小结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.5 小结"><!---->3.5 小结<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC4%E7%AB%A0%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9A%84%E6%A6%82%E5%BF%B5%E4%B8%8E%E7%AE%97%E6%B3%95.html" class="nav-link sidebar-link sidebar-page" aria-label="第 4 章 垃圾回收的概念与算法"><!---->第 4 章 垃圾回收的概念与算法<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC5%E7%AB%A0%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%92%8C%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html" class="nav-link sidebar-link sidebar-page" aria-label="第 5 章 垃圾收集器和内存分配"><!---->第 5 章 垃圾收集器和内存分配<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html" class="nav-link sidebar-link sidebar-page" aria-label="第 6 章 性能监控工具"><!---->第 6 章 性能监控工具<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC7%E7%AB%A0%E5%88%86%E6%9E%90Java%E5%A0%86.html" class="nav-link sidebar-link sidebar-page" aria-label="第 7 章 分析 Java 堆"><!---->第 7 章 分析 Java 堆<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC8%E7%AB%A0%E9%94%81%E4%B8%8E%E5%B9%B6%E5%8F%91.html" class="nav-link sidebar-link sidebar-page" aria-label="第 8 章 锁与并发"><!---->第 8 章 锁与并发<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC9%E7%AB%A0Class%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84.html" class="nav-link sidebar-link sidebar-page" aria-label="第 9 章 Class 文件结构"><!---->第 9 章 Class 文件结构<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC10%E7%AB%A0Class%E8%A3%85%E8%BD%BD%E7%B3%BB%E7%BB%9F.html" class="nav-link sidebar-link sidebar-page" aria-label="第 10 章 Class 装载系统"><!---->第 10 章 Class 装载系统<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC11%E7%AB%A0%E5%AD%97%E8%8A%82%E7%A0%81%E6%89%A7%E8%A1%8C.html" class="nav-link sidebar-link sidebar-page" aria-label="第 11 章 字节码执行"><!---->第 11 章 字节码执行<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">深入理解 Java 虚拟机：JVM 高级特性与最佳实践</span><span class="arrow right"></span></button><!----></section><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><p class="sidebar-heading"><span class="icon iconfont icon-note" style=""></span><span class="title">leetcode</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/leetcode/Top100/" class="nav-link sidebar-link sidebar-page" aria-label="Top 100"><!---->Top 100<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->第 3 章 常用 Java 虚拟机参数</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down" localizeddate="2022年7月30日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://www.cxlsn.cn/" target="_blank" rel="noopener noreferrer">阿楠sneaker</a></span><span property="author" content="阿楠sneaker"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年7月30日</span><meta property="datePublished" content="2022-07-30T08:51:46.000Z"></span><!----><!----><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down" localizeddate="2022年7月30日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 32 分钟</span><meta property="timeRequired" content="PT32M"></span><span class="words-info" aria-label="字数🔠" data-balloon-pos="down" localizeddate="2022年7月30日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>约 9654 字</span><meta property="wordCount" content="9654"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-1-一切运行都有迹可循-掌握跟踪调试参数" class="router-link-active router-link-exact-active toc-link level2">3.1 一切运行都有迹可循：掌握跟踪调试参数</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-1-1-跟踪垃圾回收—读懂虚拟机日志" class="router-link-active router-link-exact-active toc-link level3">3.1.1 跟踪垃圾回收—读懂虚拟机日志</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-1-2-类加载-卸载的跟踪" class="router-link-active router-link-exact-active toc-link level3">3.1.2 类加载 / 卸载的跟踪</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-1-3-查看系统参数" class="router-link-active router-link-exact-active toc-link level3">3.1.3 查看系统参数</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-2-让性能飞起来-学习堆的配置参数" class="router-link-active router-link-exact-active toc-link level2">3.2 让性能飞起来：学习堆的配置参数</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-2-1-最大堆和初始堆的设置" class="router-link-active router-link-exact-active toc-link level3">3.2.1 最大堆和初始堆的设置</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-2-2-新生代的配置" class="router-link-active router-link-exact-active toc-link level3">3.2.2 新生代的配置</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-2-3-堆溢出处理" class="router-link-active router-link-exact-active toc-link level3">3.2.3 堆溢出处理</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-3-别让性能有缺口-了解非堆内存的参数配置" class="router-link-active router-link-exact-active toc-link level2">3.3 别让性能有缺口：了解非堆内存的参数配置</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-3-1-方法区配置" class="router-link-active router-link-exact-active toc-link level3">3.3.1 方法区配置</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-3-2-栈配置" class="router-link-active router-link-exact-active toc-link level3">3.3.2 栈配置</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-3-3-直接内存配置" class="router-link-active router-link-exact-active toc-link level3">3.3.3 直接内存配置</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-4-client-和-server-二选一-虚拟机的工作模式" class="router-link-active router-link-exact-active toc-link level2">3.4 Client 和 Server 二选一：虚拟机的工作模式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html#_3-5-小结" class="router-link-active router-link-exact-active toc-link level2">3.5 小结</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="第-3-章-常用-java-虚拟机参数" tabindex="-1"><a class="header-anchor" href="#第-3-章-常用-java-虚拟机参数" aria-hidden="true">#</a> 第 3 章 常用 Java 虚拟机参数</h1><p>要诊断虚拟机，我们就要学习如何对 Java 虚拟机进行最基本的配置和跟踪。本章将主要介绍一些常用的 Java 虚拟机参数，它们可以对系统进行跟踪和配置，对系统故障诊断、性能优化有着重要的作用。</p><p>本章涉及的主要知识点有：</p><ul><li>跟踪 Java 虚拟机的垃圾回收和类加载等信息。</li><li>配置 Java 虚拟机的堆空间。</li><li>配置永久区和 Java 栈。</li><li>学习虚拟机的服务器和客户端模式。</li></ul><h2 id="_3-1-一切运行都有迹可循-掌握跟踪调试参数" tabindex="-1"><a class="header-anchor" href="#_3-1-一切运行都有迹可循-掌握跟踪调试参数" aria-hidden="true">#</a> 3.1 一切运行都有迹可循：掌握跟踪调试参数</h2><p>在虚拟机的运行过程中，如果可以跟踪系统的运行状态，对于故障排查会有一定的帮助。为此，虚拟机提供了一些跟踪系统状态的参数，使用给定的参数执行 Java 虚拟机，就可以在系统运行时打印相关日志，用于问题分析。</p><h3 id="_3-1-1-跟踪垃圾回收—读懂虚拟机日志" tabindex="-1"><a class="header-anchor" href="#_3-1-1-跟踪垃圾回收—读懂虚拟机日志" aria-hidden="true">#</a> 3.1.1 跟踪垃圾回收—读懂虚拟机日志</h3><p>Java 的一大特色就是支持自动垃圾回收（GC），但是有时候，如果垃圾回收频繁，或者占用了太长的 CPU 时间，就不得不引起重视。此时，就需要一些跟踪参数来进一步甄别垃圾回收器的效率和效果。</p><p>最简单的一个 GC 参数是 -XX:+PrintGC（在 JDK 9、JDK 10 中建议使用 -Xlog:gc），使用这个参数启动 Java 虚拟机后，只要遇到 GC，就会打印日志，如下所示：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[GC 4793K-&gt;377K(15872K), 0.0006926 secs]
[GC 4857K-&gt;377K(15936K), 0.0003595 secs]
[GC 4857K-&gt;377K(15936K), 0.0001755 secs]
[GC 4857K-&gt;377K(15936K), 0.0001957 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该日志显示，一共进行了 4 次 GC，每次 GC 占用一行，在 GC 前，堆空间使用量约为 4MB，在 GC 后，堆空间使用量为 377 KB，当前可用的堆空间总和约为 16MB（15936KB）。最后，显示的是本次 GC 所花的时间。</p><p>JDK 9、JDK 10 默认使用 G1 作为垃圾回收器，使用参数 -Xlog:gc 来打印 GC 日志，如下所示：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[0.012s] [info] [gc] Using G1
[0.107s] [info] [gc] GC(0) Pause Full (System.gc()) 16M -&gt; 7M(34M) 23.511ms
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>该日志显示，一共进行了 1 次 GC，在 GC 前，堆空间使用量为 16MB，在 GC 后，堆空间使用量为 7MB，当前可用的堆空间总和为 34MB。最后，显示的是本次 GC 所花的时间，为 23.511ms。</p><p>如果需要更加详细的信息，可以使用 -XX:+PrintGCDetails 参数。JDK 8（JDK 9、JDK 10 建议使用 -Xlog:gc*，后面讲述）中的输出可能如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[GC[DefNew: 8704K-&gt;1087K(9792K),	0.0665590 secs] 22753K-&gt;17720K(31680K), 0.0666180 secs] [Times: user=0.06 sys=0.00, real=0.06 secs]
[GC[DefNew: 9791K-&gt;9791K(9792K), 0.0000350 secs][Tenured: 16632K-&gt;13533K(21888K), 0.4063120 secs] 26424K-&gt;13533K(31680K), [Perm : 2583K-&gt;2583K(21248K)], 0.4064710 secs] [Times: user=0.41 sys=0.00, real=0.40 secs]
[GC[DefNew: 8704K-&gt;1087K(9792K),	0.0574610 secs] 22237K-&gt;16688K(31680K), 0.0575180 secs] [Times: user=0.06 sys=0.00, real=0.06 secs]
Heap
 def new generation  total 9792K, used 4586K [0x00000000f8e00000, 0x00000000f98a0000, 0x00000000f98a0000)
  eden space 8704K, 40% used [0x00000000f8e00000, 0x00000000f916a8e0, 0x00000000f9680000) 
  from space 1088K, 99% used [0x00000000f9680000, 0x00000000f978ffe0, 0x00000000f9790000) 
  to space 1088K, 0% used [0x00000000f9790000, 0x00000000f9790000, 0x00000000f98a0000) 
 tenured generation  total 21888K, used 15600K [0x00000000f98a0000, 0x00000000fae00000, 0x00000000fae00000)
  the space 21888K, 71% used [0x00000000f98a0000, 0x00000000fa7dc278, 0x00000000fa7dc400, 0x00000000fae00000)
 compacting perm gen total 21248K, used 2591K [0x00000000fae00000, 0x00000000fc2c0000, 0x0000000100000000)
  the space 21248K, 12% used [0x00000000fae00000, 0x00000000fb087ca8, 0x00000000fb087e00, 0x00000000fc2c0000)
No shared spaces configured.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从这个输出中可以看到，系统经历了 3 次 GC，第 1 次仅为新生代 GC，回收的效果是新生代从回收前的 8MB左右降低到 1MB。整个堆从 22MB 左右降低到 17MB。</p><p>第 2 次（加粗部分）为 Full GC，它同时回收了新生代、老年代和永久区。日志显示，新生代在这次 GC 中没有释放空间（严格来说，这是 GC 日志的一个小 bug，事实上，在这次 Full GC 完成后，新生代被清空，由于 GC 日志输出时机的关系，各个版本 JDK 的日志多少有些不太精确的地方，读者需要留意），老年代从 16MB 降低到 13MB。整个堆大小从 26MB 左右降低为 13MB左右（这个大小完全与老年代实际大小相等，因此也可以推断，新生代实际上已被清空）。永久区的大小没有变化。日志的最后显示了 GC 所花的时间，其中 user 表示用户态 CPU 耗时，sys 表示系统 CPU 耗时，real 表示 GC 实际经历的时间。</p><p>参数 -XX:+PrintGCDetails 还会使虚拟机在退出前打印堆的详细信息，详细信息描述了当前堆的各个区间的使用情况。如上输出所示，当前新生代（new generation）总大小为 9792KB，已使用 4586KB。紧跟其后的 3 个 16 进制数字表示新生代的下界、当前上界和上界。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[0x00000000f8e00000, 0x00000000f98a0000, 0x00000000f98a0000)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>使用上界减去下界就能得到当前堆空间的最大值，使用当前上界减去下界，就是当前虚拟机已经为程序分配的空间。如果当前上界等于下界，说明当前的堆空间已经没有扩大的可能性。在本例中（0x00000000f98a0000 - 0x00000000f8e00000）/ 1024 = 10880KB。这块空间正好等于 eden + from + to 的总和。而可用的新生代 9792KB 为 eden + from（to）的总和，对于两者出现差异的原因，读者可以参考本书第 4 章。</p><p>除了新生代，详细的堆日志中还显示了老年代（tenured generation）和永久区（compacting perm gen）的使用情况，其格式和新生代相同。</p><p>JDK 9、JDK 10 使用参数 -Xlog:gc* 来打印更加详细的 GC 日志，如下所示：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[0.010s][info][gc,heap] Heap region size: 1M
[0.012s][info][gc    ] Using G1
[0.013s][info][gc,heap,coops] Heap address: 0x00000000fe000000, size: 32MB, Compressed Oops mode: 32-bit
[5.335s][info][gc,start     ] GC(0) Pause Young (G1 Evacuation Pause) 
[5.336s][info][gc,task	    ] GC(0) Using 8 workers of 8 for evacuation
[5.339s][info][gc,phases	] GC(0) Pre Evacuate Collection Set: 0.0ms
[5.340s][info][gc,phases	] GC(0) Evacuate Collection Set: 3.3ms
[5.341s][info][gcrphases	] GC(0) Post Evacuate Collection Set: 0.1ms 
[5.341s][info][gc,phases	] GC(0) Other: 0.6ms
[5.341s][info][gc,heap	    ] GC(0) Eden regions: 14-&gt;0(17)
[5.341s][info][gc,heap	    ] GC(0) Survivor regions: 0-&gt;2(2)
[5.342s][info][gc,heap	    ] GC(0) Old regions: 0-&gt;0
[5.342s][info][gc,heap	    ] GC(0) Humongous regions: 0-&gt;0
[5.342s][info][gc,metaspace	] GC(0) Metaspace: 3418K-&gt;3418K(1056768K)
[5.342s][info][gc	        ] GC(0) Pause Young (G1 Evacuation Pause) 14M-&gt;1M(32M) 7.028ms	 
[5.342s][info][gc,cpu	    ] GC(0) User=0.05s Sys=0.00s Real=0.01s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从这个输出中可以看到，堆的最大可用大小为 32MB，系统经历了 1 次GC，为新生代GC，回收的效果是整个堆从 14MB 左右降低到了 1MB。在 JDK 9、JDK 10 中，除了新生代、老年代，还新增了一个巨型区域，即上述输出中的 Humongous regions。</p><p>另外，日志中有详细的时间信息，第一列显示 Java 程序运行的时间，Pause Young (G1 Evacuation Pause) 14M-&gt;1M(32M) 7.028ms 表示新生代垃圾回收花了 7.028ms。</p><p>Pre Evacuate Collection Set、Evacuate Collection Set、Post Evacuate Collection Set、Other 代表 G1 垃圾回收标记—清除算法不同阶段所花费的时间。</p><p>最后一行的时间信息跟 JDK 8 相同，不再赘述。</p><p>如果需要更全面的堆信息，还可以使用参数 -XX:+PrintHeapAtGC（考虑到兼容性，从 JDK 9 开始已经删除此参数，查看堆信息可以使用 VisualVM，第 6 章将会讲述）。它会在每次 GC 前、后分别打印堆的信息，就如同 -XX:+PrintGCDetails 的最后输出一样。下面就是 -XX:+PrintHeapAtGC 的输出样式，限于篇幅，只给出部分输出：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{Heap before GC invocations=8 (full 3):
def new generation total 8576K, used 8575K [0x32680000, 0x32fc0000, 0x33120000)   
 eden space 7680K, 100% used [0x32680000, 0x32e00000z 0x32e00000)
 from space 896K,  99% used [0x32ee0000, 0x32fbffc0z 0x32fc0000)
 to space 896K,  0% used [0x32e00000, 0x32e00000, 0x32ee0000)
tenured generation  total 18880K, used 12353K [0x33120000, 0x34390000, 0x34680000)
省略部分输出
[GC[DefNew: 8575K-&gt;895K(8576K) , 0.0017210 secs] 20929K-&gt;14048K(27456K) , 0.0017756 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
Heap after GC invocations=9 (full 3):
def new generation total 8576K, used 895K [0x32680000, 0x32fc0000, 0x33120000) 
 eden space 7680K,	0% used [0x32680000, 0x32680000, 0x32e00000)
 from space 896K, 99% used [0x32e00000, 0x32edffc0, 0x32ee0000) 
 to space 896K,	0% used [0x32ee0000, 0x32ee0000, 0x32fc0000)
tenured generation total 18880K, used 13152K [0x33120000, 0x34390000, 0x34680000) 
 the space 18880K, 69% used [0x33120000, 0x33df8288, 0x33df8400, 0x34390000) 
省略部分输出
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，在使用 -XX:+PrintHeapAtGC 后，在 GC 日志输出前、后都有详细的堆信息输出，分别表示 GC 回收前和 GC 回收后的堆信息，使用这个参数，可以很好地观察 GC 对堆空间的影响。</p><p>如果需要分析 GC 发生的时间，还可以使用 -XX:+PrintGCTimeStamps（JDK 9、JDK 10 中使用 -Xlog:gc* 已经默认打印出时间，前文关于 -Xlog:gc* 已经有讲述，这里不再赘述）参数，该参数会在每次 GC 时，额外输出 GC 发生的时间，该输出时间为虚拟机启动后的时间偏移量。如下代码表示在系统启动后 0.08s、0.088s、0.094s 发生了 GC。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	0.080: [GC0.080: [DefNew: 4416K-&gt;512K(4928K), 0.0055792 secs] 4416K-&gt;3889K(15872K), 0.0057061 secs] [Times: user=0.00 sys=0.00, real=0.01 secs]
	0.088: [GC0.088: [DefNew: 4928K-&gt;511K(4928K), 0.0044292 secs] 8305K-&gt;7751K(15872K), 0.0045321 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
	0.094: [GC0.094: [DefNew: 4927K-&gt;511K(4928K) , 0.0044136 secs] 0.099: [Tenured: 11238K-&gt;11327K(11328K), 0.0113929 secs] 12167K-&gt;11750K(16256K), [Perm : 142K-&gt; 142K(12288K)], 0.0160228 secs] [Times: user=0.02 sys=0.00, real=0.02 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由于 GC 会引起应用程序停顿，因此还需要特别关注应用程序的执行时间和停顿时间。使用参数 -XX:+PrintGCApplicationConcurrentTime 可以打印应用程序的执行时间，使用参数 -XX:+PrintGCApplicationStoppedTime 可以打印应用程序由于 GC 而产生的停顿时间，如下所示：如果想跟踪系统内的软引用、弱引用、虚引用和 Finallize 队列，可以打开 -XX:+PrintReferenceGC（考虑到兼容性，从 JDK 9 开始已经删除此参数，查看堆信息可以使用 VisualVM，第 6 章将会讲述）开关，结果如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    Application time: 0.0026770 seconds
    Total time for which application threads were stopped: 0.0091600 seconds 
    Application time: 0.0039006 seconds
    Total time for which application threads were stopped: 0.0024330 seconds
    [GC[DefNew[SoftReference, 0 refs, 0.0000212 secs][WeakReference, 7 refs, 0.0000046 secs] [FinalReference, 4 refs, 0.0000056 secs] [PhantomReference, 0 refs, 0.0000036 secs][JNI Weak Reference, 0.0000056 secs]: 2752K-〉320K(3072K), 0.0031630 secs] 2752K-&gt;2574K (992OK) , 0.0031937 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>默认情况下，GC 的日志会在控制台中输出，这不便于后续分析和定位问题。所以，虚拟机允许将 GC 日志以文件的形式输出，可以使用参数 -Xloggc 指定。比如使用参数 -Xloggc:log/gc.log（在 JDK 9、JDK 10 中建议使用 -Xlog:gc:log/gc.log）启动虚拟机，可以在当前目录的 log 文件夹下的 gc.log 文件中记录所有的 GC 日志。图3.1 显示了由 -Xloggc 生成的 gc.log 文件，JDK 9、JDK 10 生成的文件与 JDK 8 相同，不再赘述。</p><p><img src="/assets/图3-1.537ddb0a.jpg" alt="图3-1" loading="lazy"></p><p>图3.1 记录 GC 日志到文件</p><h3 id="_3-1-2-类加载-卸载的跟踪" tabindex="-1"><a class="header-anchor" href="#_3-1-2-类加载-卸载的跟踪" aria-hidden="true">#</a> 3.1.2 类加载 / 卸载的跟踪</h3><p>Java 程序的运行离不开类的加载，为了更好地理解程序如何执行，有时候需要知道系统加载了哪些类。一般情况下，系统加载的类存在于文件系统中，以 jar 的形式打包或者以 class 文件的形式存在，可以直接通过文件系统查看。但是随着动态代理、AOP 等技术的普遍使用，系统也极有可能在运行时动态生成某些类，这些类相对比较隐蔽，无法通过文件系统找到，此时虚拟机提供的类加载 / 卸载跟踪参数就显得格外有意义。</p><p>可以使用参数 -verbose:class 跟踪类的加载 / 卸载，也可以单独使用参数 -XX:+TraceClassLoading（在 JDK 9、JDK 10 中建议使用 -Xlog:class+load=info，跟 JDK 8 中的参数 -XX:+TraceClassLoading 效果相同）跟踪类的加载，使用参数 -XX:+TraceClassUnloading（在 JDK 9、JDK 10 中建议使用 -Xlog:class+unload=info，跟 JDK 8 中的参数 -XX:+TraceClassLoading 效果相同）跟踪类的卸载。这两类参数是等价的。</p><p>【示例 3-1】下面这段代码使用 ASM 动态生成名为 Example 的类，并将其反复加载到系统中（ASM 的使用可以参阅 9.3 节）。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnloadClass</span> <span class="token keyword">implements</span> <span class="token class-name">Opcodes</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">SecurityException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ClassWriter</span> cw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassWriter</span><span class="token punctuation">(</span><span class="token class-name">ClassWriter</span><span class="token punctuation">.</span>COMPUTE_MAXS <span class="token operator">|</span> <span class="token class-name">ClassWriter</span><span class="token punctuation">.</span>COMPUTE_FRAMES<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cw<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>V1_7<span class="token punctuation">,</span> ACC_PUBLIC<span class="token punctuation">,</span> <span class="token string">&quot;Example&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;java/lang/Object&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MethodVisitor</span> mw <span class="token operator">=</span> cw<span class="token punctuation">.</span><span class="token function">visitMethod</span><span class="token punctuation">(</span>ACC_PUBLIC<span class="token punctuation">,</span> <span class="token string">&quot;&lt;init&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;() V&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mw<span class="token punctuation">.</span><span class="token function">visitVarInsn</span><span class="token punctuation">(</span>ALOAD<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mw<span class="token punctuation">.</span><span class="token function">visitMethodInsn</span><span class="token punctuation">(</span>INVOKESPECIAL<span class="token punctuation">,</span> <span class="token string">&quot;java/lang/Object&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;init&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;()V&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mw<span class="token punctuation">.</span><span class="token function">visitInsn</span><span class="token punctuation">(</span>RETURN<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mw<span class="token punctuation">.</span><span class="token function">visitMaxs</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mw<span class="token punctuation">.</span><span class="token function">visitEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mw <span class="token operator">=</span> cw<span class="token punctuation">.</span><span class="token function">visitMethod</span><span class="token punctuation">(</span>ACC_PUBLIC <span class="token operator">+</span> ACC_STATIC<span class="token punctuation">,</span> <span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;([Ljava/lang/String;)V&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mw<span class="token punctuation">.</span><span class="token function">visitFieldInsn</span><span class="token punctuation">(</span>GETSTATIC<span class="token punctuation">,</span> <span class="token string">&quot;java/lang/System&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;out&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Ljava/io/PrintStream;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mw<span class="token punctuation">.</span><span class="token function">visitLdcInsn</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mw<span class="token punctuation">.</span><span class="token function">visitMethodInsn</span><span class="token punctuation">(</span>INVOKEVIRTUAL<span class="token punctuation">,</span> <span class="token string">&quot;java/io/PrintStream&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;println&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;(Ljava/lang/String;)V&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mw<span class="token punctuation">.</span><span class="token function">visitInsn</span><span class="token punctuation">(</span>RETURN<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mw<span class="token punctuation">.</span><span class="token function">visitMaxs</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mw<span class="token punctuation">.</span><span class="token function">visitEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> code <span class="token operator">=</span> cw<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">UnloadClassLoader</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UnloadClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Method</span> m <span class="token operator">=</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">&quot;defineClass&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            m<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            m<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>loader<span class="token punctuation">,</span><span class="token string">&quot;Example&quot;</span><span class="token punctuation">,</span> code<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> code<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
            m<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述代码的第 3 ~ 18 行使用 ASM 生成名为 Example 的类，并将其保存在 code 数组中。第 20 ~ 27 行使用 ClassLoader 将新生成的类反复加载到系统中，每次循环使用新的 ClassLoader 实例，并在循环结束前进行 Full GC，释放上一次循环加载的类，因此，这一过程会涉及类的加载和卸载。</p><p>使用参数 -XX:+TraceClassUnloading 和参数 -XX:+TraceClassLoading 执行上述代码，跟踪类的加载和卸载过程，部分输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Loaded java.lang.Object from shared objects file] 
[Loaded java.io.Serializable from shared objects file] 
[Loaded java.lang.Comparable from shared objects file] 
省略部分输出
[Loaded sun.reflect.DelegatingMethodAccessorImpl from shared objects file]
[Loaded Example from __JVM_DefineClass__]
[Loaded sun.misc.Cleaner from shared objects file]
[Loaded Example from __JVM_DefineClass__] 
[Unloading class Example]
省略部分输出
[Unloading class Example]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从这份日志中可以看到，系统先加载了 java.lang.Object 类，作为所有类的父类。日志的后半部分显示，系统对 Example 类先后进行了 10 次加载和 9 次卸载（最后一次加载的类没有机会被卸载）。</p><p><strong>注意</strong>：动态类的加载是非常隐蔽的，它们由代码逻辑控制，不出现在文件系统中，跟踪这些类需要使用 -XX:+TraceClassLoading 等参数。</p><p>Java 虚拟机还允许研发人员在运行时打印、查看系统中类的分布情况，只要在系统启动时加上 -XX:+PrintClassHistogram 参数，然后在 Java 的控制台中按下 Ctrl + Break 组合键，控制台上就会显示当前的类信息柱状图，如下所示：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>num    #instances    #bytes    classname
------------------------------------------------
1:	       890617	470266000	[B
2:	       890643	 21375432	java.util.HashMap$Node
3:	       890608	 14249728	java.lang.Long
4:	           13	  8389712	[Ljava.util.HashMap$Node;
5:	         2062      371680   [C
6:	          463       41904   java.lang.Class
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过这个柱状图信息，可以看到当前系统中占用空间最大的对象，以及它的实例数量和所占用空间大小。</p><h3 id="_3-1-3-查看系统参数" tabindex="-1"><a class="header-anchor" href="#_3-1-3-查看系统参数" aria-hidden="true">#</a> 3.1.3 查看系统参数</h3><p>由于目前的 Java 虚拟机支持众多的可配参数，不同的参数可能对系统的执行效果有较大的影响，因此有必要明确当前系统的实际运行参数。虚拟机提供了一些手段来帮助研发人员获得这些参数。</p><p>参数 -XX:+PrintVMOptions 可以在程序运行时打印虚拟机接收到的命令行显式参数。其输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>VM option &#39;+PrintVMOptions&#39;
VM option &#39;+UseSerialGC1&#39;
VM option &#39;+DisableExplicitGC&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这说明该虚拟机启动时，命令行明确指定了 UseSerialGC、DisableExplicitGC 两个参数。</p><p>参数 -XX:+PrintCommandLineFlags 可以打印传递给虚拟机的显式和隐式参数，隐式参数未必是通过命令行直接给出的，它可能是在虚拟机启动时自行设置的，使用 -XX:+PrintCommandLineFlags 后，可能的输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	-XX:+DisableExplicitGC -XX:InitialHeapSize=16777216 -XX:MaxHeapSize=268435456 
-XX:+PrintCommanciLineFlags -XX:-UseLargePagesIndividualAllocation -XX:+UseSerialGC
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>在本例中，-XX:InitialHeapSize、-XX:MaxHeapSize 和 -XX:-UseLargePagesIndividualAllocation 并未在命令行显式指定，是由虚拟机自行设置的。</p><p>此外，另一个有用的参数是 -XX:+PrintFlagsFinal，它会打印所有的系统参数的值。开启这个参数后，虚拟机可能会产生 500 多行输出，每一行为一个配置参数及其当前取值，读者如果对虚拟机的各参数感兴趣，可以打印出这些参数，逐个学习。</p><h2 id="_3-2-让性能飞起来-学习堆的配置参数" tabindex="-1"><a class="header-anchor" href="#_3-2-让性能飞起来-学习堆的配置参数" aria-hidden="true">#</a> 3.2 让性能飞起来：学习堆的配置参数</h2><p>堆是 Java 进程的重要组成部分，几乎所有与应用相关的内存空间都和堆有关。本节将主要介绍与堆有关的参数设置，这些参数可以说是 Java 虚拟机中最重要的，也是对程序性能有着重要影响的。</p><h3 id="_3-2-1-最大堆和初始堆的设置" tabindex="-1"><a class="header-anchor" href="#_3-2-1-最大堆和初始堆的设置" aria-hidden="true">#</a> 3.2.1 最大堆和初始堆的设置</h3><p>当 Java 进程启动时，虚拟机就会分配一块初始堆空间，可以使用参数 -Xms 指定这块空间的大小。一般来说，虚拟机会尽可能维持在初始堆空间的范围内运行。但是如果初始堆空间耗尽，虚拟机将会对堆空间进行扩展，其扩展上限为最大堆空间，最大堆空间可以使用参数 -Xmx 指定。</p><p>【示例 3-2】下面通过一个简单的示例，说明最大堆、初始堆和系统可用内存的含义，以及它们彼此之间的关系。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HeapAlloc</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;maxMemory=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">maxMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; bytes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;free mem=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">freeMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; bytes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;total mem=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">totalMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; bytes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;分配了 1MB 空间给数组&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;maxMemory=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">maxMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; bytes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;free mem=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">freeMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; bytes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;total mem=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">totalMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; bytes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;分配了 4MB 空间给数组&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;maxMemory=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">maxMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; bytes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;free mem=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">freeMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; bytes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;total mem=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">totalMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; bytes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述代码首先在第 3 ~ 8 行打印了基本的系统信息，包括最大可用内存、当前空闲内存和当前总内存。然后，在第 10 行申请了 1MB 内存空间，显然，这块空间将在堆上分配。在第 13 ~ 18 行，同样打印了最大可用内存、当前空闲内存和当前总内存。接着，在第 20 行再次申请了 4MB 内存空间。最后，同样打印了 3 个参数。</p><p>根据前文很容易想到，这里的最大可用内存就是 -Xmx 的取值，当前总内存应该不小于 -Xms 的取值，因为当前总内存总是在 -Xms 和 -Xmx 之间，从 -Xms 开始根据需要向上增长。当前空闲内存应该是当前总内存减去当前已经使用的内存。</p><p>这样理解差不多是正确的，之所以使用 “差不多” 一词，是因为这样理解并不是十分全面的。使用如下参数执行程序，很快就能发现偏差。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-Xmx20m -Xms5m -XX:+PrintCommandLineFlags -XX:+PrintGCDetails -XX:+UseSerialGC
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>程序的输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	-XX:InitialHeapSize=5242880 -XX:MaxHeapSize=20971520 -XX:+PrintCommandLineFlags 
-XX:+PrintGCDetails -XX:+UseCompressedOops -XX:-UseLargePagesIndividualAllocation -XX:+UseSerialGC 
    maxMemory=20316160 bytes
    free mem=4553832 bytes
    total mem=5111808 bytes
    [GC[DefNew: 544K-&gt;128K(1536K), 0.0011590 secs] 544K-&gt;377(4992K), 0.0012395 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
    分配了 1MB 空间给数组
    maxMemory=20316160 bytes
    free mem=3619072 bytes
    total mem=5111808 bytes
	[GC[DefNew: 1208K-&gt;0K(1536K), 0.0010289 secs][Tenured: 1401K-&gt;1401K(3456K), 0.0030155 secs] 1457K-&gt;1401K(4992K), [Perm : 143K-&gt;143K(1288K)], 0.0041523 secs] [Times: user=0.02 sys=0.00, real=0.01 secs] 
    分配了 4MB 空间给数组
    maxMemory=20316160 bytes
    free mem=3795728 bytes
    total mem=9441280 bytes
	Heap
 def new generation   total 1664K, used 46K [0x332800000, 0x33440000, 0x33920000)
  eden space 1536K,   3% used [0x332800000, 0x3328ba68, 0x33400000)
  from space 128K,   0% used [0x33400000, 0x33400000, 0x33420000)
  to   space 128K,   0% used [0x33420000, 0x33420000, 0x33440000)
 tenured generation   total 7556K, used 5497K [0x33920000, 0x34081000, 0x346800000)
   the space 7556K,  72% used [0x33920000, 0x33e7e5d0, 0x33e7e600, 0x34081000)
 compacting perm gen  total 12288K, used 143K [0x346800000, 0x35280000, 0x38680000)
   the space 12288K,   1% used [0x34680000, 0x346a3db0, 0x346a3e00, 0x35280000)
    ro space 10240K,  44% used [0x38680000, 0x38af73f0, 0x38af7400, 0x39080000)
    rw space 12288K,  52% used [0x39080000, 0x396cdd28, 0x396cde00, 0x39c80000)
No shared spaces configured.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，当前最大内存由 -XX:MaxHeapSize=20971520 指定，它正好是 20 × 1024 × 1024 = 20971520 字节。而打印的最大可用内存仅为 20316160 字节，比设定值略少。这是因为分配给堆的内存空间和实际可用内存空间并非一个概念。由于垃圾回收的需要，虚拟机会对堆空间进行分区管理，不同的区采用不同的回收算法，一些算法会使用空间换时间的策略，因此会存在可用内存的损失，详细算法可以参见 4.2.3 节，这里不展开讨论。最终的结果就是实际可用内存会浪费大小等于 from / to 的空间。因此，实际最大可用内存为 -Xmx 的值减去 from 的值。从堆的详细信息可以看到，0x33420000 - 0x33400000 = 0x20000 = 131072 字节。但很不幸，读者应该会发现 20971520 - 131072 = 20840448 字节，与实际值 20316160 依然存在偏差。出现这个偏差是因为虚拟机内部并没有直接使用新生代 from / to 的大小，而是进一步对它们做了对齐操作。对于串行 GC 的情况，虚拟机使用以下方法估算 from / to 的大小，并进行对齐。</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">align_size_down_</span><span class="token expression"><span class="token punctuation">(</span>size<span class="token punctuation">,</span> alignment<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token punctuation">(</span>alignment<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">inline</span> <span class="token class-name">intptr_t</span> <span class="token function">align_size_down</span><span class="token punctuation">(</span><span class="token class-name">intptr_t</span> size<span class="token punctuation">,</span> <span class="token class-name">intptr_t</span> alignment<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">return</span> <span class="token function">align_size_down_</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> alignment<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">size_t</span> <span class="token function">compute_survivor_size</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> gen_size<span class="token punctuation">,</span> <span class="token class-name">size_t</span> alignment<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
  <span class="token class-name">size_t</span> n <span class="token operator">=</span> gen_size <span class="token operator">/</span> <span class="token punctuation">(</span>SurvivorRatio <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> n <span class="token operator">&gt;</span> alignment <span class="token operator">?</span> <span class="token function">align_size_down</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> alignment<span class="token punctuation">)</span> <span class="token operator">:</span> alignment<span class="token punctuation">;</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述代码中的 alignment 变量在非 ARM 平台上为 1 &lt;&lt; 16，即 2<sup>16</sup>，参数 gen_size 表示新生代的总大小，SurvivorRatio 默认值为 8，表示幸存代的比例。在本例中，使用 compute_survivor_size 估算并对齐后的 from / to 区间大小为：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>n</mtext><mo>=</mo><mtext>gensize</mtext><mtext> </mtext><mi mathvariant="normal">/</mi><mtext> </mtext><mo stretchy="false">(</mo><mtext>SurvivorRatio</mtext><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo><mo>=</mo><mn>6946816</mn><mtext> </mtext><mi mathvariant="normal">/</mi><mtext> </mtext><mn>10</mn><mo>=</mo><mn>694681</mn><mspace linebreak="newline"></mspace><mo stretchy="false">(</mo><mtext>size</mtext><mo stretchy="false">)</mo><mtext> </mtext><mo>&amp;</mo><mtext> </mtext><mtext>-</mtext><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>alignment</mtext><mo stretchy="false">)</mo><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mn>694681</mn><mtext> </mtext><mo>&amp;</mo><mo>∽</mo><mo stretchy="false">(</mo><msup><mn>2</mn><mn>16</mn></msup><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mo>=</mo><mtext>0xA9999</mtext><mtext> </mtext><mo>&amp;</mo><mtext> </mtext><mtext>0xFFFFFFFFFFFE0000</mtext><mo>=</mo><mtext>0xA0000</mtext><mo>=</mo><mn>655360</mn></mrow><annotation encoding="application/x-tex">\text{n} = \text{gensize} \,/\, (\text{SurvivorRatio} + 2) = 6946816 \,/\, 10=694681 \\ (\text{size}) \,\And\, \text{-}((\text{alignment}) - 1) = 694681 \,\And \backsim(2^{16}-1) \\ =\text{0xA9999} \,\And\, \text{0xFFFFFFFFFFFE0000} = \text{0xA0000} = 655360 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord text"><span class="mord">n</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">gensize</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">/</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">SurvivorRatio</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">6946816</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">/</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">10</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">694681</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">size</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">&amp;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">-</span></span><span class="mopen">((</span><span class="mord text"><span class="mord">alignment</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">694681</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">&amp;</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">∽</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">16</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord text"><span class="mord">0xA9999</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">&amp;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">0xFFFFFFFFFFFE0000</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">0xA0000</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">655360</span></span></span></span></span></p><p>用 20971520 减去 655360，得出实际可用最大堆空间为 20316160 字节，与输出值吻合。这可以解释实际可用堆大小与- Xmx 配置值之间的偏差。</p><p>打印显示，程序运行初期空闲内存约为 4.5MB，总内存约为 5MB。在进行了 1MB 内存分配后，最大可用内存不变（理论上它永远不变），总内存依然为 5MB，而空闲内存约为 3.5MB，这与分配了 1MB 内存有关。之后，程序申请了 4MB 内存，由于剩余可用内存已经不能满足需要，因此堆空间进行了扩展，扩展后总内存约为 10MB，空闲内存约为 3.5MB。</p><p><strong>提示</strong>：在实际工作中，也可以直接将初始堆 -Xms 与最大堆 -Xmx 设置为相等。这样的好处是，可以减少程序运行时进行垃圾回收的次数，从而提高程序的性能。</p><h3 id="_3-2-2-新生代的配置" tabindex="-1"><a class="header-anchor" href="#_3-2-2-新生代的配置" aria-hidden="true">#</a> 3.2.2 新生代的配置</h3><p>参数 -Xmn 可以用于设置新生代的大小。设置一个较大的新生代会减小老年代的大小，这个参数对系统性能及 GC 行为有很大的影响。新生代的大小一般设置为整个堆空间的 1/3 到 1/4。</p><p>参数 -XX:SurvivorRatio 用来设置新生代中 eden 区和 from / to 区的比例，它的含义如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-XX:SurvivorRatio=eden/from=eden/to
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>【示例 3-3】考察以下这段简单的 Java 程序，它连续向系统请求 10MB 空间（每次申请 1MB）。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NewSizeDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用不同的堆分配参数执行这段程序，因为虚拟机的表现受到堆空间分配的影响，所以运行过程不尽相同。下面分别使用不同的参数执行，读者可以一起来实战演习。</p><p>（1）使用 -Xmx20m -Xms20m -Xmn1m -XX:SurvivorRatio=2 -XX:+PrintGCDetails 运行上述 Java 程序，输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[GC[DefNew: 512K-&gt;256K(768K), 0.0013368 secs] 512K-&gt;370K(20224K), 0.0013772 secs] [Times: user=0.02 sys=0.00, real=0.00 secs]
Heap
 def new generation total 768K, used 303K [0x33060000, 0x33160000, 0x33160000) 
  eden space 512K,	9% used [0x33060000, 0x3306bfb0, 0x330e0000)
  from space 256K, 100% used [0x33120000, 0x33160000, 0x33160000)
  to   space 256K, 0% used [0x330e0000, 0x330e0000, 0x33120000)
 tenured generation total 19456K,used 10354K [0x33160000, 0x34460000, 0x34460000)
  the space 256K, 0% used [0x33160000, 0x33b7c9f0, 0x33b7ca00, 0x34460000)
 compacting perm gen total 12288K,used 142K [0x34460000, 0x35060000, 0x38460000)
  the space 12288K, 1% used [0x34460000, 0x34483a90, 0x34483c00, 0x35060000)
   ro space 10240K, 44% used [0x38460000, 0x388d73f0, 0x388d7400, 0x38e60000)
   rw space 12288K, 52% used [0x38e60000, 0x394add28, 0x394ade00, 0x39a60000)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里 eden 区与 from 区的比值为 2∶1，故 eden 区为 512KB。总可用新生代大小为 512KB + 256KB= 768KB，新生代总大小为 512KB + 256KB + 256KB = 1024KB = 1MB。由于 eden 区无法容纳任何一个程序中分配的 1MB 数组，故触发了一次新生代 GC，对 eden 区进行了部分回收。同时，这个偏小的新生代无法为 1MB 数组预留空间，故所有的数组都分配在老年代，老年代最终占用 10354KB 空间。</p><p>（2）使用参数 -Xmx20m -Xms20m -Xmn7m -XX:SurvivorRatio=2 -XX:+PrintGCDetails 运行上述程序，将新生代扩大为 7MB，则输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[GC[DefNew: 2583K-&gt;1401K(5376K), 0.0015520 secs] 2583K-&gt;1401K(18688K), 0.0015898 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[GC[DefNew: 4588K-&gt;1024K(5376K), 0.0011594 secs] 4588K-&gt;1401K(18688K), 0.0011865 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[GC[DefNew: 4124K-&gt;1024K(5376K), 0.0005396 secs] 4501K-&gt;1401K(18688K), 0.0005681 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
Heap
 def new generation total 5376K, used 3162K [0x33060000, 0x33760000, 0x33760000) 
  eden space 3584K,	59% used [0x33060000, 0x33276960, 0x333e0000)
  from space 1792K, 57% used [0x335a0000, 0x336a0010, 0x33760000)
  to   space 1792K, 0% used [0x333e0000, 0x333e0000, 0x335a0000)
 tenured generation total 13312K,used 377K [0x33760000, 0x34460000, 0x34460000)
  the space 13312K, 2% used [0x33760000, 0x337be5a8, 0x337be600, 0x34460000)
 compacting perm gen total 12288K,used 142K [0x34460000, 0x35060000, 0x38460000)
  the space 12288K, 1% used [0x34460000, 0x34483a90, 0x34483c00, 0x35060000)
   ro space 10240K, 44% used [0x38460000, 0x388d73f0, 0x388d7400, 0x38e60000)
   rw space 12288K, 52% used [0x38e60000, 0x394add28, 0x394ade00, 0x39a60000)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个参数下，由于 eden 区有足够的空间，因此所有的数组都分配在 eden 区。但 eden 区并不足以预留 10MB 的空间，故在程序运行期间出现了 3 次新生代 GC。由于每申请一次空间，同时也废弃了上一次申请的空间（上一次申请的内存失去了引用），故在新生代 GC 中，有效回收了这些失效的内存。最终结果是：所有的内存分配都在新生代进行，通过 GC 保证了新生代有足够的空间，而老年代没有为这些数组预留任何空间，只是在 GC 过程中，部分新生代对象晋升到老年代。</p><p>(3) 使用参数 -Xmx20m -Xms20m -Xmn15m -XX:SurvivorRatio=8 -XX:+PrintGCDetails 运行上述程序，输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Heap
 def new generation total 13824K, used 11223K [0x33060000, 0x33f60000, 0x33f60000) 
  eden space 12288K, 91% used [0x33060000, 0x33b55f40, 0x33c60000)
  from space 1536K, 0% used [0x33c60000, 0x33c60010, 0x33de0000)
  to   space 1536K, 0% used [0x33de0000, 0x33de0000, 0x33f60000)
 tenured generation total 13312K,used 0K [0x33f60000, 0x34460000, 0x34460000)
  the space 5120K, 0% used [0x33f60000, 0x33f60000, 0x33f60000, 0x34460000)
 compacting perm gen total 12288K,used 142K [0x34460000, 0x35060000, 0x38460000)
  the space 12288K, 1% used [0x34460000, 0x34483a90, 0x34483c00, 0x35060000)
   ro space 10240K, 44% used [0x38460000, 0x388d73f0, 0x388d7400, 0x38e60000)
   rw space 12288K, 52% used [0x38e60000, 0x394add28, 0x394ade00, 0x39a60000)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这次执行中，由于新生代使用 15MB 空间，其中 eden 区占用了 12288KB，完全满足 10MB 数组的分配，因此所有的分配行为都在 eden 区直接进行，且没有触发任何 GC 行为。因此 from / to 和老年代 tenured 的使用率都为 0。</p><p>由此可见，不同的堆分布情况对系统会产生一定影响。在实际工作中，应该根据系统的特点做合理的设置，基本策略是：尽可能将对象预留在新生代，减少老年代 GC 的次数（本例中的第一种情况，对象都分配在老年代，显然为后续的老年代 GC 埋下了伏笔）。</p><p>除了可以使用参数 -Xmn 指定新生代的绝对大小，还可以使用参数 -XX:NewRatio 来设置新生代和老年代的比例，如下所示：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-XX:NewRatio=老年代/新生代
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>(4) 使用参数 -Xmx20m -Xms20m -XX:NewRatio=2 -XX:+PrintGCDetails 运行上述代码，输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[GC[DefNew: 4647K-&gt;377K(6144K), 0.0016252 secs] 4647K-&gt;1401K(19840K), 0.0016728 secs] [Times: user=0.02 sys=0.00, real=0.00 secs]
[GC[DefNew: 5669K-&gt;0K(6144K), 0.0011792 secs] 6693K-&gt;2425K(19840K), 0.0012087 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
Heap
 def new generation total 6144K, used 1134K [0x33060000, 0x33700000, 0x33700000) 
  eden space 5504K,	20% used [0x33060000, 0x3317b8c8, 0x335c0000)
  from space 640K, 0% used [0x335c0000, 0x335c0088, 0x33660000)
  to   space 640K, 0% used [0x33660000, 0x33660000, 0x33700000)
 tenured generation total 13696K,used 2425K [0x33700000, 0x34460000, 0x34460000)
  the space 13696K, 17% used [0x33760000, 0x3395e540, 0x3395e600, 0x34460000)
 compacting perm gen total 12288K,used 142K [0x34460000, 0x35060000, 0x38460000)
  the space 12288K, 1% used [0x34460000, 0x34483a90, 0x34483c00, 0x35060000)
   ro space 10240K, 44% used [0x38460000, 0x388d73f0, 0x388d7400, 0x38e60000)
   rw space 12288K, 52% used [0x38e60000, 0x394add28, 0x394ade00, 0x39a60000)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时，因为堆大小为 20MB，新生代和老年代的比为 1：2，故新生代大小为 20MB x 1/3 = 7MB，老年代为 13MB。由于在新生代 GC 时，from / to 空间不足以容纳任何一个 1MB 数组，影响了新生代的正常回收，故在新生代回收时需要老年代进行空间担保。这导致两个 1MB 数组进入老年代（在新生代 GC 时，尚有 1MB 数组幸存，理应进入 from / to，而 from / to 只有 640KB，不足以容纳）。</p><p><strong>注意</strong>：-XX:SurvivorRatio 可以设置 eden 区与 survivor 的比例。-XX:NewRatio 可以设置老年代与新生代的比例。</p><p>图3.2 显示了几个重要的堆分配参数的含义。</p><p><img src="/assets/图3-2.e4a423c9.jpg" alt="图3-2" loading="lazy"></p><p>图3.2 堆分配参数示意图</p><h3 id="_3-2-3-堆溢出处理" tabindex="-1"><a class="header-anchor" href="#_3-2-3-堆溢出处理" aria-hidden="true">#</a> 3.2.3 堆溢出处理</h3><p>在 Java 程序的运行过程中，如果堆空间不足，则有可能抛出内存溢出错误，简称 OOM（Out Of Memory）。如下文字显示了典型的堆内存溢出：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space 
	at geym.zbase.ch3.heap.DumpOOM.main(DumpOOM.java:20)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>一旦发生这类问题，系统就会被迫退出。如果发生在生产环境，可能会引起严重的业务中断。为了能够不断改善系统，避免或减少这类错误发生，需要在发生错误时，获得尽可能多的现场，以帮助研发人员排查问题。Java 虚拟机提供了参数 -XX:+HeapDumpOnOutOfMemoryError，可以在内存溢出时导出整个堆的信息。和它配合使用的还有 -XX:HeapDumpPath，可以指定导出堆的存放路径。</p><p>【示例 3-4】以下代码合计分配了 25MB 内存空间。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DumpOOM</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Vector</span> v <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">25</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            v<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用如下参数执行上述代码：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-Xmx20m -Xms5m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=d:/a.dump
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>显然，20MB 堆空间不能满足 25MB 内存需求，系统发生内存溢出。在发生错误后，控制台输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>java.lang.OutOfMemoryError: Java heap space
Dumping heap to d:/a.dump ...
Heap dump file created [23067302 bytes in 0.160 secs]
Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space 
	at geym.zbase.ch3.heap.DumpOOM.main(DumpOOM.java:19)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，虚拟机将当前的堆信息导出，并保存到 D:/a.dump 文件。使用 MAT 等工具打开该文件进行分析，如图3.3 所示，可以很容易地找到这些 byte 数组和保存它们的 Vector 对象实例。有关 MAT 等工具的使用方法，可以参阅第 7 章。</p><p><img src="/assets/图3-3.567d507c.jpg" alt="图3-3" loading="lazy"></p><p>图3.3 MAT 查看堆文件</p><p>除了在发生 OOM 时可以导出堆信息，虚拟机还允许在发生错误时执行一个脚本文件。该文件可以用于崩溃的程序的自救、报警或者通知，也可以帮助开发人员获得更多的系统信息，如完整的线程转存（即 Thread Dump 或者 Core Dump）文件。</p><p>这里给出一个在发生 OOM 时导出线程转存的例子。准备 printstack.bat 脚本如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:/tools/jdk1.7_40/bin/jstack -F %1 &gt; D:/a.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>以上脚本将会导出给定 Java 虚拟机进程的线程信息，并保存在 D:/a.txt 文件中。</p><p>使用如下参数执行上述代码：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-Xmx20m -Xms5m &quot;-XX:OnOutOfMemoryError=D:/tools/jdk1.7_40/bin/printstack.bat %p&quot; 
-XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=d:/a.dump
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>在程序异常退出时，系统 D 盘会生成新文件 a.txt，里面保存着线程转存信息。本例中，文件路径 &quot;D:/tools/jdk1.7_40” 为笔者的 JDK 安装目录，读者可以替换成自己的 JAVA_HOME 目录进行尝试。</p><h2 id="_3-3-别让性能有缺口-了解非堆内存的参数配置" tabindex="-1"><a class="header-anchor" href="#_3-3-别让性能有缺口-了解非堆内存的参数配置" aria-hidden="true">#</a> 3.3 别让性能有缺口：了解非堆内存的参数配置</h2><p>除了堆内存，虚拟机还有一些内存用于方法区、线程栈和直接内存。它们与堆内存是相对独立的。与堆内存相比，虽然这些内存空间和应用程序本身的关系可能不那么密切，但是从系统层面看，有效、合理地配置这些内存参数，对系统的性能和稳定性也有着重要作用。</p><h3 id="_3-3-1-方法区配置" tabindex="-1"><a class="header-anchor" href="#_3-3-1-方法区配置" aria-hidden="true">#</a> 3.3.1 方法区配置</h3><p>方法区主要存放类的元信息。</p><p>在 JDK 1.6 和 JDK 1.7 等版本中，可以使用 -XX:PermSize 和 -XX:MaxPermSize 配置永久区大小。其中，-XX:PermSize 表示初始的永久区大小，-XX:MaxPermSize 表示最大永久区大小。</p><p>从 JDK 1.8 开始，永久区被彻底移除，使用了新的元数据区存放类的元数据。在默认情况下，元数据区只受系统可用内存的限制，但依然可以使用参 -XX:MaxMetaspaceSize 指定永久区的最大可用值。方法区的详细使用和配置可以参考 2.5 节。</p><h3 id="_3-3-2-栈配置" tabindex="-1"><a class="header-anchor" href="#_3-3-2-栈配置" aria-hidden="true">#</a> 3.3.2 栈配置</h3><p>栈是每个线程私有的内存空间。在 Java 虚拟机中可以使用 -Xss 参数指定线程的栈大小。由于在 2.4 节中己经详细介绍了栈的配置和使用，这里不再展开。</p><h3 id="_3-3-3-直接内存配置" tabindex="-1"><a class="header-anchor" href="#_3-3-3-直接内存配置" aria-hidden="true">#</a> 3.3.3 直接内存配置</h3><p>直接内存也是 Java 程序中非常重要的组成部分，特别是在 NIO 被广泛使用后，直接内存的使用也变得非常普遍。直接内存跳过了 Java 堆，使 Java 程序可以直接访问原生堆空间。因此，从一定程度上加快了内存空间的访问速度。但是，武断地认为使用直接内存一定可以提高内存访问速度也是不正确的。</p><p>最大可用直接内存可以使用参数 -XX:MaxDirectMemorySize 设置，如果不设置，默认值为最大堆空间，即 -Xmx 的值。当直接内存使用量达到 -XX:MaxDirectMemorySize 时，就会触发垃圾回收，如果垃圾回收不能有效释放足够的空间，直接内存溢出依然会引起系统的 OOM。</p><p>【示例 3-5】一般来说，直接内存的访问速度（读或者写）比堆内存快。下面的代码统计了直接内存和堆内存的读写速度。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccessDirectBuffer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">directAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> starttime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ByteBuffer</span> b <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocateDirect</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">99</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
                b<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
            b<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">99</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
                b<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            b<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> endtime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;testDirectWrite:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endtime <span class="token operator">-</span> starttime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bufferAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> starttime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ByteBuffer</span> b <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">99</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
                b<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
            b<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">99</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
                b<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            b<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> endtime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;testBufferWrite:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endtime <span class="token operator">-</span> starttime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">AccessDirectBuffer</span> alloc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AccessDirectBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        alloc<span class="token punctuation">.</span><span class="token function">bufferAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        alloc<span class="token punctuation">.</span><span class="token function">directAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        alloc<span class="token punctuation">.</span><span class="token function">bufferAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        alloc<span class="token punctuation">.</span><span class="token function">directAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述代码中，使用 bufferAccess() 方法进行堆内存读写，并进行耗时统计，使用 directAccess() 方法对直接内存进行读写，并进行耗时统计。在笔者的计算机上，上述代码输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>testBufferWrite:414 
testDirectWrite:232
testBufferWrite:398
testDirectWrite:238
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在程序中，对 bufferAccess() 和 directAccess() 方法分别进行了两次调用，第一次视为热身代码，这里忽略其输出，我们只关注第 2 次调用的输出结果。从结果可以看出，直接内存的访问速度比堆内存快约 40%。若使用 -server 参数执行上述代码（笔者的环境中默认为 -client 模式），输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>testBufferWrite:95
testDirectWrite:35
testBufferWrite:101
testDirectWrite:13
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，直接内存被 Server 优化后，比堆内存的访问速度提升了将近一个数量级。</p><p>虽然在访问读写上直接内存有较大的优势，但是在内存空间申请时，直接内存毫无优势可言。看以下代码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AllocDirectBuffer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">directAllocate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> starttime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">200000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ByteBuffer</span> b <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocateDirect</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> endtime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;directAllocate:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endtime <span class="token operator">-</span> starttime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bufferAllocate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> starttime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">200000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ByteBuffer</span> b <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> endtime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;bufferAllocate:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endtime <span class="token operator">-</span> starttime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">AllocDirectBuffer</span> alloc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AllocDirectBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        alloc<span class="token punctuation">.</span><span class="token function">bufferAllocate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        alloc<span class="token punctuation">.</span><span class="token function">directAllocate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        alloc<span class="token punctuation">.</span><span class="token function">bufferAllocate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        alloc<span class="token punctuation">.</span><span class="token function">directAllocate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在笔者的环境中，其执行结果如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>bufferAllocate:68
directAllocate:306
bufferAllocate:89
directAllocate:279
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，在申请内存空间时，堆空间的速度远远快于直接内存。</p><p>由此可以得出结论：直接内存适合申请次数较少、访问较频繁的场合。如果需要频繁申请内存空间，则并不适合使用直接内存。</p><h2 id="_3-4-client-和-server-二选一-虚拟机的工作模式" tabindex="-1"><a class="header-anchor" href="#_3-4-client-和-server-二选一-虚拟机的工作模式" aria-hidden="true">#</a> 3.4 Client 和 Server 二选一：虚拟机的工作模式</h2><p>目前 Java 虚拟机支持 Client 和 Server 两种运行模式。使用参数 -client 可以指定使用 Client 模式，使用参数 -server 可以指定使用 Server 模式。在默认情况下，虚拟机会根据当前计算机系统环境自动选择运行模式。使用 -version 参数可以查看当前模式，如下所示：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>./java -version
java version &quot;1.7.0_40&quot;
Java(TM) SE Runtime Environment (build 1.7.0_40-b43)
Java HotSpot(TM) Client VM (build 24.0-b56, mixed mode, sharing)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用 -server 参数后，就可以得到如下输出：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>./java -server -version
java version &quot;1.7.0_40&quot;
Java(TM) SE Runtime Environment (build 1.7.0_40-b43)
Java HotSpot(TM) Server VM (build 24.0-b56, mixed mode)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>与 Client 模式相比，Server 模式的启动比较慢，因为 Server 模式会尝试收集更多的系统性能信息，使用更复杂的优化算法对程序进行优化。因此，当系统完全启动并进入运行稳定期后，Server 模式的执行速度会远远快于 Client 模式。所以，对于后台长期运行的系统来说；使用 -server 参数启动对系统的整体性能可以有不小的帮助。但对于用户界面程序而言，运行时间不长，又追求启动速度，Client 模式也是不错的选择。</p><p>从发展趋势上看，未来 64 位系统必然会逐步取代 32 位系统，而在 64 位系统中虚拟机更倾向于使用 Server 模式。</p><p>虚拟机在 Server 模式和 Client 模式下的各种参数可能会有很大的不同，读者如果需要查看给定参数的默认值，可以使用 -XX:+PrintFlagsFinal 参数。这里以 JIT 编译阈值和最大堆为例，展示 Client 模式和 Server 模式的区别。</p><p>对于 Client 模式，参数如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>./java -XX:+PrintFlagsFinal -client -version | grep -E &#39; CompileThreshold| MaxHeapSize&#39;
	intx CompileThreshold = 1500 {pd product}
	uintx MaxHeapSize:= 268435456 {product}
java version &quot;1.7.0_40&quot;
Java(TM) SE Runtime Environment (build 1.7.0_40-b43)
Java HotSpot(TM) Client VM (build 24.0-b56, mixed mode, sharing)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对于Server模式，参数如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>./java -XX:+PrintFlagsFinal -server -version | grep -E &#39; CompileThreshold| MaxHeapSize&#39;
	intx CompileThreshold = 10000 {pd product}
	uintx MaxHeapSize:= 1073741824 {product}
java version &quot;1.7.0_40&quot;
Java(TM) SE Runtime Environment (build 1.7.0_40-b43)
Java HotSpot(TM) Server VM (build 24.0-b56, mixed mode)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，在 Client 模式下，CompileThreshold 的默认值为 1500，即函数被调用 1500 次后，会进行 JIT 编译（有关 JIT 编译的更多细节请参阅第 11 章）。而在 Server 模式下，这个数值为 10000。因此，在 Server 模式下系统更有可能解释执行。而一旦进行编译，Server 模式的优化效果会好于 Client 模式。对于系统最大堆，在 Client 模式下为约 256MB，而在 Server 模式下约为 1GB。至于其他参数，读者可以使用类似的方式进行比较。</p><h2 id="_3-5-小结" tabindex="-1"><a class="header-anchor" href="#_3-5-小结" aria-hidden="true">#</a> 3.5 小结</h2><p>本章主要介绍了一些常用的 Java 虚拟机参数，如垃圾回收跟踪参数、类加载跟踪参数等。同时也详细介绍了堆空间的配置方法及方法区、Java 栈和直接内存配置。此外，还介绍了系统发生内存溢出后的信息获取和补救方法。最后，简要介绍了虚拟机的 Server 和 Client 运行模式。</p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://gitee.com/anansneaker/vuepress-theme-hope/edit/master/docs/reading-notes/实战Java虚拟机：JVM故障诊断与性能优化/第3章常用Java虚拟机参数.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/8/6 下午5:11:40</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: cl55563@163.com">阿楠sneaker</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC2%E7%AB%A0%E8%AE%A4%E8%AF%86Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84.html" class="nav-link prev" aria-label="第 2 章 认识 Java 虚拟机的基本结构"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->第 2 章 认识 Java 虚拟机的基本结构</div></a><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC4%E7%AB%A0%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9A%84%E6%A6%82%E5%BF%B5%E4%B8%8E%E7%AE%97%E6%B3%95.html" class="nav-link next" aria-label="第 4 章 垃圾回收的概念与算法"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">第 4 章 垃圾回收的概念与算法<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"></div><div class="copyright">Copyright © 2022 阿楠sneaker</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.0d56c066.js" defer></script>
  </body>
</html>
