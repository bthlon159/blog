<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.48" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://www.cxlsn.cn/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html"><meta property="og:site_name" content="MyBlog"><meta property="og:title" content="第 6 章 性能监控工具"><meta property="og:type" content="article"><meta property="og:image" content="https://www.cxlsn.cn/"><meta property="og:updated_time" content="2022-08-16T11:56:17.000Z"><meta property="og:locale" content="zh-CN"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="第 6 章 性能监控工具"><meta property="article:modified_time" content="2022-08-16T11:56:17.000Z"><title>第 6 章 性能监控工具 | MyBlog</title><meta name="description" content="MyBlog">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.09a441ee.css">
    <link rel="modulepreload" href="/assets/app.0d56c066.js"><link rel="modulepreload" href="/assets/第6章性能监控工具.html.e9ce7787.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/assets/第6章性能监控工具.html.d9178ab7.js"><link rel="prefetch" href="/assets/index.html.18f6ed2e.js"><link rel="prefetch" href="/assets/home.html.32fca429.js"><link rel="prefetch" href="/assets/slide.html.a293c482.js"><link rel="prefetch" href="/assets/index.html.bcf51f43.js"><link rel="prefetch" href="/assets/index.html.3768ee5f.js"><link rel="prefetch" href="/assets/index.html.b7a9ea16.js"><link rel="prefetch" href="/assets/第10章 异常.html.33f3792f.js"><link rel="prefetch" href="/assets/第11章 并发.html.41f89aa7.js"><link rel="prefetch" href="/assets/第12章 序列化.html.08c4c0cc.js"><link rel="prefetch" href="/assets/第2章 创建和销毁对象.html.1b6f55e3.js"><link rel="prefetch" href="/assets/第3章 对于所有对象都通用的方法.html.e81922f0.js"><link rel="prefetch" href="/assets/第4章 类和接口.html.bbf64366.js"><link rel="prefetch" href="/assets/第5章 泛型.html.053306ed.js"><link rel="prefetch" href="/assets/第6章 枚举和注解.html.cb21ea0d.js"><link rel="prefetch" href="/assets/第7章 Lambda和Stream.html.664c81b8.js"><link rel="prefetch" href="/assets/第8章 方法.html.bfc52ab1.js"><link rel="prefetch" href="/assets/第9章 通用编程.html.6a1d88a2.js"><link rel="prefetch" href="/assets/index.html.153be5a1.js"><link rel="prefetch" href="/assets/index.html.4b079bc8.js"><link rel="prefetch" href="/assets/第1章Java多线程技能.html.f4c43a60.js"><link rel="prefetch" href="/assets/第2章对象及变量的并发访问.html.24971a2d.js"><link rel="prefetch" href="/assets/第3章线程间通信.html.e9963ba8.js"><link rel="prefetch" href="/assets/第4章锁的使用.html.bc309d92.js"><link rel="prefetch" href="/assets/第5章定时器.html.aaf2b6ee.js"><link rel="prefetch" href="/assets/第6章单例模式与多线程.html.a87eb20f.js"><link rel="prefetch" href="/assets/第7章拾遗增补.html.2cbb6898.js"><link rel="prefetch" href="/assets/第8章并发集合框架.html.1739cc6b.js"><link rel="prefetch" href="/assets/第9章线程池ThreadPoolExecutor的使用.html.186199c8.js"><link rel="prefetch" href="/assets/index.html.62274579.js"><link rel="prefetch" href="/assets/第1章多线程基础.html.afd475cd.js"><link rel="prefetch" href="/assets/第2章Atomic类.html.06be1f5d.js"><link rel="prefetch" href="/assets/第3章Lock与Condition.html.ab9d71ca.js"><link rel="prefetch" href="/assets/第4章同步工具类.html.c3382339.js"><link rel="prefetch" href="/assets/第5章并发容器.html.ef80cb1d.js"><link rel="prefetch" href="/assets/第6章线程池与Future.html.e4a6ecca.js"><link rel="prefetch" href="/assets/第7章ForkJoinPool.html.98e49c17.js"><link rel="prefetch" href="/assets/第8章CompletableFuture.html.f7a413b4.js"><link rel="prefetch" href="/assets/index.html.12f0ee52.js"><link rel="prefetch" href="/assets/第10章Java并发包中线程同步器原理剖析.html.b977fee1.js"><link rel="prefetch" href="/assets/第11章并发编程实践.html.623c5cbb.js"><link rel="prefetch" href="/assets/第1章并发编程线程基础.html.3967f815.js"><link rel="prefetch" href="/assets/第2章并发编程的其他基础知识.html.1c7f7072.js"><link rel="prefetch" href="/assets/第3章Java并发包中ThreadLocalRandom类原理剖析.html.8f28f52d.js"><link rel="prefetch" href="/assets/第4章Java并发包中原子操作类原理剖析.html.2e32d2f3.js"><link rel="prefetch" href="/assets/第5章Java并发包中并发List源码剖析.html.4b8c96f3.js"><link rel="prefetch" href="/assets/第6章Java并发包中锁原理剖析.html.57b14c73.js"><link rel="prefetch" href="/assets/第7章Java并发包中并发队列原理剖析.html.21d8c694.js"><link rel="prefetch" href="/assets/第8章Java并发包中线程池ThreadPoolExecutor原理探究.html.44cbbd21.js"><link rel="prefetch" href="/assets/第9章Java并发包中ScheduledThreadPoolExecutor原理探究.html.b4fa44fb.js"><link rel="prefetch" href="/assets/index.html.e5d1d6c3.js"><link rel="prefetch" href="/assets/第10章 Map和Set.html.a55e5985.js"><link rel="prefetch" href="/assets/第11章 堆与优先级列表.html.e280a8e4.js"><link rel="prefetch" href="/assets/第12章 通用容器和总结.html.7f8f71e8.js"><link rel="prefetch" href="/assets/第13章 文件基本技术.html.5f4b89df.js"><link rel="prefetch" href="/assets/第14章 文件高级技术.html.8c6479e2.js"><link rel="prefetch" href="/assets/第15章 并发基础知识.html.5cb53a4c.js"><link rel="prefetch" href="/assets/第16章 并发包的基石.html.142bea88.js"><link rel="prefetch" href="/assets/第17章 并发容器.html.3acbf1e5.js"><link rel="prefetch" href="/assets/第18章 异步任务执行服务.html.1b161f70.js"><link rel="prefetch" href="/assets/第19章 同步和协作工具类.html.addf5980.js"><link rel="prefetch" href="/assets/第1章 编程基础.html.baf9d7d3.js"><link rel="prefetch" href="/assets/第20章 并发总结.html.0b3bb480.js"><link rel="prefetch" href="/assets/第21章 反射.html.af2446cd.js"><link rel="prefetch" href="/assets/第22章 注解.html.d1e27bc4.js"><link rel="prefetch" href="/assets/第23章 动态代理.html.7995d8c2.js"><link rel="prefetch" href="/assets/第24章 类加载机制.html.b0642f1c.js"><link rel="prefetch" href="/assets/第25章 正则表达式.html.8b5d5322.js"><link rel="prefetch" href="/assets/第26章 函数式编程.html.7b517aff.js"><link rel="prefetch" href="/assets/第2章 理解数据背后的二进制.html.94e4cb31.js"><link rel="prefetch" href="/assets/第3章 类的基础.html.5639d229.js"><link rel="prefetch" href="/assets/第4章 类的继承.html.2f958e91.js"><link rel="prefetch" href="/assets/第5章 类的继承.html.7d7e56a6.js"><link rel="prefetch" href="/assets/第6章 异常.html.adb3eef3.js"><link rel="prefetch" href="/assets/第7章 常用基础类.html.17e1b88d.js"><link rel="prefetch" href="/assets/第8章 泛型.html.9d1aa562.js"><link rel="prefetch" href="/assets/第9章 列表和队列.html.1b223279.js"><link rel="prefetch" href="/assets/index.html.213dbe07.js"><link rel="prefetch" href="/assets/第10章Executor框架.html.2d819cce.js"><link rel="prefetch" href="/assets/第11章Java并发编程实践.html.e045243d.js"><link rel="prefetch" href="/assets/第1章并发编程的挑战.html.f2cf1cf0.js"><link rel="prefetch" href="/assets/第2章Java并发机制的底层实现原理.html.84620d72.js"><link rel="prefetch" href="/assets/第3章Java内存模型.html.57e9f10a.js"><link rel="prefetch" href="/assets/第4章Java并发编程基础.html.e1837d6e.js"><link rel="prefetch" href="/assets/第5章Java中的锁.html.509db6c5.js"><link rel="prefetch" href="/assets/第6章Java并发容器和框架.html.fab16b37.js"><link rel="prefetch" href="/assets/第7章Java中的13个原子操作类.html.8a2e8902.js"><link rel="prefetch" href="/assets/第8章Java中的并发工具类.html.ede4146b.js"><link rel="prefetch" href="/assets/第9章Java中的线程池.html.e7e64f52.js"><link rel="prefetch" href="/assets/index.html.ccabe8d8.js"><link rel="prefetch" href="/assets/第10章避免活跃性危险.html.288ef3a6.js"><link rel="prefetch" href="/assets/第11章性能与可伸缩性.html.66974eb6.js"><link rel="prefetch" href="/assets/第12章并发程序的测试.html.064eea71.js"><link rel="prefetch" href="/assets/第13章显式锁.html.bf44c451.js"><link rel="prefetch" href="/assets/第14章构建自定义的同步工具.html.23a2e0be.js"><link rel="prefetch" href="/assets/第15章原子变量与非阻塞同步机制.html.06dd6e43.js"><link rel="prefetch" href="/assets/第16章Java内存模型简介.html.977d59cd.js"><link rel="prefetch" href="/assets/第1章简介.html.90b5e48c.js"><link rel="prefetch" href="/assets/第2章线程安全.html.2501a94b.js"><link rel="prefetch" href="/assets/第3章对象的共享.html.faeb65aa.js"><link rel="prefetch" href="/assets/第4章对象的组合.html.1fe1b50c.js"><link rel="prefetch" href="/assets/第5章基础构建模块.html.1fe6799b.js"><link rel="prefetch" href="/assets/第6章任务执行.html.70613e72.js"><link rel="prefetch" href="/assets/第7章取消与关闭.html.1e1c2d49.js"><link rel="prefetch" href="/assets/第8章线程池的使用.html.72ef0a90.js"><link rel="prefetch" href="/assets/第9章图形用户界面应用程序.html.11c377b5.js"><link rel="prefetch" href="/assets/001-two-sum.html.a3f3595a.js"><link rel="prefetch" href="/assets/002-add-two-numbers.html.e7703c4f.js"><link rel="prefetch" href="/assets/003-longest-substring-without-repeating-characters.html.0c6329c6.js"><link rel="prefetch" href="/assets/index.html.d8ad8d07.js"><link rel="prefetch" href="/assets/index.html.5a513471.js"><link rel="prefetch" href="/assets/第10章前端编译与优化.html.2a6b1789.js"><link rel="prefetch" href="/assets/第11章后端编译与优化.html.59704c7c.js"><link rel="prefetch" href="/assets/第12章Java内存模型与线程.html.deaa5ea6.js"><link rel="prefetch" href="/assets/第13章线程安全与锁优化.html.fd873e3a.js"><link rel="prefetch" href="/assets/第1章走近Java.html.0897d78c.js"><link rel="prefetch" href="/assets/第2章Java内存区域与内存溢出异常.html.0978cdd4.js"><link rel="prefetch" href="/assets/第3章垃圾收集器与内存分配策略.html.a47791fa.js"><link rel="prefetch" href="/assets/第4章虚拟机性能监控、故障处理工具.html.61f80277.js"><link rel="prefetch" href="/assets/第5章调优案例分析与实战.html.7a5b7c4c.js"><link rel="prefetch" href="/assets/第6章类文件结构.html.3e8cd2c6.js"><link rel="prefetch" href="/assets/第7章虚拟机类加载机制.html.3af5a31c.js"><link rel="prefetch" href="/assets/第8章虚拟机字节码执行引擎.html.dc5c593e.js"><link rel="prefetch" href="/assets/第9章类加载及执行子系统的案例与实战.html.c3e2fd28.js"><link rel="prefetch" href="/assets/index.html.c2e9c36e.js"><link rel="prefetch" href="/assets/第1章走入并行世界.html.bf2758d5.js"><link rel="prefetch" href="/assets/第2章Java并行程序基础.html.8a27b9a6.js"><link rel="prefetch" href="/assets/第3章JDK并发包.html.55a5bb57.js"><link rel="prefetch" href="/assets/第4章锁的优化及注意事项.html.0ac6ac12.js"><link rel="prefetch" href="/assets/第5章并行模式与算法.html.6e857f15.js"><link rel="prefetch" href="/assets/第6章Java8910与并发.html.61173fb4.js"><link rel="prefetch" href="/assets/第7章使用Akka构建高并发程序.html.610f0e53.js"><link rel="prefetch" href="/assets/第8章并行程序调试.html.dcf9af72.js"><link rel="prefetch" href="/assets/第9章多线程优化示例—Jetty核心代码分析.html.1b25b9bb.js"><link rel="prefetch" href="/assets/index.html.8c841845.js"><link rel="prefetch" href="/assets/第10章Class装载系统.html.800b1d8e.js"><link rel="prefetch" href="/assets/第11章字节码执行.html.fd59242f.js"><link rel="prefetch" href="/assets/第1章初探Java虚拟机.html.80ec8c68.js"><link rel="prefetch" href="/assets/第2章认识Java虚拟机的基本结构.html.bbf499e1.js"><link rel="prefetch" href="/assets/第3章常用Java虚拟机参数.html.10cb1042.js"><link rel="prefetch" href="/assets/第4章垃圾回收的概念与算法.html.90d52151.js"><link rel="prefetch" href="/assets/第5章垃圾收集器和内存分配.html.98dc8566.js"><link rel="prefetch" href="/assets/第7章分析Java堆.html.76f053df.js"><link rel="prefetch" href="/assets/第8章锁与并发.html.c6edc3b8.js"><link rel="prefetch" href="/assets/第9章Class文件结构.html.ce3b9ffe.js"><link rel="prefetch" href="/assets/404.html.a61819a1.js"><link rel="prefetch" href="/assets/index.html.196bf7d0.js"><link rel="prefetch" href="/assets/index.html.6474b04a.js"><link rel="prefetch" href="/assets/index.html.12d9ea9f.js"><link rel="prefetch" href="/assets/index.html.8cf1d97b.js"><link rel="prefetch" href="/assets/index.html.b1d72dff.js"><link rel="prefetch" href="/assets/index.html.6a433ed8.js"><link rel="prefetch" href="/assets/index.html.292db8d2.js"><link rel="prefetch" href="/assets/index.html.db46c28d.js"><link rel="prefetch" href="/assets/home.html.b3222fa8.js"><link rel="prefetch" href="/assets/slide.html.3b4fa46d.js"><link rel="prefetch" href="/assets/index.html.eab01647.js"><link rel="prefetch" href="/assets/index.html.f6997ce1.js"><link rel="prefetch" href="/assets/index.html.4f492e58.js"><link rel="prefetch" href="/assets/第10章 异常.html.b369a82a.js"><link rel="prefetch" href="/assets/第11章 并发.html.1e83a7e7.js"><link rel="prefetch" href="/assets/第12章 序列化.html.934b2280.js"><link rel="prefetch" href="/assets/第2章 创建和销毁对象.html.bf39597f.js"><link rel="prefetch" href="/assets/第3章 对于所有对象都通用的方法.html.c2f582c1.js"><link rel="prefetch" href="/assets/第4章 类和接口.html.d616fa92.js"><link rel="prefetch" href="/assets/第5章 泛型.html.fe9bf71e.js"><link rel="prefetch" href="/assets/第6章 枚举和注解.html.b0c192a2.js"><link rel="prefetch" href="/assets/第7章 Lambda和Stream.html.11e132a3.js"><link rel="prefetch" href="/assets/第8章 方法.html.0f5952cd.js"><link rel="prefetch" href="/assets/第9章 通用编程.html.a9158c44.js"><link rel="prefetch" href="/assets/index.html.66d9275e.js"><link rel="prefetch" href="/assets/index.html.e1e195ac.js"><link rel="prefetch" href="/assets/第1章Java多线程技能.html.d201a503.js"><link rel="prefetch" href="/assets/第2章对象及变量的并发访问.html.8eff37f9.js"><link rel="prefetch" href="/assets/第3章线程间通信.html.96ad7aa4.js"><link rel="prefetch" href="/assets/第4章锁的使用.html.0b108a46.js"><link rel="prefetch" href="/assets/第5章定时器.html.079d1655.js"><link rel="prefetch" href="/assets/第6章单例模式与多线程.html.dd40cab9.js"><link rel="prefetch" href="/assets/第7章拾遗增补.html.c98b6afc.js"><link rel="prefetch" href="/assets/第8章并发集合框架.html.c47636a0.js"><link rel="prefetch" href="/assets/第9章线程池ThreadPoolExecutor的使用.html.fdd06e63.js"><link rel="prefetch" href="/assets/index.html.970ebb57.js"><link rel="prefetch" href="/assets/第1章多线程基础.html.f6e06884.js"><link rel="prefetch" href="/assets/第2章Atomic类.html.5c9a96af.js"><link rel="prefetch" href="/assets/第3章Lock与Condition.html.dd94c834.js"><link rel="prefetch" href="/assets/第4章同步工具类.html.f32cb37a.js"><link rel="prefetch" href="/assets/第5章并发容器.html.11ef3b3d.js"><link rel="prefetch" href="/assets/第6章线程池与Future.html.f2664d19.js"><link rel="prefetch" href="/assets/第7章ForkJoinPool.html.5b09c440.js"><link rel="prefetch" href="/assets/第8章CompletableFuture.html.00ddc982.js"><link rel="prefetch" href="/assets/index.html.05f6dacd.js"><link rel="prefetch" href="/assets/第10章Java并发包中线程同步器原理剖析.html.22c349a1.js"><link rel="prefetch" href="/assets/第11章并发编程实践.html.5db30ba4.js"><link rel="prefetch" href="/assets/第1章并发编程线程基础.html.59828def.js"><link rel="prefetch" href="/assets/第2章并发编程的其他基础知识.html.95634460.js"><link rel="prefetch" href="/assets/第3章Java并发包中ThreadLocalRandom类原理剖析.html.5e3f88be.js"><link rel="prefetch" href="/assets/第4章Java并发包中原子操作类原理剖析.html.aa40f522.js"><link rel="prefetch" href="/assets/第5章Java并发包中并发List源码剖析.html.19da87be.js"><link rel="prefetch" href="/assets/第6章Java并发包中锁原理剖析.html.e64d1f1d.js"><link rel="prefetch" href="/assets/第7章Java并发包中并发队列原理剖析.html.05c55f53.js"><link rel="prefetch" href="/assets/第8章Java并发包中线程池ThreadPoolExecutor原理探究.html.355c02bf.js"><link rel="prefetch" href="/assets/第9章Java并发包中ScheduledThreadPoolExecutor原理探究.html.bc89022d.js"><link rel="prefetch" href="/assets/index.html.0812d30d.js"><link rel="prefetch" href="/assets/第10章 Map和Set.html.d15ebc0a.js"><link rel="prefetch" href="/assets/第11章 堆与优先级列表.html.22879ed0.js"><link rel="prefetch" href="/assets/第12章 通用容器和总结.html.af4e25e8.js"><link rel="prefetch" href="/assets/第13章 文件基本技术.html.e9de4ab6.js"><link rel="prefetch" href="/assets/第14章 文件高级技术.html.6944682e.js"><link rel="prefetch" href="/assets/第15章 并发基础知识.html.fbf03dc9.js"><link rel="prefetch" href="/assets/第16章 并发包的基石.html.f5fbd049.js"><link rel="prefetch" href="/assets/第17章 并发容器.html.d522da1e.js"><link rel="prefetch" href="/assets/第18章 异步任务执行服务.html.76e9a36e.js"><link rel="prefetch" href="/assets/第19章 同步和协作工具类.html.669856bd.js"><link rel="prefetch" href="/assets/第1章 编程基础.html.3f747685.js"><link rel="prefetch" href="/assets/第20章 并发总结.html.1e326470.js"><link rel="prefetch" href="/assets/第21章 反射.html.25579869.js"><link rel="prefetch" href="/assets/第22章 注解.html.10b1af26.js"><link rel="prefetch" href="/assets/第23章 动态代理.html.76b2167b.js"><link rel="prefetch" href="/assets/第24章 类加载机制.html.2dc4cd09.js"><link rel="prefetch" href="/assets/第25章 正则表达式.html.d3486e09.js"><link rel="prefetch" href="/assets/第26章 函数式编程.html.dd3f8bd7.js"><link rel="prefetch" href="/assets/第2章 理解数据背后的二进制.html.3d5eaefa.js"><link rel="prefetch" href="/assets/第3章 类的基础.html.c86161b4.js"><link rel="prefetch" href="/assets/第4章 类的继承.html.2bce738f.js"><link rel="prefetch" href="/assets/第5章 类的继承.html.ad950d91.js"><link rel="prefetch" href="/assets/第6章 异常.html.09ddca79.js"><link rel="prefetch" href="/assets/第7章 常用基础类.html.12c88740.js"><link rel="prefetch" href="/assets/第8章 泛型.html.81d0949a.js"><link rel="prefetch" href="/assets/第9章 列表和队列.html.38c68a48.js"><link rel="prefetch" href="/assets/index.html.bf5d33db.js"><link rel="prefetch" href="/assets/第10章Executor框架.html.a7e672e0.js"><link rel="prefetch" href="/assets/第11章Java并发编程实践.html.debb41c7.js"><link rel="prefetch" href="/assets/第1章并发编程的挑战.html.1b00855d.js"><link rel="prefetch" href="/assets/第2章Java并发机制的底层实现原理.html.f005f932.js"><link rel="prefetch" href="/assets/第3章Java内存模型.html.6ec525fb.js"><link rel="prefetch" href="/assets/第4章Java并发编程基础.html.bd275d3c.js"><link rel="prefetch" href="/assets/第5章Java中的锁.html.83cc4dba.js"><link rel="prefetch" href="/assets/第6章Java并发容器和框架.html.8a83a2ef.js"><link rel="prefetch" href="/assets/第7章Java中的13个原子操作类.html.2c3c8029.js"><link rel="prefetch" href="/assets/第8章Java中的并发工具类.html.61794c87.js"><link rel="prefetch" href="/assets/第9章Java中的线程池.html.9434f936.js"><link rel="prefetch" href="/assets/index.html.93c2aee6.js"><link rel="prefetch" href="/assets/第10章避免活跃性危险.html.e7ea1e3a.js"><link rel="prefetch" href="/assets/第11章性能与可伸缩性.html.42d4a3a1.js"><link rel="prefetch" href="/assets/第12章并发程序的测试.html.690d2aba.js"><link rel="prefetch" href="/assets/第13章显式锁.html.1171f97b.js"><link rel="prefetch" href="/assets/第14章构建自定义的同步工具.html.6c72f888.js"><link rel="prefetch" href="/assets/第15章原子变量与非阻塞同步机制.html.9de6dd1b.js"><link rel="prefetch" href="/assets/第16章Java内存模型简介.html.847d1584.js"><link rel="prefetch" href="/assets/第1章简介.html.5ff3b256.js"><link rel="prefetch" href="/assets/第2章线程安全.html.34a72eca.js"><link rel="prefetch" href="/assets/第3章对象的共享.html.088b59e3.js"><link rel="prefetch" href="/assets/第4章对象的组合.html.420592f2.js"><link rel="prefetch" href="/assets/第5章基础构建模块.html.b697dc08.js"><link rel="prefetch" href="/assets/第6章任务执行.html.d2692cee.js"><link rel="prefetch" href="/assets/第7章取消与关闭.html.1033df86.js"><link rel="prefetch" href="/assets/第8章线程池的使用.html.5655d9dd.js"><link rel="prefetch" href="/assets/第9章图形用户界面应用程序.html.2c9a92f0.js"><link rel="prefetch" href="/assets/001-two-sum.html.bd5b42b8.js"><link rel="prefetch" href="/assets/002-add-two-numbers.html.1cd12f58.js"><link rel="prefetch" href="/assets/003-longest-substring-without-repeating-characters.html.3f87474a.js"><link rel="prefetch" href="/assets/index.html.346ee126.js"><link rel="prefetch" href="/assets/index.html.bddb9164.js"><link rel="prefetch" href="/assets/第10章前端编译与优化.html.27f33bd6.js"><link rel="prefetch" href="/assets/第11章后端编译与优化.html.2d98e937.js"><link rel="prefetch" href="/assets/第12章Java内存模型与线程.html.e5d51c84.js"><link rel="prefetch" href="/assets/第13章线程安全与锁优化.html.2e377ef2.js"><link rel="prefetch" href="/assets/第1章走近Java.html.7c41e7a9.js"><link rel="prefetch" href="/assets/第2章Java内存区域与内存溢出异常.html.82365a5f.js"><link rel="prefetch" href="/assets/第3章垃圾收集器与内存分配策略.html.1360e884.js"><link rel="prefetch" href="/assets/第4章虚拟机性能监控、故障处理工具.html.0a90211f.js"><link rel="prefetch" href="/assets/第5章调优案例分析与实战.html.e7e286da.js"><link rel="prefetch" href="/assets/第6章类文件结构.html.9f84d086.js"><link rel="prefetch" href="/assets/第7章虚拟机类加载机制.html.31c0a6a3.js"><link rel="prefetch" href="/assets/第8章虚拟机字节码执行引擎.html.6f40ca25.js"><link rel="prefetch" href="/assets/第9章类加载及执行子系统的案例与实战.html.5bf71bd8.js"><link rel="prefetch" href="/assets/index.html.18e34f59.js"><link rel="prefetch" href="/assets/第1章走入并行世界.html.d4a7a8b1.js"><link rel="prefetch" href="/assets/第2章Java并行程序基础.html.79f6e18f.js"><link rel="prefetch" href="/assets/第3章JDK并发包.html.df0acd9f.js"><link rel="prefetch" href="/assets/第4章锁的优化及注意事项.html.5a2b559c.js"><link rel="prefetch" href="/assets/第5章并行模式与算法.html.c0ec6141.js"><link rel="prefetch" href="/assets/第6章Java8910与并发.html.9a2cc047.js"><link rel="prefetch" href="/assets/第7章使用Akka构建高并发程序.html.e1442a98.js"><link rel="prefetch" href="/assets/第8章并行程序调试.html.ddf890de.js"><link rel="prefetch" href="/assets/第9章多线程优化示例—Jetty核心代码分析.html.0ab5a261.js"><link rel="prefetch" href="/assets/index.html.9735d51d.js"><link rel="prefetch" href="/assets/第10章Class装载系统.html.50bb638d.js"><link rel="prefetch" href="/assets/第11章字节码执行.html.f0a2e1fd.js"><link rel="prefetch" href="/assets/第1章初探Java虚拟机.html.0a668344.js"><link rel="prefetch" href="/assets/第2章认识Java虚拟机的基本结构.html.1777df39.js"><link rel="prefetch" href="/assets/第3章常用Java虚拟机参数.html.65784af7.js"><link rel="prefetch" href="/assets/第4章垃圾回收的概念与算法.html.d6231456.js"><link rel="prefetch" href="/assets/第5章垃圾收集器和内存分配.html.6446a277.js"><link rel="prefetch" href="/assets/第7章分析Java堆.html.ee273e82.js"><link rel="prefetch" href="/assets/第8章锁与并发.html.7624390a.js"><link rel="prefetch" href="/assets/第9章Class文件结构.html.f4c2ac9f.js"><link rel="prefetch" href="/assets/404.html.36540b0d.js"><link rel="prefetch" href="/assets/index.html.583c479d.js"><link rel="prefetch" href="/assets/index.html.c407fe6a.js"><link rel="prefetch" href="/assets/index.html.99a8f87f.js"><link rel="prefetch" href="/assets/index.html.7587b161.js"><link rel="prefetch" href="/assets/index.html.f6866d7d.js"><link rel="prefetch" href="/assets/index.html.a985c72b.js"><link rel="prefetch" href="/assets/index.html.4c96ae2e.js"><link rel="prefetch" href="/assets/404.629f43ab.js"><link rel="prefetch" href="/assets/Layout.26a2a4c9.js"><link rel="prefetch" href="/assets/Slide.b01858c1.js"><link rel="prefetch" href="/assets/Blog.ac038c81.js"><link rel="prefetch" href="/assets/auto.esm.52abc6cc.js"><link rel="prefetch" href="/assets/index.147398ee.js"><link rel="prefetch" href="/assets/index.e1c5a3de.js"><link rel="prefetch" href="/assets/mermaid.esm.min.e741c6cd.js"><link rel="prefetch" href="/assets/highlight.esm.9b852bc5.js"><link rel="prefetch" href="/assets/markdown.esm.77e8db25.js"><link rel="prefetch" href="/assets/math.esm.cb9d4be3.js"><link rel="prefetch" href="/assets/notes.esm.62c5f19d.js"><link rel="prefetch" href="/assets/reveal.esm.41ec5d7f.js"><link rel="prefetch" href="/assets/search.esm.04894411.js"><link rel="prefetch" href="/assets/zoom.esm.78977eba.js"><link rel="prefetch" href="/assets/photoswipe.esm.2debdee5.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="MyBlog"><!----><span class="site-name hide-in-pad">MyBlog</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="读书笔记"><span class="title"><span class="icon iconfont icon-note" style=""></span>读书笔记</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/reading-notes/Effective%20Java" class="nav-link" aria-label="Effective Java"><!---->Effective Java<!----></a></li><li class="dropdown-item"><a href="/reading-notes/Java%E7%BC%96%E7%A8%8B%E7%9A%84%E9%80%BB%E8%BE%91" class="nav-link" aria-label="Java 编程的逻辑"><!---->Java 编程的逻辑<!----></a></li><li class="dropdown-item"><a href="/reading-notes/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98" class="nav-link" aria-label="Java 并发编程实战"><!---->Java 并发编程实战<!----></a></li><li class="dropdown-item"><a href="/reading-notes/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF" class="nav-link" aria-label="Java 多线程编程核心技术"><!---->Java 多线程编程核心技术<!----></a></li><li class="dropdown-item"><a href="/reading-notes/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B9%8B%E7%BE%8E" class="nav-link" aria-label="Java 并发编程之美"><!---->Java 并发编程之美<!----></a></li><li class="dropdown-item"><a href="/reading-notes/Java%E5%B9%B6%E5%8F%91%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%9AJDK%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90" class="nav-link" aria-label="Java 并发实现原理：JDK 源码剖析"><!---->Java 并发实现原理：JDK 源码剖析<!----></a></li><li class="dropdown-item"><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E9%AB%98%E5%B9%B6%E5%8F%91%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1" class="nav-link" aria-label="实战 Java 高并发程序设计"><!---->实战 Java 高并发程序设计<!----></a></li><li class="dropdown-item"><a href="/reading-notes/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E8%89%BA%E6%9C%AF" class="nav-link" aria-label="Java 并发编程的艺术"><!---->Java 并发编程的艺术<!----></a></li><li class="dropdown-item"><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" class="nav-link active" aria-label="实战 Java 虚拟机：JVM 故障诊断与性能优化"><!---->实战 Java 虚拟机：JVM 故障诊断与性能优化<!----></a></li><li class="dropdown-item"><a href="/reading-notes/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" class="nav-link" aria-label="深入理解 Java 虚拟机：JVM 高级特性与最佳实践"><!---->深入理解 Java 虚拟机：JVM 高级特性与最佳实践<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="leetcode"><span class="title"><span class="icon iconfont icon-note" style=""></span>leetcode</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/leetcode/Top100" class="nav-link" aria-label="Top 100"><!---->Top 100<!----></a></li></ul></button></div></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://gitee.com/anansneaker/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="Gitee"><svg xmlns="http://www.w3.org/2000/svg" class="icon gitee-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="gitee icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm242.97-533.34H482.39a23.7 23.7 0 0 0-23.7 23.7l-.03 59.28c0 13.08 10.59 23.7 23.7 23.7h165.96a23.7 23.7 0 0 1 23.7 23.7v11.85a71.1 71.1 0 0 1-71.1 71.1H375.71a23.7 23.7 0 0 1-23.7-23.7V423.11a71.1 71.1 0 0 1 71.1-71.1h331.8a23.7 23.7 0 0 0 23.7-23.7l.06-59.25a23.73 23.73 0 0 0-23.7-23.73H423.11a177.78 177.78 0 0 0-177.78 177.75v331.83c0 13.08 10.62 23.7 23.7 23.7h349.62a159.99 159.99 0 0 0 159.99-159.99V482.33a23.7 23.7 0 0 0-23.7-23.7z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><p class="sidebar-heading active"><span class="icon iconfont icon-note" style=""></span><span class="title">读书笔记</span><!----></p><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Effective Java</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java 编程的逻辑</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java 并发编程实战</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java多线程编程核心技术</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java 并发编程之美</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java 并发实现原理：JDK 源码剖析</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">实战 Java 高并发程序设计</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java 并发编程的艺术</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">实战 Java 虚拟机：JVM 故障诊断与性能优化</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC1%E7%AB%A0%E5%88%9D%E6%8E%A2Java%E8%99%9A%E6%8B%9F%E6%9C%BA.html" class="nav-link sidebar-link sidebar-page" aria-label="第 1 章 初探 Java 虚拟机"><!---->第 1 章 初探 Java 虚拟机<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC2%E7%AB%A0%E8%AE%A4%E8%AF%86Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84.html" class="nav-link sidebar-link sidebar-page" aria-label="第 2 章 认识 Java 虚拟机的基本结构"><!---->第 2 章 认识 Java 虚拟机的基本结构<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC3%E7%AB%A0%E5%B8%B8%E7%94%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.html" class="nav-link sidebar-link sidebar-page" aria-label="第 3 章 常用 Java 虚拟机参数"><!---->第 3 章 常用 Java 虚拟机参数<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC4%E7%AB%A0%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9A%84%E6%A6%82%E5%BF%B5%E4%B8%8E%E7%AE%97%E6%B3%95.html" class="nav-link sidebar-link sidebar-page" aria-label="第 4 章 垃圾回收的概念与算法"><!---->第 4 章 垃圾回收的概念与算法<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC5%E7%AB%A0%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%92%8C%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html" class="nav-link sidebar-link sidebar-page" aria-label="第 5 章 垃圾收集器和内存分配"><!---->第 5 章 垃圾收集器和内存分配<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="第 6 章 性能监控工具"><!---->第 6 章 性能监控工具<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-1-有我更高效-linux-下的性能监控工具" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.1 有我更高效：Linux 下的性能监控工具"><!---->6.1 有我更高效：Linux 下的性能监控工具<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-1-1-显示系统整体资源使用情况——top-命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.1.1 显示系统整体资源使用情况——top 命令"><!---->6.1.1 显示系统整体资源使用情况——top 命令<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-1-2-监控内存和-cpu——vmstat-命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.1.2 监控内存和 CPU——vmstat 命令"><!---->6.1.2 监控内存和 CPU——vmstat 命令<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-1-3-监控-i-o——iostat-命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.1.3 监控 I/O——iostat 命令"><!---->6.1.3 监控 I/O——iostat 命令<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-1-4-多功能诊断器——pidstat-工具" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.1.4 多功能诊断器——pidstat 工具"><!---->6.1.4 多功能诊断器——pidstat 工具<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-2-用我更高效-windows-下的性能监控工具" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.2 用我更高效：Windows 下的性能监控工具"><!---->6.2 用我更高效：Windows 下的性能监控工具<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-2-1-任务管理器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.2.1 任务管理器"><!---->6.2.1 任务管理器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-2-2-perfmon-性能监控工具" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.2.2 perfmon 性能监控工具"><!---->6.2.2 perfmon 性能监控工具<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-2-3-process-explorer-进程管理工具" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.2.3 Process Explorer 进程管理工具"><!---->6.2.3 Process Explorer 进程管理工具<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-2-4-pslist-命令——windows-下也有命令行工具" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.2.4 pslist 命令——Windows 下也有命令行工具"><!---->6.2.4 pslist 命令——Windows 下也有命令行工具<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-外科手术刀-jdk-性能监控工具" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.3 外科手术刀：JDK 性能监控工具"><!---->6.3 外科手术刀：JDK 性能监控工具<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-1-查看-java-进程——jps-命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.3.1 查看 Java 进程——jps 命令"><!---->6.3.1 查看 Java 进程——jps 命令<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-2-查看虚拟机运行时信息一jstat-命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.3.2 查看虚拟机运行时信息一jstat 命令"><!---->6.3.2 查看虚拟机运行时信息一jstat 命令<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-3-查看虚拟机参数——jinfo-命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.3.3 查看虚拟机参数——jinfo 命令"><!---->6.3.3 查看虚拟机参数——jinfo 命令<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-4-导出堆到文件——jmap-命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.3.4 导出堆到文件——jmap 命令"><!---->6.3.4 导出堆到文件——jmap 命令<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-5-jdk-自带的堆分析工具——jhat-命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.3.5 JDK 自带的堆分析工具——jhat 命令"><!---->6.3.5 JDK 自带的堆分析工具——jhat 命令<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-6-查看线程堆栈——jstack-命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.3.6 查看线程堆栈——jstack 命令"><!---->6.3.6 查看线程堆栈——jstack 命令<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-7-远程主机信息收集——jstatd-命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.3.7 远程主机信息收集——jstatd 命令"><!---->6.3.7 远程主机信息收集——jstatd 命令<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-8-多功能命令行——jcmd-命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.3.8 多功能命令行——jcmd 命令"><!---->6.3.8 多功能命令行——jcmd 命令<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-9-性能统计工具——hprof" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.3.9 性能统计工具——hprof"><!---->6.3.9 性能统计工具——hprof<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-10-扩展-jps-命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.3.10 扩展 jps 命令"><!---->6.3.10 扩展 jps 命令<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-4-我是你的眼-图形化虚拟机监控工具-jconsole" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.4 我是你的眼：图形化虚拟机监控工具 JConsole"><!---->6.4 我是你的眼：图形化虚拟机监控工具 JConsole<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-4-1-jconsole-连接-java-程序" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.4.1 JConsole 连接 Java 程序"><!---->6.4.1 JConsole 连接 Java 程序<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-4-2-java-程序概况" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.4.2 Java 程序概况"><!---->6.4.2 Java 程序概况<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-4-3-内存监控" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.4.3 内存监控"><!---->6.4.3 内存监控<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-4-4-线程监控" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.4.4 线程监控"><!---->6.4.4 线程监控<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-4-5-类加载情况" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.4.5 类加载情况"><!---->6.4.5 类加载情况<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-4-6-虚拟机信息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.4.6 虚拟机信息"><!---->6.4.6 虚拟机信息<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-5-一目了然-可视化性能监控工具-visualvm" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.5 一目了然：可视化性能监控工具 VisualVM"><!---->6.5 一目了然：可视化性能监控工具 VisualVM<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-5-1-visualvm-连接应用程序" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.5.1 VisualVM 连接应用程序"><!---->6.5.1 VisualVM 连接应用程序<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-5-2-监控应用程序概况" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.5.2 监控应用程序概况"><!---->6.5.2 监控应用程序概况<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-5-3-thread-dump-和分析" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.5.3 Thread Dump 和分析"><!---->6.5.3 Thread Dump 和分析<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-5-4-性能分析" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.5.4 性能分析"><!---->6.5.4 性能分析<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-5-5-内存快照分析" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.5.5 内存快照分析"><!---->6.5.5 内存快照分析<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-5-6-btrace-介绍" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.5.6 BTrace 介绍"><!---->6.5.6 BTrace 介绍<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-6-来自-jrockit-的礼物-虚拟机诊断工具-mission-control" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.6 来自 JRockit 的礼物：虚拟机诊断工具 Mission Control"><!---->6.6 来自 JRockit 的礼物：虚拟机诊断工具 Mission Control<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-6-1-mbean-服务器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.6.1 MBean 服务器"><!---->6.6.1 MBean 服务器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-6-2-飞行记录器-flight-recorder" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.6.2 飞行记录器（Flight Recorder）"><!---->6.6.2 飞行记录器（Flight Recorder）<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-7-小结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.7 小结"><!---->6.7 小结<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC7%E7%AB%A0%E5%88%86%E6%9E%90Java%E5%A0%86.html" class="nav-link sidebar-link sidebar-page" aria-label="第 7 章 分析 Java 堆"><!---->第 7 章 分析 Java 堆<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC8%E7%AB%A0%E9%94%81%E4%B8%8E%E5%B9%B6%E5%8F%91.html" class="nav-link sidebar-link sidebar-page" aria-label="第 8 章 锁与并发"><!---->第 8 章 锁与并发<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC9%E7%AB%A0Class%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84.html" class="nav-link sidebar-link sidebar-page" aria-label="第 9 章 Class 文件结构"><!---->第 9 章 Class 文件结构<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC10%E7%AB%A0Class%E8%A3%85%E8%BD%BD%E7%B3%BB%E7%BB%9F.html" class="nav-link sidebar-link sidebar-page" aria-label="第 10 章 Class 装载系统"><!---->第 10 章 Class 装载系统<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC11%E7%AB%A0%E5%AD%97%E8%8A%82%E7%A0%81%E6%89%A7%E8%A1%8C.html" class="nav-link sidebar-link sidebar-page" aria-label="第 11 章 字节码执行"><!---->第 11 章 字节码执行<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">深入理解 Java 虚拟机：JVM 高级特性与最佳实践</span><span class="arrow right"></span></button><!----></section><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><p class="sidebar-heading"><span class="icon iconfont icon-note" style=""></span><span class="title">leetcode</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/leetcode/Top100/" class="nav-link sidebar-link sidebar-page" aria-label="Top 100"><!---->Top 100<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->第 6 章 性能监控工具</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down" localizeddate="2022年7月30日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://www.cxlsn.cn/" target="_blank" rel="noopener noreferrer">阿楠sneaker</a></span><span property="author" content="阿楠sneaker"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年7月30日</span><meta property="datePublished" content="2022-07-30T08:51:46.000Z"></span><!----><!----><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down" localizeddate="2022年7月30日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 63 分钟</span><meta property="timeRequired" content="PT63M"></span><span class="words-info" aria-label="字数🔠" data-balloon-pos="down" localizeddate="2022年7月30日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>约 18908 字</span><meta property="wordCount" content="18908"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-1-有我更高效-linux-下的性能监控工具" class="router-link-active router-link-exact-active toc-link level2">6.1 有我更高效：Linux 下的性能监控工具</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-1-1-显示系统整体资源使用情况——top-命令" class="router-link-active router-link-exact-active toc-link level3">6.1.1 显示系统整体资源使用情况——top 命令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-1-2-监控内存和-cpu——vmstat-命令" class="router-link-active router-link-exact-active toc-link level3">6.1.2 监控内存和 CPU——vmstat 命令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-1-3-监控-i-o——iostat-命令" class="router-link-active router-link-exact-active toc-link level3">6.1.3 监控 I/O——iostat 命令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-1-4-多功能诊断器——pidstat-工具" class="router-link-active router-link-exact-active toc-link level3">6.1.4 多功能诊断器——pidstat 工具</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-2-用我更高效-windows-下的性能监控工具" class="router-link-active router-link-exact-active toc-link level2">6.2 用我更高效：Windows 下的性能监控工具</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-2-1-任务管理器" class="router-link-active router-link-exact-active toc-link level3">6.2.1 任务管理器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-2-2-perfmon-性能监控工具" class="router-link-active router-link-exact-active toc-link level3">6.2.2 perfmon 性能监控工具</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-2-3-process-explorer-进程管理工具" class="router-link-active router-link-exact-active toc-link level3">6.2.3 Process Explorer 进程管理工具</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-2-4-pslist-命令——windows-下也有命令行工具" class="router-link-active router-link-exact-active toc-link level3">6.2.4 pslist 命令——Windows 下也有命令行工具</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-外科手术刀-jdk-性能监控工具" class="router-link-active router-link-exact-active toc-link level2">6.3 外科手术刀：JDK 性能监控工具</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-1-查看-java-进程——jps-命令" class="router-link-active router-link-exact-active toc-link level3">6.3.1 查看 Java 进程——jps 命令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-2-查看虚拟机运行时信息一jstat-命令" class="router-link-active router-link-exact-active toc-link level3">6.3.2 查看虚拟机运行时信息一jstat 命令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-3-查看虚拟机参数——jinfo-命令" class="router-link-active router-link-exact-active toc-link level3">6.3.3 查看虚拟机参数——jinfo 命令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-4-导出堆到文件——jmap-命令" class="router-link-active router-link-exact-active toc-link level3">6.3.4 导出堆到文件——jmap 命令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-5-jdk-自带的堆分析工具——jhat-命令" class="router-link-active router-link-exact-active toc-link level3">6.3.5 JDK 自带的堆分析工具——jhat 命令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-6-查看线程堆栈——jstack-命令" class="router-link-active router-link-exact-active toc-link level3">6.3.6 查看线程堆栈——jstack 命令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-7-远程主机信息收集——jstatd-命令" class="router-link-active router-link-exact-active toc-link level3">6.3.7 远程主机信息收集——jstatd 命令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-8-多功能命令行——jcmd-命令" class="router-link-active router-link-exact-active toc-link level3">6.3.8 多功能命令行——jcmd 命令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-9-性能统计工具——hprof" class="router-link-active router-link-exact-active toc-link level3">6.3.9 性能统计工具——hprof</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-3-10-扩展-jps-命令" class="router-link-active router-link-exact-active toc-link level3">6.3.10 扩展 jps 命令</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-4-我是你的眼-图形化虚拟机监控工具-jconsole" class="router-link-active router-link-exact-active toc-link level2">6.4 我是你的眼：图形化虚拟机监控工具 JConsole</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-4-1-jconsole-连接-java-程序" class="router-link-active router-link-exact-active toc-link level3">6.4.1 JConsole 连接 Java 程序</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-4-2-java-程序概况" class="router-link-active router-link-exact-active toc-link level3">6.4.2 Java 程序概况</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-4-3-内存监控" class="router-link-active router-link-exact-active toc-link level3">6.4.3 内存监控</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-4-4-线程监控" class="router-link-active router-link-exact-active toc-link level3">6.4.4 线程监控</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-4-5-类加载情况" class="router-link-active router-link-exact-active toc-link level3">6.4.5 类加载情况</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-4-6-虚拟机信息" class="router-link-active router-link-exact-active toc-link level3">6.4.6 虚拟机信息</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-5-一目了然-可视化性能监控工具-visualvm" class="router-link-active router-link-exact-active toc-link level2">6.5 一目了然：可视化性能监控工具 VisualVM</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-5-1-visualvm-连接应用程序" class="router-link-active router-link-exact-active toc-link level3">6.5.1 VisualVM 连接应用程序</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-5-2-监控应用程序概况" class="router-link-active router-link-exact-active toc-link level3">6.5.2 监控应用程序概况</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-5-3-thread-dump-和分析" class="router-link-active router-link-exact-active toc-link level3">6.5.3 Thread Dump 和分析</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-5-4-性能分析" class="router-link-active router-link-exact-active toc-link level3">6.5.4 性能分析</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-5-5-内存快照分析" class="router-link-active router-link-exact-active toc-link level3">6.5.5 内存快照分析</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-5-6-btrace-介绍" class="router-link-active router-link-exact-active toc-link level3">6.5.6 BTrace 介绍</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-6-来自-jrockit-的礼物-虚拟机诊断工具-mission-control" class="router-link-active router-link-exact-active toc-link level2">6.6 来自 JRockit 的礼物：虚拟机诊断工具 Mission Control</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-6-1-mbean-服务器" class="router-link-active router-link-exact-active toc-link level3">6.6.1 MBean 服务器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-6-2-飞行记录器-flight-recorder" class="router-link-active router-link-exact-active toc-link level3">6.6.2 飞行记录器（Flight Recorder）</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC6%E7%AB%A0%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7.html#_6-7-小结" class="router-link-active router-link-exact-active toc-link level2">6.7 小结</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="第-6-章-性能监控工具" tabindex="-1"><a class="header-anchor" href="#第-6-章-性能监控工具" aria-hidden="true">#</a> 第 6 章 性能监控工具</h1><p>性能是任何一款软件都需要关注的重要指标。除了软件的基本功能，性能可以说是评价软件优劣的最重要的指标之一。我们该如何有效地监控和诊断性能问题呢？本章基于实践，着重介绍一些针对系统和 Java 虚拟机的监控和诊断工具，以帮助读者在实际开发过程中改善系统性能。</p><p>本章涉及的主要知识点有：</p><ul><li><p>Linux 下的性能监控工具。</p></li><li><p>Windows 下的性能监控工具。</p></li><li><p>JDK 自带的命令行工具。</p></li><li><p>JConsole、VisualVM 和 Mission Control 的介绍。</p></li></ul><h2 id="_6-1-有我更高效-linux-下的性能监控工具" tabindex="-1"><a class="header-anchor" href="#_6-1-有我更高效-linux-下的性能监控工具" aria-hidden="true">#</a> 6.1 有我更高效：Linux 下的性能监控工具</h2><p>Linux 平台是使用最广泛的服务器平台之一。不少 Java 端程序都运行在类 Linux 平台下（如 AIX、Solaris 等）。不同的类 Linux 操作系统的很多命令都非常相似，不少命令只有一些细节上的差异。本节主要介绍用于 Linux 平台的性能收集和统计工具。</p><h3 id="_6-1-1-显示系统整体资源使用情况——top-命令" tabindex="-1"><a class="header-anchor" href="#_6-1-1-显示系统整体资源使用情况——top-命令" aria-hidden="true">#</a> 6.1.1 显示系统整体资源使用情况——top 命令</h3><p>top 命令是 Linux 常用的性能分析工具，能够实时显示系统中各个进程的资源占用状况。top 命令的部分输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code> [root@redhat6 tmp]# top                               
 top - 09:33:57 UP 6:37, 3 users, load average:0.10, 0.05, 0.07
 Tasks: 191 total, 1 running, 190 sleeping, 0 stopped, 0 zombie
 Cpu(s): 3.3%us, 2.2%sy, 0.0%ni, 94.5%id, 0.0%wa, 0.0%hi, 0.0%si, 0.0%st
 Mem: 2071628k total, 1738012k used, 333616k free, 75044k buffers
 Swap: 4161528k total, 5348k used, 4156180k free, 1095040k cached

 PID    USER    PR      NI      VIRT        RES     SHR     S   %CPU    %MEM    TIME+   COMMAND
 2078   root    20      0       56016       25m     8348    S   9.3     1.3     4:39.27 Xorg
 4022   oracle  20      0       82540       13m     9.9m    S   1.3     0.7	    0:11.28 gnome-terminal
 16055  root    20      0       2660        1144    872     R   0.3     0.1     0:00.03 top
 1      root    20      0       2828        1272    1068    S   0.0     0.1     0:02.02 init
 2      root    20      0       0           0       0       S   0.0     0.0     0:00.00 kthreadd
 3      root    RT      0       0           0       0       S   0.0     0.0     0:00.74 migration/0
 4      root    20      0       0           0       0       S   0.0     0.0     0:00.01 ksoftirqd/0
 5      root    RT      0       0           0       0       S   0.0     0.0     0:00.00 watchdog/0
 6      root    RT      0       0           0       0       S   0.0     0.0     0:00.40 migration/1
 7      root    20      0       0           0       0       S   0.0     0.0     0:00.01 ksoftirqd/1
 8      root    RT      0       0           0       0       S   0.0     0.0     0:00.00 watchdog/1
 9      root    20      0       0           0       0       S   0.0     0.0     0:00.13 events/0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>top 命令的输出可以分为两个部分：前半部分是统计信息，后半部分是进程信息。</p><p>在统计信息中，第 1 行是任务队列信息，它的结果等同于 uptime 命令。从左到右依次表示系统当前时间、系统运行时间、当前登录用户数。最后的 load average 表示系统的平均负载，即任务队列的平均长度，其中的 3 个值分别表示 1 分钟、5 分钟、15 分钟到现在的平均值。</p><p>第 2 行是进程统计信息，分别是正在运行的进程数、睡眠进程数、停止的进程数、僵尸进程数。</p><p>等 3 行是 CPU 统计信息，us 表示用户空间 CPU 占用率、sy 表示内核空间 CPU 占用率、ni 表示用户进程空间改变过优先级的进程 CPU 的占用率、id 表示空闲 CPU 占用率、wa 表示等待输入和输出的 CPU 时间百分比、hi 表示硬件中断请求、si 表示软件中断请求。在 Mem 中，从左到右，依次表示物理内存总量、己使用的物理内存、空闲物理内存、内核缓冲使用量。在 Swap 中，依次表示交换区总量、空闲交换区大小、缓冲交换区大小。</p><p>top 命令的第 2 部分是进程信息，显示了系统内各个进程的资源使用情况，主要字段的含义如下。</p><ul><li><p>PID：进程 ID。</p></li><li><p>USER：进程所有者的用户名。</p></li><li><p>PR：优先级。</p></li><li><p>NI：nice 值，负值表示高优先级，正值表示低优先级。</p></li><li><p>%CPU：上次更新到现在的 CPU 时间占用百分比。</p></li><li><p>TIME+：进程使用的 CPU 时间总计，单位为 1/100 秒。</p></li><li><p>%MEM：进程使用的物理内存百分比。</p></li><li><p>VIRT：进程使用的虚拟内存总量，单位为 KB，VIRT = SWAP + RES。</p></li><li><p>RES：进程使用的、未被换出的物理内存大小，单位为KB，RES = CODE + DATA。</p></li><li><p>SHR：共享内存大小，单位为 KB。</p></li><li><p>COMMAND：命令名 / 命令行。</p></li></ul><p><strong>注意</strong>：使用 top 命令可以从宏观上观察系统中各个进程的 CPU 占用情况，以及内存使用情况。</p><h3 id="_6-1-2-监控内存和-cpu——vmstat-命令" tabindex="-1"><a class="header-anchor" href="#_6-1-2-监控内存和-cpu——vmstat-命令" aria-hidden="true">#</a> 6.1.2 监控内存和 CPU——vmstat 命令</h3><p>vmstat 命令也是一个功能比较齐全的性能监测工具。它可以统计 CPU、内存使用情况、Swap 使用情况等信息。和 sar 工具类似，vmstat 也可以指定采样周期和采样次数。</p><p>【示例 6-1】下例每秒釆样一次，共计 3 次。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[root@redhat6 tmp]# vmstat 1 3
 procs ----------------------memory----------- ----swap-- ---io---- ----system----- --cpu--------
 r      b       swpd      free    buff  cache   si  so  bi    bo    in   cs   us  sy  id  wa  st
 0      0       5312    221444  119176  1122592  73  0  0     34    185  281   1   2  97   1   0
 0      0       5312    221048  119176  1122592  32  0  0     0     442  725   2   1  97   0   0
 0      0       5312    221048  119176  1122592  0   0  0     0     463  741   2   1  97   0   0 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果中各列含义如表6.1 所示。</p><p>表6.1 vmstat 命令输出结果中各列含义</p><p><img src="/assets/表6-1.27891e21.png" alt="表6-1" loading="lazy"></p><p>【示例 6-2】以下代码显示了一个线程切换频繁的 Java 程序。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HoldIOckMain</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Random</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lock<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            lock<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 一个持有锁的线程</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">HoldIOckTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">HoldIOckTask</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>i <span class="token operator">=</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 持有锁</span>
                    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                            <span class="token comment">// 等待</span>
                            lock<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">else</span>
                            <span class="token comment">// 通知</span>
                            lock<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 每 2 个线程，使用同一锁对象</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lock<span class="token punctuation">.</span>length <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HoldIOckTask</span><span class="token punctuation">(</span>i <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用 vmstat 工具监控上述 Java 程序执行时的情况：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[oracle@redhat6 ~]$ vmstat 1 4
 procs ----------------------memory----------- ----swap-- ---io---- ----system----- --cpu--------
 r      b       swpd      free    buff  cache    si  so  bi    bo    in    cs    us   sy  id  wa  st
 6      0       5472    185240  134860  1257524  65   0  0     24    192   302    2    1  96   0   0
 7      0       5472    185108  134860  1257524  0    0  0     0     2399  2451   99   1   0   0   0
 9      0       5472    185124  134860  1257524  0    0  0     0     2350  2410   99   1   0   0   0 
 7      0       5472    185124  134860  1257524  128  0  0     0     2339  2367   99   1   0   0   0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，加粗部分有着很高的 cs 值（上下文切换）和 us 值（用户 CPU 时间），表明系统的上下文切换频繁，用户 CPU 占用率很高。</p><p><strong>注意</strong>：vmstat 工具可以查看内存、交互分区、I/O 操作、上下文切换、时钟中断及 CPU 的使用情况。</p><h3 id="_6-1-3-监控-i-o——iostat-命令" tabindex="-1"><a class="header-anchor" href="#_6-1-3-监控-i-o——iostat-命令" aria-hidden="true">#</a> 6.1.3 监控 I/O——iostat 命令</h3><p>iostat 命令可以提供详细的 I/O 信息，它的基本使用方法如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[root@redhat6 tmp]# iostat 1 2
Linux 2.6.32-71.el6.i686 (redhat6) 03/25/2012 _i686_ (2 CPU) 

avg-cpu: %user  %nice  %system  %iowait  %steal  %idle
         1.05   0.00   1.67	    0.63     0.00     96.64

Device:    tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
sda       7.21    62.88        35.64        2083412    1180818
dm-0     13.29    62.66        35.41        2076369    1173160
dm-1      0.09     0.11         0.23           3720       7640

avg-cpu: %user  %nice  %system  %iowait  %steal  %idle
         1.49   0.00   11.94    0.00     0.00    86.57

Device:    tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
sda       7.00     4.00        16.00             4        16
dm-0      8.00     4.00        16.00             4        16
dm-1      0.00     0.00         0.00             0         0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上命令显示了 CPU 的使用概况和磁盘 I/O 的信息。输出信息每 1 秒釆样 1 次，合计釆样两次。如果只需要显示磁盘情况，不需要显示 CPU 使用情况，则可以使用命令：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>iostat -d 1 2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>-d 表示输出磁盘使用情况。输出结果中各列的含义如下。</p><ul><li><p>tps：该设备每秒的传输次数。</p></li><li><p>kB_read/s：每秒从设备读取的数据量。</p></li><li><p>kB_wrtn/s：每秒向设备写入的数据量。</p></li><li><p>kB_read：读取的总数据量。</p></li><li><p>kB_wrtn：写入的总数据量。</p></li></ul><p>如果需要得到更多的统计信息，可以使用 -x 选项，如：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>iostat -x 1 2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>注意</strong>：磁盘 I/O 很容易成为系统性能瓶颈，通过 iostat 命令可以快速定位系统是否产生了大量的 I/O 操作。</p><h3 id="_6-1-4-多功能诊断器——pidstat-工具" tabindex="-1"><a class="header-anchor" href="#_6-1-4-多功能诊断器——pidstat-工具" aria-hidden="true">#</a> 6.1.4 多功能诊断器——pidstat 工具</h3><p>pidstat 是一个功能强大的性能监测工具，也是 Sysstat 的组件之一。读者可以在 <a href="http://www.icewalkers.com/Linux/Software/59040/Sysstat.html" target="_blank" rel="noopener noreferrer">http://www.icewalkers.com/Linux/Software/59040/Sysstat.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 下载这个工具。下载后，通过 ./configure、make、make install 等 3 个命令即可安装 pidstat 工具。如果是 Ubuntu 系统，也可以简单地通过以下命令安装：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo apt-get install sysstat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>pidstat 工具的强大之处在于，它不仅可以监视进程的性能情况，也可以监视线程的性能情况。本节将详细介绍 pidstat 在这方面的功能。</p><ol><li><p>CPU 使用率监控</p><p>【示例 6-3】下例是一个简单地占用 CPU 的程序，它开启了 4 个用户线程，其中，1 个线程大量占用 CPU 资源，其他 3 个线程则处于空闲状态。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HoldCPUMain</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">HoldCPUTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 占用 CPU</span>
                <span class="token keyword">double</span> a <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">LazyTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 空闲线程</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 开启线程，占用 CPU</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HoldCPUTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 空闲线程</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LazyTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LazyTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LazyTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行以上程序，要监控该程序的 CPU 使用率，可以先使用 jps 命令找到 Java 程序的 PID，然后使用 pidstat 命令输出程序的 CPU 使用情况。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[root@redhat6 tmp]# jps
443 Jps
16185
1187 HoldCPUMain
[root@redhat6 tmp]# pidstat -p 1187 -u 1 3
Linux 2.6.32-71.el6.i686 (redhat6) 03/25/2012	_i686_	(2 CPU)
 01:38:19 PM   PID   %usr  %system  %guest  %CPU   CPU   Command             
 01:38:20 PM   1187  99.01   0.00    0.00   99.01    1     java 
 01:38:21 PM   1187  100.00  0.00    0.00   100.00   1     java 
 01:38:22 PM   1187  99.00   0.00    0.00   99.00    1     java 
 Average:      1187  99.34   0.00    0.00   99.34    -     java 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>pidstat 的参数 -p 用于指定进程 ID，-u 表示对 CPU 使用率的监控。参数 1 3 表示每秒采样一次，合计釆样 3 次。从这个输出中可以看到，该应用程序 CPU 占用率几乎达到 100%。pidstat 的功能不仅仅限于观察进程信息，还可以进一步监控线程的信息。使用以下命令：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>pidstat -p 1187 1 3 -u -t
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这个命令的部分输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>01:47:30 PM    TGID   TID    %usr    %system    %guest    %CPU   CPU     Command
01:47:31 PM    1187    -     98.02    0.00       0.00     98.02   0      java
01:47:31 PM      -    1187   0.00     0.00       0.00     0.00    0      |__java
省略部分线程
01:47:31 PM      -    1203   0.00     0.00       0.00     0.00    0      |__java
01:47:31 PM      -    1204   97.03    0.00       0.00     97.03   1      |__java
省略部分线程
01:47:31 PM      -    1207   0.00     0.00       0.00     0.00    1      |__java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>-t 参数将系统性能的监控细化到线程级别。从这个输出中可以知道，该 Java 应用程序之所以有如此高的 CPU 占用率，是因为线程 1204 的缘故。</p><p><strong>注意</strong>：使用 pidstat 工具不仅可以定位到进程，甚至可以进一步定位到线程。</p><p>使用以下命令可以导出指定 Java 应用程序的所有线程：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>jstack -l 1187 &gt; /tmp/t.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在输出的 t.txt 文件中，可以找到这么一段输出内容：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&quot;Thread-0&quot; prio=10 tid=0xb75b3000 nid=0x4b4 runnable [0x8f171000]
	java.lang.Thread.State: RUNNABLE
		at javatuning.ch6.toolscheck.HoldCPUMain$HoldCPUTask.run(HoldCPUMain.java:7) 
		at java.lang.Thread.run(Thread.java:636)
		
		Locked ownable synchronizers:
        - None
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从加粗的部分可以看到，这个线程正是 HoldCPUTask 类，它的 nid（native ID）为 0x4b4，转为 10 进制后，正好是 1204。</p><p>通过这个方法，开发人员可以很容易地捕获在 Java 应用程序中大量占用 CPU 的线程。</p></li><li><p>I/O 使用情况监控</p><p>磁盘 I/O 也是常见的性能瓶颈之一，使用 pidstat 工具也可以监控进程内线程的 I/O 情况。</p><p>【示例 6-4】下例开启了 4 个线程，其中线程 HoldIOTask 产生了大量的 I/O 操作。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HoldIOMain</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">HoldIOTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;temp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                        <span class="token comment">// 大量的写操作</span>
                        fos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    fos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;temp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 大量的读操作</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span>fis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">LazyTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 一个空闲线程</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 开启占用 I/O 的线程</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HoldIOTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 开启空闲线程</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LazyTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LazyTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LazyTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在程序运行过程中，使用以下命令监控程序 I/O 使用情况。其中 22796 是通过 jps 命令查询得到的进程 ID，-d 参数表明监控对象为磁盘 I/O。1 3 表示每秒釆样一次，合计釆样 3 次。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[oracle@redhat6 ~]$ pidstat -p 22796 -d -t 1 3
Linux 2.6.32-71.el6.i686 (redhat6)	03/25/2012 _i686_ (2 CPU) 
 06:06:00 PM     TGID     TID    kB_rd/s    kB_wr/s     kB_ccwr/s    Command 
 06:06:01 PM    22796      -       0.00      332.00          0.00       java 
 06:06:01 PM       -     22796     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22799     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22802     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22803     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22805     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22806     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22807     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22808     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22809     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22810     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22811     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22812     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22813     0.00      328.00          0.00     |__java
 06:06:01 PM       -     22814     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22815     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22816     0.00        0.00          0.00     |__java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从输出结果中可以看到，进程中的 22813（0x591D）线程产生了大量 I/O 操作。通过前文中提到的 jstatck 命令，可以导出当前线程堆栈，查找 nid 为 22813（0x591D）的线程，即可定位到 HoldIOTask 线程。</p><p><strong>注意</strong>：使用 pidstat 可以查看进程和线程的 I/O 信息。</p></li><li><p>内存监控</p><p>使用 pidstat 工具，还可以监控指定进程的内存使用情况。</p><p>【示例 6-5】下例使用 pidstat 工具对进程 ID 为 27233 的进程进行内存监控。每秒刷新一次，共进行 5 次统计。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[oracle@redhat6 ~]$ pidstat -r -p 27233 1 5
Linux 2.6.32-71.el6.i686 (redhat6)	04/14/2012 _i686_ (2 CPU) 
 09:50:32 AM     PID    minflt/s    majflt/s      VSZ    RSS   %MEM   Command
 09:50:33 AM   27233       0.00         0.00   728164  11476   0.55     java 
 09:50:34 AM   27233       1.00         0.00   728164  11480   0.55     java 
 09:50:35 AM   27233       1.00         0.00   728164  11484   0.55     java 
 09:50:36 AM   27233       1.00         0.00   728164  11488   0.55     java 
 09:50:37 AM   27233       0.99         0.00   728164  11492   0.55     java 
 Average:      27233       0.80         0.00   728164  11484   0.55     java 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果中各列含义如下。</p><ul><li>minflt/s：表示该进程每秒 minor faults（不需要从磁盘中调出内存页）的总数。</li><li>majflt/s：表示该进程每秒 major faults（需要从磁盘中调出内存页）的总数。</li><li>VSZ：表示该进程使用的虚拟内存大小，单位为 KB。</li><li>RSS：表示该进程占用的物理内存大小，单位为 KB。</li><li>%MEM：表示占用内存比例。</li></ul></li></ol><p><strong>注意</strong>：pidstat 工具是一款多合一的优秀工具。它不仅可以监控 CPU、I/O 和内存资源，甚至可以将问题定位到相关线程，方便对应用程序进行故障排查。</p><h2 id="_6-2-用我更高效-windows-下的性能监控工具" tabindex="-1"><a class="header-anchor" href="#_6-2-用我更高效-windows-下的性能监控工具" aria-hidden="true">#</a> 6.2 用我更高效：Windows 下的性能监控工具</h2><p>作为桌面市场的占领者，在 Windows 平台上也运行着大量的 Java 应用程序。本节主要介绍一些可以工作在 Windows 平台上的性能监控工具，包括 Windows 系统自带的任务管理、性能监控工具，以及一些优秀的第三方工具。本节以 Windows 7 为例，介绍一些 Windows 下的性能监控工具。</p><h3 id="_6-2-1-任务管理器" tabindex="-1"><a class="header-anchor" href="#_6-2-1-任务管理器" aria-hidden="true">#</a> 6.2.1 任务管理器</h3><p>Windows 系统的任务管理器是大家最熟知的一款系统工具。通过 Ctrl + Alt + Del 组合键便能呼出。任务管理乍看并不起眼，但事实上它却是使用最方便、功能也非常强大的一款性能统计工具。任务管理界面如图6.1 所示。</p><p><img src="/assets/图6-1.b4ae9261.png" alt="图6-1" loading="lazy"></p><p>图6.1 任务管理器界面</p><p>可以看到，任务管理的进程页罗列了系统内进程的名称、所属用户、CPU 使用率和内存使用量等信息。通过任务管理器，可以方便地实时监控各个进程的 CPU 和内存使用情况，对于简单的性能监控，已经足够了。</p><p>除了图6.1 中所展示的列，任务管理的进程页面还可以显示更多的性能参数，比如进程 ID、I/O 信息等，如图6.2 所示。通过 “查看” 菜单下的 “选择列” 菜单，可以弹出 “选择进程页列” 对话框。在这个对话框中，可以选择需要监控的列信息。</p><p><img src="/assets/图6-2.17ce4776.png" alt="图6-2" loading="lazy"></p><p>图6.2 任务管理器支持的性能参数</p><p>除了对进程进行单独的监控，任务管理还能对计算机系统的整体运行情况进行监控，包括 CPU、内存及网络的使用情况。图6.3 展示了 CPU 和内存使用情况，图6.4 展示了当前的网络使用情况。</p><p><img src="/assets/图6-3.9190a120.png" alt="图6-3" loading="lazy"></p><p>图6.3 CPU 和内存使用情况</p><p><img src="/assets/图6-4.0f5fcec3.png" alt="图6-4" loading="lazy"></p><p>图6.4 当前的网络使用情况</p><p><strong>注意</strong>：任务管理器很常用，也非常强大。它可以显示系统的网络负载，任意进程的 CPU 占用率、内存使用量及 I/O 使用情况。</p><h3 id="_6-2-2-perfmon-性能监控工具" tabindex="-1"><a class="header-anchor" href="#_6-2-2-perfmon-性能监控工具" aria-hidden="true">#</a> 6.2.2 perfmon 性能监控工具</h3><p>与任务管理器相比，perfmon 可以说是 Windows 专业级的性能监控工具了。它的功能极其强大，不仅可以监控计算机系统的整体运行情况，也可以专门针对某一个进程或者线程进行状态监控。并且，它所支持的监控对象也非常多，几乎涉及系统的所有方面，从 CPU 使用情况到内存利用率、I/O 速度、网络使用状况、进程数、线程等无不在其监控范围内。perfmon 运行界面如图6.5 所示。</p><p><img src="/assets/图6-5.3c419799.png" alt="图6-5" loading="lazy"></p><p>图6.5 perfmon 运行界面</p><p>读者可以在 “开始” 菜单中调出的 “运行” 对话框使用 perfmon 命令，或者双击控制面板的管理工具中的 “性能监视器” 快捷方式打开这个工具，如图6.6 所示。</p><p><img src="/assets/图6-6.bcd817b3.png" alt="图6-6" loading="lazy"></p><p>图6.6 打开 perfmon 的方式</p><p>perfmon 工具的底部显示了当前正在监控的系统对象。可以在监控对象列表中使用右键添加计数器，如图6.7 所示，选择需要监控的对象，如图6.8 所示。</p><p><img src="/assets/图6-7.96e99bb0.png" alt="图6-7" loading="lazy"></p><p>图6.7 在 perfmon 添加计数器</p><p><img src="/assets/图6-8.17356fa7.png" alt="图6-8" loading="lazy"></p><p>图6.8 选择要监控的指标和监控对象</p><p>可以看到，perfmon 工具支持的性能对象很多。这里需要重点关注的是 Thread 监控项下的内容，如 User Time 表示线程占用 CPU 的时间百分比、ID Thread 表示线程 ID 号、ID Process 表示进程 ID 号。在监控的对象实例中，可以选择 Java 进程的线程。</p><p>【示例 6-6】读者应该还记得 6.1.4 节中使用的 HoldCPUMain 程序吧！以该样例程序为例，本节将展示如何使用 perfmon 工具找出在 Java 应用程序中最消耗 CPU 资源的线程。</p><ol><li><p>运行 HoldCPUMain。按照图6.8 的配置，设置测量对象为 Thread，并选择 javaw.exe 进程中所有的线程。</p></li><li><p>单击查看报表按钮，切换 perfmon 工具的显示模式，如图6.9 所示。</p><p><img src="/assets/图6-9.55e5e92e.png" alt="图6-9" loading="lazy"></p><p>图6.9 切换显示模式</p></li><li><p>在报表中可以很容易地看到，在当前 Java 应用程序中，线程 ID 为 2548 的线程的 CPU 占用率很高，如图6.10 所示。</p><p><img src="/assets/图6-10.811511fa.png" alt="图6-10" loading="lazy"></p><p>图6.10线程监控结果</p></li><li><p>将 11452 换算成 16 进制为 2CBC。通过 jstack 等工具导出 Java 应用程序的线程快照，并查找 2CBC，可以找到：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Thread-0&quot; prio=6 tid=0x04d98400 nid=0x2cbc runnable [0x04d2f000]
	java.lang.Thread.State: RUNNABLE
		at geym.zbase.ch6.hold.HoldCPUMain$HoldCPUTask.run(HoldCPUMain.java:8)
		at java.lang.Thread.run(Thread.java:724)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>至此完成线程定位，通过 perfmon 找到了 Java 程序中消耗 CPU 最多的线程代码。</p></li></ol><p><strong>注意</strong>：perform 工具也是 Windows 自带的一款性能监控软件。可以监控的性能指标繁多，功能也非常强大。当任务管理器无法满足要求时，推荐使用。</p><p>在 Windows 7 下，perfmon 工具支持带参数 /res 启动，用于专门监控系统资源的使用情况。使用如下命令启动 perfmon：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>perfmon /res
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>使用该命令打开的资源监控工具，可以非常细致地观察系统内的资源使用情况，如图6.11 所示。在这个视图中，可以查看每个 CPU 核的信息、磁盘使用率、网络使用率、内存使用率、系统中打开和监听的端口及相关进程等。</p><p><img src="/assets/图6-11.115822dc.png" alt="图6-11" loading="lazy"></p><p>图6.11 perfmon /res 的界面</p><h3 id="_6-2-3-process-explorer-进程管理工具" tabindex="-1"><a class="header-anchor" href="#_6-2-3-process-explorer-进程管理工具" aria-hidden="true">#</a> 6.2.3 Process Explorer 进程管理工具</h3><p>Process Explorer 是一款功能极其强大的进程管理工具。它完全可以替代 Windows 自带的任务管理器。读者可以在 <a href="http://technet.microsoft.com/en-us/sysintemals/bb896653" target="_blank" rel="noopener noreferrer">http://technet.microsoft.com/en-us/sysintemals/bb896653<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 下载该工具。Process Explorer 运行界面如图6.12 所示。</p><p><img src="/assets/图6-12.85e226d0.png" alt="图6-12" loading="lazy"></p><p>图6.12 Process Explorer 运行界面</p><p>Process Explorer 不仅显示了系统内所有的进程，还进一步显示了进程间的父子关系。Process Explorer 所支持的测量项非常多。可以在列表头部单击鼠标右键，打开 &quot;Select Columns” 对话框选择需要统计的策略项，如图6.13 所示。Process Explorer 将统计项进行了分类，主要有进程模块信息、进程性能、I/O 使用情况、网络使用情况、内存使用情况等。</p><p><img src="/assets/图6-13.32251852.png" alt="图6-13" loading="lazy"></p><p>图6.13 进程性能统计类型</p><p>在进程中右击，打开属性对话框，可以显示选中进程的详细信息，包括线程数、上下文环境，以及 CPU、I/O 和内存使用情况等。</p><p>【示例 6-7】在介绍 vmstat 工具时使用了名为 HoldLockMain 的例子，演示了一个大量线程切换的场景。在此，继续使用该实例，演示 Process Explorer 的使用方法。</p><ol><li><p>运行 HoldLockMain，在 Process Explorer 中可以看到 Java 程序的 CPU 占用率很高，如图6.14 所示。</p><p><img src="/assets/图6-14.ec660c4c.png" alt="图6-14" loading="lazy"></p><p>图6.14 Process Explorer 监控 CPU 占用率</p></li><li><p>右击 javaw.exe，打开属性对话框，并查看线程页，如图6.15 所示。</p><p><img src="/assets/图6-15.a586abca.png" alt="图6-15" loading="lazy"></p><p>图6.15 查看线程情况</p></li><li><p>可以看到，在该 Java 程序中，线程的上下文切换数值和 CPU 占用率都比较大。査看当前 CPU 占用率达 12%、上下文切换达 163 次的线程 ID 为 2864，换算成 16 进制为 B30。在线程快照中查找，有以下结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Thread-14&quot; prio=6 tid=0x02b4c800  nid=0xb30 runnable [0x032bf000..0x032bfc94] 
	java.lang.Thread.State: RUNNABLE
		at javatuning.ch6.toolscheck.HoldIOckMain$HoldIOckTask.run(HoldIOckMain.java:19)
		-locked &lt;0x22a23478&gt; (a java.lang.Object)
		at java.lang.Thread.run(Thread.java:619)
		
		Locked ownable synchronizers:
		-None
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过 Process Explorer，这里已经找到其中一个消耗 CPU 大量资源的线程。在实际开发过程中，使用类似的方法，便可以找出程序中最消耗资源的线程。</p></li></ol><p><strong>注意</strong>：可以认为 Process Explorer 是一个加强版的任务管理器，但是它不是 Windows 系统自带的工具，需要下载安装。</p><h3 id="_6-2-4-pslist-命令——windows-下也有命令行工具" tabindex="-1"><a class="header-anchor" href="#_6-2-4-pslist-命令——windows-下也有命令行工具" aria-hidden="true">#</a> 6.2.4 pslist 命令——Windows 下也有命令行工具</h3><p>与之前介绍的性能监控工具不同，pslist 是一款 Windows 下的命令行工具。虽然与之前的 GUI 工具相比，命令行工具在易用性上略有不足，但它依然具有 GUI 工具所不能替代的功能与用途。读者可以在 <a href="http://technet.microsoft.com/en-us/sysintemals/bb896682" target="_blank" rel="noopener noreferrer">http://technet.microsoft.com/en-us/sysintemals/bb896682<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 下载并安装该工具。</p><p>pslist 命令的基本用法如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>pslist [-d] [-m] [-x] [-t] [-s [n] [-r n] [name|pid]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>各参数含义如下。</p><ul><li>-d：显示线程详细信息。</li><li>-m：显示内存详细信息。</li><li>-x：显示进程、内存和线程信息。</li><li>-t：显示进程之间父子关系。</li><li>-s [n]：进入监控模式，n 指定程序运行时间，使用 Esc 键退出。</li><li>-r n：指定监控模式下的刷新时间，单位为秒。</li><li>name：指定监控的进程名称，pslist 将监控所有以给定名字开头的进程。</li><li>-e：使用精确匹配，打开这个开关，pslist 将只监控 name 参数指定的进程。</li><li>pid：指定进程 ID。</li></ul><p>【示例 6-8】本节延用 HoldCPUTask 示例。</p><ol><li><p>运行 HoldCPUTask 程序，使用 pslist 列出所有 Java 应用程序进程：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;pslist java
Name	Pid   Pri Thd  Hnd  Priv    CPU Time    Elapsed Time
javaw	2268	8  14  119 28068  0:02:08.765	0:02:10.265
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>使用 -d 参数列出线程信息：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;pslist java -d

javaw 2268:
Tid     Pri  Cswtch   State            User Time      Kernel Time    Elapsed Time
3212    9    49       Wait:UserReq     0:00:00.015    0:00:00.000    0:03:34.421
1428    9    280      Wait:UserReq     0:00:00.078    0:00:00.078    0:03:34.375
2052    10   274      Wait:UserReq     0:00:00.000    0:00:00.000    0:03:34.171
540     11   3        Wait:UserReq     0:00:00.000    0:00:00.000    0:03:33.953
184     9    2        Wait:UserReq     0:00:00.000    0:00:00.000    0:03:33.953
4052    10   6        Wait:UserReq     0:00:00.000    0:00:00.000    0:03:33.484
1156    10   2        Wait:UserReq     0:00:00.000    0:00:00.000    0:03:33.484
2448    11   42       Wait:UserReq     0:00:00.015    0:00:00.000    0:03:33.484
3728    8    3        Wait:UserReq     0:00:00.000    0:00:00.000    0:03:33.484
2552    10   4699     Wait:DelayExec   0:00:00.000    0:00:00.000    0:03:33.484
2548    8    142357   Running          0:03:32.406    0:00:00.015    0:03:33.328
1856    8    252      Wait:UserReq     0:00:00.000    0:00:00.000    0:03:33.312
3528    8    250      Wait:UserReq     0:00:00.000    0:00:00.000    0:03:33.312
1448    8    238      Wait:UserReq     0:00:00.000    0:00:00.000    0:03:33.312
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>找到正在运行中并且具有最高 Cswtch 上下文切换值的线程 2548，换算成 16 进制为 9F4（很明显，该线程也是占用 CP U时间最多的线程）。在线程快照中查找这个线程的 ID：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&quot;Thread-0&quot; prio=6 tid=0x02b38800 nid=0x9f4 runnable [0x02e5f000..0x02e5fb94] 
    java.lang.Thread.State: RUNNABLE
        at java.util.Random.nextDouble(Random.java:394)
        at java.lang.Math.random(Math.java:695)
        at javatuning.ch6.toolscheck.HoldCPUMain$HoldCPOTask.run(HoldCPUMain.java:8)
        at java.lang.Thread.run(Thread.java:619)

        Locked ownable synchronizers:
        -None
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>进行以上操作后，即可找到当前最消耗 CPU 的线程 HoldCPUTask。</p></li></ol><h2 id="_6-3-外科手术刀-jdk-性能监控工具" tabindex="-1"><a class="header-anchor" href="#_6-3-外科手术刀-jdk-性能监控工具" aria-hidden="true">#</a> 6.3 外科手术刀：JDK 性能监控工具</h2><p>在 JDK 的开发包中，除了大家熟知的 java.exe 和 javac.exe，还有一系列辅助工具。这些辅助工具可以帮助开发人员很好地解决 Java 应用程序的一些疑难杂症。这些工具在 JDK 安装目录下的 bin 中，图6.16 显示了部分辅助工具。</p><p><img src="/assets/图6-16.2abea8af.png" alt="图6-16" loading="lazy"></p><p>图6.16 JDK 内置工具</p><p>虽然乍看之下，这些工作都是 exe 可执行文件。但事实上，它们只是 Java 程序的一层包装，其真正实现在 tools.jar 中，如图6.17 所示。</p><p><img src="/assets/图6-17.dfe5b257.png" alt="图6-17" loading="lazy"></p><p>图6.17 tools.jar 中的实现</p><p>以 jps 工具为例，在控制台执行 jps 命令和 java -classpath %Java_HOME%/lib/tools.jar sun.tools.jps.Jps 命令是等价的，即 jps.exe 只是这个命令的一层包装。</p><h3 id="_6-3-1-查看-java-进程——jps-命令" tabindex="-1"><a class="header-anchor" href="#_6-3-1-查看-java-进程——jps-命令" aria-hidden="true">#</a> 6.3.1 查看 Java 进程——jps 命令</h3><p>jps 命令类似于 Linux 下的 ps 命令，但它只用于列出 Java 的进程。直接运行 jps 命令不加任何参数，可以列出 Java 程序进程 ID 及 Main 函数名称，如下所示：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jps
6260 Jps
7988 Main
400
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从这个输出中可以看到，当前系统中共存在 3 个 Java 应用程序，其中第一个输出 Jps 就是 jps 命令本身，这更加证明此命令的本质也是一个 Java 程序。此外，jps 命令还提供了一系列参数来控制它的输出内容。</p><p>参数 -q 可以指定 jps 只输出进程 ID，而不输出类的名称：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jps -q
7988
7152
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参数 -m 可以用于输出传递给 Java 进程（主函数）的参数：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jps -m
7988 Main --log-config-file D:\tools\squirrel-sql-3.2.1\log4j.properties --squirrel-home D:\tools\squirrel-sql-3.2.1
7456 Jps -m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参数 -l 可以用于输出主函数的完整路径：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C: \Documents and Settings\Administrator&gt;jps -m -l
7244 sun.tools.jps.Jps -m -l
7988 net.sourceforge.squirrel_sql.client.Main --log-config-file D:\tools\squirrel-sql-3.2.1\log4j.properties --squirrel-home D:\tools\squirrel-sql-3.2.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参数 -v 可以显示传递给 Java 虚拟机的参数：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jps -m -l -v
6992 sun.tools.jps.Jps -m -l -v -Denv.class.path=.;D:\tools\jdk6.0\lib\dt.jar;D:\tools\jdk6.0\lib\tools.jar;D:\tools\jdk6.0\lib -Dapplication.home=D:\tools\jdk6.0 -Xms8m
7988 net.sourceforge.squirrel_sql.client.Main --log-config-file D:\tools\squirrel-sql-3.2.1\log4j.properties --squirrel-home D:\tools\squirrel-sql-3.2.1 -Xmx256m -Dsun.java2d.noddraw=true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意</strong>：jps 命令类似于 ps 命令，但是它只列出系统中所有的 Java 应用程序。通过 jps 命令可以方便地查看 Java 进程的启动类、传入参数和 Java 虚拟机参数等信息。</p><h3 id="_6-3-2-查看虚拟机运行时信息一jstat-命令" tabindex="-1"><a class="header-anchor" href="#_6-3-2-查看虚拟机运行时信息一jstat-命令" aria-hidden="true">#</a> 6.3.2 查看虚拟机运行时信息一jstat 命令</h3><p>jstat 命令是一个可以用于观察 Java 应用程序运行时相关信息的工具。它的功能非常强大，可以通过它查看堆信息的详细情况。它的基本使用语法为：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;count&gt;]]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>option 可以由以下值构成。</p><ul><li>-class：显示 ClassLoader 的相关信息。</li><li>-compiler：显示 JIT 编译的相关信息。</li><li>-gc：显示与 GC 相关的堆信息。</li><li>-gccapacity：显示各个代的容量及使用情况。</li><li>-gccause：显示垃圾回收相关信息（同 -gcutil），同时显示最后一次或当前正在发生的垃圾回收的诱发原因。</li><li>-gcnew：显示新生代信息。</li><li>-gcnewcapacity：显示新生代大小与使用情况。</li><li>-gcoid：显示老年代和永久代的信息。</li><li>-gcoldcapacity：显示老年代的大小。</li><li>-gcpermcapacity：显示永久代的大小。</li><li>-gcutil：显示垃圾回收信息。</li><li>-printcompilation：输出 JIT 编译的方法信息。</li></ul></li><li><p>-t 参数可以在输出信息前加上一个 Timestamp 列，显示程序的运行时间。</p></li><li><p>-h 参数可以指定在周期性数据输出时，输出多少行数据后输出一个表头信息。</p></li><li><p>interval 参数用于指定输出统计数据的周期，单位为毫秒。</p></li><li><p>count 参数用于指定一共输出多少次数据。</p></li></ul><p>如下示例输出 Java 进程 2972 的 ClassLoader 相关信息。每秒统计一次信息，一共输出两次。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jstat -class -t 2972 1000 2
Timestamp  Loaded  Bytes   Unloaded  Bytes  Time 
1395.6     2375    2683.8   7        6.2     3.45
1396.6     2375    2683.8   7        6.2     3.45
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 -class 的输出中，Loaded 表示载入类的数量，Bytes 表示载入类的合计大小，Unloaded 表示卸载类的数量，第 2 个 Bytes 表示卸载类的大小，Time 表示在加载和卸载类上所花的时间。</p><p>下例显示了查看 JIT 编译的信息：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jstat -compiler -t 2972
Timestamp Compiled Failed Invalid   Time  FailedType FailedMethod 
1675.9	     779	   0	   0	0.61	    0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Compiled 表示编译任务执行的次数，Failed 表示编译失败的次数，Invalid 表示编译不可用的次数，Time 表示编译的总耗时，FailedType 表示最后一次编译失败的类型，FailedMethod 表示最后一次编译失败的类名和方法名。</p><p>下例显示了与 GC 相关的堆信息的输出：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jstat -gc 2972
SOC	  SIC SOU SIU    EC    EU     OC       OU	    PC    PU    YGC   YGCT FGC   FGCT    GCT
64.0 64.0 0.0 2.0 896.0 448.9 12312.0  9019.1  12288.0  9101.3  101	 0.153   2	0.210  0.364
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>S0C：s0（from 区）的大小（KB）。</li><li>S1C：s1（from 区）的大小（KB）。</li><li>S0U：s0（from区）巳使用的空间（KB）。</li><li>S1U：s1（from区）己使用的空间（KB）。</li><li>EC：eden 区的大小（KB）。</li><li>EU：eden 区的使用空间（KB）。</li><li>OC：老年代大小（KB）。</li><li>OU：老年代已经使用的空间（KB）。</li><li>PC：永久区大小（KB）。</li><li>PU：永久区的使用空间（KB）。</li><li>YGC：新生代 GC 次数。</li><li>YGCT：新生代 GC 耗时。</li><li>FGC：Full GC 次数。</li><li>FGCT：Full GC 耗时。</li><li>GCT：GC 总耗时。</li></ul><p>下例显示了各个代的信息，与 -gc 相比，它不仅输出了各个代的当前大小，也包含了各个代的最大值和最小值。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jstat -gccapacity 2972
NGCMN     NGCMX     NGC  S0C   S1C     EC   OGCMN    OGCMX     OGC        OC    PGCMN    PGCMX     PGC    PC   YGC  FGC
1024.0  20160.0  1024.0 64.0  64.0  896.0  4096.0  241984.0  12312.0  12312.0  12288.0 65536.0  12288.0 12288.0 129  2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>NGCMN：当前新生代最小值（KB）。</li><li>NGCMX：当前新生代最大值（KB）。</li><li>NGC：当前新生代大小（KB）。</li><li>OGCMN：老年代最小值（KB）。</li><li>OGCMX：老年代最大值（KB）。</li><li>PGCMN：永久代最小值（KB）。</li><li>PGCMX：永久代最大值（KB）。</li></ul><p>下例显示了最近一次 GC 的原因，以及当前 GC 的原因：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jstat -gccause 2972
S0     S1      E    O    P     YGC   YGCT  FGC    GCT        LGCC    GCC
0.00 0.00  19.58 59.99  91.43  143  0.207   3   0.538  System.gc()  No GC
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>LGCC：上次 GC 的原因。</li><li>GCC：当前 GC 的原因。</li></ul><p>本例显示，最近一次 GC 是由于显式的 System.gc() 调用所引起的，当前时刻未进行 GC。</p><p>-gcnew 参数可以用于查看新生代的一些详细信息：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jstat -gcnew 2972
S0C      S1C  S0U   S1U  TT  MTT    DSS       EC    EU   YGC     YGCT
128.0  128.0  0.0  11.8  15   15   64.0   1024.0  139.8  159    0.223
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>TT：新生代对象晋升到老年代对象的年龄。</p></li><li><p>MTT：新生代对象晋升到老年代对象的年龄最大值。</p></li><li><p>DSS：所需的 survivor 区大小。</p></li></ul><p>-gcnewcapacity 参数可以详细输出新生代各个区的大小信息：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jstat -gcnewcapacity 2972
NGCMN    NGCMX	  NGC	SOCMX	  S0C	 S1CMX  S1IC	 ECMX	   EC   YGC FGC
1024.0 20160.0	1280.0	128.0	1984.0	1984.0 128.0	16192.0	1024.0  178  3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>S0CMX：s0 区的最大值（KB）。</li><li>S1CMX：s1 区的最大值（KB）。</li><li>ECMX：eden 区的最大值（KB）。</li></ul><p>-gcold用于展现老年代 GC 的概况：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jstat -gcold 2972
PC	         PU       OC      OU   YGC   FGC  FGCT     GCT
12288.0  11295.6  15048.0  9106.1   190    3   0.331  0.580
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>-gcoldcapacity 用于展现老年代的容量信息：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jstat -gcoldcapacity 2972 
 OGCMN    OGCMX    OGC      OC  YGC FGC  FGCT   GCT
4096.0 241984.0 15048.0 15048.0 195   3 0.331 0.584
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>-gcpermcapacity 用于展示永久区的使用情况：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jstat -gcpermcapacity 2972
  PGCMN   PGCMX     PGC     PC  YGC  FGC  FGCT    GCT
12288.0 65536.0 12288.0 12288.0 220    3  0.331  0.605
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>-gcutil 用于展示 GC 回收相关信息：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jstat -gcutil 2972
S0     S1      E    O      P   YGC   YGCT  FGC   FGCT    GCT
7.65 0.00  62.88 60.60  92.19  224  0.277   3   0.331  0.609
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>S0：s0 区使用的百分比。</p></li><li><p>S1：s1 区使用的百分比。</p></li><li><p>E：eden 区使用的百分比。</p></li><li><p>O：老年代使用的百分比。</p></li><li><p>P：永久区使用的百分比。</p></li></ul><p><strong>注意</strong>：jstat 命令可以非常详细地查看 Java 应用程序的堆使用情况及 GC 情况。</p><h3 id="_6-3-3-查看虚拟机参数——jinfo-命令" tabindex="-1"><a class="header-anchor" href="#_6-3-3-查看虚拟机参数——jinfo-命令" aria-hidden="true">#</a> 6.3.3 查看虚拟机参数——jinfo 命令</h3><p>jinfo 命令可以用来查看正在运行的 Java 应用程序的扩展参数，甚至支持在运行时修改部分参数。它的基本语法为：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>jinfo &lt;option&gt; &lt;pid&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>其中 option 可以为以下信息。</p><ul><li><p>-flag &lt;name&gt;：打印指定 Java 虚拟机的参数值。</p></li><li><p>-flag [+|-]&lt;name&gt;：设置指定 Java 虚拟机参数的布尔值。</p></li><li><p>-flag &lt;name&gt;=&lt;value&gt;：设置指定 Java 虚拟机参数的值。</p></li></ul><p>在很多情况下，Java 应用程序不会指定所有的 Java 虚拟机参数。而此时，开发人员可能不知道某一个具体的 Java 虚拟机参数的默认值。在这种情况下，可能需要通过查找文档获取某个参数的默认值。这个查找过程可能是非常艰难的。但有了 jinfo 命令，开发人员可以很方便地找到 Java 虚拟机参数的当前值。</p><p>下例显示了新生代对象晋升到老年代对象的最大年龄。在应用程序启动时，并没有指定这个参数，但通过 jinfo 命令可以查看这个参数的当前数值。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jinfo -flag MaxTenuringThreshold 2972 
-XX:MaxTenuringThreshold=15
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>显示是否打印 GC 详细信息：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jinfo -flag PrintGCDetails 2972
-XX:-PrintGCDetails
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>除了查找参数的值，jinfo 命令也支持修改部分参数的数值，当然，这个修改能力是极其有限的。下例显示了通过 jinfo 命令对 PrintGCDetails 参数的修改，它可以在 Java 程序运行时，动态关闭或者打开这个开关。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jinfo -flag PrintGCDetails 2972
-XX:-PrintGCDetails

C:\Documents and Settings\Administrator&gt;jinfo -flag +PrintGCDetails 2972

C:\Documents and Settings\Administrator&gt;jinfo -flag PrintGCDetails 2972 
-XX:+PrintGCDetails
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意</strong>：使用 jinfo 命令不仅可以查看运行时某一个 Java 虚拟机参数的实际取值，甚至可以在运行时修改部分参数，并使之立即生效（并非所有参数都支持动态修改）。</p><h3 id="_6-3-4-导出堆到文件——jmap-命令" tabindex="-1"><a class="header-anchor" href="#_6-3-4-导出堆到文件——jmap-命令" aria-hidden="true">#</a> 6.3.4 导出堆到文件——jmap 命令</h3><p>jmap 命令是一个多功能的命令。它可以生成 Java 程序的堆 Dump 文件，也可以查看堆内对象实例的统计信息、查看 ClassLoader 的信息及 finalizer 队列。</p><p>下例使用 jmap 命令生成 PID 为 2972 的 Java 程序的对象统计信息，并输出到 s.txt 文件中。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>jmap -histo 2972 &gt; c:\s.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>输出文件结构如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>num	 #instances   #bytes    class name
--------------------------------------------
1:        4983   6057848    [I                                    
2:       20929   2473080    &lt;constMethodKlass&gt;        
...
1932:        1         8   sun.java2d.pipe.AlphaColorPipe       
1933:        1         8   sun.reflect.GeneratedMethodAccessor64 
Total    230478  22043360                                         
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，这个输出显示了内存中的实例数量和合计。</p><p>jmap 命令另一个更为重要的功能是得到 Java 程序的当前堆快照：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jmap -dunp:format=b,file=c:\heap.hprof 2972
Dumping heap to C:\heap.hprof ...
Heap dump file created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>本例中，将应用程序的堆快照输出到 C 盘 heap.bin 文件中。之后，可以通过多种工具分析该堆文件。比如，下文中提到的 jhat 工具或者 VisualVM、MAT 等工具。</p><p><strong>注意</strong>：jmap 可用于导出 Java 应用程序的堆快照。</p><p>此外，jmap 还可以查看系统的 ClassLoader 的信息，如下所示：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Users\Administrator&gt;jmap -permstat 10360
Attaching to process ID 10360，please wait...
class_loader classes bytes parent_loader alive? type

&lt;bootstrap&gt; 368 1644840  null       live  &lt;internal&gt; 
0x246f0b70  0    0       null       live  sun/misc/Launcher$ExtClassLoader@0x39114a50 
0x246f94b8  9    63472  0x246f0b70  live  sun/misc/Launcher$AppClassLoader@0x39136bb8 
                                            
total = 3    377   1708312    N/A   alive=3, dead=0   N/A    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，系统中有 3 个 ClassLoader，并显示了它们的父子关系。同时，也显示了每个 ClassLoader 内部加载的类的数量和总大小。</p><p>通过 jmap 命令，还可以观察系统 finalizer 队列中的对象，一个不恰当的 finalize() 函数可能导致对象堆积在 finalizer 队列中。使用以下命令可以查看堆积在 finalizer 队列中的对象：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Users\Administrator&gt;jmap -finalizerinfo 9828
Number of objects pending for finalization: 13461

Count    Class description 	
-----------------------------------
13458	geym.zbase.ch5.LongFinalize$LF
3       java.io.FileInputStream
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，在 finalizer 队列中，堆积了大量的 geym.zbase.ch5.LongFinalize$LF 对象实例和 3 个 java.io.FileInputStream 实例。</p><h3 id="_6-3-5-jdk-自带的堆分析工具——jhat-命令" tabindex="-1"><a class="header-anchor" href="#_6-3-5-jdk-自带的堆分析工具——jhat-命令" aria-hidden="true">#</a> 6.3.5 JDK 自带的堆分析工具——jhat 命令</h3><p>使用 jhat 命令可以分析 Java 应用程序的堆快照内容。</p><p><strong>说明</strong>：jhat 命令在 JDK 9、JDK 10 中已经被删除，官方建议用 VisualVM 代替，参考 6.5.5 节。</p><p>【示例 6-9】以前文中 jmap 命令的输出堆文件 heap.hprof 为例。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jhat c:\heap.hprof
Reading from c:\heap.hprof...
Dump file created Thu Mar 22 22:27:19 CST 2012
Snapshot read, resolving...
Resolving 133055 objects...
Chasing references, expect 26 dots...................	
Eliminating duplicate references...................	 
Snapshot resolved.
Started HTTP server on port 7000
Server is ready.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在分析完成后，使用 HTTP 服务器展示其分析结果。在浏览器中访问 <a href="http://127.0.0.1:7000" target="_blank" rel="noopener noreferrer">http://127.0.0.1:7000<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，输出结果如图6.18 所示。</p><p><img src="/assets/图6-18.003fb210.png" alt="图6-18" loading="lazy"></p><p>图6.18 jhat 输出结果</p><p>在默认页中，jhat 服务器显示了所有的非平台类信息。单击链接，可以查看选中类的超类、ClassLoader 及该类的实例等信息。此外，在页面底部，还为开发人员提供了其他查询方式，如图6.19 所示。</p><p><img src="/assets/图6-19.3e76212f.png" alt="图6-19" loading="lazy"></p><p>图6.19 jhat 提供的查询功能</p><p>通过这些链接，开发者可以进一步查看所有类信息（包括 Java 平台的类）、所有类的实例数量及实例的具体信息。最后，还有一个链接指向 OQL 査询界面。</p><p>图6.20 显示了在 jhat 中查看 Java 应用程序里 java.lang.String 类的实例数量的结果。</p><p><img src="/assets/图6-20.c53cf0fe.png" alt="图6-20" loading="lazy"></p><p>图6.20 显示实例数量</p><p>单击 instances 链接可以进一步查看 String 对象的实例，如图6.21 所示。</p><p><img src="/assets/图6-21.8278aea6.png" alt="图6-21" loading="lazy"></p><p>图6.21 显示 String 对象的实例</p><p>通常，导出的堆快照信息非常多，可能很难通过页面上简单的链接索引找到想要的信息。为此，jhat 命令还支持使用 OQL 对堆快照进行查询。执行 OQL 的界面非常简洁，如图6.22 所示。使用 OQL 查询出当前 Java 程序中所有 java.io.File 对象的路径，如下所示：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>select file.path.value.toString() from java.io.File file
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="/assets/图6-22.cc02a958.png" alt="图6-22" loading="lazy"></p><p>图6.22 OQL 查询界面</p><p>jhat 的 OQL 与 VisualVM 的 OQL 非常接近，有兴趣的读者可以查阅本书中的相关章节。</p><p><strong>注意</strong>：jhat 命令可以对堆快照文件进行分析，它启动一个 HTTP 服务器，开发人员可以通过浏览器浏览 Java 堆快照。</p><h3 id="_6-3-6-查看线程堆栈——jstack-命令" tabindex="-1"><a class="header-anchor" href="#_6-3-6-查看线程堆栈——jstack-命令" aria-hidden="true">#</a> 6.3.6 查看线程堆栈——jstack 命令</h3><p>jstack 命令用于导出 Java 应用程序的线程堆栈，语法为：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>jstack [-l] &lt;pid&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>-l 选项用于打印锁的附加信息。</p><p>jstack 命令会在控制台输出程序中所有的锁信息，可以使用重定向将输出保存到文件中，如：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>jstack -l 2348 &gt; C:\deadlock.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>【示例 6-10】下例演示了一个简单的死锁，两个线程分别占用 south 锁和 north 锁，并同时请求对方占用的锁，导致死锁发生。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeadLock</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token class-name">Object</span> myDirect<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> south <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> north <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">DeadLock</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>myDirect <span class="token operator">=</span> obj<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>myDirect <span class="token operator">==</span> south<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;south&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>myDirect <span class="token operator">==</span> north<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;north&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>myDirect <span class="token operator">==</span> south<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// 占用 north</span>
                north<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 等待 north 启动</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// 占用 south</span>
                south<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;car to south has passed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;car to south is killed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>north<span class="token punctuation">.</span><span class="token function">isHeldByCurrentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
                    north<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>south<span class="token punctuation">.</span><span class="token function">isHeldByCurrentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
                    south<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>myDirect <span class="token operator">==</span> north<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// 占用 south</span>
                south<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// 占用 north</span>
                north<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;car to north has passed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;car to north is killed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>north<span class="token punctuation">.</span><span class="token function">isHeldByCurrentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
                    north<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>south<span class="token punctuation">.</span><span class="token function">isHeldByCurrentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
                    south<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 2 个线程死锁</span>
        <span class="token class-name">DeadLock</span> car2south <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeadLock</span><span class="token punctuation">(</span>south<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DeadLock</span> car2north <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeadLock</span><span class="token punctuation">(</span>north<span class="token punctuation">)</span><span class="token punctuation">;</span>
        car2south<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        car2north<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用 jstack 命令打印上例的输出，部分输出结果如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&quot;north&quot; prio=6 tid=0x0109c400 nid=0x17e4 waiting on condition [0x0517f000]
java.lang.Thread.State: WAITING (parking)
at sun.misc.Unsafe.park(Native Method)
- parking to wait for &lt;0x24704068&gt; (a java.util.concurrent.locks.ReentrantLock$NonfairSync)
at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186) 
at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)
at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireInterruptibly(AbstractQueuedSynchronizer.java:894)
at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireInterruptibly(AbstractQueuedSynchronizer.java:1221)
at java.util.concurrent.locks.ReentrantLock.lockInterruptibly(ReentrantLock.java:340)
at geym.zbase.ch6.hold.DeadLock.run(DeadLock.java:49)

Locked ownable synchronizers:
-&lt;0x24704040&gt; (a java.util.concurrent.locks.ReentrantLock$NonfairSync)

&quot;south&quot; prio=6 tid=0x01061000 nid=0x12bc waiting on condition [0x04fdf000] 
java.lang.Thread.State: WAITING (parking)
at sun.misc.Unsafe.park(Native Method)
- parking to wait for &lt;0x24704040&gt; (a java.util.concurrent.locks.ReentrantLock$NonfairSync)
at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)
at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireInterruptibly(AbstractQueuedSynchronizer.java:894)
at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireInterruptibly(AbstractQueuedSynchronizer.java:1221)
at java.util.concurrent.locks.ReentrantLock.lockInterruptibly(ReentrantLock.java:340)
at geym.zbase.ch6.hold.DeadLock.run(DeadLock.java:29)

Locked ownable synchronizers:
- &lt;0x24704068&gt; (a java.util.concurrent.locks.ReentrantLock$NonfairSync) 
省略部分输出
Found one Java-level deadlock:
==============================
&quot;north&quot;:
waiting for ownable synchronizer 0x24704068, (a java.util.concurrent.locks.ReentrantLock$NonfairSync),
which is held by &quot;south&quot;
&quot;south&quot;:
waiting for ownable synchronizer 0x24704040, (a java.util.concurrent.locks.ReentrantLock$NonfairSync),
which is held by &quot;north&quot;
省略部分输出
Found 1 deadlock.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从输出中，可以很容易地找到死锁，并同时显示了发生死锁的两个线程，以及死锁线程的持有对象和等待对象，帮助开发人员解决死锁问题。</p><p><strong>注意</strong>：通过 jstack 命令不仅可以得到线程堆栈，还能自动进行死锁检查，输出找到的死锁信息。</p><h3 id="_6-3-7-远程主机信息收集——jstatd-命令" tabindex="-1"><a class="header-anchor" href="#_6-3-7-远程主机信息收集——jstatd-命令" aria-hidden="true">#</a> 6.3.7 远程主机信息收集——jstatd 命令</h3><p>在本节之前所述的工具中，只涉及监控本机的 Java 应用程序，而在这些工具中，一些监控工具也支持对远程计算机的监控（如 jps、jstat）。为了启用远程监控，需要配合使用 jstatd 命令。</p><p>jstatd 命令是一个 RMI 服务端程序，它的作用相当于代理服务器，建立本地计算机与远程监控工具的通信。jstatd 服务器将本机的 Java 应用程序信息传递到远程计算机，如图6.23 所示。</p><p><img src="/assets/图6-23.041035e9.png" alt="图6-23" loading="lazy"></p><p>图6.23 jstatd 命令工作示意图</p><p>直接打开 jstatd 服务器可能会抛出访问拒绝异常：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jstatd
Could not create remote object
access denied (java.util.PropertyPermission java.rmi.server.ignoreSubClasses write)
java.security.AccessControlException: access denied (java.util.Propertypermission java.rmi.server.ignoreSubClasses write)
at java.security.AccessControlContext.checkPe rmission(AccessControlContext.java:323) 
at java.security.Accesscontroller.checkpermission(Accesscontroller.java:546) 
at java.lang.SecurityManager.checkPermission(SecurityManager.java:532)
at java.lang.System.setProperty(System.java:725)
at sun.tools.jstatd.Jstatd.main(Jstatd.java:122)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这是由于 jstatd 程序没有足够的权限所致。可以使用 Java 的安全策略，为其分配相应的权限。下面的代码为 jstatd 分配了最大的权限，将其保存在 jstatd.all.policy 文件中：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>grant codebase &quot;file:E:/tools/jdk-10.0.2/lib/tools.jar&quot; {
	permission java.security.AllPermission;
};
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后，使用以下命令再次开启 jstatd 服务器：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jstatd -J-Djava.security.policy= c:\jstatd.all.policy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这样服务器即可开启成功。</p><p>-J 参数是一个公共的参数，如 jps、jstat 等命令都可以接收这个参数。由于 jps、jstat 命令本身也是 Java 应用程序，-J 参数可以为 jps 等命令本身设置 Java 虚拟机参数。</p><p>在默认情况下，jstatd 命令将在 1099 端口开启 RMI 服务器。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;netstat -ano|findstr 1099
TCP    0.0.0.0:1099   0.0.0.0:0    LISTENING    3656
C:\Documents and Settings\Administrator&gt;jps
3656 Jstatd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上命令行显示，本机的 1099 端口处于监听状态，相关进程号是 3656。使用 jsp 显示 3656 进程，正是 jstatd，说明 jstatd 启动成功。</p><p>使用 jps 显示远程计算机的 Java 进程：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jps localhost:1099
3656 Jstatd
460 Main
2464 Jps
844
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用 jstat 显示远程进程 460 的 GC 情况：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;jstat -gcutil 460@localhost:1099
so    SI     E      0      P      YGC   YGCT   FGC   FGCT   GCT  
0.00  22.05  88.55  91.62  69.88  23    0.091  0     0.000  0.091 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-8-多功能命令行——jcmd-命令" tabindex="-1"><a class="header-anchor" href="#_6-3-8-多功能命令行——jcmd-命令" aria-hidden="true">#</a> 6.3.8 多功能命令行——jcmd 命令</h3><p>在 JDK 1.7 以后，新增了一个命令行工具 jcmd。它是一个多功能的工具，可以用来导出堆、查看 Java 进程、导出线程信息、执行 GC 等。</p><p>jcmd 命令可以针对给定的 Java 虚拟机执行一条命令。首先来看一下如何使用 jcmd 命令列出当前系统中的所有 Java 虚拟机：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\tools\jdk-10.0.2&gt;jcmd -l
6192
7148 sun.tools.jcmd.JCmd -l
2828 geym.zbase.ch6.hold.DeadLock
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参数 -l 表示列出所有的 Java 虚拟机，针对每一个虚拟机，jcmd 命令可以使用 help 命令列出它们所支持的命令：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\tools\jdk-10.0.2&gt;jcmd 2828 help
2828:
The following commands are available:
JFR.stop
JFR.start
JFR.dump
JFR.check
VM.native_memory
VM.commercial_features
ManagementAgent.stop
ManagementAgent.start_local
ManagementAgent.start
Thread.print
GC.class_histogram
GC.heap_dump
GC.run_finalization
GC.run
VM.uptime
VM.flags
VM.system_properties
VM.command_line
VM.version
Help
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里罗列的就是进程号 2828 虚拟机所支持的 jcmd 命令操作，下面介绍几个常用的命令。</p><ol><li><p>查看虚拟机启动时间 VM.uptime：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\tools\jdk-10.0.2&gt;jcmd 2828 VM.uptime
2828:
3805.305 s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>jcmd 命令也支持直接使用 MainClass 的名字来代替进程号，这样在编写脚本的时候也更为容易，如下所示：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\tools\jdk-10.0.2&gt;jcmd geym.zbase.ch6.hold.DeadLock VM.uptime
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>打印线程栈信息：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\tools\jdk-10.0.2&gt;jcmd 2828 Thread.print
2828:
2014-10-07 10:46:09
Full thread dump Java HotSpot(TM) Client VM (24.0-b56 mixed mode, sharing): 
省略所有线程信息
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>查看系统中类的统计信息：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\tools\jdk-10.0.2&gt;jcmd 2828 GC.class_histogram
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>导出堆信息：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\&gt;jcmd 2828 GC.heap_dump D:\d.dump
2828:
Heap dump file created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>GC.heap_dump 接收一个参数作为堆 Dump 文件的输出路径，得到堆文件后，可以使用 MAT 或者 VisualVM 等工具进行分析。</p></li><li><p>获得系统的 Properties 内容：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\&gt;jcmd 2828 VM.system_properties
2828:
#Tue Oct 07 13:12:56 CST 2014
java.runtime.name=Java(TM) SE Runtime Environment
sun.boot.library.path=D\:\\tools\\jdk-10.0.2\\jre\\bin
java.vm.version=24.0-b56
java.vm.vendor=Oracle Corporation
省略输出
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>获得启动参数：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\&gt;jcmd 2828 VM.flags
2828:
-XX:+FlightRecorder -XX:InitialHeapSize=l6777216 -XX:MaxHeapSize=268435456 -XX:+UnlockCommercialFeatures -XX:-UseLargePagesIndividualAllocation
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>获得所有性能统计相关数据。</p><p>通过 jcmd 命令，还可以获得所有的 PerfData 数据，如下所示：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\&gt;jcmd 2828 PerfCounter.print
2828:
java.cis.sharedLoadedClasses=704
java.cis.sharedUnloadedClasses=0
java.cis.unloadedClasses=83
省略部分输出
java.threads.daemon=11
java.threads.live=14
java.threads.livePeak=16
java.threads.started=28
省略部分输出
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个输出中，可以找到所有的性能统计相关的数据，作为示例，这里给出了活动线程数量、活动线程峰值等信息。</p></li></ol><p>从以上示例中可以看到，jcmd 拥有 jmap 的大部分功能，并且在 Oracle 的官方网站上也推荐使用 jcmd 命令代替 jmap 命令。</p><h3 id="_6-3-9-性能统计工具——hprof" tabindex="-1"><a class="header-anchor" href="#_6-3-9-性能统计工具——hprof" aria-hidden="true">#</a> 6.3.9 性能统计工具——hprof</h3><p>与前文中介绍的监控工具不同，hprof 不是独立的监控工具，它只是一个 Java agent 工具。它可以用于监控 Java 应用程序在运行时的 CPU 信息和堆信息。使用 java -agentlib:hprof=help 命令可以查看 hprof 的帮助文档。</p><p><strong>说明</strong>：hprof 在 JDK 9、JDK 10 中已经被删除，官方建议用 VisualVM 代替，参考 6.5.5 节和 6.5.6 节。</p><p>下面是 hprof 工具帮助信息的输出，加粗部分是常用的参数。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\Documents and Settings\Administrator&gt;java -agentlib:hprof=help HPROF: Heap and CPU Profiling Agent (JVMTI Demonstration Code)
hprof usage: java -agentlib:hprof=[help]|[&lt;option&gt;=&lt;value&gt;, ...]
Option Name and Value      Description                       Default
-----------------------    -------------                     -----------
heap=dump|sites|all        heap profiling                    all
cpu=samples|times|old      CPU usage                         off
monitor=y|n                monitor contention                n
format=a|b                 text(txt) or binary output        a
file=&lt;file&gt;                write data to file                java.hprof[{.txt}]
net=&lt;host&gt;:&lt;port&gt;          send data over a socket           off
depth=&lt;size&gt;               stack trace depth                 4
interval=&lt;ms&gt;              sample interval in ms             10
cutoff=&lt;value&gt;             output cutoff point               0.0001
lineno=y|n                 line number in traces?            y
thread=y|n                 thread in traces?                 n
doe=y|n                    dump on exit?                     y
msa=y|n                    Solaris micro state accounting    n
force=y|n                  force output to &lt;file&gt;            y
verbose=y|n                print messages about dumps        y
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用 hprof 工具可以查看程序中各个函数的 CPU 占用时间。以下代码包含 3 个方法，分别占用不同的 CPU 时间。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HProfTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">slowMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 模拟一个很慢的方法</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">slowerMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 模拟一个更慢的方法</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 一个很快的方法</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fastMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HProfTest</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HProfTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 分别运行这些方法</span>
        test<span class="token punctuation">.</span><span class="token function">fastMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        test<span class="token punctuation">.</span><span class="token function">slowMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        test<span class="token punctuation">.</span><span class="token function">slowerMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用参数 -agentlib:hprof=cpu=times,interval=10 运行以上代码。times 选项将会在 Java 函数的调用前、后记录函数的执行时间，进而计算函数的执行时间。在程序的当前目录下，会生成 java.hprof.txt 文件，记录性能统计信息，包含如下内容：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>CPU TIME (ms) BEGIN (total = 11224) Tue Oct 07 13:36:52 2014
rank    self     accum   count    trace     method 
1      89.10%    89.10%     1    303832     geym.zbase.ch6.hold.HprofTest.slowerMethod        
2      8.91%     98.01%     1    301213     geym.zbase.ch6.hold.HprofTest.slowMethod
3      0.12%     98.13%   114    303737     java.util.Properties.saveConvert
4      0.08%     98.21%   3003   303730     java.lang.String.charAt
5      0.08%     98.29%   3313   303732     java.lang.AbstractStringBuilder.append
6      0.0-8%    98.37%   1172   300382     java.lang.Character.toLowerCase
7      0.05%     98.42%   3313   303733     java.lang.StringBuffer.append
省略部分内容
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用参数 -agentlib:hprof=heap=dump,format=b,file=c:\core.hprof 运行程序，可以将应用程序的堆快照保存在指定文件 c:\core.hprof 中。使用 MAT 或者 VisualVM 等工具可以分析这个堆文件。</p><p>使用参数 -agentlib:hprof=heap=sites 运行程序，可以输出 Java 应用程序中每个跟踪点上的类所占内存的百分比，部分输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>SITES BEGIN (ordered by live bytes) Tue Oct 07 13:39:48 2014
percent        live   alloc&#39;ed stack class 
rank   self   accum  bytes   objs   bytes  objs    trace    name                                                           
1     7.06%   7.06%  32800   2      32800   2     300254    char[]  
2     4.83%   11.89% 22416   174    22416   174   300006    char[]
3     4.10%   15.98% 19040   595    19040   595   300177    java.util.LinkedHashMap$Entry                  
4     3.53%   19.52% 16416   2      16416   2     300251    byte[]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里以 rank3 为例，说明在跟踪点 300177，分配了 4.83% 的总内存，合计使用 22416 字节。在输出日志中查找 300177，可以得到部分堆栈：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>TRACE 300177:
    java.util.HashMap$Entry.&lt;init&gt;(HashMap.java:814)
    java.util.LinkedHashMap$Entry.&lt;init&gt;(LinkedHashMap.java:325) 
    java.util.LinkedHashMap.createEntry(LinkedHashMap.java:442) 
    java.util.HashMap.addEntry(HashMap.java:888)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-10-扩展-jps-命令" tabindex="-1"><a class="header-anchor" href="#_6-3-10-扩展-jps-命令" aria-hidden="true">#</a> 6.3.10 扩展 jps 命令</h3><p>前文已经介绍过，包括 jps 在内的命令本质上是使用 Java 实现的。以 jps 命令为例，它在实现过程中，使用 MonitoredVmUtil 类获得给定虚拟机的相关信息。而 MonitoredVmUtil 的主要功能都来自于 MonitoredVm.findByName() 方法，通过 PerfData 数据查询，可以得到虚拟机的相关性能参数。</p><p>【示例 6-11】下面的代码使用 MonitoredVm.findByName() 方法查询了活动线程数、活动线程数峰值和 daemon 线程数。将这段代码加在 jps 的主实现中，就可以扩展 jps 的功能，在枚举系统中 Java 进程的同时，也显示每一个 Java 进程的线程信息。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">LongMonitor</span> l<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LongMonitor</span><span class="token punctuation">)</span> vm<span class="token punctuation">.</span><span class="token function">findByName</span><span class="token punctuation">(</span><span class="token string">&quot;java.threads.live&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
output<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;活动线程：&quot;</span> <span class="token operator">+</span> l<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">LongMonitor</span> str<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LongMonitor</span><span class="token punctuation">)</span> vm<span class="token punctuation">.</span><span class="token function">findByName</span><span class="token punctuation">(</span><span class="token string">&quot;java.threads.livePeak&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
output<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;活动线程峰值 g：&quot;</span> <span class="token operator">+</span> str<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LongMonitor</span><span class="token punctuation">)</span> vm<span class="token punctuation">.</span><span class="token function">findByName</span><span class="token punctuation">(</span><span class="token string">&quot;java.threads.daemon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
output<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;daemon 线程总数：&quot;</span> <span class="token operator">+</span> str<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行修改后的 jps，显示如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>6020 Jps 活动线程：5 活动线程峰值 g：5 daemon 线程总数：4
5572 活动线程：31 活动线程峰值 g：31 daemon 线程总数：22
6832 DeadLock 活动线程：9 活动线程峰值 g：9 daemon 线程总数：6
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，除了显示进程 ID 和 MainClass，还显示每一个进程的线程数量。</p><p><strong>注意</strong>：本节所用到的类均在 OpenJDK 源码中，读者可以下载源码尝试修改 jps 的实现。</p><h2 id="_6-4-我是你的眼-图形化虚拟机监控工具-jconsole" tabindex="-1"><a class="header-anchor" href="#_6-4-我是你的眼-图形化虚拟机监控工具-jconsole" aria-hidden="true">#</a> 6.4 我是你的眼：图形化虚拟机监控工具 JConsole</h2><p>JConsole 是 JDK 自带的图形化性能监控工具。通过 JConsole 工具，可以查看 Java 应用程序的运行概况，可以监控堆信息、永久区使用情况、类加载情况等。本节主要介绍 JConsole 工具的基本使用方法。</p><h3 id="_6-4-1-jconsole-连接-java-程序" tabindex="-1"><a class="header-anchor" href="#_6-4-1-jconsole-连接-java-程序" aria-hidden="true">#</a> 6.4.1 JConsole 连接 Java 程序</h3><p>JConsole 程序在 %JAVA_HOME%/bin 目录下，启动后，程序便要求指定连接 Java 应用程序，如图6.24 所示。</p><p><img src="/assets/图6-24.644f3d57.png" alt="图6-24" loading="lazy"></p><p>图6.24 JConsole 连接 Java 应用</p><p>在新建连接对话框中，罗列了所有的本地 Java 应用程序，选择需要连接的程序即可。在本地进程下，还有一个用于连接远程进程的文本框，输入正确的远程进程地址即可连接。</p><p>如果需要使用 JConsole 连接远程进程，则可以在远程 Java 应用程序启动时加上如下参数：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-Djava.rmi.server.hostname=127.0.0.1
-Dcom.sun.management.jmxremote
-Dcom.sun.management.jmxremote.port=8888
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.ssl=false
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>-Djava.rmi.server.hostname 用于指定运行 Java 应用程序的计算机的 IP 地址，-Dcom.sun. management.Jmxremote.port 用于指定通过 JMX 管理该进程的端口号。基于以上配置启动的 Java 应用程序，通过 JConsole 在远程连接时，只需要填写如下远程进程即可：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>127.0.0.1:8888
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_6-4-2-java-程序概况" tabindex="-1"><a class="header-anchor" href="#_6-4-2-java-程序概况" aria-hidden="true">#</a> 6.4.2 Java 程序概况</h3><p>在连接上 Java 应用程序后，便可以查看应用程序概况，如图6.25 所示。图中 4 个折线图分别显示了堆内存使用量、系统线程数量、加载类数量及 CPU 占用率。</p><p><img src="/assets/图6-25.256d5b0c.png" alt="图6-25" loading="lazy"></p><p>图6.25 JConsole 查看应用程序概况</p><h3 id="_6-4-3-内存监控" tabindex="-1"><a class="header-anchor" href="#_6-4-3-内存监控" aria-hidden="true">#</a> 6.4.3 内存监控</h3><p>切换到内存监控界面，可以显示当前内存的详细信息。不仅包括堆内存的整体信息，更细化到 eden 区、survivor 区、老年代的使用情况。同时，也包括非堆区，即永久代的使用情况。单击右上角的 “执行 GC” 按钮，可以强制应用程序进行一次 Full GC，如图6.26 所示。</p><p><img src="/assets/图6-26.19ac651c.png" alt="图6-26" loading="lazy"></p><p>图6.26 JConsole 查看堆内存信息</p><p><strong>注意</strong>：在 JConsole 中，可以查看堆的详细信息，包括堆的大小、使用率、eden 区大小、survivor 区大小、永久区大小等。</p><h3 id="_6-4-4-线程监控" tabindex="-1"><a class="header-anchor" href="#_6-4-4-线程监控" aria-hidden="true">#</a> 6.4.4 线程监控</h3><p>JConsole 中的线程选项卡允许开发人员监控程序内的线程，如图6.27 所示。JConsole 显示了系统内的线程数量，并在屏幕下方显示了程序中所有的线程。单击线程名称，便可以查看线程的栈信息。</p><p><img src="/assets/图6-27.036fa897.png" alt="图6-27" loading="lazy"></p><p>图6.27 JConsole查看线程信息</p><p>使用 “检测死锁” 按钮，还可以自动检测多线程应用程序的死锁情况。图6.28 展示了由 JConsole 检测到的死锁线程。</p><p><img src="/assets/图6-28.1ce922a5.png" alt="图6-28" loading="lazy"></p><p>图6.28 JConsole 死锁线程检查</p><p>本例中使用的测试代码可以参考 6.3.6 节中的示例。</p><p><strong>注意</strong>：使用 JConsole 可以方便地查看系统内的线程信息，并且可以快速定位死锁问题。</p><h3 id="_6-4-5-类加载情况" tabindex="-1"><a class="header-anchor" href="#_6-4-5-类加载情况" aria-hidden="true">#</a> 6.4.5 类加载情况</h3><p>JConsole 的类页面如图6.29 所示，显示了系统已经装载类的数量。在详细信息栏中，还显示了已卸载类的数量。</p><p><img src="/assets/图6-29.afcdd437.png" alt="图6-29" loading="lazy"></p><p>图6.29 JConsole 的类页面</p><h3 id="_6-4-6-虚拟机信息" tabindex="-1"><a class="header-anchor" href="#_6-4-6-虚拟机信息" aria-hidden="true">#</a> 6.4.6 虚拟机信息</h3><p>在 VM 概要页，JConsole 显示了当前应用程序的运行环境，包括虚拟机类型、版本、堆信息及虚拟机参数等，如图6.30 所示。</p><p><img src="/assets/图6-30.f6ff81cc.png" alt="图6-30" loading="lazy"></p><p>图6.30 JConsole 展示 Java 虚拟机虚拟机信息</p><p><strong>注意</strong>：VM 概要显示了当前 Java 应用程序的基本信息，如虚拟机类型、虚拟机版本、系统线程信息、操作系统内存信息、堆信息、垃圾回收器类型、Java 虚拟机参数及类路径等。</p><h2 id="_6-5-一目了然-可视化性能监控工具-visualvm" tabindex="-1"><a class="header-anchor" href="#_6-5-一目了然-可视化性能监控工具-visualvm" aria-hidden="true">#</a> 6.5 一目了然：可视化性能监控工具 VisualVM</h2><p>VisualVM 是一个功能强大的多合一故障诊断和性能监控可视化工具，它集成了多种性能统计工具的功能，使用 VisualVM 可以代替 jstats、jmap、jhat、jstack，甚至代替 JConsole。在 JDK 6 升级到 JDK 7 以后，VisualVM 便作为 JDK 的一部分发布，即它完全免费。</p><p>VisualVM 也可以作为独立的软件安装，读者可以在 <a href="http://visualvm.java.net" target="_blank" rel="noopener noreferrer">http://visualvm.java.net<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 下载，然后安装 VisualVM 的最新版本。</p><p>VisualVM 的一大特点是支持插件扩展，并且插件安装非常方便。我们既可以通过离线下载插件文件 *.nbm，然后在 Plugin 对话框的己下载页面添加己下载的插件，也可以在可用插件页面下，在线安装插件，如图6.31 所示。</p><p><img src="/assets/图6-31.e6d937c4.png" alt="图6-31" loading="lazy"></p><p>图6.31 VisualVM 安装插件</p><h3 id="_6-5-1-visualvm-连接应用程序" tabindex="-1"><a class="header-anchor" href="#_6-5-1-visualvm-连接应用程序" aria-hidden="true">#</a> 6.5.1 VisualVM 连接应用程序</h3><p>VisualVM 支持多种方式连接应用程序，最常用的就是本地连接。只要本地计算机内有 Java 应用程序正在执行，在 VisualVM 的 Local 节点下，就会出现这些应用程序。</p><p>双击应用程序或者使用鼠标右键打开应用程序，就能够监控应用程序运行，如图6.32 所示。由于 VisualVM 本身也是 Java 应用程序，所以自身也在列表内。</p><p><img src="/assets/图6-32.7367883f.png" alt="图6-32" loading="lazy"></p><p>图6.32 VisualVM 监控应用程序</p><p>除了本地连接，VisualVM 也支持远程 JMX 连接。Java 应用程序可以通过以下参数打开 JMX 端口：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-Djava.rmi.server.hostname=127.0.0.1
-Dcom.sun.management.jmxremote
-Dcom.sun.management.jmxremote.port=8888
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.ssl=false
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过如图6.33 所示的操作来添加 JMX 连接。</p><p><img src="/assets/图6-33.76796645.png" alt="图6-33" loading="lazy"></p><p>图6.33 VisualVM 添加 JMX 连接</p><p>在弹出的对话框中填写远程计算机地址、端口，如图6.34 所示。如果需要验证，则填写用户名和密码。</p><p><img src="/assets/图6-34.e322b5c9.png" alt="图6-34" loading="lazy"></p><p>图6.34 VisualVM 配置 JMX 连接</p><p>添加成功后，在 Local 节点下就会出现一个 JMX 图标的应用程序，如图6.35 所示。图中两个应用程序分别通过本地方式与 JMX 方式连接，两者的标识图标是不同的。</p><p><img src="/assets/图6-35.a58920e7.png" alt="图6-35" loading="lazy"></p><p>图6.35 VisualVM 中的 JMX 应用程序</p><h3 id="_6-5-2-监控应用程序概况" tabindex="-1"><a class="header-anchor" href="#_6-5-2-监控应用程序概况" aria-hidden="true">#</a> 6.5.2 监控应用程序概况</h3><p>通过 VisualVM，可以查看应用程序的基本概况，比如进程 ID、Main Class、启动参数等，如图6.36 所示。</p><p><img src="/assets/图6-36.39f45b9b.png" alt="图6-36" loading="lazy"></p><p>图6.36 VisualVM 显示应用程序概况</p><p>单击 Tab 页面上的监视页面，即可监控应用程序 CPU、堆、永久区、类加载和线程数的总体情况。通过页面上的 “执行垃圾回收” 和 “堆 Dump” 按钮还可以手工执行 Full GC 和生成堆快照，如图6.37 所示。</p><p><img src="/assets/图6-37.3f480101.png" alt="图6-37" loading="lazy"></p><p>图6.37 VisualVM 显示 Java 程序内存信息</p><p><strong>注意</strong>：VisualVM 将 CPU 使用情况、堆信息、永久区信息、线程及类加载情况做了可视化的展示，方便开发人员查看。</p><h3 id="_6-5-3-thread-dump-和分析" tabindex="-1"><a class="header-anchor" href="#_6-5-3-thread-dump-和分析" aria-hidden="true">#</a> 6.5.3 Thread Dump 和分析</h3><p>VisualVM 的线程页面（如图6.38 所示）可以提供详细的线程信息。单击右上角的 “线程 Dump” 按钮可以导出当前所有线程的堆栈信息（相当于使用 jstack 命令）。</p><p><img src="/assets/图6-38.115585a1.png" alt="图6-38" loading="lazy"></p><p>图6.38 VisualVM 的线程页面</p><p>如果 VisualVM 在当前程序中找到死锁，则会以十分显眼的方式在线程页面中给予提示，如图6.39 所示。</p><p><img src="/assets/图6-39.03f57ea6.png" alt="图6-39" loading="lazy"></p><p>图6.39 VisualVM 的死锁提示</p><p><strong>注意</strong>：VisualVM 的 Thread 页面提供了详细的线程信息，还会进行自动的死锁监测，一旦发现存在死锁便会提示用户。</p><h3 id="_6-5-4-性能分析" tabindex="-1"><a class="header-anchor" href="#_6-5-4-性能分析" aria-hidden="true">#</a> 6.5.4 性能分析</h3><p>VisualVM 有两个采样器，在 Sampler 页面显示了 CPU 和内存两个性能采样器，用于实时监控程序信息。CPU 采样器可以将 CPU 占用时间定位到方法，内存釆样器可以查看当前程序的堆信息。</p><p>通过 VisualVM 的釆样功能，可以找到该程序中占用 CPU 时间最长的方法，如图6.40 所示。可以看到 HoldCPUTask.run() 方法占用了大量的 CPU 时间，而 LazyTask.run() 方法就非常空闲。通常，可以根据这个功能，简单地定位到系统中最消耗资源的方法，并加以改进。</p><p><img src="/assets/图6-40.5eb7a7fd.png" alt="图6-40" loading="lazy"></p><p>图6.40 VisualVM 方法耗时监控</p><p>在 VisualVM 的默认统计信息中，并不包含 JDK 的内置对象的函数调用统计，比如 java.* 包中的类。如果需要统计 JDK 内的方法调用情况，需要单击右上角的 “设置” 选项，手工进行配置。如图6.41 所示，增加了 java.util.* 包内的函数调用统计信息。可以看到，java.util.Random.next() 方法最消耗 CPU 资源。</p><p><img src="/assets/图6-41.e22be49c.png" alt="图6-41" loading="lazy"></p><p>图6.41增加对 java.util.* 的监控</p><p>通过内存采样器，可以实时查看系统中实例的分布情况，如图6.42 所示。随着程序的运行，VisualVM 会实时更新这些数据，动态显示各个 class 所占的内存大小。</p><p><img src="/assets/图6-42.4772ac73.png" alt="图6-42" loading="lazy"></p><p>图6.42 VisualVM 内存监控</p><h3 id="_6-5-5-内存快照分析" tabindex="-1"><a class="header-anchor" href="#_6-5-5-内存快照分析" aria-hidden="true">#</a> 6.5.5 内存快照分析</h3><p>使用右键菜单中的 “堆 Dump”，可以立即获得当前应用程序的内存快照，如图6.43 所示（相当于使用 jmap 命令）。</p><p><img src="/assets/图6-43.d6d1afdc.png" alt="图6-43" loading="lazy"></p><p>图6.43 内存快照分析功能</p><p>内存快照分析如图6.44 所示，例数和 OQL 控制台。下面分别介绍它们。</p><p><img src="/assets/图6-44.f7da41fc.png" alt="图6-44" loading="lazy"></p><p>图6.44 内存快照分析</p><ol><li><p>概要页面展示了当前内存的整体信息，包括内存大小、实例总数、类总数等。</p></li><li><p>在类页面中，以类为索引，显示了每个类的实例数和占用空间。在类页面中，还可以对两个不同的内存快照文件进行比较，这个功能可以帮助开发者快速分析同一应用程序在运行的不同时刻，内存数据产生的变化，如图6.44 所示。</p><p>在这个类展示的页面中，如果需要获取指定类的更多信息，可以单击右键，进入该类的实例页面，如图6.45 所示。</p><p><img src="/assets/图6-45.3e7f8e29.png" alt="图6-45" loading="lazy"></p><p>图6.45 进入类实例页面</p></li><li><p>在实例数页面中，将显示指定类的所有实例。开发者可以查看当前内存中的实际内容。图6.46 显示了查看一个 String 对象实例页面的部分内容。可以看到，系统中所有的 String 对象都一一被列出，并且可以看到所有对象的具体数据。</p><p><img src="/assets/图6-46.eabf5e13.png" alt="图6-46" loading="lazy"></p><p>图6.46 String 对象实例显示</p><p>在右下角的引用部分，可以查看系统中引用这个实例的对象，进而展示对象间的引用关系。</p></li><li><p>OQL 控制台提供了更强大的对象查询功能。有关 VisualVM 的 OQL 支持，将在后续章节进行详细阐述。</p></li></ol><p><strong>注意</strong>：通过 VisualVM 提供的内存快照分析工具，可以查看堆快照内的类信息和对象信息。</p><h3 id="_6-5-6-btrace-介绍" tabindex="-1"><a class="header-anchor" href="#_6-5-6-btrace-介绍" aria-hidden="true">#</a> 6.5.6 BTrace 介绍</h3><p>BTrace 是一款非常有意思的工具，它可以在不停机的情况下，通过字节码注入动态监控系统的运行情况，可以跟踪指定的方法调用、构造函数调用和系统内存等信息。本节在参考 BTrace 用户手册的基础上，着眼于实际应用，选取较为实用的几个 BTrace 脚本，演示 BTrace 工具强大的功能。在 VisualVM 中安装 BTrace 的方法很简单，如图6.47 所示。</p><p><img src="/assets/图6-47.96d2560b.png" alt="图6-47" loading="lazy"></p><p>图6.47 BTrace 的安装</p><p>在 VisualVM 中安装 BTrace 插件后，便可以针对 Java 应用程序执行 BTrace 脚本了。在 Java 应用程序节点上单击右键，选择 &quot;Trace application&quot; 即可进入 BTrace 插件界面，如图6.48 所示。</p><p><img src="/assets/图6-48.6f03ce20.png" alt="图6-48" loading="lazy"></p><p>图6.48 进入 BTrace 界面</p><p>BTrace 界面主要分为上下两部分。上半部分为代码区，下半部分为输出结果区。在代码区中完成 BTrace 脚本的编写，单击 Start 按钮将 BTrace 脚本注入选中应用程序，程序输出结果将在下半部分显示，如图6.49 所示。</p><p><img src="/assets/图6-49.bd65ce89.png" alt="图6-49" loading="lazy"></p><p>图6.49 BTrace 插件运行界面</p><p>【示例 6-12】本节使用的目标测试程序如下，该程序周期性地进行网络读取操作，下文中将使用 BTrace 对该程序进行监控。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">HoldNetTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visitWeb</span><span class="token punctuation">(</span><span class="token class-name">String</span> strUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">URL</span> url <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">URLConnection</span> urlcon <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">InputStream</span> is <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>strUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
            urlcon <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            is <span class="token operator">=</span> urlcon<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BufferedReader</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">StringBuffer</span> bs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> l <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>l <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                bs<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>is <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    is<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">visitWeb</span><span class="token punctuation">(</span><span class="token string">&quot;http://www.sina.com.cn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><p>监控指定函数耗时</p><p>使用 BTrace 脚本可以通过正则表达式指定监控特定类的特定方法的耗时。以下代码将监控所有类中名为 visitWeb() 的函数的执行时间。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span></span><span class="token class-name">BTraceUtils</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * 监控方法耗时
 *
 */</span>
<span class="token annotation punctuation">@BTrace</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PrintTimes</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 开始时间
     */</span>
    <span class="token annotation punctuation">@TLS</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 方法开始时调用
     */</span>
    <span class="token annotation punctuation">@OnMethod</span><span class="token punctuation">(</span>clazz <span class="token operator">=</span> <span class="token string">&quot;/.+/&quot;</span><span class="token punctuation">,</span>                                   <span class="token comment">// 监控任意类</span>
            method <span class="token operator">=</span> <span class="token string">&quot;/visitWeb/&quot;</span><span class="token punctuation">)</span>                              <span class="token comment">// 监控 visitWeb() 方法</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">startMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        startTime <span class="token operator">=</span> <span class="token function">timeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 方法结束时调用<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
     * Kind.RETURN 这个注解很重要
     */</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;deprecation&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@OnMethod</span><span class="token punctuation">(</span>clazz <span class="token operator">=</span> <span class="token string">&quot;/.+/&quot;</span><span class="token punctuation">,</span>
            method <span class="token operator">=</span> <span class="token string">&quot;/visitWeb/&quot;</span><span class="token punctuation">,</span>
            location <span class="token operator">=</span> <span class="token annotation punctuation">@Location</span><span class="token punctuation">(</span><span class="token class-name">Kind</span><span class="token punctuation">.</span>RETURN<span class="token punctuation">)</span><span class="token punctuation">)</span>                  <span class="token comment">// 方法返回时触发</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">endMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token function">probeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">probeMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot; [&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token string">&quot;Time taken: &quot;</span><span class="token punctuation">,</span> <span class="token function">str</span><span class="token punctuation">(</span><span class="token function">timeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上脚本使用 @OnMethod 注释指定要监控的类和方法名称。它在函数开始运行时记录函数的起始执行时间，在函数返回时记录函数的终止时间，从而计算函数的运行耗时。将这段脚本注入样例目标程序，部分输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>geym.zbase.ch6.HoldNetMain_BTrace$HoldNetTask.visitWeb [Time taken : 1343] 
geym.zbase.ch6.HoldNetMain_BTrace$HoldNetTask.visitWeb [Time taken : 1295] 
geym.zbase.ch6.HoldNetMain_BTrace$HoldNetTask.visitWeb [Time taken : 1332] 
geym.zbase.ch6.HoldNetMain_BTrace$HoldNetTask.visitWeb [Time taken : 1293] 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意</strong>：通过 BTrace 脚本可以监控指定的某一个函数的运行耗时。</p></li><li><p>监控函数参数</p><p>在上面的示例中，展示了如何通过 BTrace 监控 visitWeb() 函数的执行时间。除了执行时间，当前函数访问哪个网站依然是一个让人很关注的信息。通过 BTrace 可以很容易地获得 visitWeb() 函数的参数信息。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span></span><span class="token class-name">BTraceUtils</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span></span><span class="token class-name">AnyType</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * 监控方法耗时
 * 
 */</span>
<span class="token annotation punctuation">@BTrace</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PrintTimes</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@OnMethod</span><span class="token punctuation">(</span>
            clazz <span class="token operator">=</span> <span class="token string">&quot;/.*HoldNetTask/&quot;</span><span class="token punctuation">,</span>                                   <span class="token comment">// 要监控的类</span>
            method <span class="token operator">=</span> <span class="token string">&quot;/visitWeb/&quot;</span>                                        <span class="token comment">// 要监控的方法</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">anyWriteFile</span><span class="token punctuation">(</span><span class="token annotation punctuation">@ProbeClassName</span> <span class="token class-name">String</span> pcn<span class="token punctuation">,</span>
                                    <span class="token annotation punctuation">@ProbeMethodName</span> <span class="token class-name">String</span> pmn<span class="token punctuation">,</span>
                                    <span class="token class-name">AnyType</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span>pcn<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                      <span class="token comment">// 类名称</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print</span><span class="token punctuation">(</span>pmn<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                      <span class="token comment">// 方法名称</span>
        <span class="token function">printArray</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                <span class="token comment">// 传递给方法的参数</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上脚本监控 HoldNetTask 类的 visitWeb() 方法，并在每次方法调用时，输出系统传递给该方法的参数。程序的部分输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>geym.zbase.ch6.HoldNetMain_BTrace$HoldNetTask.visitWeb[[http://www.sina.com.cn](http://www.sina.com.cn),] 
geym.zbase.ch6.HoldNetMain_BTrace$HoldNetTask.visitWeb[[http://www.sina.com.cn](http://www.sina.com.cn),]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>加粗部分即 visitWeb() 方法的接收参数。通过 BTrace，在不影响系统正常运行的情况下，捕获了所有指定方法的调用及传入参数。</p><p><strong>注意</strong>：Btrace 可以跟踪指定方法的传入参数。获取方法的参数值，对于现场问题排查会很有帮助。</p></li><li><p>取得任意行代码信息</p><p>通过 BTrace 脚本 @Location 注释，可以指定程序运行到某一行代码时，触发某一行为。下例显示了通过 BTrace 脚本获取 HoldNetTask 类第 27 行代码的信息（当目标程序运行到第 27 行时，触发 BTrace 脚本）。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span></span><span class="token class-name">BTraceUtils</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@BTrace</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AllLines</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@OnMethod</span><span class="token punctuation">(</span>
            clazz <span class="token operator">=</span> <span class="token string">&quot;/.*HoldNetTask/&quot;</span><span class="token punctuation">,</span>                            <span class="token comment">// 监控以 HoldNetTask 结尾的类</span>
            location <span class="token operator">=</span> <span class="token annotation punctuation">@Location</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">Kind</span><span class="token punctuation">.</span>LINE<span class="token punctuation">,</span> line <span class="token operator">=</span> <span class="token number">27</span><span class="token punctuation">)</span>    <span class="token comment">// 指定在第 27 行触发</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">online</span><span class="token punctuation">(</span><span class="token annotation punctuation">@ProbeClassName</span> <span class="token class-name">String</span> pcn<span class="token punctuation">,</span>
                              <span class="token annotation punctuation">@ProbeMethodName</span> <span class="token class-name">String</span> pmn<span class="token punctuation">,</span>
                              <span class="token keyword">int</span> line<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Strings</span><span class="token punctuation">.</span><span class="token function">strcat</span><span class="token punctuation">(</span>pcn<span class="token punctuation">,</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Strings</span><span class="token punctuation">.</span><span class="token function">strcat</span><span class="token punctuation">(</span>pmn<span class="token punctuation">,</span> <span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">println</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上脚本在目标程序运行到第 27 行时触发，并打印该行信息。该脚本部分输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>geym.zbase.ch6.HoldNetMain_BTrace$HoldNetTask.visitWeb:27
geym.zbase.ch6.HoldNetMain_BTrace$HoldNetTask.visitWeb:27
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>由脚本输出可以看到，BTrace 正确识别出 HoldNetTask 类的第 27 行代码，正处于 visitWeb() 函数的运行区间中。若将 @Location 中 line 的值设置为 1，则 BTrace 脚本将在每一行触发。</p></li><li><p>定时触发</p><p>BTrace 脚本支持定时触发。可以周期性地执行某一行为，获取系统信息。下例使用 @OnTimer 标记制定两个周期性任务，分别为每秒运行一次和每 3 秒运行一次。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span></span><span class="token class-name">BTraceUtils</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@BTrace</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Timers</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@OnTimer</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>                                  <span class="token comment">// 每秒运行</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">getUpTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Strings</span><span class="token punctuation">.</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token string">&quot;1000 msec: &quot;</span><span class="token punctuation">,</span>
                <span class="token class-name">Strings</span><span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token class-name">Sys</span><span class="token punctuation">.</span>VM<span class="token punctuation">.</span><span class="token function">vmUptime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 虚拟机启动时间</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@OnTimer</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>                                  <span class="token comment">// 每 3 秒运行</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">getStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">jstackAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token comment">// 导出线程堆栈</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在脚本的第 6 行，指定一个每秒运行一次的任务，并打印虚拟机的启动时间。在第 12 行，指定一个每 3 秒运行一次的任务，每次都将导出系统的线程快照。</p><p><strong>注意</strong>：通过 BTrace 可以在当前应用程序中，定时获取一些运行时系统信息。</p></li><li><p>获取类的属性</p><p>在程序运行过程中，BTrace 还可以在指定的位置获得对象实例的字段信息。比如在本实例中，可以在调用 URL.openConnection() 时查看实际打开的 URL 地址，代码如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span></span><span class="token class-name">BTraceUtils</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@BTrace</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PrintField</span> <span class="token punctuation">{</span>
    <span class="token comment">// 打印实例属性</span>
    <span class="token annotation punctuation">@OnMethod</span><span class="token punctuation">(</span>clazz <span class="token operator">=</span> <span class="token string">&quot;/.*URL/&quot;</span><span class="token punctuation">,</span>
            method <span class="token operator">=</span> <span class="token string">&quot;/.*openConnection/&quot;</span><span class="token punctuation">,</span> location <span class="token operator">=</span> <span class="token annotation punctuation">@Location</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">Kind</span><span class="token punctuation">.</span>ENTRY<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">visitWebEntry</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Self</span> <span class="token class-name">Object</span> self<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token function">probeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">probeMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">println</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token function">classOf</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;protocolPathProp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 只能取值 static</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token function">classOf</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;host&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 获得实例变量</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;===========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里监控 URL 对象，在调用 openConnection() 方法时，获得当前对象实例 self，然后获取对应实例的 host 等属性。这段代码的执行结果如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>java.net.URL.openConnection
http://www.sina.com.cn
java.protocol.handler.pkgs
www.sina.com.cn
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>获取方法调用</p><p>BTrace 还可以获得一个方法的内部调用的方法信息。比如，本例中的 visitWeb() 方法在其内部又调用了 URL.openConnection()、URLConnection.getInputStream()、BufferedReader.readLine() 等方法。通过 BTrace 可以把这些调用的方法依次打印出来：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span></span><span class="token class-name">BTraceUtils</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@BTrace</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PrintField</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@OnMethod</span><span class="token punctuation">(</span>clazz <span class="token operator">=</span> <span class="token string">&quot;/.*HoldNetTask/&quot;</span><span class="token punctuation">,</span>
            method <span class="token operator">=</span> <span class="token string">&quot;visitWeb&quot;</span><span class="token punctuation">,</span> location <span class="token operator">=</span> <span class="token annotation punctuation">@Location</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">Kind</span><span class="token punctuation">.</span>CALL<span class="token punctuation">,</span> clazz <span class="token operator">=</span> <span class="token string">&quot;/.*URL.*/&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;/.*/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">visitWebEntry</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Self</span> <span class="token class-name">Object</span> self<span class="token punctuation">,</span> <span class="token annotation punctuation">@ProbeClassName</span> <span class="token class-name">String</span> pcm<span class="token punctuation">,</span> <span class="token annotation punctuation">@ProbeMethodName</span> <span class="token class-name">String</span> pmn<span class="token punctuation">,</span>
                                     <span class="token annotation punctuation">@TargetInstance</span> <span class="token class-name">Object</span> instance<span class="token punctuation">,</span> <span class="token annotation punctuation">@TargetMethodOrField</span> <span class="token class-name">String</span> method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Strings</span><span class="token punctuation">.</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token string">&quot;Context: &quot;</span><span class="token punctuation">,</span> <span class="token class-name">Strings</span><span class="token punctuation">.</span><span class="token function">strcat</span><span class="token punctuation">(</span>pcm<span class="token punctuation">,</span> <span class="token class-name">Strings</span><span class="token punctuation">.</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token string">&quot;#&quot;</span><span class="token punctuation">,</span> pmn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">classOf</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// 被调用目标对象</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Strings</span><span class="token punctuation">.</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 被调用方法</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述代码监控 HoldNetTask.visitWeb() 方法内部所调用到的包含 &quot;URL” 为类名的类的方法，并给出了被调用方法的名称。程序的输出如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Context: geym/zbase/ch6/HoldNetMain_BTrace$HoldNetTask#visitWeb 
class java.net.URL.openConnection
Context: geym/zbase/ch6/HoldNetMain_BTrace$HoldNetTask#visitWeb 
class sun.net.www.protocol.http.HttpURLConnection.getInputstream
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，在 visitWeb() 方法的执行过程中，先后执行了 openConnection() 和 getInputStream() 方法。在使用这种方式监控调用时，需要注意筛选被调用的方法，因为在一次执行中，可能出现成百上千次调用，如果不加以筛选，那么输出结果集可能会异常庞大而无法处理。</p></li></ol><h2 id="_6-6-来自-jrockit-的礼物-虚拟机诊断工具-mission-control" tabindex="-1"><a class="header-anchor" href="#_6-6-来自-jrockit-的礼物-虚拟机诊断工具-mission-control" aria-hidden="true">#</a> 6.6 来自 JRockit 的礼物：虚拟机诊断工具 Mission Control</h2><p>在 Oracle 收购 Sun 之前，Oracle 的 JRockit 虚拟机提供了一款叫作 JRockit Mission Control 的虚拟机诊断工具。在 Oracle 收购 Sun 之后，Oracle 公司同时拥有了 Sun Hotspot 和 JRockit 两款虚拟机。根据 Oracle 对于 Java 的战略，在今后的发展中，会将 JRockit 的优秀特性移植到 Hotspot 上。其中，一个重要的改进就是在 Sun 的 JDK 中加入了 JRockit 支持。在 Oracle JDK 7 Update 40 之后，Mission Control 这款工具己经绑定在 Oracle JDK 中发布（很不幸，OpenJDK 中并没有该工具）。</p><p>Mission Control 程序为 %JAVA_HOME%/bin/jmc.exe，打开这款软件，主要界面如图6.50 所示。</p><p><img src="/assets/图6-50.e0720875.png" alt="图6-50" loading="lazy"></p><p>图6.50 Oracle Java Mission Control 主要界面</p><h3 id="_6-6-1-mbean-服务器" tabindex="-1"><a class="header-anchor" href="#_6-6-1-mbean-服务器" aria-hidden="true">#</a> 6.6.1 MBean 服务器</h3><p>在 Mission Control 界面左侧的 JVM 浏览器中，枚举了系统内所有的 Java 进程。打开其中一个进程的 MBean 服务器，如图6.51 所示。</p><p><img src="/assets/图6-51.efa7bebb.png" alt="图6-51" loading="lazy"></p><p>图6.51 Oracle Java Mission Control MBean 服务器</p><p>可以看到，Mission Control 的界面非常有特色，在默认的界面中，以飞机仪表的视图显示了 Java 堆使用空间、CPU 使用率和 Live Set + Fragmentation。</p><p>Mission Control 的一大特点是可以自由设置图标内容。比如，如果希望在飞机仪表面板中再增加一个监控项，可以单击右侧的添加按钮进行添加，如图6.52 所示。</p><p><img src="/assets/图6-52.ca520d3e.png" alt="图6-52" loading="lazy"></p><p>图6.52 添加新的监控项</p><p>作为示例这里添加了一个线程数量，如图6.53 所示。</p><p><img src="/assets/图6-53.5b3884d9.png" alt="图6-53" loading="lazy"></p><p>图6.53 添加了线程数量飞机仪表面板</p><p>除了飞机仪表面板，Mission Control 的整个概览面板都是可以调整的。如图6.54 所示，在默认的折线图中，又添加了 eden 区的使用率。</p><p><img src="/assets/图6-54.45163ac1.png" alt="图6-54" loading="lazy"></p><p>图6.54 在折线图中添加新的性能选项</p><p>单击 “运行时” 按钮，如图6.55 所示，通过左下侧的 Tab 页切换，还可以显示内存、垃圾收集、内存池、线程等信息。</p><p><img src="/assets/图6-55.cd187d44.png" alt="图6-55" loading="lazy"></p><p>图6.55 运行时信息</p><h3 id="_6-6-2-飞行记录器-flight-recorder" tabindex="-1"><a class="header-anchor" href="#_6-6-2-飞行记录器-flight-recorder" aria-hidden="true">#</a> 6.6.2 飞行记录器（Flight Recorder）</h3><p>飞行记录器是 Mission Control 提供的另一大功能，和 MBean 服务器不同，它通过记录程序在一段时间内的运行情况，将记录结果进行分析和展示，可以更进一步对系统的性能进行分析和诊断。要使用飞行记录器，要监控的程序必须带以下参数启动：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-XX:+Unlock.CommercialFeatures -XX:+FlightRecorder
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>从参数的命名上可以看到，这个功能带有很重的商业色彩。</p><p>如图6.56 所示，在启动飞行记录器后，默认会进行 1 分钟的系统性能数据釆集。</p><p><img src="/assets/图6-56.c73fc50d.png" alt="图6-56" loading="lazy"></p><p>图6.56 启动飞行记录器</p><p>记录结束后，Mission Control 会自动打开刚才的记录，如图6.57 所示。可以看到，飞行记录器显示了更多的信息。</p><p><img src="/assets/图6-57.91983d22.png" alt="图6-57" loading="lazy"></p><p>图6.57 飞行记录器</p><p>除了常规的内存和 CPU 信息，还有代码、线程和 I/O 等比较重要的信息。以代码为例，它可以显示系统中的热点方法及其占用时间。如图6.58 所示，显示了占用 CPU 时间最多的方法调用树信息。</p><p><img src="/assets/图6-58.b3797dac.png" alt="图6-58" loading="lazy"></p><p>图6.58 方法调用树信息</p><p>在 I/O 页面，还可以看到磁盘文件的读写情况，以及网络 Socket 的访问情况。这里以网络访问为例，图6.59 显示了在记录时间段内程序通过 Socket 访问的远程主机，以及数据读取次数和数据读取数量。限于篇幅，更多详细的内容不再一一罗列，读者可以自行尝试。</p><p><img src="/assets/图6-59.39f4e880.png" alt="图6-59" loading="lazy"></p><p>图6.59 程序进行 Socket 读取的信息</p><h2 id="_6-7-小结" tabindex="-1"><a class="header-anchor" href="#_6-7-小结" aria-hidden="true">#</a> 6.7 小结</h2><p>本章主要介绍了一些监控 Java 虚拟机和操作系统性能表现的实用工具。首先，在操作系统层面，主要涉及 Linux 和 Windows 两个平台，介绍了如何在系统中找到消耗资源最多的进程和线程，进而辅助定位问题。其次，详细介绍了一些 JDK 自带的性能诊断工具，通过这些工具可以更细致地观察虚拟机的运行情况，同时，笔者抛砖引玉，给出了一个加强和改进 jps 命令的方法，有兴趣的读者可以对此做更深入的研究，甚至开发自己的性能监控工具。</p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://gitee.com/anansneaker/vuepress-theme-hope/edit/master/docs/reading-notes/实战Java虚拟机：JVM故障诊断与性能优化/第6章性能监控工具.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/8/16 下午7:56:17</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: cl55563@163.com">阿楠sneaker</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC5%E7%AB%A0%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%92%8C%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html" class="nav-link prev" aria-label="第 5 章 垃圾收集器和内存分配"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->第 5 章 垃圾收集器和内存分配</div></a><a href="/reading-notes/%E5%AE%9E%E6%88%98Java%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%9AJVM%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%AC%AC7%E7%AB%A0%E5%88%86%E6%9E%90Java%E5%A0%86.html" class="nav-link next" aria-label="第 7 章 分析 Java 堆"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">第 7 章 分析 Java 堆<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"></div><div class="copyright">Copyright © 2022 阿楠sneaker</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.0d56c066.js" defer></script>
  </body>
</html>
