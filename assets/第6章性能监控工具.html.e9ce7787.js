import{_ as p}from"./plugin-vue_export-helper.21dcd24c.js";import{r as i,o as l,c,a as s,b as t,e as a,d as n}from"./app.0d56c066.js";var o="/assets/\u88686-1.27891e21.png",u="/assets/\u56FE6-1.b4ae9261.png",d="/assets/\u56FE6-2.17ce4776.png",r="/assets/\u56FE6-3.9190a120.png",v="/assets/\u56FE6-4.0f5fcec3.png",k="/assets/\u56FE6-5.3c419799.png",m="/assets/\u56FE6-6.bcd817b3.png",b="/assets/\u56FE6-7.96e99bb0.png",g="/assets/\u56FE6-8.17356fa7.png",h="/assets/\u56FE6-9.55e5e92e.png",x="/assets/\u56FE6-10.811511fa.png",y="/assets/\u56FE6-11.115822dc.png",f="/assets/\u56FE6-12.85e226d0.png",j="/assets/\u56FE6-13.32251852.png",w="/assets/\u56FE6-14.ec660c4c.png",C="/assets/\u56FE6-15.a586abca.png",_="/assets/\u56FE6-16.2abea8af.png",T="/assets/\u56FE6-17.dfe5b257.png",M="/assets/\u56FE6-18.003fb210.png",S="/assets/\u56FE6-19.3e76212f.png",P="/assets/\u56FE6-20.c53cf0fe.png",J="/assets/\u56FE6-21.8278aea6.png",D="/assets/\u56FE6-22.cc02a958.png",U="/assets/\u56FE6-23.041035e9.png",q="/assets/\u56FE6-24.644f3d57.png",L="/assets/\u56FE6-25.256d5b0c.png",z="/assets/\u56FE6-26.19ac651c.png",I="/assets/\u56FE6-27.036fa897.png",B="/assets/\u56FE6-28.1ce922a5.png",O="/assets/\u56FE6-29.afcdd437.png",V="/assets/\u56FE6-30.f6ff81cc.png",G="/assets/\u56FE6-31.e6d937c4.png",A="/assets/\u56FE6-32.7367883f.png",R="/assets/\u56FE6-33.76796645.png",N="/assets/\u56FE6-34.e322b5c9.png",H="/assets/\u56FE6-35.a58920e7.png",E="/assets/\u56FE6-36.39f45b9b.png",F="/assets/\u56FE6-37.3f480101.png",W="/assets/\u56FE6-38.115585a1.png",K="/assets/\u56FE6-39.03f57ea6.png",X="/assets/\u56FE6-40.5eb7a7fd.png",$="/assets/\u56FE6-41.e22be49c.png",Q="/assets/\u56FE6-42.4772ac73.png",Y="/assets/\u56FE6-43.d6d1afdc.png",Z="/assets/\u56FE6-44.f7da41fc.png",nn="/assets/\u56FE6-45.3e7f8e29.png",sn="/assets/\u56FE6-46.eabf5e13.png",an="/assets/\u56FE6-47.96d2560b.png",en="/assets/\u56FE6-48.6f03ce20.png",tn="/assets/\u56FE6-49.bd65ce89.png",pn="/assets/\u56FE6-50.e0720875.png",ln="/assets/\u56FE6-51.efa7bebb.png",cn="/assets/\u56FE6-52.ca520d3e.png",on="/assets/\u56FE6-53.5b3884d9.png",un="/assets/\u56FE6-54.45163ac1.png",dn="/assets/\u56FE6-55.cd187d44.png",rn="/assets/\u56FE6-56.c73fc50d.png",vn="/assets/\u56FE6-57.91983d22.png",kn="/assets/\u56FE6-58.b3797dac.png",mn="/assets/\u56FE6-59.39f4e880.png";const bn={},gn=a(`<h1 id="\u7B2C-6-\u7AE0-\u6027\u80FD\u76D1\u63A7\u5DE5\u5177" tabindex="-1"><a class="header-anchor" href="#\u7B2C-6-\u7AE0-\u6027\u80FD\u76D1\u63A7\u5DE5\u5177" aria-hidden="true">#</a> \u7B2C 6 \u7AE0 \u6027\u80FD\u76D1\u63A7\u5DE5\u5177</h1><p>\u6027\u80FD\u662F\u4EFB\u4F55\u4E00\u6B3E\u8F6F\u4EF6\u90FD\u9700\u8981\u5173\u6CE8\u7684\u91CD\u8981\u6307\u6807\u3002\u9664\u4E86\u8F6F\u4EF6\u7684\u57FA\u672C\u529F\u80FD\uFF0C\u6027\u80FD\u53EF\u4EE5\u8BF4\u662F\u8BC4\u4EF7\u8F6F\u4EF6\u4F18\u52A3\u7684\u6700\u91CD\u8981\u7684\u6307\u6807\u4E4B\u4E00\u3002\u6211\u4EEC\u8BE5\u5982\u4F55\u6709\u6548\u5730\u76D1\u63A7\u548C\u8BCA\u65AD\u6027\u80FD\u95EE\u9898\u5462\uFF1F\u672C\u7AE0\u57FA\u4E8E\u5B9E\u8DF5\uFF0C\u7740\u91CD\u4ECB\u7ECD\u4E00\u4E9B\u9488\u5BF9\u7CFB\u7EDF\u548C Java \u865A\u62DF\u673A\u7684\u76D1\u63A7\u548C\u8BCA\u65AD\u5DE5\u5177\uFF0C\u4EE5\u5E2E\u52A9\u8BFB\u8005\u5728\u5B9E\u9645\u5F00\u53D1\u8FC7\u7A0B\u4E2D\u6539\u5584\u7CFB\u7EDF\u6027\u80FD\u3002</p><p>\u672C\u7AE0\u6D89\u53CA\u7684\u4E3B\u8981\u77E5\u8BC6\u70B9\u6709\uFF1A</p><ul><li><p>Linux \u4E0B\u7684\u6027\u80FD\u76D1\u63A7\u5DE5\u5177\u3002</p></li><li><p>Windows \u4E0B\u7684\u6027\u80FD\u76D1\u63A7\u5DE5\u5177\u3002</p></li><li><p>JDK \u81EA\u5E26\u7684\u547D\u4EE4\u884C\u5DE5\u5177\u3002</p></li><li><p>JConsole\u3001VisualVM \u548C Mission Control \u7684\u4ECB\u7ECD\u3002</p></li></ul><h2 id="_6-1-\u6709\u6211\u66F4\u9AD8\u6548-linux-\u4E0B\u7684\u6027\u80FD\u76D1\u63A7\u5DE5\u5177" tabindex="-1"><a class="header-anchor" href="#_6-1-\u6709\u6211\u66F4\u9AD8\u6548-linux-\u4E0B\u7684\u6027\u80FD\u76D1\u63A7\u5DE5\u5177" aria-hidden="true">#</a> 6.1 \u6709\u6211\u66F4\u9AD8\u6548\uFF1ALinux \u4E0B\u7684\u6027\u80FD\u76D1\u63A7\u5DE5\u5177</h2><p>Linux \u5E73\u53F0\u662F\u4F7F\u7528\u6700\u5E7F\u6CDB\u7684\u670D\u52A1\u5668\u5E73\u53F0\u4E4B\u4E00\u3002\u4E0D\u5C11 Java \u7AEF\u7A0B\u5E8F\u90FD\u8FD0\u884C\u5728\u7C7B Linux \u5E73\u53F0\u4E0B\uFF08\u5982 AIX\u3001Solaris \u7B49\uFF09\u3002\u4E0D\u540C\u7684\u7C7B Linux \u64CD\u4F5C\u7CFB\u7EDF\u7684\u5F88\u591A\u547D\u4EE4\u90FD\u975E\u5E38\u76F8\u4F3C\uFF0C\u4E0D\u5C11\u547D\u4EE4\u53EA\u6709\u4E00\u4E9B\u7EC6\u8282\u4E0A\u7684\u5DEE\u5F02\u3002\u672C\u8282\u4E3B\u8981\u4ECB\u7ECD\u7528\u4E8E Linux \u5E73\u53F0\u7684\u6027\u80FD\u6536\u96C6\u548C\u7EDF\u8BA1\u5DE5\u5177\u3002</p><h3 id="_6-1-1-\u663E\u793A\u7CFB\u7EDF\u6574\u4F53\u8D44\u6E90\u4F7F\u7528\u60C5\u51B5\u2014\u2014top-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_6-1-1-\u663E\u793A\u7CFB\u7EDF\u6574\u4F53\u8D44\u6E90\u4F7F\u7528\u60C5\u51B5\u2014\u2014top-\u547D\u4EE4" aria-hidden="true">#</a> 6.1.1 \u663E\u793A\u7CFB\u7EDF\u6574\u4F53\u8D44\u6E90\u4F7F\u7528\u60C5\u51B5\u2014\u2014top \u547D\u4EE4</h3><p>top \u547D\u4EE4\u662F Linux \u5E38\u7528\u7684\u6027\u80FD\u5206\u6790\u5DE5\u5177\uFF0C\u80FD\u591F\u5B9E\u65F6\u663E\u793A\u7CFB\u7EDF\u4E2D\u5404\u4E2A\u8FDB\u7A0B\u7684\u8D44\u6E90\u5360\u7528\u72B6\u51B5\u3002top \u547D\u4EE4\u7684\u90E8\u5206\u8F93\u51FA\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code> [root@redhat6 tmp]# top                               
 top - 09:33:57 UP 6:37, 3 users, load average:0.10, 0.05, 0.07
 Tasks: 191 total, 1 running, 190 sleeping, 0 stopped, 0 zombie
 Cpu(s): 3.3%us, 2.2%sy, 0.0%ni, 94.5%id, 0.0%wa, 0.0%hi, 0.0%si, 0.0%st
 Mem: 2071628k total, 1738012k used, 333616k free, 75044k buffers
 Swap: 4161528k total, 5348k used, 4156180k free, 1095040k cached

 PID    USER    PR      NI      VIRT        RES     SHR     S   %CPU    %MEM    TIME+   COMMAND
 2078   root    20      0       56016       25m     8348    S   9.3     1.3     4:39.27 Xorg
 4022   oracle  20      0       82540       13m     9.9m    S   1.3     0.7	    0:11.28 gnome-terminal
 16055  root    20      0       2660        1144    872     R   0.3     0.1     0:00.03 top
 1      root    20      0       2828        1272    1068    S   0.0     0.1     0:02.02 init
 2      root    20      0       0           0       0       S   0.0     0.0     0:00.00 kthreadd
 3      root    RT      0       0           0       0       S   0.0     0.0     0:00.74 migration/0
 4      root    20      0       0           0       0       S   0.0     0.0     0:00.01 ksoftirqd/0
 5      root    RT      0       0           0       0       S   0.0     0.0     0:00.00 watchdog/0
 6      root    RT      0       0           0       0       S   0.0     0.0     0:00.40 migration/1
 7      root    20      0       0           0       0       S   0.0     0.0     0:00.01 ksoftirqd/1
 8      root    RT      0       0           0       0       S   0.0     0.0     0:00.00 watchdog/1
 9      root    20      0       0           0       0       S   0.0     0.0     0:00.13 events/0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>top \u547D\u4EE4\u7684\u8F93\u51FA\u53EF\u4EE5\u5206\u4E3A\u4E24\u4E2A\u90E8\u5206\uFF1A\u524D\u534A\u90E8\u5206\u662F\u7EDF\u8BA1\u4FE1\u606F\uFF0C\u540E\u534A\u90E8\u5206\u662F\u8FDB\u7A0B\u4FE1\u606F\u3002</p><p>\u5728\u7EDF\u8BA1\u4FE1\u606F\u4E2D\uFF0C\u7B2C 1 \u884C\u662F\u4EFB\u52A1\u961F\u5217\u4FE1\u606F\uFF0C\u5B83\u7684\u7ED3\u679C\u7B49\u540C\u4E8E uptime \u547D\u4EE4\u3002\u4ECE\u5DE6\u5230\u53F3\u4F9D\u6B21\u8868\u793A\u7CFB\u7EDF\u5F53\u524D\u65F6\u95F4\u3001\u7CFB\u7EDF\u8FD0\u884C\u65F6\u95F4\u3001\u5F53\u524D\u767B\u5F55\u7528\u6237\u6570\u3002\u6700\u540E\u7684 load average \u8868\u793A\u7CFB\u7EDF\u7684\u5E73\u5747\u8D1F\u8F7D\uFF0C\u5373\u4EFB\u52A1\u961F\u5217\u7684\u5E73\u5747\u957F\u5EA6\uFF0C\u5176\u4E2D\u7684 3 \u4E2A\u503C\u5206\u522B\u8868\u793A 1 \u5206\u949F\u30015 \u5206\u949F\u300115 \u5206\u949F\u5230\u73B0\u5728\u7684\u5E73\u5747\u503C\u3002</p><p>\u7B2C 2 \u884C\u662F\u8FDB\u7A0B\u7EDF\u8BA1\u4FE1\u606F\uFF0C\u5206\u522B\u662F\u6B63\u5728\u8FD0\u884C\u7684\u8FDB\u7A0B\u6570\u3001\u7761\u7720\u8FDB\u7A0B\u6570\u3001\u505C\u6B62\u7684\u8FDB\u7A0B\u6570\u3001\u50F5\u5C38\u8FDB\u7A0B\u6570\u3002</p><p>\u7B49 3 \u884C\u662F CPU \u7EDF\u8BA1\u4FE1\u606F\uFF0Cus \u8868\u793A\u7528\u6237\u7A7A\u95F4 CPU \u5360\u7528\u7387\u3001sy \u8868\u793A\u5185\u6838\u7A7A\u95F4 CPU \u5360\u7528\u7387\u3001ni \u8868\u793A\u7528\u6237\u8FDB\u7A0B\u7A7A\u95F4\u6539\u53D8\u8FC7\u4F18\u5148\u7EA7\u7684\u8FDB\u7A0B CPU \u7684\u5360\u7528\u7387\u3001id \u8868\u793A\u7A7A\u95F2 CPU \u5360\u7528\u7387\u3001wa \u8868\u793A\u7B49\u5F85\u8F93\u5165\u548C\u8F93\u51FA\u7684 CPU \u65F6\u95F4\u767E\u5206\u6BD4\u3001hi \u8868\u793A\u786C\u4EF6\u4E2D\u65AD\u8BF7\u6C42\u3001si \u8868\u793A\u8F6F\u4EF6\u4E2D\u65AD\u8BF7\u6C42\u3002\u5728 Mem \u4E2D\uFF0C\u4ECE\u5DE6\u5230\u53F3\uFF0C\u4F9D\u6B21\u8868\u793A\u7269\u7406\u5185\u5B58\u603B\u91CF\u3001\u5DF1\u4F7F\u7528\u7684\u7269\u7406\u5185\u5B58\u3001\u7A7A\u95F2\u7269\u7406\u5185\u5B58\u3001\u5185\u6838\u7F13\u51B2\u4F7F\u7528\u91CF\u3002\u5728 Swap \u4E2D\uFF0C\u4F9D\u6B21\u8868\u793A\u4EA4\u6362\u533A\u603B\u91CF\u3001\u7A7A\u95F2\u4EA4\u6362\u533A\u5927\u5C0F\u3001\u7F13\u51B2\u4EA4\u6362\u533A\u5927\u5C0F\u3002</p><p>top \u547D\u4EE4\u7684\u7B2C 2 \u90E8\u5206\u662F\u8FDB\u7A0B\u4FE1\u606F\uFF0C\u663E\u793A\u4E86\u7CFB\u7EDF\u5185\u5404\u4E2A\u8FDB\u7A0B\u7684\u8D44\u6E90\u4F7F\u7528\u60C5\u51B5\uFF0C\u4E3B\u8981\u5B57\u6BB5\u7684\u542B\u4E49\u5982\u4E0B\u3002</p><ul><li><p>PID\uFF1A\u8FDB\u7A0B ID\u3002</p></li><li><p>USER\uFF1A\u8FDB\u7A0B\u6240\u6709\u8005\u7684\u7528\u6237\u540D\u3002</p></li><li><p>PR\uFF1A\u4F18\u5148\u7EA7\u3002</p></li><li><p>NI\uFF1Anice \u503C\uFF0C\u8D1F\u503C\u8868\u793A\u9AD8\u4F18\u5148\u7EA7\uFF0C\u6B63\u503C\u8868\u793A\u4F4E\u4F18\u5148\u7EA7\u3002</p></li><li><p>%CPU\uFF1A\u4E0A\u6B21\u66F4\u65B0\u5230\u73B0\u5728\u7684 CPU \u65F6\u95F4\u5360\u7528\u767E\u5206\u6BD4\u3002</p></li><li><p>TIME+\uFF1A\u8FDB\u7A0B\u4F7F\u7528\u7684 CPU \u65F6\u95F4\u603B\u8BA1\uFF0C\u5355\u4F4D\u4E3A 1/100 \u79D2\u3002</p></li><li><p>%MEM\uFF1A\u8FDB\u7A0B\u4F7F\u7528\u7684\u7269\u7406\u5185\u5B58\u767E\u5206\u6BD4\u3002</p></li><li><p>VIRT\uFF1A\u8FDB\u7A0B\u4F7F\u7528\u7684\u865A\u62DF\u5185\u5B58\u603B\u91CF\uFF0C\u5355\u4F4D\u4E3A KB\uFF0CVIRT = SWAP + RES\u3002</p></li><li><p>RES\uFF1A\u8FDB\u7A0B\u4F7F\u7528\u7684\u3001\u672A\u88AB\u6362\u51FA\u7684\u7269\u7406\u5185\u5B58\u5927\u5C0F\uFF0C\u5355\u4F4D\u4E3AKB\uFF0CRES = CODE + DATA\u3002</p></li><li><p>SHR\uFF1A\u5171\u4EAB\u5185\u5B58\u5927\u5C0F\uFF0C\u5355\u4F4D\u4E3A KB\u3002</p></li><li><p>COMMAND\uFF1A\u547D\u4EE4\u540D / \u547D\u4EE4\u884C\u3002</p></li></ul><p><strong>\u6CE8\u610F</strong>\uFF1A\u4F7F\u7528 top \u547D\u4EE4\u53EF\u4EE5\u4ECE\u5B8F\u89C2\u4E0A\u89C2\u5BDF\u7CFB\u7EDF\u4E2D\u5404\u4E2A\u8FDB\u7A0B\u7684 CPU \u5360\u7528\u60C5\u51B5\uFF0C\u4EE5\u53CA\u5185\u5B58\u4F7F\u7528\u60C5\u51B5\u3002</p><h3 id="_6-1-2-\u76D1\u63A7\u5185\u5B58\u548C-cpu\u2014\u2014vmstat-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_6-1-2-\u76D1\u63A7\u5185\u5B58\u548C-cpu\u2014\u2014vmstat-\u547D\u4EE4" aria-hidden="true">#</a> 6.1.2 \u76D1\u63A7\u5185\u5B58\u548C CPU\u2014\u2014vmstat \u547D\u4EE4</h3><p>vmstat \u547D\u4EE4\u4E5F\u662F\u4E00\u4E2A\u529F\u80FD\u6BD4\u8F83\u9F50\u5168\u7684\u6027\u80FD\u76D1\u6D4B\u5DE5\u5177\u3002\u5B83\u53EF\u4EE5\u7EDF\u8BA1 CPU\u3001\u5185\u5B58\u4F7F\u7528\u60C5\u51B5\u3001Swap \u4F7F\u7528\u60C5\u51B5\u7B49\u4FE1\u606F\u3002\u548C sar \u5DE5\u5177\u7C7B\u4F3C\uFF0Cvmstat \u4E5F\u53EF\u4EE5\u6307\u5B9A\u91C7\u6837\u5468\u671F\u548C\u91C7\u6837\u6B21\u6570\u3002</p><p>\u3010\u793A\u4F8B 6-1\u3011\u4E0B\u4F8B\u6BCF\u79D2\u91C6\u6837\u4E00\u6B21\uFF0C\u5171\u8BA1 3 \u6B21\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[root@redhat6 tmp]# vmstat 1 3
 procs ----------------------memory----------- ----swap-- ---io---- ----system----- --cpu--------
 r      b       swpd      free    buff  cache   si  so  bi    bo    in   cs   us  sy  id  wa  st
 0      0       5312    221444  119176  1122592  73  0  0     34    185  281   1   2  97   1   0
 0      0       5312    221048  119176  1122592  32  0  0     0     442  725   2   1  97   0   0
 0      0       5312    221048  119176  1122592  0   0  0     0     463  741   2   1  97   0   0 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\u4E2D\u5404\u5217\u542B\u4E49\u5982\u88686.1 \u6240\u793A\u3002</p><p>\u88686.1 vmstat \u547D\u4EE4\u8F93\u51FA\u7ED3\u679C\u4E2D\u5404\u5217\u542B\u4E49</p><p><img src="`+o+`" alt="\u88686-1" loading="lazy"></p><p>\u3010\u793A\u4F8B 6-2\u3011\u4EE5\u4E0B\u4EE3\u7801\u663E\u793A\u4E86\u4E00\u4E2A\u7EBF\u7A0B\u5207\u6362\u9891\u7E41\u7684 Java \u7A0B\u5E8F\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HoldIOckMain</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Random</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lock<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            lock<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u4E00\u4E2A\u6301\u6709\u9501\u7684\u7EBF\u7A0B</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">HoldIOckTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">HoldIOckTask</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>i <span class="token operator">=</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// \u6301\u6709\u9501</span>
                    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                            <span class="token comment">// \u7B49\u5F85</span>
                            lock<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">else</span>
                            <span class="token comment">// \u901A\u77E5</span>
                            lock<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u6BCF 2 \u4E2A\u7EBF\u7A0B\uFF0C\u4F7F\u7528\u540C\u4E00\u9501\u5BF9\u8C61</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lock<span class="token punctuation">.</span>length <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HoldIOckTask</span><span class="token punctuation">(</span>i <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u7528 vmstat \u5DE5\u5177\u76D1\u63A7\u4E0A\u8FF0 Java \u7A0B\u5E8F\u6267\u884C\u65F6\u7684\u60C5\u51B5\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[oracle@redhat6 ~]$ vmstat 1 4
 procs ----------------------memory----------- ----swap-- ---io---- ----system----- --cpu--------
 r      b       swpd      free    buff  cache    si  so  bi    bo    in    cs    us   sy  id  wa  st
 6      0       5472    185240  134860  1257524  65   0  0     24    192   302    2    1  96   0   0
 7      0       5472    185108  134860  1257524  0    0  0     0     2399  2451   99   1   0   0   0
 9      0       5472    185124  134860  1257524  0    0  0     0     2350  2410   99   1   0   0   0 
 7      0       5472    185124  134860  1257524  128  0  0     0     2339  2367   99   1   0   0   0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u52A0\u7C97\u90E8\u5206\u6709\u7740\u5F88\u9AD8\u7684 cs \u503C\uFF08\u4E0A\u4E0B\u6587\u5207\u6362\uFF09\u548C us \u503C\uFF08\u7528\u6237 CPU \u65F6\u95F4\uFF09\uFF0C\u8868\u660E\u7CFB\u7EDF\u7684\u4E0A\u4E0B\u6587\u5207\u6362\u9891\u7E41\uFF0C\u7528\u6237 CPU \u5360\u7528\u7387\u5F88\u9AD8\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1Avmstat \u5DE5\u5177\u53EF\u4EE5\u67E5\u770B\u5185\u5B58\u3001\u4EA4\u4E92\u5206\u533A\u3001I/O \u64CD\u4F5C\u3001\u4E0A\u4E0B\u6587\u5207\u6362\u3001\u65F6\u949F\u4E2D\u65AD\u53CA CPU \u7684\u4F7F\u7528\u60C5\u51B5\u3002</p><h3 id="_6-1-3-\u76D1\u63A7-i-o\u2014\u2014iostat-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_6-1-3-\u76D1\u63A7-i-o\u2014\u2014iostat-\u547D\u4EE4" aria-hidden="true">#</a> 6.1.3 \u76D1\u63A7 I/O\u2014\u2014iostat \u547D\u4EE4</h3><p>iostat \u547D\u4EE4\u53EF\u4EE5\u63D0\u4F9B\u8BE6\u7EC6\u7684 I/O \u4FE1\u606F\uFF0C\u5B83\u7684\u57FA\u672C\u4F7F\u7528\u65B9\u6CD5\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[root@redhat6 tmp]# iostat 1 2
Linux 2.6.32-71.el6.i686 (redhat6) 03/25/2012 _i686_ (2 CPU) 

avg-cpu: %user  %nice  %system  %iowait  %steal  %idle
         1.05   0.00   1.67	    0.63     0.00     96.64

Device:    tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
sda       7.21    62.88        35.64        2083412    1180818
dm-0     13.29    62.66        35.41        2076369    1173160
dm-1      0.09     0.11         0.23           3720       7640

avg-cpu: %user  %nice  %system  %iowait  %steal  %idle
         1.49   0.00   11.94    0.00     0.00    86.57

Device:    tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
sda       7.00     4.00        16.00             4        16
dm-0      8.00     4.00        16.00             4        16
dm-1      0.00     0.00         0.00             0         0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE5\u4E0A\u547D\u4EE4\u663E\u793A\u4E86 CPU \u7684\u4F7F\u7528\u6982\u51B5\u548C\u78C1\u76D8 I/O \u7684\u4FE1\u606F\u3002\u8F93\u51FA\u4FE1\u606F\u6BCF 1 \u79D2\u91C6\u6837 1 \u6B21\uFF0C\u5408\u8BA1\u91C6\u6837\u4E24\u6B21\u3002\u5982\u679C\u53EA\u9700\u8981\u663E\u793A\u78C1\u76D8\u60C5\u51B5\uFF0C\u4E0D\u9700\u8981\u663E\u793A CPU \u4F7F\u7528\u60C5\u51B5\uFF0C\u5219\u53EF\u4EE5\u4F7F\u7528\u547D\u4EE4\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>iostat -d 1 2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>-d \u8868\u793A\u8F93\u51FA\u78C1\u76D8\u4F7F\u7528\u60C5\u51B5\u3002\u8F93\u51FA\u7ED3\u679C\u4E2D\u5404\u5217\u7684\u542B\u4E49\u5982\u4E0B\u3002</p><ul><li><p>tps\uFF1A\u8BE5\u8BBE\u5907\u6BCF\u79D2\u7684\u4F20\u8F93\u6B21\u6570\u3002</p></li><li><p>kB_read/s\uFF1A\u6BCF\u79D2\u4ECE\u8BBE\u5907\u8BFB\u53D6\u7684\u6570\u636E\u91CF\u3002</p></li><li><p>kB_wrtn/s\uFF1A\u6BCF\u79D2\u5411\u8BBE\u5907\u5199\u5165\u7684\u6570\u636E\u91CF\u3002</p></li><li><p>kB_read\uFF1A\u8BFB\u53D6\u7684\u603B\u6570\u636E\u91CF\u3002</p></li><li><p>kB_wrtn\uFF1A\u5199\u5165\u7684\u603B\u6570\u636E\u91CF\u3002</p></li></ul><p>\u5982\u679C\u9700\u8981\u5F97\u5230\u66F4\u591A\u7684\u7EDF\u8BA1\u4FE1\u606F\uFF0C\u53EF\u4EE5\u4F7F\u7528 -x \u9009\u9879\uFF0C\u5982\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>iostat -x 1 2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>\u6CE8\u610F</strong>\uFF1A\u78C1\u76D8 I/O \u5F88\u5BB9\u6613\u6210\u4E3A\u7CFB\u7EDF\u6027\u80FD\u74F6\u9888\uFF0C\u901A\u8FC7 iostat \u547D\u4EE4\u53EF\u4EE5\u5FEB\u901F\u5B9A\u4F4D\u7CFB\u7EDF\u662F\u5426\u4EA7\u751F\u4E86\u5927\u91CF\u7684 I/O \u64CD\u4F5C\u3002</p><h3 id="_6-1-4-\u591A\u529F\u80FD\u8BCA\u65AD\u5668\u2014\u2014pidstat-\u5DE5\u5177" tabindex="-1"><a class="header-anchor" href="#_6-1-4-\u591A\u529F\u80FD\u8BCA\u65AD\u5668\u2014\u2014pidstat-\u5DE5\u5177" aria-hidden="true">#</a> 6.1.4 \u591A\u529F\u80FD\u8BCA\u65AD\u5668\u2014\u2014pidstat \u5DE5\u5177</h3>`,40),hn=n("pidstat \u662F\u4E00\u4E2A\u529F\u80FD\u5F3A\u5927\u7684\u6027\u80FD\u76D1\u6D4B\u5DE5\u5177\uFF0C\u4E5F\u662F Sysstat \u7684\u7EC4\u4EF6\u4E4B\u4E00\u3002\u8BFB\u8005\u53EF\u4EE5\u5728 "),xn={href:"http://www.icewalkers.com/Linux/Software/59040/Sysstat.html",target:"_blank",rel:"noopener noreferrer"},yn=n("http://www.icewalkers.com/Linux/Software/59040/Sysstat.html"),fn=n(" \u4E0B\u8F7D\u8FD9\u4E2A\u5DE5\u5177\u3002\u4E0B\u8F7D\u540E\uFF0C\u901A\u8FC7 ./configure\u3001make\u3001make install \u7B49 3 \u4E2A\u547D\u4EE4\u5373\u53EF\u5B89\u88C5 pidstat \u5DE5\u5177\u3002\u5982\u679C\u662F Ubuntu \u7CFB\u7EDF\uFF0C\u4E5F\u53EF\u4EE5\u7B80\u5355\u5730\u901A\u8FC7\u4EE5\u4E0B\u547D\u4EE4\u5B89\u88C5\uFF1A"),jn=a(`<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo apt-get install sysstat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>pidstat \u5DE5\u5177\u7684\u5F3A\u5927\u4E4B\u5904\u5728\u4E8E\uFF0C\u5B83\u4E0D\u4EC5\u53EF\u4EE5\u76D1\u89C6\u8FDB\u7A0B\u7684\u6027\u80FD\u60C5\u51B5\uFF0C\u4E5F\u53EF\u4EE5\u76D1\u89C6\u7EBF\u7A0B\u7684\u6027\u80FD\u60C5\u51B5\u3002\u672C\u8282\u5C06\u8BE6\u7EC6\u4ECB\u7ECD pidstat \u5728\u8FD9\u65B9\u9762\u7684\u529F\u80FD\u3002</p><ol><li><p>CPU \u4F7F\u7528\u7387\u76D1\u63A7</p><p>\u3010\u793A\u4F8B 6-3\u3011\u4E0B\u4F8B\u662F\u4E00\u4E2A\u7B80\u5355\u5730\u5360\u7528 CPU \u7684\u7A0B\u5E8F\uFF0C\u5B83\u5F00\u542F\u4E86 4 \u4E2A\u7528\u6237\u7EBF\u7A0B\uFF0C\u5176\u4E2D\uFF0C1 \u4E2A\u7EBF\u7A0B\u5927\u91CF\u5360\u7528 CPU \u8D44\u6E90\uFF0C\u5176\u4ED6 3 \u4E2A\u7EBF\u7A0B\u5219\u5904\u4E8E\u7A7A\u95F2\u72B6\u6001\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HoldCPUMain</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">HoldCPUTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u5360\u7528 CPU</span>
                <span class="token keyword">double</span> a <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">LazyTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// \u7A7A\u95F2\u7EBF\u7A0B</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5F00\u542F\u7EBF\u7A0B\uFF0C\u5360\u7528 CPU</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HoldCPUTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u7A7A\u95F2\u7EBF\u7A0B</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LazyTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LazyTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LazyTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD0\u884C\u4EE5\u4E0A\u7A0B\u5E8F\uFF0C\u8981\u76D1\u63A7\u8BE5\u7A0B\u5E8F\u7684 CPU \u4F7F\u7528\u7387\uFF0C\u53EF\u4EE5\u5148\u4F7F\u7528 jps \u547D\u4EE4\u627E\u5230 Java \u7A0B\u5E8F\u7684 PID\uFF0C\u7136\u540E\u4F7F\u7528 pidstat \u547D\u4EE4\u8F93\u51FA\u7A0B\u5E8F\u7684 CPU \u4F7F\u7528\u60C5\u51B5\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[root@redhat6 tmp]# jps
443 Jps
16185
1187 HoldCPUMain
[root@redhat6 tmp]# pidstat -p 1187 -u 1 3
Linux 2.6.32-71.el6.i686 (redhat6) 03/25/2012	_i686_	(2 CPU)
 01:38:19 PM   PID   %usr  %system  %guest  %CPU   CPU   Command             
 01:38:20 PM   1187  99.01   0.00    0.00   99.01    1     java 
 01:38:21 PM   1187  100.00  0.00    0.00   100.00   1     java 
 01:38:22 PM   1187  99.00   0.00    0.00   99.00    1     java 
 Average:      1187  99.34   0.00    0.00   99.34    -     java 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>pidstat \u7684\u53C2\u6570 -p \u7528\u4E8E\u6307\u5B9A\u8FDB\u7A0B ID\uFF0C-u \u8868\u793A\u5BF9 CPU \u4F7F\u7528\u7387\u7684\u76D1\u63A7\u3002\u53C2\u6570 1 3 \u8868\u793A\u6BCF\u79D2\u91C7\u6837\u4E00\u6B21\uFF0C\u5408\u8BA1\u91C6\u6837 3 \u6B21\u3002\u4ECE\u8FD9\u4E2A\u8F93\u51FA\u4E2D\u53EF\u4EE5\u770B\u5230\uFF0C\u8BE5\u5E94\u7528\u7A0B\u5E8F CPU \u5360\u7528\u7387\u51E0\u4E4E\u8FBE\u5230 100%\u3002pidstat \u7684\u529F\u80FD\u4E0D\u4EC5\u4EC5\u9650\u4E8E\u89C2\u5BDF\u8FDB\u7A0B\u4FE1\u606F\uFF0C\u8FD8\u53EF\u4EE5\u8FDB\u4E00\u6B65\u76D1\u63A7\u7EBF\u7A0B\u7684\u4FE1\u606F\u3002\u4F7F\u7528\u4EE5\u4E0B\u547D\u4EE4\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>pidstat -p 1187 1 3 -u -t
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8FD9\u4E2A\u547D\u4EE4\u7684\u90E8\u5206\u8F93\u51FA\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>01:47:30 PM    TGID   TID    %usr    %system    %guest    %CPU   CPU     Command
01:47:31 PM    1187    -     98.02    0.00       0.00     98.02   0      java
01:47:31 PM      -    1187   0.00     0.00       0.00     0.00    0      |__java
\u7701\u7565\u90E8\u5206\u7EBF\u7A0B
01:47:31 PM      -    1203   0.00     0.00       0.00     0.00    0      |__java
01:47:31 PM      -    1204   97.03    0.00       0.00     97.03   1      |__java
\u7701\u7565\u90E8\u5206\u7EBF\u7A0B
01:47:31 PM      -    1207   0.00     0.00       0.00     0.00    1      |__java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>-t \u53C2\u6570\u5C06\u7CFB\u7EDF\u6027\u80FD\u7684\u76D1\u63A7\u7EC6\u5316\u5230\u7EBF\u7A0B\u7EA7\u522B\u3002\u4ECE\u8FD9\u4E2A\u8F93\u51FA\u4E2D\u53EF\u4EE5\u77E5\u9053\uFF0C\u8BE5 Java \u5E94\u7528\u7A0B\u5E8F\u4E4B\u6240\u4EE5\u6709\u5982\u6B64\u9AD8\u7684 CPU \u5360\u7528\u7387\uFF0C\u662F\u56E0\u4E3A\u7EBF\u7A0B 1204 \u7684\u7F18\u6545\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1A\u4F7F\u7528 pidstat \u5DE5\u5177\u4E0D\u4EC5\u53EF\u4EE5\u5B9A\u4F4D\u5230\u8FDB\u7A0B\uFF0C\u751A\u81F3\u53EF\u4EE5\u8FDB\u4E00\u6B65\u5B9A\u4F4D\u5230\u7EBF\u7A0B\u3002</p><p>\u4F7F\u7528\u4EE5\u4E0B\u547D\u4EE4\u53EF\u4EE5\u5BFC\u51FA\u6307\u5B9A Java \u5E94\u7528\u7A0B\u5E8F\u7684\u6240\u6709\u7EBF\u7A0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>jstack -l 1187 &gt; /tmp/t.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5728\u8F93\u51FA\u7684 t.txt \u6587\u4EF6\u4E2D\uFF0C\u53EF\u4EE5\u627E\u5230\u8FD9\u4E48\u4E00\u6BB5\u8F93\u51FA\u5185\u5BB9\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&quot;Thread-0&quot; prio=10 tid=0xb75b3000 nid=0x4b4 runnable [0x8f171000]
	java.lang.Thread.State: RUNNABLE
		at javatuning.ch6.toolscheck.HoldCPUMain$HoldCPUTask.run(HoldCPUMain.java:7) 
		at java.lang.Thread.run(Thread.java:636)
		
		Locked ownable synchronizers:
        - None
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECE\u52A0\u7C97\u7684\u90E8\u5206\u53EF\u4EE5\u770B\u5230\uFF0C\u8FD9\u4E2A\u7EBF\u7A0B\u6B63\u662F HoldCPUTask \u7C7B\uFF0C\u5B83\u7684 nid\uFF08native ID\uFF09\u4E3A 0x4b4\uFF0C\u8F6C\u4E3A 10 \u8FDB\u5236\u540E\uFF0C\u6B63\u597D\u662F 1204\u3002</p><p>\u901A\u8FC7\u8FD9\u4E2A\u65B9\u6CD5\uFF0C\u5F00\u53D1\u4EBA\u5458\u53EF\u4EE5\u5F88\u5BB9\u6613\u5730\u6355\u83B7\u5728 Java \u5E94\u7528\u7A0B\u5E8F\u4E2D\u5927\u91CF\u5360\u7528 CPU \u7684\u7EBF\u7A0B\u3002</p></li><li><p>I/O \u4F7F\u7528\u60C5\u51B5\u76D1\u63A7</p><p>\u78C1\u76D8 I/O \u4E5F\u662F\u5E38\u89C1\u7684\u6027\u80FD\u74F6\u9888\u4E4B\u4E00\uFF0C\u4F7F\u7528 pidstat \u5DE5\u5177\u4E5F\u53EF\u4EE5\u76D1\u63A7\u8FDB\u7A0B\u5185\u7EBF\u7A0B\u7684 I/O \u60C5\u51B5\u3002</p><p>\u3010\u793A\u4F8B 6-4\u3011\u4E0B\u4F8B\u5F00\u542F\u4E86 4 \u4E2A\u7EBF\u7A0B\uFF0C\u5176\u4E2D\u7EBF\u7A0B HoldIOTask \u4EA7\u751F\u4E86\u5927\u91CF\u7684 I/O \u64CD\u4F5C\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HoldIOMain</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">HoldIOTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;temp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                        <span class="token comment">// \u5927\u91CF\u7684\u5199\u64CD\u4F5C</span>
                        fos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    fos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;temp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// \u5927\u91CF\u7684\u8BFB\u64CD\u4F5C</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span>fis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">LazyTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// \u4E00\u4E2A\u7A7A\u95F2\u7EBF\u7A0B</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5F00\u542F\u5360\u7528 I/O \u7684\u7EBF\u7A0B</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HoldIOTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5F00\u542F\u7A7A\u95F2\u7EBF\u7A0B</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LazyTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LazyTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LazyTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u7A0B\u5E8F\u8FD0\u884C\u8FC7\u7A0B\u4E2D\uFF0C\u4F7F\u7528\u4EE5\u4E0B\u547D\u4EE4\u76D1\u63A7\u7A0B\u5E8F I/O \u4F7F\u7528\u60C5\u51B5\u3002\u5176\u4E2D 22796 \u662F\u901A\u8FC7 jps \u547D\u4EE4\u67E5\u8BE2\u5F97\u5230\u7684\u8FDB\u7A0B ID\uFF0C-d \u53C2\u6570\u8868\u660E\u76D1\u63A7\u5BF9\u8C61\u4E3A\u78C1\u76D8 I/O\u30021 3 \u8868\u793A\u6BCF\u79D2\u91C6\u6837\u4E00\u6B21\uFF0C\u5408\u8BA1\u91C6\u6837 3 \u6B21\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[oracle@redhat6 ~]$ pidstat -p 22796 -d -t 1 3
Linux 2.6.32-71.el6.i686 (redhat6)	03/25/2012 _i686_ (2 CPU) 
 06:06:00 PM     TGID     TID    kB_rd/s    kB_wr/s     kB_ccwr/s    Command 
 06:06:01 PM    22796      -       0.00      332.00          0.00       java 
 06:06:01 PM       -     22796     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22799     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22802     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22803     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22805     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22806     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22807     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22808     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22809     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22810     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22811     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22812     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22813     0.00      328.00          0.00     |__java
 06:06:01 PM       -     22814     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22815     0.00        0.00          0.00     |__java
 06:06:01 PM       -     22816     0.00        0.00          0.00     |__java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECE\u8F93\u51FA\u7ED3\u679C\u4E2D\u53EF\u4EE5\u770B\u5230\uFF0C\u8FDB\u7A0B\u4E2D\u7684 22813\uFF080x591D\uFF09\u7EBF\u7A0B\u4EA7\u751F\u4E86\u5927\u91CF I/O \u64CD\u4F5C\u3002\u901A\u8FC7\u524D\u6587\u4E2D\u63D0\u5230\u7684 jstatck \u547D\u4EE4\uFF0C\u53EF\u4EE5\u5BFC\u51FA\u5F53\u524D\u7EBF\u7A0B\u5806\u6808\uFF0C\u67E5\u627E nid \u4E3A 22813\uFF080x591D\uFF09\u7684\u7EBF\u7A0B\uFF0C\u5373\u53EF\u5B9A\u4F4D\u5230 HoldIOTask \u7EBF\u7A0B\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1A\u4F7F\u7528 pidstat \u53EF\u4EE5\u67E5\u770B\u8FDB\u7A0B\u548C\u7EBF\u7A0B\u7684 I/O \u4FE1\u606F\u3002</p></li><li><p>\u5185\u5B58\u76D1\u63A7</p><p>\u4F7F\u7528 pidstat \u5DE5\u5177\uFF0C\u8FD8\u53EF\u4EE5\u76D1\u63A7\u6307\u5B9A\u8FDB\u7A0B\u7684\u5185\u5B58\u4F7F\u7528\u60C5\u51B5\u3002</p><p>\u3010\u793A\u4F8B 6-5\u3011\u4E0B\u4F8B\u4F7F\u7528 pidstat \u5DE5\u5177\u5BF9\u8FDB\u7A0B ID \u4E3A 27233 \u7684\u8FDB\u7A0B\u8FDB\u884C\u5185\u5B58\u76D1\u63A7\u3002\u6BCF\u79D2\u5237\u65B0\u4E00\u6B21\uFF0C\u5171\u8FDB\u884C 5 \u6B21\u7EDF\u8BA1\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[oracle@redhat6 ~]$ pidstat -r -p 27233 1 5
Linux 2.6.32-71.el6.i686 (redhat6)	04/14/2012 _i686_ (2 CPU) 
 09:50:32 AM     PID    minflt/s    majflt/s      VSZ    RSS   %MEM   Command
 09:50:33 AM   27233       0.00         0.00   728164  11476   0.55     java 
 09:50:34 AM   27233       1.00         0.00   728164  11480   0.55     java 
 09:50:35 AM   27233       1.00         0.00   728164  11484   0.55     java 
 09:50:36 AM   27233       1.00         0.00   728164  11488   0.55     java 
 09:50:37 AM   27233       0.99         0.00   728164  11492   0.55     java 
 Average:      27233       0.80         0.00   728164  11484   0.55     java 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\u4E2D\u5404\u5217\u542B\u4E49\u5982\u4E0B\u3002</p><ul><li>minflt/s\uFF1A\u8868\u793A\u8BE5\u8FDB\u7A0B\u6BCF\u79D2 minor faults\uFF08\u4E0D\u9700\u8981\u4ECE\u78C1\u76D8\u4E2D\u8C03\u51FA\u5185\u5B58\u9875\uFF09\u7684\u603B\u6570\u3002</li><li>majflt/s\uFF1A\u8868\u793A\u8BE5\u8FDB\u7A0B\u6BCF\u79D2 major faults\uFF08\u9700\u8981\u4ECE\u78C1\u76D8\u4E2D\u8C03\u51FA\u5185\u5B58\u9875\uFF09\u7684\u603B\u6570\u3002</li><li>VSZ\uFF1A\u8868\u793A\u8BE5\u8FDB\u7A0B\u4F7F\u7528\u7684\u865A\u62DF\u5185\u5B58\u5927\u5C0F\uFF0C\u5355\u4F4D\u4E3A KB\u3002</li><li>RSS\uFF1A\u8868\u793A\u8BE5\u8FDB\u7A0B\u5360\u7528\u7684\u7269\u7406\u5185\u5B58\u5927\u5C0F\uFF0C\u5355\u4F4D\u4E3A KB\u3002</li><li>%MEM\uFF1A\u8868\u793A\u5360\u7528\u5185\u5B58\u6BD4\u4F8B\u3002</li></ul></li></ol><p><strong>\u6CE8\u610F</strong>\uFF1Apidstat \u5DE5\u5177\u662F\u4E00\u6B3E\u591A\u5408\u4E00\u7684\u4F18\u79C0\u5DE5\u5177\u3002\u5B83\u4E0D\u4EC5\u53EF\u4EE5\u76D1\u63A7 CPU\u3001I/O \u548C\u5185\u5B58\u8D44\u6E90\uFF0C\u751A\u81F3\u53EF\u4EE5\u5C06\u95EE\u9898\u5B9A\u4F4D\u5230\u76F8\u5173\u7EBF\u7A0B\uFF0C\u65B9\u4FBF\u5BF9\u5E94\u7528\u7A0B\u5E8F\u8FDB\u884C\u6545\u969C\u6392\u67E5\u3002</p><h2 id="_6-2-\u7528\u6211\u66F4\u9AD8\u6548-windows-\u4E0B\u7684\u6027\u80FD\u76D1\u63A7\u5DE5\u5177" tabindex="-1"><a class="header-anchor" href="#_6-2-\u7528\u6211\u66F4\u9AD8\u6548-windows-\u4E0B\u7684\u6027\u80FD\u76D1\u63A7\u5DE5\u5177" aria-hidden="true">#</a> 6.2 \u7528\u6211\u66F4\u9AD8\u6548\uFF1AWindows \u4E0B\u7684\u6027\u80FD\u76D1\u63A7\u5DE5\u5177</h2><p>\u4F5C\u4E3A\u684C\u9762\u5E02\u573A\u7684\u5360\u9886\u8005\uFF0C\u5728 Windows \u5E73\u53F0\u4E0A\u4E5F\u8FD0\u884C\u7740\u5927\u91CF\u7684 Java \u5E94\u7528\u7A0B\u5E8F\u3002\u672C\u8282\u4E3B\u8981\u4ECB\u7ECD\u4E00\u4E9B\u53EF\u4EE5\u5DE5\u4F5C\u5728 Windows \u5E73\u53F0\u4E0A\u7684\u6027\u80FD\u76D1\u63A7\u5DE5\u5177\uFF0C\u5305\u62EC Windows \u7CFB\u7EDF\u81EA\u5E26\u7684\u4EFB\u52A1\u7BA1\u7406\u3001\u6027\u80FD\u76D1\u63A7\u5DE5\u5177\uFF0C\u4EE5\u53CA\u4E00\u4E9B\u4F18\u79C0\u7684\u7B2C\u4E09\u65B9\u5DE5\u5177\u3002\u672C\u8282\u4EE5 Windows 7 \u4E3A\u4F8B\uFF0C\u4ECB\u7ECD\u4E00\u4E9B Windows \u4E0B\u7684\u6027\u80FD\u76D1\u63A7\u5DE5\u5177\u3002</p><h3 id="_6-2-1-\u4EFB\u52A1\u7BA1\u7406\u5668" tabindex="-1"><a class="header-anchor" href="#_6-2-1-\u4EFB\u52A1\u7BA1\u7406\u5668" aria-hidden="true">#</a> 6.2.1 \u4EFB\u52A1\u7BA1\u7406\u5668</h3><p>Windows \u7CFB\u7EDF\u7684\u4EFB\u52A1\u7BA1\u7406\u5668\u662F\u5927\u5BB6\u6700\u719F\u77E5\u7684\u4E00\u6B3E\u7CFB\u7EDF\u5DE5\u5177\u3002\u901A\u8FC7 Ctrl + Alt + Del \u7EC4\u5408\u952E\u4FBF\u80FD\u547C\u51FA\u3002\u4EFB\u52A1\u7BA1\u7406\u4E4D\u770B\u5E76\u4E0D\u8D77\u773C\uFF0C\u4F46\u4E8B\u5B9E\u4E0A\u5B83\u5374\u662F\u4F7F\u7528\u6700\u65B9\u4FBF\u3001\u529F\u80FD\u4E5F\u975E\u5E38\u5F3A\u5927\u7684\u4E00\u6B3E\u6027\u80FD\u7EDF\u8BA1\u5DE5\u5177\u3002\u4EFB\u52A1\u7BA1\u7406\u754C\u9762\u5982\u56FE6.1 \u6240\u793A\u3002</p><p><img src="`+u+'" alt="\u56FE6-1" loading="lazy"></p><p>\u56FE6.1 \u4EFB\u52A1\u7BA1\u7406\u5668\u754C\u9762</p><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u4EFB\u52A1\u7BA1\u7406\u7684\u8FDB\u7A0B\u9875\u7F57\u5217\u4E86\u7CFB\u7EDF\u5185\u8FDB\u7A0B\u7684\u540D\u79F0\u3001\u6240\u5C5E\u7528\u6237\u3001CPU \u4F7F\u7528\u7387\u548C\u5185\u5B58\u4F7F\u7528\u91CF\u7B49\u4FE1\u606F\u3002\u901A\u8FC7\u4EFB\u52A1\u7BA1\u7406\u5668\uFF0C\u53EF\u4EE5\u65B9\u4FBF\u5730\u5B9E\u65F6\u76D1\u63A7\u5404\u4E2A\u8FDB\u7A0B\u7684 CPU \u548C\u5185\u5B58\u4F7F\u7528\u60C5\u51B5\uFF0C\u5BF9\u4E8E\u7B80\u5355\u7684\u6027\u80FD\u76D1\u63A7\uFF0C\u5DF2\u7ECF\u8DB3\u591F\u4E86\u3002</p><p>\u9664\u4E86\u56FE6.1 \u4E2D\u6240\u5C55\u793A\u7684\u5217\uFF0C\u4EFB\u52A1\u7BA1\u7406\u7684\u8FDB\u7A0B\u9875\u9762\u8FD8\u53EF\u4EE5\u663E\u793A\u66F4\u591A\u7684\u6027\u80FD\u53C2\u6570\uFF0C\u6BD4\u5982\u8FDB\u7A0B ID\u3001I/O \u4FE1\u606F\u7B49\uFF0C\u5982\u56FE6.2 \u6240\u793A\u3002\u901A\u8FC7 \u201C\u67E5\u770B\u201D \u83DC\u5355\u4E0B\u7684 \u201C\u9009\u62E9\u5217\u201D \u83DC\u5355\uFF0C\u53EF\u4EE5\u5F39\u51FA \u201C\u9009\u62E9\u8FDB\u7A0B\u9875\u5217\u201D \u5BF9\u8BDD\u6846\u3002\u5728\u8FD9\u4E2A\u5BF9\u8BDD\u6846\u4E2D\uFF0C\u53EF\u4EE5\u9009\u62E9\u9700\u8981\u76D1\u63A7\u7684\u5217\u4FE1\u606F\u3002</p><p><img src="'+d+'" alt="\u56FE6-2" loading="lazy"></p><p>\u56FE6.2 \u4EFB\u52A1\u7BA1\u7406\u5668\u652F\u6301\u7684\u6027\u80FD\u53C2\u6570</p><p>\u9664\u4E86\u5BF9\u8FDB\u7A0B\u8FDB\u884C\u5355\u72EC\u7684\u76D1\u63A7\uFF0C\u4EFB\u52A1\u7BA1\u7406\u8FD8\u80FD\u5BF9\u8BA1\u7B97\u673A\u7CFB\u7EDF\u7684\u6574\u4F53\u8FD0\u884C\u60C5\u51B5\u8FDB\u884C\u76D1\u63A7\uFF0C\u5305\u62EC CPU\u3001\u5185\u5B58\u53CA\u7F51\u7EDC\u7684\u4F7F\u7528\u60C5\u51B5\u3002\u56FE6.3 \u5C55\u793A\u4E86 CPU \u548C\u5185\u5B58\u4F7F\u7528\u60C5\u51B5\uFF0C\u56FE6.4 \u5C55\u793A\u4E86\u5F53\u524D\u7684\u7F51\u7EDC\u4F7F\u7528\u60C5\u51B5\u3002</p><p><img src="'+r+'" alt="\u56FE6-3" loading="lazy"></p><p>\u56FE6.3 CPU \u548C\u5185\u5B58\u4F7F\u7528\u60C5\u51B5</p><p><img src="'+v+'" alt="\u56FE6-4" loading="lazy"></p><p>\u56FE6.4 \u5F53\u524D\u7684\u7F51\u7EDC\u4F7F\u7528\u60C5\u51B5</p><p><strong>\u6CE8\u610F</strong>\uFF1A\u4EFB\u52A1\u7BA1\u7406\u5668\u5F88\u5E38\u7528\uFF0C\u4E5F\u975E\u5E38\u5F3A\u5927\u3002\u5B83\u53EF\u4EE5\u663E\u793A\u7CFB\u7EDF\u7684\u7F51\u7EDC\u8D1F\u8F7D\uFF0C\u4EFB\u610F\u8FDB\u7A0B\u7684 CPU \u5360\u7528\u7387\u3001\u5185\u5B58\u4F7F\u7528\u91CF\u53CA I/O \u4F7F\u7528\u60C5\u51B5\u3002</p><h3 id="_6-2-2-perfmon-\u6027\u80FD\u76D1\u63A7\u5DE5\u5177" tabindex="-1"><a class="header-anchor" href="#_6-2-2-perfmon-\u6027\u80FD\u76D1\u63A7\u5DE5\u5177" aria-hidden="true">#</a> 6.2.2 perfmon \u6027\u80FD\u76D1\u63A7\u5DE5\u5177</h3><p>\u4E0E\u4EFB\u52A1\u7BA1\u7406\u5668\u76F8\u6BD4\uFF0Cperfmon \u53EF\u4EE5\u8BF4\u662F Windows \u4E13\u4E1A\u7EA7\u7684\u6027\u80FD\u76D1\u63A7\u5DE5\u5177\u4E86\u3002\u5B83\u7684\u529F\u80FD\u6781\u5176\u5F3A\u5927\uFF0C\u4E0D\u4EC5\u53EF\u4EE5\u76D1\u63A7\u8BA1\u7B97\u673A\u7CFB\u7EDF\u7684\u6574\u4F53\u8FD0\u884C\u60C5\u51B5\uFF0C\u4E5F\u53EF\u4EE5\u4E13\u95E8\u9488\u5BF9\u67D0\u4E00\u4E2A\u8FDB\u7A0B\u6216\u8005\u7EBF\u7A0B\u8FDB\u884C\u72B6\u6001\u76D1\u63A7\u3002\u5E76\u4E14\uFF0C\u5B83\u6240\u652F\u6301\u7684\u76D1\u63A7\u5BF9\u8C61\u4E5F\u975E\u5E38\u591A\uFF0C\u51E0\u4E4E\u6D89\u53CA\u7CFB\u7EDF\u7684\u6240\u6709\u65B9\u9762\uFF0C\u4ECE CPU \u4F7F\u7528\u60C5\u51B5\u5230\u5185\u5B58\u5229\u7528\u7387\u3001I/O \u901F\u5EA6\u3001\u7F51\u7EDC\u4F7F\u7528\u72B6\u51B5\u3001\u8FDB\u7A0B\u6570\u3001\u7EBF\u7A0B\u7B49\u65E0\u4E0D\u5728\u5176\u76D1\u63A7\u8303\u56F4\u5185\u3002perfmon \u8FD0\u884C\u754C\u9762\u5982\u56FE6.5 \u6240\u793A\u3002</p><p><img src="'+k+'" alt="\u56FE6-5" loading="lazy"></p><p>\u56FE6.5 perfmon \u8FD0\u884C\u754C\u9762</p><p>\u8BFB\u8005\u53EF\u4EE5\u5728 \u201C\u5F00\u59CB\u201D \u83DC\u5355\u4E2D\u8C03\u51FA\u7684 \u201C\u8FD0\u884C\u201D \u5BF9\u8BDD\u6846\u4F7F\u7528 perfmon \u547D\u4EE4\uFF0C\u6216\u8005\u53CC\u51FB\u63A7\u5236\u9762\u677F\u7684\u7BA1\u7406\u5DE5\u5177\u4E2D\u7684 \u201C\u6027\u80FD\u76D1\u89C6\u5668\u201D \u5FEB\u6377\u65B9\u5F0F\u6253\u5F00\u8FD9\u4E2A\u5DE5\u5177\uFF0C\u5982\u56FE6.6 \u6240\u793A\u3002</p><p><img src="'+m+'" alt="\u56FE6-6" loading="lazy"></p><p>\u56FE6.6 \u6253\u5F00 perfmon \u7684\u65B9\u5F0F</p><p>perfmon \u5DE5\u5177\u7684\u5E95\u90E8\u663E\u793A\u4E86\u5F53\u524D\u6B63\u5728\u76D1\u63A7\u7684\u7CFB\u7EDF\u5BF9\u8C61\u3002\u53EF\u4EE5\u5728\u76D1\u63A7\u5BF9\u8C61\u5217\u8868\u4E2D\u4F7F\u7528\u53F3\u952E\u6DFB\u52A0\u8BA1\u6570\u5668\uFF0C\u5982\u56FE6.7 \u6240\u793A\uFF0C\u9009\u62E9\u9700\u8981\u76D1\u63A7\u7684\u5BF9\u8C61\uFF0C\u5982\u56FE6.8 \u6240\u793A\u3002</p><p><img src="'+b+'" alt="\u56FE6-7" loading="lazy"></p><p>\u56FE6.7 \u5728 perfmon \u6DFB\u52A0\u8BA1\u6570\u5668</p><p><img src="'+g+'" alt="\u56FE6-8" loading="lazy"></p><p>\u56FE6.8 \u9009\u62E9\u8981\u76D1\u63A7\u7684\u6307\u6807\u548C\u76D1\u63A7\u5BF9\u8C61</p><p>\u53EF\u4EE5\u770B\u5230\uFF0Cperfmon \u5DE5\u5177\u652F\u6301\u7684\u6027\u80FD\u5BF9\u8C61\u5F88\u591A\u3002\u8FD9\u91CC\u9700\u8981\u91CD\u70B9\u5173\u6CE8\u7684\u662F Thread \u76D1\u63A7\u9879\u4E0B\u7684\u5185\u5BB9\uFF0C\u5982 User Time \u8868\u793A\u7EBF\u7A0B\u5360\u7528 CPU \u7684\u65F6\u95F4\u767E\u5206\u6BD4\u3001ID Thread \u8868\u793A\u7EBF\u7A0B ID \u53F7\u3001ID Process \u8868\u793A\u8FDB\u7A0B ID \u53F7\u3002\u5728\u76D1\u63A7\u7684\u5BF9\u8C61\u5B9E\u4F8B\u4E2D\uFF0C\u53EF\u4EE5\u9009\u62E9 Java \u8FDB\u7A0B\u7684\u7EBF\u7A0B\u3002</p><p>\u3010\u793A\u4F8B 6-6\u3011\u8BFB\u8005\u5E94\u8BE5\u8FD8\u8BB0\u5F97 6.1.4 \u8282\u4E2D\u4F7F\u7528\u7684 HoldCPUMain \u7A0B\u5E8F\u5427\uFF01\u4EE5\u8BE5\u6837\u4F8B\u7A0B\u5E8F\u4E3A\u4F8B\uFF0C\u672C\u8282\u5C06\u5C55\u793A\u5982\u4F55\u4F7F\u7528 perfmon \u5DE5\u5177\u627E\u51FA\u5728 Java \u5E94\u7528\u7A0B\u5E8F\u4E2D\u6700\u6D88\u8017 CPU \u8D44\u6E90\u7684\u7EBF\u7A0B\u3002</p><ol><li><p>\u8FD0\u884C HoldCPUMain\u3002\u6309\u7167\u56FE6.8 \u7684\u914D\u7F6E\uFF0C\u8BBE\u7F6E\u6D4B\u91CF\u5BF9\u8C61\u4E3A Thread\uFF0C\u5E76\u9009\u62E9 javaw.exe \u8FDB\u7A0B\u4E2D\u6240\u6709\u7684\u7EBF\u7A0B\u3002</p></li><li><p>\u5355\u51FB\u67E5\u770B\u62A5\u8868\u6309\u94AE\uFF0C\u5207\u6362 perfmon \u5DE5\u5177\u7684\u663E\u793A\u6A21\u5F0F\uFF0C\u5982\u56FE6.9 \u6240\u793A\u3002</p><p><img src="'+h+'" alt="\u56FE6-9" loading="lazy"></p><p>\u56FE6.9 \u5207\u6362\u663E\u793A\u6A21\u5F0F</p></li><li><p>\u5728\u62A5\u8868\u4E2D\u53EF\u4EE5\u5F88\u5BB9\u6613\u5730\u770B\u5230\uFF0C\u5728\u5F53\u524D Java \u5E94\u7528\u7A0B\u5E8F\u4E2D\uFF0C\u7EBF\u7A0B ID \u4E3A 2548 \u7684\u7EBF\u7A0B\u7684 CPU \u5360\u7528\u7387\u5F88\u9AD8\uFF0C\u5982\u56FE6.10 \u6240\u793A\u3002</p><p><img src="'+x+`" alt="\u56FE6-10" loading="lazy"></p><p>\u56FE6.10\u7EBF\u7A0B\u76D1\u63A7\u7ED3\u679C</p></li><li><p>\u5C06 11452 \u6362\u7B97\u6210 16 \u8FDB\u5236\u4E3A 2CBC\u3002\u901A\u8FC7 jstack \u7B49\u5DE5\u5177\u5BFC\u51FA Java \u5E94\u7528\u7A0B\u5E8F\u7684\u7EBF\u7A0B\u5FEB\u7167\uFF0C\u5E76\u67E5\u627E 2CBC\uFF0C\u53EF\u4EE5\u627E\u5230\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Thread-0&quot; prio=6 tid=0x04d98400 nid=0x2cbc runnable [0x04d2f000]
	java.lang.Thread.State: RUNNABLE
		at geym.zbase.ch6.hold.HoldCPUMain$HoldCPUTask.run(HoldCPUMain.java:8)
		at java.lang.Thread.run(Thread.java:724)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u81F3\u6B64\u5B8C\u6210\u7EBF\u7A0B\u5B9A\u4F4D\uFF0C\u901A\u8FC7 perfmon \u627E\u5230\u4E86 Java \u7A0B\u5E8F\u4E2D\u6D88\u8017 CPU \u6700\u591A\u7684\u7EBF\u7A0B\u4EE3\u7801\u3002</p></li></ol><p><strong>\u6CE8\u610F</strong>\uFF1Aperform \u5DE5\u5177\u4E5F\u662F Windows \u81EA\u5E26\u7684\u4E00\u6B3E\u6027\u80FD\u76D1\u63A7\u8F6F\u4EF6\u3002\u53EF\u4EE5\u76D1\u63A7\u7684\u6027\u80FD\u6307\u6807\u7E41\u591A\uFF0C\u529F\u80FD\u4E5F\u975E\u5E38\u5F3A\u5927\u3002\u5F53\u4EFB\u52A1\u7BA1\u7406\u5668\u65E0\u6CD5\u6EE1\u8DB3\u8981\u6C42\u65F6\uFF0C\u63A8\u8350\u4F7F\u7528\u3002</p><p>\u5728 Windows 7 \u4E0B\uFF0Cperfmon \u5DE5\u5177\u652F\u6301\u5E26\u53C2\u6570 /res \u542F\u52A8\uFF0C\u7528\u4E8E\u4E13\u95E8\u76D1\u63A7\u7CFB\u7EDF\u8D44\u6E90\u7684\u4F7F\u7528\u60C5\u51B5\u3002\u4F7F\u7528\u5982\u4E0B\u547D\u4EE4\u542F\u52A8 perfmon\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>perfmon /res
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4F7F\u7528\u8BE5\u547D\u4EE4\u6253\u5F00\u7684\u8D44\u6E90\u76D1\u63A7\u5DE5\u5177\uFF0C\u53EF\u4EE5\u975E\u5E38\u7EC6\u81F4\u5730\u89C2\u5BDF\u7CFB\u7EDF\u5185\u7684\u8D44\u6E90\u4F7F\u7528\u60C5\u51B5\uFF0C\u5982\u56FE6.11 \u6240\u793A\u3002\u5728\u8FD9\u4E2A\u89C6\u56FE\u4E2D\uFF0C\u53EF\u4EE5\u67E5\u770B\u6BCF\u4E2A CPU \u6838\u7684\u4FE1\u606F\u3001\u78C1\u76D8\u4F7F\u7528\u7387\u3001\u7F51\u7EDC\u4F7F\u7528\u7387\u3001\u5185\u5B58\u4F7F\u7528\u7387\u3001\u7CFB\u7EDF\u4E2D\u6253\u5F00\u548C\u76D1\u542C\u7684\u7AEF\u53E3\u53CA\u76F8\u5173\u8FDB\u7A0B\u7B49\u3002</p><p><img src="`+y+'" alt="\u56FE6-11" loading="lazy"></p><p>\u56FE6.11 perfmon /res \u7684\u754C\u9762</p><h3 id="_6-2-3-process-explorer-\u8FDB\u7A0B\u7BA1\u7406\u5DE5\u5177" tabindex="-1"><a class="header-anchor" href="#_6-2-3-process-explorer-\u8FDB\u7A0B\u7BA1\u7406\u5DE5\u5177" aria-hidden="true">#</a> 6.2.3 Process Explorer \u8FDB\u7A0B\u7BA1\u7406\u5DE5\u5177</h3>',42),wn=n("Process Explorer \u662F\u4E00\u6B3E\u529F\u80FD\u6781\u5176\u5F3A\u5927\u7684\u8FDB\u7A0B\u7BA1\u7406\u5DE5\u5177\u3002\u5B83\u5B8C\u5168\u53EF\u4EE5\u66FF\u4EE3 Windows \u81EA\u5E26\u7684\u4EFB\u52A1\u7BA1\u7406\u5668\u3002\u8BFB\u8005\u53EF\u4EE5\u5728 "),Cn={href:"http://technet.microsoft.com/en-us/sysintemals/bb896653",target:"_blank",rel:"noopener noreferrer"},_n=n("http://technet.microsoft.com/en-us/sysintemals/bb896653"),Tn=n(" \u4E0B\u8F7D\u8BE5\u5DE5\u5177\u3002Process Explorer \u8FD0\u884C\u754C\u9762\u5982\u56FE6.12 \u6240\u793A\u3002"),Mn=a('<p><img src="'+f+'" alt="\u56FE6-12" loading="lazy"></p><p>\u56FE6.12 Process Explorer \u8FD0\u884C\u754C\u9762</p><p>Process Explorer \u4E0D\u4EC5\u663E\u793A\u4E86\u7CFB\u7EDF\u5185\u6240\u6709\u7684\u8FDB\u7A0B\uFF0C\u8FD8\u8FDB\u4E00\u6B65\u663E\u793A\u4E86\u8FDB\u7A0B\u95F4\u7684\u7236\u5B50\u5173\u7CFB\u3002Process Explorer \u6240\u652F\u6301\u7684\u6D4B\u91CF\u9879\u975E\u5E38\u591A\u3002\u53EF\u4EE5\u5728\u5217\u8868\u5934\u90E8\u5355\u51FB\u9F20\u6807\u53F3\u952E\uFF0C\u6253\u5F00 &quot;Select Columns\u201D \u5BF9\u8BDD\u6846\u9009\u62E9\u9700\u8981\u7EDF\u8BA1\u7684\u7B56\u7565\u9879\uFF0C\u5982\u56FE6.13 \u6240\u793A\u3002Process Explorer \u5C06\u7EDF\u8BA1\u9879\u8FDB\u884C\u4E86\u5206\u7C7B\uFF0C\u4E3B\u8981\u6709\u8FDB\u7A0B\u6A21\u5757\u4FE1\u606F\u3001\u8FDB\u7A0B\u6027\u80FD\u3001I/O \u4F7F\u7528\u60C5\u51B5\u3001\u7F51\u7EDC\u4F7F\u7528\u60C5\u51B5\u3001\u5185\u5B58\u4F7F\u7528\u60C5\u51B5\u7B49\u3002</p><p><img src="'+j+'" alt="\u56FE6-13" loading="lazy"></p><p>\u56FE6.13 \u8FDB\u7A0B\u6027\u80FD\u7EDF\u8BA1\u7C7B\u578B</p><p>\u5728\u8FDB\u7A0B\u4E2D\u53F3\u51FB\uFF0C\u6253\u5F00\u5C5E\u6027\u5BF9\u8BDD\u6846\uFF0C\u53EF\u4EE5\u663E\u793A\u9009\u4E2D\u8FDB\u7A0B\u7684\u8BE6\u7EC6\u4FE1\u606F\uFF0C\u5305\u62EC\u7EBF\u7A0B\u6570\u3001\u4E0A\u4E0B\u6587\u73AF\u5883\uFF0C\u4EE5\u53CA CPU\u3001I/O \u548C\u5185\u5B58\u4F7F\u7528\u60C5\u51B5\u7B49\u3002</p><p>\u3010\u793A\u4F8B 6-7\u3011\u5728\u4ECB\u7ECD vmstat \u5DE5\u5177\u65F6\u4F7F\u7528\u4E86\u540D\u4E3A HoldLockMain \u7684\u4F8B\u5B50\uFF0C\u6F14\u793A\u4E86\u4E00\u4E2A\u5927\u91CF\u7EBF\u7A0B\u5207\u6362\u7684\u573A\u666F\u3002\u5728\u6B64\uFF0C\u7EE7\u7EED\u4F7F\u7528\u8BE5\u5B9E\u4F8B\uFF0C\u6F14\u793A Process Explorer \u7684\u4F7F\u7528\u65B9\u6CD5\u3002</p><ol><li><p>\u8FD0\u884C HoldLockMain\uFF0C\u5728 Process Explorer \u4E2D\u53EF\u4EE5\u770B\u5230 Java \u7A0B\u5E8F\u7684 CPU \u5360\u7528\u7387\u5F88\u9AD8\uFF0C\u5982\u56FE6.14 \u6240\u793A\u3002</p><p><img src="'+w+'" alt="\u56FE6-14" loading="lazy"></p><p>\u56FE6.14 Process Explorer \u76D1\u63A7 CPU \u5360\u7528\u7387</p></li><li><p>\u53F3\u51FB javaw.exe\uFF0C\u6253\u5F00\u5C5E\u6027\u5BF9\u8BDD\u6846\uFF0C\u5E76\u67E5\u770B\u7EBF\u7A0B\u9875\uFF0C\u5982\u56FE6.15 \u6240\u793A\u3002</p><p><img src="'+C+`" alt="\u56FE6-15" loading="lazy"></p><p>\u56FE6.15 \u67E5\u770B\u7EBF\u7A0B\u60C5\u51B5</p></li><li><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u5728\u8BE5 Java \u7A0B\u5E8F\u4E2D\uFF0C\u7EBF\u7A0B\u7684\u4E0A\u4E0B\u6587\u5207\u6362\u6570\u503C\u548C CPU \u5360\u7528\u7387\u90FD\u6BD4\u8F83\u5927\u3002\u67FB\u770B\u5F53\u524D CPU \u5360\u7528\u7387\u8FBE 12%\u3001\u4E0A\u4E0B\u6587\u5207\u6362\u8FBE 163 \u6B21\u7684\u7EBF\u7A0B ID \u4E3A 2864\uFF0C\u6362\u7B97\u6210 16 \u8FDB\u5236\u4E3A B30\u3002\u5728\u7EBF\u7A0B\u5FEB\u7167\u4E2D\u67E5\u627E\uFF0C\u6709\u4EE5\u4E0B\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Thread-14&quot; prio=6 tid=0x02b4c800  nid=0xb30 runnable [0x032bf000..0x032bfc94] 
	java.lang.Thread.State: RUNNABLE
		at javatuning.ch6.toolscheck.HoldIOckMain$HoldIOckTask.run(HoldIOckMain.java:19)
		-locked &lt;0x22a23478&gt; (a java.lang.Object)
		at java.lang.Thread.run(Thread.java:619)
		
		Locked ownable synchronizers:
		-None
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u901A\u8FC7 Process Explorer\uFF0C\u8FD9\u91CC\u5DF2\u7ECF\u627E\u5230\u5176\u4E2D\u4E00\u4E2A\u6D88\u8017 CPU \u5927\u91CF\u8D44\u6E90\u7684\u7EBF\u7A0B\u3002\u5728\u5B9E\u9645\u5F00\u53D1\u8FC7\u7A0B\u4E2D\uFF0C\u4F7F\u7528\u7C7B\u4F3C\u7684\u65B9\u6CD5\uFF0C\u4FBF\u53EF\u4EE5\u627E\u51FA\u7A0B\u5E8F\u4E2D\u6700\u6D88\u8017\u8D44\u6E90\u7684\u7EBF\u7A0B\u3002</p></li></ol><p><strong>\u6CE8\u610F</strong>\uFF1A\u53EF\u4EE5\u8BA4\u4E3A Process Explorer \u662F\u4E00\u4E2A\u52A0\u5F3A\u7248\u7684\u4EFB\u52A1\u7BA1\u7406\u5668\uFF0C\u4F46\u662F\u5B83\u4E0D\u662F Windows \u7CFB\u7EDF\u81EA\u5E26\u7684\u5DE5\u5177\uFF0C\u9700\u8981\u4E0B\u8F7D\u5B89\u88C5\u3002</p><h3 id="_6-2-4-pslist-\u547D\u4EE4\u2014\u2014windows-\u4E0B\u4E5F\u6709\u547D\u4EE4\u884C\u5DE5\u5177" tabindex="-1"><a class="header-anchor" href="#_6-2-4-pslist-\u547D\u4EE4\u2014\u2014windows-\u4E0B\u4E5F\u6709\u547D\u4EE4\u884C\u5DE5\u5177" aria-hidden="true">#</a> 6.2.4 pslist \u547D\u4EE4\u2014\u2014Windows \u4E0B\u4E5F\u6709\u547D\u4EE4\u884C\u5DE5\u5177</h3>`,10),Sn=n("\u4E0E\u4E4B\u524D\u4ECB\u7ECD\u7684\u6027\u80FD\u76D1\u63A7\u5DE5\u5177\u4E0D\u540C\uFF0Cpslist \u662F\u4E00\u6B3E Windows \u4E0B\u7684\u547D\u4EE4\u884C\u5DE5\u5177\u3002\u867D\u7136\u4E0E\u4E4B\u524D\u7684 GUI \u5DE5\u5177\u76F8\u6BD4\uFF0C\u547D\u4EE4\u884C\u5DE5\u5177\u5728\u6613\u7528\u6027\u4E0A\u7565\u6709\u4E0D\u8DB3\uFF0C\u4F46\u5B83\u4F9D\u7136\u5177\u6709 GUI \u5DE5\u5177\u6240\u4E0D\u80FD\u66FF\u4EE3\u7684\u529F\u80FD\u4E0E\u7528\u9014\u3002\u8BFB\u8005\u53EF\u4EE5\u5728 "),Pn={href:"http://technet.microsoft.com/en-us/sysintemals/bb896682",target:"_blank",rel:"noopener noreferrer"},Jn=n("http://technet.microsoft.com/en-us/sysintemals/bb896682"),Dn=n(" \u4E0B\u8F7D\u5E76\u5B89\u88C5\u8BE5\u5DE5\u5177\u3002"),Un=a(`<p>pslist \u547D\u4EE4\u7684\u57FA\u672C\u7528\u6CD5\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>pslist [-d] [-m] [-x] [-t] [-s [n] [-r n] [name|pid]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5404\u53C2\u6570\u542B\u4E49\u5982\u4E0B\u3002</p><ul><li>-d\uFF1A\u663E\u793A\u7EBF\u7A0B\u8BE6\u7EC6\u4FE1\u606F\u3002</li><li>-m\uFF1A\u663E\u793A\u5185\u5B58\u8BE6\u7EC6\u4FE1\u606F\u3002</li><li>-x\uFF1A\u663E\u793A\u8FDB\u7A0B\u3001\u5185\u5B58\u548C\u7EBF\u7A0B\u4FE1\u606F\u3002</li><li>-t\uFF1A\u663E\u793A\u8FDB\u7A0B\u4E4B\u95F4\u7236\u5B50\u5173\u7CFB\u3002</li><li>-s [n]\uFF1A\u8FDB\u5165\u76D1\u63A7\u6A21\u5F0F\uFF0Cn \u6307\u5B9A\u7A0B\u5E8F\u8FD0\u884C\u65F6\u95F4\uFF0C\u4F7F\u7528 Esc \u952E\u9000\u51FA\u3002</li><li>-r n\uFF1A\u6307\u5B9A\u76D1\u63A7\u6A21\u5F0F\u4E0B\u7684\u5237\u65B0\u65F6\u95F4\uFF0C\u5355\u4F4D\u4E3A\u79D2\u3002</li><li>name\uFF1A\u6307\u5B9A\u76D1\u63A7\u7684\u8FDB\u7A0B\u540D\u79F0\uFF0Cpslist \u5C06\u76D1\u63A7\u6240\u6709\u4EE5\u7ED9\u5B9A\u540D\u5B57\u5F00\u5934\u7684\u8FDB\u7A0B\u3002</li><li>-e\uFF1A\u4F7F\u7528\u7CBE\u786E\u5339\u914D\uFF0C\u6253\u5F00\u8FD9\u4E2A\u5F00\u5173\uFF0Cpslist \u5C06\u53EA\u76D1\u63A7 name \u53C2\u6570\u6307\u5B9A\u7684\u8FDB\u7A0B\u3002</li><li>pid\uFF1A\u6307\u5B9A\u8FDB\u7A0B ID\u3002</li></ul><p>\u3010\u793A\u4F8B 6-8\u3011\u672C\u8282\u5EF6\u7528 HoldCPUTask \u793A\u4F8B\u3002</p><ol><li><p>\u8FD0\u884C HoldCPUTask \u7A0B\u5E8F\uFF0C\u4F7F\u7528 pslist \u5217\u51FA\u6240\u6709 Java \u5E94\u7528\u7A0B\u5E8F\u8FDB\u7A0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;pslist java
Name	Pid   Pri Thd  Hnd  Priv    CPU Time    Elapsed Time
javaw	2268	8  14  119 28068  0:02:08.765	0:02:10.265
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u4F7F\u7528 -d \u53C2\u6570\u5217\u51FA\u7EBF\u7A0B\u4FE1\u606F\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;pslist java -d

javaw 2268:
Tid     Pri  Cswtch   State            User Time      Kernel Time    Elapsed Time
3212    9    49       Wait:UserReq     0:00:00.015    0:00:00.000    0:03:34.421
1428    9    280      Wait:UserReq     0:00:00.078    0:00:00.078    0:03:34.375
2052    10   274      Wait:UserReq     0:00:00.000    0:00:00.000    0:03:34.171
540     11   3        Wait:UserReq     0:00:00.000    0:00:00.000    0:03:33.953
184     9    2        Wait:UserReq     0:00:00.000    0:00:00.000    0:03:33.953
4052    10   6        Wait:UserReq     0:00:00.000    0:00:00.000    0:03:33.484
1156    10   2        Wait:UserReq     0:00:00.000    0:00:00.000    0:03:33.484
2448    11   42       Wait:UserReq     0:00:00.015    0:00:00.000    0:03:33.484
3728    8    3        Wait:UserReq     0:00:00.000    0:00:00.000    0:03:33.484
2552    10   4699     Wait:DelayExec   0:00:00.000    0:00:00.000    0:03:33.484
2548    8    142357   Running          0:03:32.406    0:00:00.015    0:03:33.328
1856    8    252      Wait:UserReq     0:00:00.000    0:00:00.000    0:03:33.312
3528    8    250      Wait:UserReq     0:00:00.000    0:00:00.000    0:03:33.312
1448    8    238      Wait:UserReq     0:00:00.000    0:00:00.000    0:03:33.312
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u627E\u5230\u6B63\u5728\u8FD0\u884C\u4E2D\u5E76\u4E14\u5177\u6709\u6700\u9AD8 Cswtch \u4E0A\u4E0B\u6587\u5207\u6362\u503C\u7684\u7EBF\u7A0B 2548\uFF0C\u6362\u7B97\u6210 16 \u8FDB\u5236\u4E3A 9F4\uFF08\u5F88\u660E\u663E\uFF0C\u8BE5\u7EBF\u7A0B\u4E5F\u662F\u5360\u7528 CP U\u65F6\u95F4\u6700\u591A\u7684\u7EBF\u7A0B\uFF09\u3002\u5728\u7EBF\u7A0B\u5FEB\u7167\u4E2D\u67E5\u627E\u8FD9\u4E2A\u7EBF\u7A0B\u7684 ID\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&quot;Thread-0&quot; prio=6 tid=0x02b38800 nid=0x9f4 runnable [0x02e5f000..0x02e5fb94] 
    java.lang.Thread.State: RUNNABLE
        at java.util.Random.nextDouble(Random.java:394)
        at java.lang.Math.random(Math.java:695)
        at javatuning.ch6.toolscheck.HoldCPUMain$HoldCPOTask.run(HoldCPUMain.java:8)
        at java.lang.Thread.run(Thread.java:619)

        Locked ownable synchronizers:
        -None
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FDB\u884C\u4EE5\u4E0A\u64CD\u4F5C\u540E\uFF0C\u5373\u53EF\u627E\u5230\u5F53\u524D\u6700\u6D88\u8017 CPU \u7684\u7EBF\u7A0B HoldCPUTask\u3002</p></li></ol><h2 id="_6-3-\u5916\u79D1\u624B\u672F\u5200-jdk-\u6027\u80FD\u76D1\u63A7\u5DE5\u5177" tabindex="-1"><a class="header-anchor" href="#_6-3-\u5916\u79D1\u624B\u672F\u5200-jdk-\u6027\u80FD\u76D1\u63A7\u5DE5\u5177" aria-hidden="true">#</a> 6.3 \u5916\u79D1\u624B\u672F\u5200\uFF1AJDK \u6027\u80FD\u76D1\u63A7\u5DE5\u5177</h2><p>\u5728 JDK \u7684\u5F00\u53D1\u5305\u4E2D\uFF0C\u9664\u4E86\u5927\u5BB6\u719F\u77E5\u7684 java.exe \u548C javac.exe\uFF0C\u8FD8\u6709\u4E00\u7CFB\u5217\u8F85\u52A9\u5DE5\u5177\u3002\u8FD9\u4E9B\u8F85\u52A9\u5DE5\u5177\u53EF\u4EE5\u5E2E\u52A9\u5F00\u53D1\u4EBA\u5458\u5F88\u597D\u5730\u89E3\u51B3 Java \u5E94\u7528\u7A0B\u5E8F\u7684\u4E00\u4E9B\u7591\u96BE\u6742\u75C7\u3002\u8FD9\u4E9B\u5DE5\u5177\u5728 JDK \u5B89\u88C5\u76EE\u5F55\u4E0B\u7684 bin \u4E2D\uFF0C\u56FE6.16 \u663E\u793A\u4E86\u90E8\u5206\u8F85\u52A9\u5DE5\u5177\u3002</p><p><img src="`+_+'" alt="\u56FE6-16" loading="lazy"></p><p>\u56FE6.16 JDK \u5185\u7F6E\u5DE5\u5177</p><p>\u867D\u7136\u4E4D\u770B\u4E4B\u4E0B\uFF0C\u8FD9\u4E9B\u5DE5\u4F5C\u90FD\u662F exe \u53EF\u6267\u884C\u6587\u4EF6\u3002\u4F46\u4E8B\u5B9E\u4E0A\uFF0C\u5B83\u4EEC\u53EA\u662F Java \u7A0B\u5E8F\u7684\u4E00\u5C42\u5305\u88C5\uFF0C\u5176\u771F\u6B63\u5B9E\u73B0\u5728 tools.jar \u4E2D\uFF0C\u5982\u56FE6.17 \u6240\u793A\u3002</p><p><img src="'+T+`" alt="\u56FE6-17" loading="lazy"></p><p>\u56FE6.17 tools.jar \u4E2D\u7684\u5B9E\u73B0</p><p>\u4EE5 jps \u5DE5\u5177\u4E3A\u4F8B\uFF0C\u5728\u63A7\u5236\u53F0\u6267\u884C jps \u547D\u4EE4\u548C java -classpath %Java_HOME%/lib/tools.jar sun.tools.jps.Jps \u547D\u4EE4\u662F\u7B49\u4EF7\u7684\uFF0C\u5373 jps.exe \u53EA\u662F\u8FD9\u4E2A\u547D\u4EE4\u7684\u4E00\u5C42\u5305\u88C5\u3002</p><h3 id="_6-3-1-\u67E5\u770B-java-\u8FDB\u7A0B\u2014\u2014jps-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_6-3-1-\u67E5\u770B-java-\u8FDB\u7A0B\u2014\u2014jps-\u547D\u4EE4" aria-hidden="true">#</a> 6.3.1 \u67E5\u770B Java \u8FDB\u7A0B\u2014\u2014jps \u547D\u4EE4</h3><p>jps \u547D\u4EE4\u7C7B\u4F3C\u4E8E Linux \u4E0B\u7684 ps \u547D\u4EE4\uFF0C\u4F46\u5B83\u53EA\u7528\u4E8E\u5217\u51FA Java \u7684\u8FDB\u7A0B\u3002\u76F4\u63A5\u8FD0\u884C jps \u547D\u4EE4\u4E0D\u52A0\u4EFB\u4F55\u53C2\u6570\uFF0C\u53EF\u4EE5\u5217\u51FA Java \u7A0B\u5E8F\u8FDB\u7A0B ID \u53CA Main \u51FD\u6570\u540D\u79F0\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jps
6260 Jps
7988 Main
400
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECE\u8FD9\u4E2A\u8F93\u51FA\u4E2D\u53EF\u4EE5\u770B\u5230\uFF0C\u5F53\u524D\u7CFB\u7EDF\u4E2D\u5171\u5B58\u5728 3 \u4E2A Java \u5E94\u7528\u7A0B\u5E8F\uFF0C\u5176\u4E2D\u7B2C\u4E00\u4E2A\u8F93\u51FA Jps \u5C31\u662F jps \u547D\u4EE4\u672C\u8EAB\uFF0C\u8FD9\u66F4\u52A0\u8BC1\u660E\u6B64\u547D\u4EE4\u7684\u672C\u8D28\u4E5F\u662F\u4E00\u4E2A Java \u7A0B\u5E8F\u3002\u6B64\u5916\uFF0Cjps \u547D\u4EE4\u8FD8\u63D0\u4F9B\u4E86\u4E00\u7CFB\u5217\u53C2\u6570\u6765\u63A7\u5236\u5B83\u7684\u8F93\u51FA\u5185\u5BB9\u3002</p><p>\u53C2\u6570 -q \u53EF\u4EE5\u6307\u5B9A jps \u53EA\u8F93\u51FA\u8FDB\u7A0B ID\uFF0C\u800C\u4E0D\u8F93\u51FA\u7C7B\u7684\u540D\u79F0\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jps -q
7988
7152
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53C2\u6570 -m \u53EF\u4EE5\u7528\u4E8E\u8F93\u51FA\u4F20\u9012\u7ED9 Java \u8FDB\u7A0B\uFF08\u4E3B\u51FD\u6570\uFF09\u7684\u53C2\u6570\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jps -m
7988 Main --log-config-file D:\\tools\\squirrel-sql-3.2.1\\log4j.properties --squirrel-home D:\\tools\\squirrel-sql-3.2.1
7456 Jps -m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53C2\u6570 -l \u53EF\u4EE5\u7528\u4E8E\u8F93\u51FA\u4E3B\u51FD\u6570\u7684\u5B8C\u6574\u8DEF\u5F84\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C: \\Documents and Settings\\Administrator&gt;jps -m -l
7244 sun.tools.jps.Jps -m -l
7988 net.sourceforge.squirrel_sql.client.Main --log-config-file D:\\tools\\squirrel-sql-3.2.1\\log4j.properties --squirrel-home D:\\tools\\squirrel-sql-3.2.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53C2\u6570 -v \u53EF\u4EE5\u663E\u793A\u4F20\u9012\u7ED9 Java \u865A\u62DF\u673A\u7684\u53C2\u6570\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jps -m -l -v
6992 sun.tools.jps.Jps -m -l -v -Denv.class.path=.;D:\\tools\\jdk6.0\\lib\\dt.jar;D:\\tools\\jdk6.0\\lib\\tools.jar;D:\\tools\\jdk6.0\\lib -Dapplication.home=D:\\tools\\jdk6.0 -Xms8m
7988 net.sourceforge.squirrel_sql.client.Main --log-config-file D:\\tools\\squirrel-sql-3.2.1\\log4j.properties --squirrel-home D:\\tools\\squirrel-sql-3.2.1 -Xmx256m -Dsun.java2d.noddraw=true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u6CE8\u610F</strong>\uFF1Ajps \u547D\u4EE4\u7C7B\u4F3C\u4E8E ps \u547D\u4EE4\uFF0C\u4F46\u662F\u5B83\u53EA\u5217\u51FA\u7CFB\u7EDF\u4E2D\u6240\u6709\u7684 Java \u5E94\u7528\u7A0B\u5E8F\u3002\u901A\u8FC7 jps \u547D\u4EE4\u53EF\u4EE5\u65B9\u4FBF\u5730\u67E5\u770B Java \u8FDB\u7A0B\u7684\u542F\u52A8\u7C7B\u3001\u4F20\u5165\u53C2\u6570\u548C Java \u865A\u62DF\u673A\u53C2\u6570\u7B49\u4FE1\u606F\u3002</p><h3 id="_6-3-2-\u67E5\u770B\u865A\u62DF\u673A\u8FD0\u884C\u65F6\u4FE1\u606F\u4E00jstat-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_6-3-2-\u67E5\u770B\u865A\u62DF\u673A\u8FD0\u884C\u65F6\u4FE1\u606F\u4E00jstat-\u547D\u4EE4" aria-hidden="true">#</a> 6.3.2 \u67E5\u770B\u865A\u62DF\u673A\u8FD0\u884C\u65F6\u4FE1\u606F\u4E00jstat \u547D\u4EE4</h3><p>jstat \u547D\u4EE4\u662F\u4E00\u4E2A\u53EF\u4EE5\u7528\u4E8E\u89C2\u5BDF Java \u5E94\u7528\u7A0B\u5E8F\u8FD0\u884C\u65F6\u76F8\u5173\u4FE1\u606F\u7684\u5DE5\u5177\u3002\u5B83\u7684\u529F\u80FD\u975E\u5E38\u5F3A\u5927\uFF0C\u53EF\u4EE5\u901A\u8FC7\u5B83\u67E5\u770B\u5806\u4FE1\u606F\u7684\u8BE6\u7EC6\u60C5\u51B5\u3002\u5B83\u7684\u57FA\u672C\u4F7F\u7528\u8BED\u6CD5\u4E3A\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;count&gt;]]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>option \u53EF\u4EE5\u7531\u4EE5\u4E0B\u503C\u6784\u6210\u3002</p><ul><li>-class\uFF1A\u663E\u793A ClassLoader \u7684\u76F8\u5173\u4FE1\u606F\u3002</li><li>-compiler\uFF1A\u663E\u793A JIT \u7F16\u8BD1\u7684\u76F8\u5173\u4FE1\u606F\u3002</li><li>-gc\uFF1A\u663E\u793A\u4E0E GC \u76F8\u5173\u7684\u5806\u4FE1\u606F\u3002</li><li>-gccapacity\uFF1A\u663E\u793A\u5404\u4E2A\u4EE3\u7684\u5BB9\u91CF\u53CA\u4F7F\u7528\u60C5\u51B5\u3002</li><li>-gccause\uFF1A\u663E\u793A\u5783\u573E\u56DE\u6536\u76F8\u5173\u4FE1\u606F\uFF08\u540C -gcutil\uFF09\uFF0C\u540C\u65F6\u663E\u793A\u6700\u540E\u4E00\u6B21\u6216\u5F53\u524D\u6B63\u5728\u53D1\u751F\u7684\u5783\u573E\u56DE\u6536\u7684\u8BF1\u53D1\u539F\u56E0\u3002</li><li>-gcnew\uFF1A\u663E\u793A\u65B0\u751F\u4EE3\u4FE1\u606F\u3002</li><li>-gcnewcapacity\uFF1A\u663E\u793A\u65B0\u751F\u4EE3\u5927\u5C0F\u4E0E\u4F7F\u7528\u60C5\u51B5\u3002</li><li>-gcoid\uFF1A\u663E\u793A\u8001\u5E74\u4EE3\u548C\u6C38\u4E45\u4EE3\u7684\u4FE1\u606F\u3002</li><li>-gcoldcapacity\uFF1A\u663E\u793A\u8001\u5E74\u4EE3\u7684\u5927\u5C0F\u3002</li><li>-gcpermcapacity\uFF1A\u663E\u793A\u6C38\u4E45\u4EE3\u7684\u5927\u5C0F\u3002</li><li>-gcutil\uFF1A\u663E\u793A\u5783\u573E\u56DE\u6536\u4FE1\u606F\u3002</li><li>-printcompilation\uFF1A\u8F93\u51FA JIT \u7F16\u8BD1\u7684\u65B9\u6CD5\u4FE1\u606F\u3002</li></ul></li><li><p>-t \u53C2\u6570\u53EF\u4EE5\u5728\u8F93\u51FA\u4FE1\u606F\u524D\u52A0\u4E0A\u4E00\u4E2A Timestamp \u5217\uFF0C\u663E\u793A\u7A0B\u5E8F\u7684\u8FD0\u884C\u65F6\u95F4\u3002</p></li><li><p>-h \u53C2\u6570\u53EF\u4EE5\u6307\u5B9A\u5728\u5468\u671F\u6027\u6570\u636E\u8F93\u51FA\u65F6\uFF0C\u8F93\u51FA\u591A\u5C11\u884C\u6570\u636E\u540E\u8F93\u51FA\u4E00\u4E2A\u8868\u5934\u4FE1\u606F\u3002</p></li><li><p>interval \u53C2\u6570\u7528\u4E8E\u6307\u5B9A\u8F93\u51FA\u7EDF\u8BA1\u6570\u636E\u7684\u5468\u671F\uFF0C\u5355\u4F4D\u4E3A\u6BEB\u79D2\u3002</p></li><li><p>count \u53C2\u6570\u7528\u4E8E\u6307\u5B9A\u4E00\u5171\u8F93\u51FA\u591A\u5C11\u6B21\u6570\u636E\u3002</p></li></ul><p>\u5982\u4E0B\u793A\u4F8B\u8F93\u51FA Java \u8FDB\u7A0B 2972 \u7684 ClassLoader \u76F8\u5173\u4FE1\u606F\u3002\u6BCF\u79D2\u7EDF\u8BA1\u4E00\u6B21\u4FE1\u606F\uFF0C\u4E00\u5171\u8F93\u51FA\u4E24\u6B21\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jstat -class -t 2972 1000 2
Timestamp  Loaded  Bytes   Unloaded  Bytes  Time 
1395.6     2375    2683.8   7        6.2     3.45
1396.6     2375    2683.8   7        6.2     3.45
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728 -class \u7684\u8F93\u51FA\u4E2D\uFF0CLoaded \u8868\u793A\u8F7D\u5165\u7C7B\u7684\u6570\u91CF\uFF0CBytes \u8868\u793A\u8F7D\u5165\u7C7B\u7684\u5408\u8BA1\u5927\u5C0F\uFF0CUnloaded \u8868\u793A\u5378\u8F7D\u7C7B\u7684\u6570\u91CF\uFF0C\u7B2C 2 \u4E2A Bytes \u8868\u793A\u5378\u8F7D\u7C7B\u7684\u5927\u5C0F\uFF0CTime \u8868\u793A\u5728\u52A0\u8F7D\u548C\u5378\u8F7D\u7C7B\u4E0A\u6240\u82B1\u7684\u65F6\u95F4\u3002</p><p>\u4E0B\u4F8B\u663E\u793A\u4E86\u67E5\u770B JIT \u7F16\u8BD1\u7684\u4FE1\u606F\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jstat -compiler -t 2972
Timestamp Compiled Failed Invalid   Time  FailedType FailedMethod 
1675.9	     779	   0	   0	0.61	    0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Compiled \u8868\u793A\u7F16\u8BD1\u4EFB\u52A1\u6267\u884C\u7684\u6B21\u6570\uFF0CFailed \u8868\u793A\u7F16\u8BD1\u5931\u8D25\u7684\u6B21\u6570\uFF0CInvalid \u8868\u793A\u7F16\u8BD1\u4E0D\u53EF\u7528\u7684\u6B21\u6570\uFF0CTime \u8868\u793A\u7F16\u8BD1\u7684\u603B\u8017\u65F6\uFF0CFailedType \u8868\u793A\u6700\u540E\u4E00\u6B21\u7F16\u8BD1\u5931\u8D25\u7684\u7C7B\u578B\uFF0CFailedMethod \u8868\u793A\u6700\u540E\u4E00\u6B21\u7F16\u8BD1\u5931\u8D25\u7684\u7C7B\u540D\u548C\u65B9\u6CD5\u540D\u3002</p><p>\u4E0B\u4F8B\u663E\u793A\u4E86\u4E0E GC \u76F8\u5173\u7684\u5806\u4FE1\u606F\u7684\u8F93\u51FA\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jstat -gc 2972
SOC	  SIC SOU SIU    EC    EU     OC       OU	    PC    PU    YGC   YGCT FGC   FGCT    GCT
64.0 64.0 0.0 2.0 896.0 448.9 12312.0  9019.1  12288.0  9101.3  101	 0.153   2	0.210  0.364
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>S0C\uFF1As0\uFF08from \u533A\uFF09\u7684\u5927\u5C0F\uFF08KB\uFF09\u3002</li><li>S1C\uFF1As1\uFF08from \u533A\uFF09\u7684\u5927\u5C0F\uFF08KB\uFF09\u3002</li><li>S0U\uFF1As0\uFF08from\u533A\uFF09\u5DF3\u4F7F\u7528\u7684\u7A7A\u95F4\uFF08KB\uFF09\u3002</li><li>S1U\uFF1As1\uFF08from\u533A\uFF09\u5DF1\u4F7F\u7528\u7684\u7A7A\u95F4\uFF08KB\uFF09\u3002</li><li>EC\uFF1Aeden \u533A\u7684\u5927\u5C0F\uFF08KB\uFF09\u3002</li><li>EU\uFF1Aeden \u533A\u7684\u4F7F\u7528\u7A7A\u95F4\uFF08KB\uFF09\u3002</li><li>OC\uFF1A\u8001\u5E74\u4EE3\u5927\u5C0F\uFF08KB\uFF09\u3002</li><li>OU\uFF1A\u8001\u5E74\u4EE3\u5DF2\u7ECF\u4F7F\u7528\u7684\u7A7A\u95F4\uFF08KB\uFF09\u3002</li><li>PC\uFF1A\u6C38\u4E45\u533A\u5927\u5C0F\uFF08KB\uFF09\u3002</li><li>PU\uFF1A\u6C38\u4E45\u533A\u7684\u4F7F\u7528\u7A7A\u95F4\uFF08KB\uFF09\u3002</li><li>YGC\uFF1A\u65B0\u751F\u4EE3 GC \u6B21\u6570\u3002</li><li>YGCT\uFF1A\u65B0\u751F\u4EE3 GC \u8017\u65F6\u3002</li><li>FGC\uFF1AFull GC \u6B21\u6570\u3002</li><li>FGCT\uFF1AFull GC \u8017\u65F6\u3002</li><li>GCT\uFF1AGC \u603B\u8017\u65F6\u3002</li></ul><p>\u4E0B\u4F8B\u663E\u793A\u4E86\u5404\u4E2A\u4EE3\u7684\u4FE1\u606F\uFF0C\u4E0E -gc \u76F8\u6BD4\uFF0C\u5B83\u4E0D\u4EC5\u8F93\u51FA\u4E86\u5404\u4E2A\u4EE3\u7684\u5F53\u524D\u5927\u5C0F\uFF0C\u4E5F\u5305\u542B\u4E86\u5404\u4E2A\u4EE3\u7684\u6700\u5927\u503C\u548C\u6700\u5C0F\u503C\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jstat -gccapacity 2972
NGCMN     NGCMX     NGC  S0C   S1C     EC   OGCMN    OGCMX     OGC        OC    PGCMN    PGCMX     PGC    PC   YGC  FGC
1024.0  20160.0  1024.0 64.0  64.0  896.0  4096.0  241984.0  12312.0  12312.0  12288.0 65536.0  12288.0 12288.0 129  2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>NGCMN\uFF1A\u5F53\u524D\u65B0\u751F\u4EE3\u6700\u5C0F\u503C\uFF08KB\uFF09\u3002</li><li>NGCMX\uFF1A\u5F53\u524D\u65B0\u751F\u4EE3\u6700\u5927\u503C\uFF08KB\uFF09\u3002</li><li>NGC\uFF1A\u5F53\u524D\u65B0\u751F\u4EE3\u5927\u5C0F\uFF08KB\uFF09\u3002</li><li>OGCMN\uFF1A\u8001\u5E74\u4EE3\u6700\u5C0F\u503C\uFF08KB\uFF09\u3002</li><li>OGCMX\uFF1A\u8001\u5E74\u4EE3\u6700\u5927\u503C\uFF08KB\uFF09\u3002</li><li>PGCMN\uFF1A\u6C38\u4E45\u4EE3\u6700\u5C0F\u503C\uFF08KB\uFF09\u3002</li><li>PGCMX\uFF1A\u6C38\u4E45\u4EE3\u6700\u5927\u503C\uFF08KB\uFF09\u3002</li></ul><p>\u4E0B\u4F8B\u663E\u793A\u4E86\u6700\u8FD1\u4E00\u6B21 GC \u7684\u539F\u56E0\uFF0C\u4EE5\u53CA\u5F53\u524D GC \u7684\u539F\u56E0\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jstat -gccause 2972
S0     S1      E    O    P     YGC   YGCT  FGC    GCT        LGCC    GCC
0.00 0.00  19.58 59.99  91.43  143  0.207   3   0.538  System.gc()  No GC
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>LGCC\uFF1A\u4E0A\u6B21 GC \u7684\u539F\u56E0\u3002</li><li>GCC\uFF1A\u5F53\u524D GC \u7684\u539F\u56E0\u3002</li></ul><p>\u672C\u4F8B\u663E\u793A\uFF0C\u6700\u8FD1\u4E00\u6B21 GC \u662F\u7531\u4E8E\u663E\u5F0F\u7684 System.gc() \u8C03\u7528\u6240\u5F15\u8D77\u7684\uFF0C\u5F53\u524D\u65F6\u523B\u672A\u8FDB\u884C GC\u3002</p><p>-gcnew \u53C2\u6570\u53EF\u4EE5\u7528\u4E8E\u67E5\u770B\u65B0\u751F\u4EE3\u7684\u4E00\u4E9B\u8BE6\u7EC6\u4FE1\u606F\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jstat -gcnew 2972
S0C      S1C  S0U   S1U  TT  MTT    DSS       EC    EU   YGC     YGCT
128.0  128.0  0.0  11.8  15   15   64.0   1024.0  139.8  159    0.223
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>TT\uFF1A\u65B0\u751F\u4EE3\u5BF9\u8C61\u664B\u5347\u5230\u8001\u5E74\u4EE3\u5BF9\u8C61\u7684\u5E74\u9F84\u3002</p></li><li><p>MTT\uFF1A\u65B0\u751F\u4EE3\u5BF9\u8C61\u664B\u5347\u5230\u8001\u5E74\u4EE3\u5BF9\u8C61\u7684\u5E74\u9F84\u6700\u5927\u503C\u3002</p></li><li><p>DSS\uFF1A\u6240\u9700\u7684 survivor \u533A\u5927\u5C0F\u3002</p></li></ul><p>-gcnewcapacity \u53C2\u6570\u53EF\u4EE5\u8BE6\u7EC6\u8F93\u51FA\u65B0\u751F\u4EE3\u5404\u4E2A\u533A\u7684\u5927\u5C0F\u4FE1\u606F\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jstat -gcnewcapacity 2972
NGCMN    NGCMX	  NGC	SOCMX	  S0C	 S1CMX  S1IC	 ECMX	   EC   YGC FGC
1024.0 20160.0	1280.0	128.0	1984.0	1984.0 128.0	16192.0	1024.0  178  3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>S0CMX\uFF1As0 \u533A\u7684\u6700\u5927\u503C\uFF08KB\uFF09\u3002</li><li>S1CMX\uFF1As1 \u533A\u7684\u6700\u5927\u503C\uFF08KB\uFF09\u3002</li><li>ECMX\uFF1Aeden \u533A\u7684\u6700\u5927\u503C\uFF08KB\uFF09\u3002</li></ul><p>-gcold\u7528\u4E8E\u5C55\u73B0\u8001\u5E74\u4EE3 GC \u7684\u6982\u51B5\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jstat -gcold 2972
PC	         PU       OC      OU   YGC   FGC  FGCT     GCT
12288.0  11295.6  15048.0  9106.1   190    3   0.331  0.580
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>-gcoldcapacity \u7528\u4E8E\u5C55\u73B0\u8001\u5E74\u4EE3\u7684\u5BB9\u91CF\u4FE1\u606F\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jstat -gcoldcapacity 2972 
 OGCMN    OGCMX    OGC      OC  YGC FGC  FGCT   GCT
4096.0 241984.0 15048.0 15048.0 195   3 0.331 0.584
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>-gcpermcapacity \u7528\u4E8E\u5C55\u793A\u6C38\u4E45\u533A\u7684\u4F7F\u7528\u60C5\u51B5\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jstat -gcpermcapacity 2972
  PGCMN   PGCMX     PGC     PC  YGC  FGC  FGCT    GCT
12288.0 65536.0 12288.0 12288.0 220    3  0.331  0.605
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>-gcutil \u7528\u4E8E\u5C55\u793A GC \u56DE\u6536\u76F8\u5173\u4FE1\u606F\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jstat -gcutil 2972
S0     S1      E    O      P   YGC   YGCT  FGC   FGCT    GCT
7.65 0.00  62.88 60.60  92.19  224  0.277   3   0.331  0.609
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>S0\uFF1As0 \u533A\u4F7F\u7528\u7684\u767E\u5206\u6BD4\u3002</p></li><li><p>S1\uFF1As1 \u533A\u4F7F\u7528\u7684\u767E\u5206\u6BD4\u3002</p></li><li><p>E\uFF1Aeden \u533A\u4F7F\u7528\u7684\u767E\u5206\u6BD4\u3002</p></li><li><p>O\uFF1A\u8001\u5E74\u4EE3\u4F7F\u7528\u7684\u767E\u5206\u6BD4\u3002</p></li><li><p>P\uFF1A\u6C38\u4E45\u533A\u4F7F\u7528\u7684\u767E\u5206\u6BD4\u3002</p></li></ul><p><strong>\u6CE8\u610F</strong>\uFF1Ajstat \u547D\u4EE4\u53EF\u4EE5\u975E\u5E38\u8BE6\u7EC6\u5730\u67E5\u770B Java \u5E94\u7528\u7A0B\u5E8F\u7684\u5806\u4F7F\u7528\u60C5\u51B5\u53CA GC \u60C5\u51B5\u3002</p><h3 id="_6-3-3-\u67E5\u770B\u865A\u62DF\u673A\u53C2\u6570\u2014\u2014jinfo-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_6-3-3-\u67E5\u770B\u865A\u62DF\u673A\u53C2\u6570\u2014\u2014jinfo-\u547D\u4EE4" aria-hidden="true">#</a> 6.3.3 \u67E5\u770B\u865A\u62DF\u673A\u53C2\u6570\u2014\u2014jinfo \u547D\u4EE4</h3><p>jinfo \u547D\u4EE4\u53EF\u4EE5\u7528\u6765\u67E5\u770B\u6B63\u5728\u8FD0\u884C\u7684 Java \u5E94\u7528\u7A0B\u5E8F\u7684\u6269\u5C55\u53C2\u6570\uFF0C\u751A\u81F3\u652F\u6301\u5728\u8FD0\u884C\u65F6\u4FEE\u6539\u90E8\u5206\u53C2\u6570\u3002\u5B83\u7684\u57FA\u672C\u8BED\u6CD5\u4E3A\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>jinfo &lt;option&gt; &lt;pid&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5176\u4E2D option \u53EF\u4EE5\u4E3A\u4EE5\u4E0B\u4FE1\u606F\u3002</p><ul><li><p>-flag &lt;name&gt;\uFF1A\u6253\u5370\u6307\u5B9A Java \u865A\u62DF\u673A\u7684\u53C2\u6570\u503C\u3002</p></li><li><p>-flag [+|-]&lt;name&gt;\uFF1A\u8BBE\u7F6E\u6307\u5B9A Java \u865A\u62DF\u673A\u53C2\u6570\u7684\u5E03\u5C14\u503C\u3002</p></li><li><p>-flag &lt;name&gt;=&lt;value&gt;\uFF1A\u8BBE\u7F6E\u6307\u5B9A Java \u865A\u62DF\u673A\u53C2\u6570\u7684\u503C\u3002</p></li></ul><p>\u5728\u5F88\u591A\u60C5\u51B5\u4E0B\uFF0CJava \u5E94\u7528\u7A0B\u5E8F\u4E0D\u4F1A\u6307\u5B9A\u6240\u6709\u7684 Java \u865A\u62DF\u673A\u53C2\u6570\u3002\u800C\u6B64\u65F6\uFF0C\u5F00\u53D1\u4EBA\u5458\u53EF\u80FD\u4E0D\u77E5\u9053\u67D0\u4E00\u4E2A\u5177\u4F53\u7684 Java \u865A\u62DF\u673A\u53C2\u6570\u7684\u9ED8\u8BA4\u503C\u3002\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0C\u53EF\u80FD\u9700\u8981\u901A\u8FC7\u67E5\u627E\u6587\u6863\u83B7\u53D6\u67D0\u4E2A\u53C2\u6570\u7684\u9ED8\u8BA4\u503C\u3002\u8FD9\u4E2A\u67E5\u627E\u8FC7\u7A0B\u53EF\u80FD\u662F\u975E\u5E38\u8270\u96BE\u7684\u3002\u4F46\u6709\u4E86 jinfo \u547D\u4EE4\uFF0C\u5F00\u53D1\u4EBA\u5458\u53EF\u4EE5\u5F88\u65B9\u4FBF\u5730\u627E\u5230 Java \u865A\u62DF\u673A\u53C2\u6570\u7684\u5F53\u524D\u503C\u3002</p><p>\u4E0B\u4F8B\u663E\u793A\u4E86\u65B0\u751F\u4EE3\u5BF9\u8C61\u664B\u5347\u5230\u8001\u5E74\u4EE3\u5BF9\u8C61\u7684\u6700\u5927\u5E74\u9F84\u3002\u5728\u5E94\u7528\u7A0B\u5E8F\u542F\u52A8\u65F6\uFF0C\u5E76\u6CA1\u6709\u6307\u5B9A\u8FD9\u4E2A\u53C2\u6570\uFF0C\u4F46\u901A\u8FC7 jinfo \u547D\u4EE4\u53EF\u4EE5\u67E5\u770B\u8FD9\u4E2A\u53C2\u6570\u7684\u5F53\u524D\u6570\u503C\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jinfo -flag MaxTenuringThreshold 2972 
-XX:MaxTenuringThreshold=15
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u663E\u793A\u662F\u5426\u6253\u5370 GC \u8BE6\u7EC6\u4FE1\u606F\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jinfo -flag PrintGCDetails 2972
-XX:-PrintGCDetails
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u9664\u4E86\u67E5\u627E\u53C2\u6570\u7684\u503C\uFF0Cjinfo \u547D\u4EE4\u4E5F\u652F\u6301\u4FEE\u6539\u90E8\u5206\u53C2\u6570\u7684\u6570\u503C\uFF0C\u5F53\u7136\uFF0C\u8FD9\u4E2A\u4FEE\u6539\u80FD\u529B\u662F\u6781\u5176\u6709\u9650\u7684\u3002\u4E0B\u4F8B\u663E\u793A\u4E86\u901A\u8FC7 jinfo \u547D\u4EE4\u5BF9 PrintGCDetails \u53C2\u6570\u7684\u4FEE\u6539\uFF0C\u5B83\u53EF\u4EE5\u5728 Java \u7A0B\u5E8F\u8FD0\u884C\u65F6\uFF0C\u52A8\u6001\u5173\u95ED\u6216\u8005\u6253\u5F00\u8FD9\u4E2A\u5F00\u5173\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jinfo -flag PrintGCDetails 2972
-XX:-PrintGCDetails

C:\\Documents and Settings\\Administrator&gt;jinfo -flag +PrintGCDetails 2972

C:\\Documents and Settings\\Administrator&gt;jinfo -flag PrintGCDetails 2972 
-XX:+PrintGCDetails
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u6CE8\u610F</strong>\uFF1A\u4F7F\u7528 jinfo \u547D\u4EE4\u4E0D\u4EC5\u53EF\u4EE5\u67E5\u770B\u8FD0\u884C\u65F6\u67D0\u4E00\u4E2A Java \u865A\u62DF\u673A\u53C2\u6570\u7684\u5B9E\u9645\u53D6\u503C\uFF0C\u751A\u81F3\u53EF\u4EE5\u5728\u8FD0\u884C\u65F6\u4FEE\u6539\u90E8\u5206\u53C2\u6570\uFF0C\u5E76\u4F7F\u4E4B\u7ACB\u5373\u751F\u6548\uFF08\u5E76\u975E\u6240\u6709\u53C2\u6570\u90FD\u652F\u6301\u52A8\u6001\u4FEE\u6539\uFF09\u3002</p><h3 id="_6-3-4-\u5BFC\u51FA\u5806\u5230\u6587\u4EF6\u2014\u2014jmap-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_6-3-4-\u5BFC\u51FA\u5806\u5230\u6587\u4EF6\u2014\u2014jmap-\u547D\u4EE4" aria-hidden="true">#</a> 6.3.4 \u5BFC\u51FA\u5806\u5230\u6587\u4EF6\u2014\u2014jmap \u547D\u4EE4</h3><p>jmap \u547D\u4EE4\u662F\u4E00\u4E2A\u591A\u529F\u80FD\u7684\u547D\u4EE4\u3002\u5B83\u53EF\u4EE5\u751F\u6210 Java \u7A0B\u5E8F\u7684\u5806 Dump \u6587\u4EF6\uFF0C\u4E5F\u53EF\u4EE5\u67E5\u770B\u5806\u5185\u5BF9\u8C61\u5B9E\u4F8B\u7684\u7EDF\u8BA1\u4FE1\u606F\u3001\u67E5\u770B ClassLoader \u7684\u4FE1\u606F\u53CA finalizer \u961F\u5217\u3002</p><p>\u4E0B\u4F8B\u4F7F\u7528 jmap \u547D\u4EE4\u751F\u6210 PID \u4E3A 2972 \u7684 Java \u7A0B\u5E8F\u7684\u5BF9\u8C61\u7EDF\u8BA1\u4FE1\u606F\uFF0C\u5E76\u8F93\u51FA\u5230 s.txt \u6587\u4EF6\u4E2D\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>jmap -histo 2972 &gt; c:\\s.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8F93\u51FA\u6587\u4EF6\u7ED3\u6784\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>num	 #instances   #bytes    class name
--------------------------------------------
1:        4983   6057848    [I                                    
2:       20929   2473080    &lt;constMethodKlass&gt;        
...
1932:        1         8   sun.java2d.pipe.AlphaColorPipe       
1933:        1         8   sun.reflect.GeneratedMethodAccessor64 
Total    230478  22043360                                         
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u8FD9\u4E2A\u8F93\u51FA\u663E\u793A\u4E86\u5185\u5B58\u4E2D\u7684\u5B9E\u4F8B\u6570\u91CF\u548C\u5408\u8BA1\u3002</p><p>jmap \u547D\u4EE4\u53E6\u4E00\u4E2A\u66F4\u4E3A\u91CD\u8981\u7684\u529F\u80FD\u662F\u5F97\u5230 Java \u7A0B\u5E8F\u7684\u5F53\u524D\u5806\u5FEB\u7167\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jmap -dunp:format=b,file=c:\\heap.hprof 2972
Dumping heap to C:\\heap.hprof ...
Heap dump file created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u672C\u4F8B\u4E2D\uFF0C\u5C06\u5E94\u7528\u7A0B\u5E8F\u7684\u5806\u5FEB\u7167\u8F93\u51FA\u5230 C \u76D8 heap.bin \u6587\u4EF6\u4E2D\u3002\u4E4B\u540E\uFF0C\u53EF\u4EE5\u901A\u8FC7\u591A\u79CD\u5DE5\u5177\u5206\u6790\u8BE5\u5806\u6587\u4EF6\u3002\u6BD4\u5982\uFF0C\u4E0B\u6587\u4E2D\u63D0\u5230\u7684 jhat \u5DE5\u5177\u6216\u8005 VisualVM\u3001MAT \u7B49\u5DE5\u5177\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1Ajmap \u53EF\u7528\u4E8E\u5BFC\u51FA Java \u5E94\u7528\u7A0B\u5E8F\u7684\u5806\u5FEB\u7167\u3002</p><p>\u6B64\u5916\uFF0Cjmap \u8FD8\u53EF\u4EE5\u67E5\u770B\u7CFB\u7EDF\u7684 ClassLoader \u7684\u4FE1\u606F\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Users\\Administrator&gt;jmap -permstat 10360
Attaching to process ID 10360\uFF0Cplease wait...
class_loader classes bytes parent_loader alive? type

&lt;bootstrap&gt; 368 1644840  null       live  &lt;internal&gt; 
0x246f0b70  0    0       null       live  sun/misc/Launcher$ExtClassLoader@0x39114a50 
0x246f94b8  9    63472  0x246f0b70  live  sun/misc/Launcher$AppClassLoader@0x39136bb8 
                                            
total = 3    377   1708312    N/A   alive=3, dead=0   N/A    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u7CFB\u7EDF\u4E2D\u6709 3 \u4E2A ClassLoader\uFF0C\u5E76\u663E\u793A\u4E86\u5B83\u4EEC\u7684\u7236\u5B50\u5173\u7CFB\u3002\u540C\u65F6\uFF0C\u4E5F\u663E\u793A\u4E86\u6BCF\u4E2A ClassLoader \u5185\u90E8\u52A0\u8F7D\u7684\u7C7B\u7684\u6570\u91CF\u548C\u603B\u5927\u5C0F\u3002</p><p>\u901A\u8FC7 jmap \u547D\u4EE4\uFF0C\u8FD8\u53EF\u4EE5\u89C2\u5BDF\u7CFB\u7EDF finalizer \u961F\u5217\u4E2D\u7684\u5BF9\u8C61\uFF0C\u4E00\u4E2A\u4E0D\u6070\u5F53\u7684 finalize() \u51FD\u6570\u53EF\u80FD\u5BFC\u81F4\u5BF9\u8C61\u5806\u79EF\u5728 finalizer \u961F\u5217\u4E2D\u3002\u4F7F\u7528\u4EE5\u4E0B\u547D\u4EE4\u53EF\u4EE5\u67E5\u770B\u5806\u79EF\u5728 finalizer \u961F\u5217\u4E2D\u7684\u5BF9\u8C61\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Users\\Administrator&gt;jmap -finalizerinfo 9828
Number of objects pending for finalization: 13461

Count    Class description 	
-----------------------------------
13458	geym.zbase.ch5.LongFinalize$LF
3       java.io.FileInputStream
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u5728 finalizer \u961F\u5217\u4E2D\uFF0C\u5806\u79EF\u4E86\u5927\u91CF\u7684 geym.zbase.ch5.LongFinalize$LF \u5BF9\u8C61\u5B9E\u4F8B\u548C 3 \u4E2A java.io.FileInputStream \u5B9E\u4F8B\u3002</p><h3 id="_6-3-5-jdk-\u81EA\u5E26\u7684\u5806\u5206\u6790\u5DE5\u5177\u2014\u2014jhat-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_6-3-5-jdk-\u81EA\u5E26\u7684\u5806\u5206\u6790\u5DE5\u5177\u2014\u2014jhat-\u547D\u4EE4" aria-hidden="true">#</a> 6.3.5 JDK \u81EA\u5E26\u7684\u5806\u5206\u6790\u5DE5\u5177\u2014\u2014jhat \u547D\u4EE4</h3><p>\u4F7F\u7528 jhat \u547D\u4EE4\u53EF\u4EE5\u5206\u6790 Java \u5E94\u7528\u7A0B\u5E8F\u7684\u5806\u5FEB\u7167\u5185\u5BB9\u3002</p><p><strong>\u8BF4\u660E</strong>\uFF1Ajhat \u547D\u4EE4\u5728 JDK 9\u3001JDK 10 \u4E2D\u5DF2\u7ECF\u88AB\u5220\u9664\uFF0C\u5B98\u65B9\u5EFA\u8BAE\u7528 VisualVM \u4EE3\u66FF\uFF0C\u53C2\u8003 6.5.5 \u8282\u3002</p><p>\u3010\u793A\u4F8B 6-9\u3011\u4EE5\u524D\u6587\u4E2D jmap \u547D\u4EE4\u7684\u8F93\u51FA\u5806\u6587\u4EF6 heap.hprof \u4E3A\u4F8B\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jhat c:\\heap.hprof
Reading from c:\\heap.hprof...
Dump file created Thu Mar 22 22:27:19 CST 2012
Snapshot read, resolving...
Resolving 133055 objects...
Chasing references, expect 26 dots...................	
Eliminating duplicate references...................	 
Snapshot resolved.
Started HTTP server on port 7000
Server is ready.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,98),qn=n("\u5728\u5206\u6790\u5B8C\u6210\u540E\uFF0C\u4F7F\u7528 HTTP \u670D\u52A1\u5668\u5C55\u793A\u5176\u5206\u6790\u7ED3\u679C\u3002\u5728\u6D4F\u89C8\u5668\u4E2D\u8BBF\u95EE "),Ln={href:"http://127.0.0.1:7000",target:"_blank",rel:"noopener noreferrer"},zn=n("http://127.0.0.1:7000"),In=n("\uFF0C\u8F93\u51FA\u7ED3\u679C\u5982\u56FE6.18 \u6240\u793A\u3002"),Bn=a('<p><img src="'+M+'" alt="\u56FE6-18" loading="lazy"></p><p>\u56FE6.18 jhat \u8F93\u51FA\u7ED3\u679C</p><p>\u5728\u9ED8\u8BA4\u9875\u4E2D\uFF0Cjhat \u670D\u52A1\u5668\u663E\u793A\u4E86\u6240\u6709\u7684\u975E\u5E73\u53F0\u7C7B\u4FE1\u606F\u3002\u5355\u51FB\u94FE\u63A5\uFF0C\u53EF\u4EE5\u67E5\u770B\u9009\u4E2D\u7C7B\u7684\u8D85\u7C7B\u3001ClassLoader \u53CA\u8BE5\u7C7B\u7684\u5B9E\u4F8B\u7B49\u4FE1\u606F\u3002\u6B64\u5916\uFF0C\u5728\u9875\u9762\u5E95\u90E8\uFF0C\u8FD8\u4E3A\u5F00\u53D1\u4EBA\u5458\u63D0\u4F9B\u4E86\u5176\u4ED6\u67E5\u8BE2\u65B9\u5F0F\uFF0C\u5982\u56FE6.19 \u6240\u793A\u3002</p><p><img src="'+S+'" alt="\u56FE6-19" loading="lazy"></p><p>\u56FE6.19 jhat \u63D0\u4F9B\u7684\u67E5\u8BE2\u529F\u80FD</p><p>\u901A\u8FC7\u8FD9\u4E9B\u94FE\u63A5\uFF0C\u5F00\u53D1\u8005\u53EF\u4EE5\u8FDB\u4E00\u6B65\u67E5\u770B\u6240\u6709\u7C7B\u4FE1\u606F\uFF08\u5305\u62EC Java \u5E73\u53F0\u7684\u7C7B\uFF09\u3001\u6240\u6709\u7C7B\u7684\u5B9E\u4F8B\u6570\u91CF\u53CA\u5B9E\u4F8B\u7684\u5177\u4F53\u4FE1\u606F\u3002\u6700\u540E\uFF0C\u8FD8\u6709\u4E00\u4E2A\u94FE\u63A5\u6307\u5411 OQL \u67FB\u8BE2\u754C\u9762\u3002</p><p>\u56FE6.20 \u663E\u793A\u4E86\u5728 jhat \u4E2D\u67E5\u770B Java \u5E94\u7528\u7A0B\u5E8F\u91CC java.lang.String \u7C7B\u7684\u5B9E\u4F8B\u6570\u91CF\u7684\u7ED3\u679C\u3002</p><p><img src="'+P+'" alt="\u56FE6-20" loading="lazy"></p><p>\u56FE6.20 \u663E\u793A\u5B9E\u4F8B\u6570\u91CF</p><p>\u5355\u51FB instances \u94FE\u63A5\u53EF\u4EE5\u8FDB\u4E00\u6B65\u67E5\u770B String \u5BF9\u8C61\u7684\u5B9E\u4F8B\uFF0C\u5982\u56FE6.21 \u6240\u793A\u3002</p><p><img src="'+J+`" alt="\u56FE6-21" loading="lazy"></p><p>\u56FE6.21 \u663E\u793A String \u5BF9\u8C61\u7684\u5B9E\u4F8B</p><p>\u901A\u5E38\uFF0C\u5BFC\u51FA\u7684\u5806\u5FEB\u7167\u4FE1\u606F\u975E\u5E38\u591A\uFF0C\u53EF\u80FD\u5F88\u96BE\u901A\u8FC7\u9875\u9762\u4E0A\u7B80\u5355\u7684\u94FE\u63A5\u7D22\u5F15\u627E\u5230\u60F3\u8981\u7684\u4FE1\u606F\u3002\u4E3A\u6B64\uFF0Cjhat \u547D\u4EE4\u8FD8\u652F\u6301\u4F7F\u7528 OQL \u5BF9\u5806\u5FEB\u7167\u8FDB\u884C\u67E5\u8BE2\u3002\u6267\u884C OQL \u7684\u754C\u9762\u975E\u5E38\u7B80\u6D01\uFF0C\u5982\u56FE6.22 \u6240\u793A\u3002\u4F7F\u7528 OQL \u67E5\u8BE2\u51FA\u5F53\u524D Java \u7A0B\u5E8F\u4E2D\u6240\u6709 java.io.File \u5BF9\u8C61\u7684\u8DEF\u5F84\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>select file.path.value.toString() from java.io.File file
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+D+`" alt="\u56FE6-22" loading="lazy"></p><p>\u56FE6.22 OQL \u67E5\u8BE2\u754C\u9762</p><p>jhat \u7684 OQL \u4E0E VisualVM \u7684 OQL \u975E\u5E38\u63A5\u8FD1\uFF0C\u6709\u5174\u8DA3\u7684\u8BFB\u8005\u53EF\u4EE5\u67E5\u9605\u672C\u4E66\u4E2D\u7684\u76F8\u5173\u7AE0\u8282\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1Ajhat \u547D\u4EE4\u53EF\u4EE5\u5BF9\u5806\u5FEB\u7167\u6587\u4EF6\u8FDB\u884C\u5206\u6790\uFF0C\u5B83\u542F\u52A8\u4E00\u4E2A HTTP \u670D\u52A1\u5668\uFF0C\u5F00\u53D1\u4EBA\u5458\u53EF\u4EE5\u901A\u8FC7\u6D4F\u89C8\u5668\u6D4F\u89C8 Java \u5806\u5FEB\u7167\u3002</p><h3 id="_6-3-6-\u67E5\u770B\u7EBF\u7A0B\u5806\u6808\u2014\u2014jstack-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_6-3-6-\u67E5\u770B\u7EBF\u7A0B\u5806\u6808\u2014\u2014jstack-\u547D\u4EE4" aria-hidden="true">#</a> 6.3.6 \u67E5\u770B\u7EBF\u7A0B\u5806\u6808\u2014\u2014jstack \u547D\u4EE4</h3><p>jstack \u547D\u4EE4\u7528\u4E8E\u5BFC\u51FA Java \u5E94\u7528\u7A0B\u5E8F\u7684\u7EBF\u7A0B\u5806\u6808\uFF0C\u8BED\u6CD5\u4E3A\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>jstack [-l] &lt;pid&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>-l \u9009\u9879\u7528\u4E8E\u6253\u5370\u9501\u7684\u9644\u52A0\u4FE1\u606F\u3002</p><p>jstack \u547D\u4EE4\u4F1A\u5728\u63A7\u5236\u53F0\u8F93\u51FA\u7A0B\u5E8F\u4E2D\u6240\u6709\u7684\u9501\u4FE1\u606F\uFF0C\u53EF\u4EE5\u4F7F\u7528\u91CD\u5B9A\u5411\u5C06\u8F93\u51FA\u4FDD\u5B58\u5230\u6587\u4EF6\u4E2D\uFF0C\u5982\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>jstack -l 2348 &gt; C:\\deadlock.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u3010\u793A\u4F8B 6-10\u3011\u4E0B\u4F8B\u6F14\u793A\u4E86\u4E00\u4E2A\u7B80\u5355\u7684\u6B7B\u9501\uFF0C\u4E24\u4E2A\u7EBF\u7A0B\u5206\u522B\u5360\u7528 south \u9501\u548C north \u9501\uFF0C\u5E76\u540C\u65F6\u8BF7\u6C42\u5BF9\u65B9\u5360\u7528\u7684\u9501\uFF0C\u5BFC\u81F4\u6B7B\u9501\u53D1\u751F\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeadLock</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token class-name">Object</span> myDirect<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> south <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> north <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">DeadLock</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>myDirect <span class="token operator">=</span> obj<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>myDirect <span class="token operator">==</span> south<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;south&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>myDirect <span class="token operator">==</span> north<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;north&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>myDirect <span class="token operator">==</span> south<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u5360\u7528 north</span>
                north<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">// \u7B49\u5F85 north \u542F\u52A8</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// \u5360\u7528 south</span>
                south<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;car to south has passed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;car to south is killed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>north<span class="token punctuation">.</span><span class="token function">isHeldByCurrentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
                    north<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>south<span class="token punctuation">.</span><span class="token function">isHeldByCurrentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
                    south<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>myDirect <span class="token operator">==</span> north<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u5360\u7528 south</span>
                south<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// \u5360\u7528 north</span>
                north<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;car to north has passed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;car to north is killed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>north<span class="token punctuation">.</span><span class="token function">isHeldByCurrentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
                    north<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>south<span class="token punctuation">.</span><span class="token function">isHeldByCurrentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
                    south<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 2 \u4E2A\u7EBF\u7A0B\u6B7B\u9501</span>
        <span class="token class-name">DeadLock</span> car2south <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeadLock</span><span class="token punctuation">(</span>south<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DeadLock</span> car2north <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeadLock</span><span class="token punctuation">(</span>north<span class="token punctuation">)</span><span class="token punctuation">;</span>
        car2south<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        car2north<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u7528 jstack \u547D\u4EE4\u6253\u5370\u4E0A\u4F8B\u7684\u8F93\u51FA\uFF0C\u90E8\u5206\u8F93\u51FA\u7ED3\u679C\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&quot;north&quot; prio=6 tid=0x0109c400 nid=0x17e4 waiting on condition [0x0517f000]
java.lang.Thread.State: WAITING (parking)
at sun.misc.Unsafe.park(Native Method)
- parking to wait for &lt;0x24704068&gt; (a java.util.concurrent.locks.ReentrantLock$NonfairSync)
at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186) 
at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)
at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireInterruptibly(AbstractQueuedSynchronizer.java:894)
at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireInterruptibly(AbstractQueuedSynchronizer.java:1221)
at java.util.concurrent.locks.ReentrantLock.lockInterruptibly(ReentrantLock.java:340)
at geym.zbase.ch6.hold.DeadLock.run(DeadLock.java:49)

Locked ownable synchronizers:
-&lt;0x24704040&gt; (a java.util.concurrent.locks.ReentrantLock$NonfairSync)

&quot;south&quot; prio=6 tid=0x01061000 nid=0x12bc waiting on condition [0x04fdf000] 
java.lang.Thread.State: WAITING (parking)
at sun.misc.Unsafe.park(Native Method)
- parking to wait for &lt;0x24704040&gt; (a java.util.concurrent.locks.ReentrantLock$NonfairSync)
at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)
at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireInterruptibly(AbstractQueuedSynchronizer.java:894)
at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireInterruptibly(AbstractQueuedSynchronizer.java:1221)
at java.util.concurrent.locks.ReentrantLock.lockInterruptibly(ReentrantLock.java:340)
at geym.zbase.ch6.hold.DeadLock.run(DeadLock.java:29)

Locked ownable synchronizers:
- &lt;0x24704068&gt; (a java.util.concurrent.locks.ReentrantLock$NonfairSync) 
\u7701\u7565\u90E8\u5206\u8F93\u51FA
Found one Java-level deadlock:
==============================
&quot;north&quot;:
waiting for ownable synchronizer 0x24704068, (a java.util.concurrent.locks.ReentrantLock$NonfairSync),
which is held by &quot;south&quot;
&quot;south&quot;:
waiting for ownable synchronizer 0x24704040, (a java.util.concurrent.locks.ReentrantLock$NonfairSync),
which is held by &quot;north&quot;
\u7701\u7565\u90E8\u5206\u8F93\u51FA
Found 1 deadlock.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECE\u8F93\u51FA\u4E2D\uFF0C\u53EF\u4EE5\u5F88\u5BB9\u6613\u5730\u627E\u5230\u6B7B\u9501\uFF0C\u5E76\u540C\u65F6\u663E\u793A\u4E86\u53D1\u751F\u6B7B\u9501\u7684\u4E24\u4E2A\u7EBF\u7A0B\uFF0C\u4EE5\u53CA\u6B7B\u9501\u7EBF\u7A0B\u7684\u6301\u6709\u5BF9\u8C61\u548C\u7B49\u5F85\u5BF9\u8C61\uFF0C\u5E2E\u52A9\u5F00\u53D1\u4EBA\u5458\u89E3\u51B3\u6B7B\u9501\u95EE\u9898\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1A\u901A\u8FC7 jstack \u547D\u4EE4\u4E0D\u4EC5\u53EF\u4EE5\u5F97\u5230\u7EBF\u7A0B\u5806\u6808\uFF0C\u8FD8\u80FD\u81EA\u52A8\u8FDB\u884C\u6B7B\u9501\u68C0\u67E5\uFF0C\u8F93\u51FA\u627E\u5230\u7684\u6B7B\u9501\u4FE1\u606F\u3002</p><h3 id="_6-3-7-\u8FDC\u7A0B\u4E3B\u673A\u4FE1\u606F\u6536\u96C6\u2014\u2014jstatd-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_6-3-7-\u8FDC\u7A0B\u4E3B\u673A\u4FE1\u606F\u6536\u96C6\u2014\u2014jstatd-\u547D\u4EE4" aria-hidden="true">#</a> 6.3.7 \u8FDC\u7A0B\u4E3B\u673A\u4FE1\u606F\u6536\u96C6\u2014\u2014jstatd \u547D\u4EE4</h3><p>\u5728\u672C\u8282\u4E4B\u524D\u6240\u8FF0\u7684\u5DE5\u5177\u4E2D\uFF0C\u53EA\u6D89\u53CA\u76D1\u63A7\u672C\u673A\u7684 Java \u5E94\u7528\u7A0B\u5E8F\uFF0C\u800C\u5728\u8FD9\u4E9B\u5DE5\u5177\u4E2D\uFF0C\u4E00\u4E9B\u76D1\u63A7\u5DE5\u5177\u4E5F\u652F\u6301\u5BF9\u8FDC\u7A0B\u8BA1\u7B97\u673A\u7684\u76D1\u63A7\uFF08\u5982 jps\u3001jstat\uFF09\u3002\u4E3A\u4E86\u542F\u7528\u8FDC\u7A0B\u76D1\u63A7\uFF0C\u9700\u8981\u914D\u5408\u4F7F\u7528 jstatd \u547D\u4EE4\u3002</p><p>jstatd \u547D\u4EE4\u662F\u4E00\u4E2A RMI \u670D\u52A1\u7AEF\u7A0B\u5E8F\uFF0C\u5B83\u7684\u4F5C\u7528\u76F8\u5F53\u4E8E\u4EE3\u7406\u670D\u52A1\u5668\uFF0C\u5EFA\u7ACB\u672C\u5730\u8BA1\u7B97\u673A\u4E0E\u8FDC\u7A0B\u76D1\u63A7\u5DE5\u5177\u7684\u901A\u4FE1\u3002jstatd \u670D\u52A1\u5668\u5C06\u672C\u673A\u7684 Java \u5E94\u7528\u7A0B\u5E8F\u4FE1\u606F\u4F20\u9012\u5230\u8FDC\u7A0B\u8BA1\u7B97\u673A\uFF0C\u5982\u56FE6.23 \u6240\u793A\u3002</p><p><img src="`+U+`" alt="\u56FE6-23" loading="lazy"></p><p>\u56FE6.23 jstatd \u547D\u4EE4\u5DE5\u4F5C\u793A\u610F\u56FE</p><p>\u76F4\u63A5\u6253\u5F00 jstatd \u670D\u52A1\u5668\u53EF\u80FD\u4F1A\u629B\u51FA\u8BBF\u95EE\u62D2\u7EDD\u5F02\u5E38\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jstatd
Could not create remote object
access denied (java.util.PropertyPermission java.rmi.server.ignoreSubClasses write)
java.security.AccessControlException: access denied (java.util.Propertypermission java.rmi.server.ignoreSubClasses write)
at java.security.AccessControlContext.checkPe rmission(AccessControlContext.java:323) 
at java.security.Accesscontroller.checkpermission(Accesscontroller.java:546) 
at java.lang.SecurityManager.checkPermission(SecurityManager.java:532)
at java.lang.System.setProperty(System.java:725)
at sun.tools.jstatd.Jstatd.main(Jstatd.java:122)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u662F\u7531\u4E8E jstatd \u7A0B\u5E8F\u6CA1\u6709\u8DB3\u591F\u7684\u6743\u9650\u6240\u81F4\u3002\u53EF\u4EE5\u4F7F\u7528 Java \u7684\u5B89\u5168\u7B56\u7565\uFF0C\u4E3A\u5176\u5206\u914D\u76F8\u5E94\u7684\u6743\u9650\u3002\u4E0B\u9762\u7684\u4EE3\u7801\u4E3A jstatd \u5206\u914D\u4E86\u6700\u5927\u7684\u6743\u9650\uFF0C\u5C06\u5176\u4FDD\u5B58\u5728 jstatd.all.policy \u6587\u4EF6\u4E2D\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>grant codebase &quot;file:E:/tools/jdk-10.0.2/lib/tools.jar&quot; {
	permission java.security.AllPermission;
};
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7136\u540E\uFF0C\u4F7F\u7528\u4EE5\u4E0B\u547D\u4EE4\u518D\u6B21\u5F00\u542F jstatd \u670D\u52A1\u5668\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jstatd -J-Djava.security.policy= c:\\jstatd.all.policy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8FD9\u6837\u670D\u52A1\u5668\u5373\u53EF\u5F00\u542F\u6210\u529F\u3002</p><p>-J \u53C2\u6570\u662F\u4E00\u4E2A\u516C\u5171\u7684\u53C2\u6570\uFF0C\u5982 jps\u3001jstat \u7B49\u547D\u4EE4\u90FD\u53EF\u4EE5\u63A5\u6536\u8FD9\u4E2A\u53C2\u6570\u3002\u7531\u4E8E jps\u3001jstat \u547D\u4EE4\u672C\u8EAB\u4E5F\u662F Java \u5E94\u7528\u7A0B\u5E8F\uFF0C-J \u53C2\u6570\u53EF\u4EE5\u4E3A jps \u7B49\u547D\u4EE4\u672C\u8EAB\u8BBE\u7F6E Java \u865A\u62DF\u673A\u53C2\u6570\u3002</p><p>\u5728\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cjstatd \u547D\u4EE4\u5C06\u5728 1099 \u7AEF\u53E3\u5F00\u542F RMI \u670D\u52A1\u5668\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;netstat -ano|findstr 1099
TCP    0.0.0.0:1099   0.0.0.0:0    LISTENING    3656
C:\\Documents and Settings\\Administrator&gt;jps
3656 Jstatd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE5\u4E0A\u547D\u4EE4\u884C\u663E\u793A\uFF0C\u672C\u673A\u7684 1099 \u7AEF\u53E3\u5904\u4E8E\u76D1\u542C\u72B6\u6001\uFF0C\u76F8\u5173\u8FDB\u7A0B\u53F7\u662F 3656\u3002\u4F7F\u7528 jsp \u663E\u793A 3656 \u8FDB\u7A0B\uFF0C\u6B63\u662F jstatd\uFF0C\u8BF4\u660E jstatd \u542F\u52A8\u6210\u529F\u3002</p><p>\u4F7F\u7528 jps \u663E\u793A\u8FDC\u7A0B\u8BA1\u7B97\u673A\u7684 Java \u8FDB\u7A0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jps localhost:1099
3656 Jstatd
460 Main
2464 Jps
844
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u7528 jstat \u663E\u793A\u8FDC\u7A0B\u8FDB\u7A0B 460 \u7684 GC \u60C5\u51B5\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;jstat -gcutil 460@localhost:1099
so    SI     E      0      P      YGC   YGCT   FGC   FGCT   GCT  
0.00  22.05  88.55  91.62  69.88  23    0.091  0     0.000  0.091 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-8-\u591A\u529F\u80FD\u547D\u4EE4\u884C\u2014\u2014jcmd-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_6-3-8-\u591A\u529F\u80FD\u547D\u4EE4\u884C\u2014\u2014jcmd-\u547D\u4EE4" aria-hidden="true">#</a> 6.3.8 \u591A\u529F\u80FD\u547D\u4EE4\u884C\u2014\u2014jcmd \u547D\u4EE4</h3><p>\u5728 JDK 1.7 \u4EE5\u540E\uFF0C\u65B0\u589E\u4E86\u4E00\u4E2A\u547D\u4EE4\u884C\u5DE5\u5177 jcmd\u3002\u5B83\u662F\u4E00\u4E2A\u591A\u529F\u80FD\u7684\u5DE5\u5177\uFF0C\u53EF\u4EE5\u7528\u6765\u5BFC\u51FA\u5806\u3001\u67E5\u770B Java \u8FDB\u7A0B\u3001\u5BFC\u51FA\u7EBF\u7A0B\u4FE1\u606F\u3001\u6267\u884C GC \u7B49\u3002</p><p>jcmd \u547D\u4EE4\u53EF\u4EE5\u9488\u5BF9\u7ED9\u5B9A\u7684 Java \u865A\u62DF\u673A\u6267\u884C\u4E00\u6761\u547D\u4EE4\u3002\u9996\u5148\u6765\u770B\u4E00\u4E0B\u5982\u4F55\u4F7F\u7528 jcmd \u547D\u4EE4\u5217\u51FA\u5F53\u524D\u7CFB\u7EDF\u4E2D\u7684\u6240\u6709 Java \u865A\u62DF\u673A\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\\tools\\jdk-10.0.2&gt;jcmd -l
6192
7148 sun.tools.jcmd.JCmd -l
2828 geym.zbase.ch6.hold.DeadLock
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53C2\u6570 -l \u8868\u793A\u5217\u51FA\u6240\u6709\u7684 Java \u865A\u62DF\u673A\uFF0C\u9488\u5BF9\u6BCF\u4E00\u4E2A\u865A\u62DF\u673A\uFF0Cjcmd \u547D\u4EE4\u53EF\u4EE5\u4F7F\u7528 help \u547D\u4EE4\u5217\u51FA\u5B83\u4EEC\u6240\u652F\u6301\u7684\u547D\u4EE4\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\\tools\\jdk-10.0.2&gt;jcmd 2828 help
2828:
The following commands are available:
JFR.stop
JFR.start
JFR.dump
JFR.check
VM.native_memory
VM.commercial_features
ManagementAgent.stop
ManagementAgent.start_local
ManagementAgent.start
Thread.print
GC.class_histogram
GC.heap_dump
GC.run_finalization
GC.run
VM.uptime
VM.flags
VM.system_properties
VM.command_line
VM.version
Help
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u7F57\u5217\u7684\u5C31\u662F\u8FDB\u7A0B\u53F7 2828 \u865A\u62DF\u673A\u6240\u652F\u6301\u7684 jcmd \u547D\u4EE4\u64CD\u4F5C\uFF0C\u4E0B\u9762\u4ECB\u7ECD\u51E0\u4E2A\u5E38\u7528\u7684\u547D\u4EE4\u3002</p><ol><li><p>\u67E5\u770B\u865A\u62DF\u673A\u542F\u52A8\u65F6\u95F4 VM.uptime\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\\tools\\jdk-10.0.2&gt;jcmd 2828 VM.uptime
2828:
3805.305 s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>jcmd \u547D\u4EE4\u4E5F\u652F\u6301\u76F4\u63A5\u4F7F\u7528 MainClass \u7684\u540D\u5B57\u6765\u4EE3\u66FF\u8FDB\u7A0B\u53F7\uFF0C\u8FD9\u6837\u5728\u7F16\u5199\u811A\u672C\u7684\u65F6\u5019\u4E5F\u66F4\u4E3A\u5BB9\u6613\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\\tools\\jdk-10.0.2&gt;jcmd geym.zbase.ch6.hold.DeadLock VM.uptime
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u6253\u5370\u7EBF\u7A0B\u6808\u4FE1\u606F\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\\tools\\jdk-10.0.2&gt;jcmd 2828 Thread.print
2828:
2014-10-07 10:46:09
Full thread dump Java HotSpot(TM) Client VM (24.0-b56 mixed mode, sharing): 
\u7701\u7565\u6240\u6709\u7EBF\u7A0B\u4FE1\u606F
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u67E5\u770B\u7CFB\u7EDF\u4E2D\u7C7B\u7684\u7EDF\u8BA1\u4FE1\u606F\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\\tools\\jdk-10.0.2&gt;jcmd 2828 GC.class_histogram
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u5BFC\u51FA\u5806\u4FE1\u606F\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\\&gt;jcmd 2828 GC.heap_dump D:\\d.dump
2828:
Heap dump file created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>GC.heap_dump \u63A5\u6536\u4E00\u4E2A\u53C2\u6570\u4F5C\u4E3A\u5806 Dump \u6587\u4EF6\u7684\u8F93\u51FA\u8DEF\u5F84\uFF0C\u5F97\u5230\u5806\u6587\u4EF6\u540E\uFF0C\u53EF\u4EE5\u4F7F\u7528 MAT \u6216\u8005 VisualVM \u7B49\u5DE5\u5177\u8FDB\u884C\u5206\u6790\u3002</p></li><li><p>\u83B7\u5F97\u7CFB\u7EDF\u7684 Properties \u5185\u5BB9\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\\&gt;jcmd 2828 VM.system_properties
2828:
#Tue Oct 07 13:12:56 CST 2014
java.runtime.name=Java(TM) SE Runtime Environment
sun.boot.library.path=D\\:\\\\tools\\\\jdk-10.0.2\\\\jre\\\\bin
java.vm.version=24.0-b56
java.vm.vendor=Oracle Corporation
\u7701\u7565\u8F93\u51FA
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u83B7\u5F97\u542F\u52A8\u53C2\u6570\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\\&gt;jcmd 2828 VM.flags
2828:
-XX:+FlightRecorder -XX:InitialHeapSize=l6777216 -XX:MaxHeapSize=268435456 -XX:+UnlockCommercialFeatures -XX:-UseLargePagesIndividualAllocation
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u83B7\u5F97\u6240\u6709\u6027\u80FD\u7EDF\u8BA1\u76F8\u5173\u6570\u636E\u3002</p><p>\u901A\u8FC7 jcmd \u547D\u4EE4\uFF0C\u8FD8\u53EF\u4EE5\u83B7\u5F97\u6240\u6709\u7684 PerfData \u6570\u636E\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>D:\\&gt;jcmd 2828 PerfCounter.print
2828:
java.cis.sharedLoadedClasses=704
java.cis.sharedUnloadedClasses=0
java.cis.unloadedClasses=83
\u7701\u7565\u90E8\u5206\u8F93\u51FA
java.threads.daemon=11
java.threads.live=14
java.threads.livePeak=16
java.threads.started=28
\u7701\u7565\u90E8\u5206\u8F93\u51FA
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u8FD9\u4E2A\u8F93\u51FA\u4E2D\uFF0C\u53EF\u4EE5\u627E\u5230\u6240\u6709\u7684\u6027\u80FD\u7EDF\u8BA1\u76F8\u5173\u7684\u6570\u636E\uFF0C\u4F5C\u4E3A\u793A\u4F8B\uFF0C\u8FD9\u91CC\u7ED9\u51FA\u4E86\u6D3B\u52A8\u7EBF\u7A0B\u6570\u91CF\u3001\u6D3B\u52A8\u7EBF\u7A0B\u5CF0\u503C\u7B49\u4FE1\u606F\u3002</p></li></ol><p>\u4ECE\u4EE5\u4E0A\u793A\u4F8B\u4E2D\u53EF\u4EE5\u770B\u5230\uFF0Cjcmd \u62E5\u6709 jmap \u7684\u5927\u90E8\u5206\u529F\u80FD\uFF0C\u5E76\u4E14\u5728 Oracle \u7684\u5B98\u65B9\u7F51\u7AD9\u4E0A\u4E5F\u63A8\u8350\u4F7F\u7528 jcmd \u547D\u4EE4\u4EE3\u66FF jmap \u547D\u4EE4\u3002</p><h3 id="_6-3-9-\u6027\u80FD\u7EDF\u8BA1\u5DE5\u5177\u2014\u2014hprof" tabindex="-1"><a class="header-anchor" href="#_6-3-9-\u6027\u80FD\u7EDF\u8BA1\u5DE5\u5177\u2014\u2014hprof" aria-hidden="true">#</a> 6.3.9 \u6027\u80FD\u7EDF\u8BA1\u5DE5\u5177\u2014\u2014hprof</h3><p>\u4E0E\u524D\u6587\u4E2D\u4ECB\u7ECD\u7684\u76D1\u63A7\u5DE5\u5177\u4E0D\u540C\uFF0Chprof \u4E0D\u662F\u72EC\u7ACB\u7684\u76D1\u63A7\u5DE5\u5177\uFF0C\u5B83\u53EA\u662F\u4E00\u4E2A Java agent \u5DE5\u5177\u3002\u5B83\u53EF\u4EE5\u7528\u4E8E\u76D1\u63A7 Java \u5E94\u7528\u7A0B\u5E8F\u5728\u8FD0\u884C\u65F6\u7684 CPU \u4FE1\u606F\u548C\u5806\u4FE1\u606F\u3002\u4F7F\u7528 java -agentlib:hprof=help \u547D\u4EE4\u53EF\u4EE5\u67E5\u770B hprof \u7684\u5E2E\u52A9\u6587\u6863\u3002</p><p><strong>\u8BF4\u660E</strong>\uFF1Ahprof \u5728 JDK 9\u3001JDK 10 \u4E2D\u5DF2\u7ECF\u88AB\u5220\u9664\uFF0C\u5B98\u65B9\u5EFA\u8BAE\u7528 VisualVM \u4EE3\u66FF\uFF0C\u53C2\u8003 6.5.5 \u8282\u548C 6.5.6 \u8282\u3002</p><p>\u4E0B\u9762\u662F hprof \u5DE5\u5177\u5E2E\u52A9\u4FE1\u606F\u7684\u8F93\u51FA\uFF0C\u52A0\u7C97\u90E8\u5206\u662F\u5E38\u7528\u7684\u53C2\u6570\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>C:\\Documents and Settings\\Administrator&gt;java -agentlib:hprof=help HPROF: Heap and CPU Profiling Agent (JVMTI Demonstration Code)
hprof usage: java -agentlib:hprof=[help]|[&lt;option&gt;=&lt;value&gt;, ...]
Option Name and Value      Description                       Default
-----------------------    -------------                     -----------
heap=dump|sites|all        heap profiling                    all
cpu=samples|times|old      CPU usage                         off
monitor=y|n                monitor contention                n
format=a|b                 text(txt) or binary output        a
file=&lt;file&gt;                write data to file                java.hprof[{.txt}]
net=&lt;host&gt;:&lt;port&gt;          send data over a socket           off
depth=&lt;size&gt;               stack trace depth                 4
interval=&lt;ms&gt;              sample interval in ms             10
cutoff=&lt;value&gt;             output cutoff point               0.0001
lineno=y|n                 line number in traces?            y
thread=y|n                 thread in traces?                 n
doe=y|n                    dump on exit?                     y
msa=y|n                    Solaris micro state accounting    n
force=y|n                  force output to &lt;file&gt;            y
verbose=y|n                print messages about dumps        y
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u7528 hprof \u5DE5\u5177\u53EF\u4EE5\u67E5\u770B\u7A0B\u5E8F\u4E2D\u5404\u4E2A\u51FD\u6570\u7684 CPU \u5360\u7528\u65F6\u95F4\u3002\u4EE5\u4E0B\u4EE3\u7801\u5305\u542B 3 \u4E2A\u65B9\u6CD5\uFF0C\u5206\u522B\u5360\u7528\u4E0D\u540C\u7684 CPU \u65F6\u95F4\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HProfTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">slowMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u6A21\u62DF\u4E00\u4E2A\u5F88\u6162\u7684\u65B9\u6CD5</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">slowerMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u6A21\u62DF\u4E00\u4E2A\u66F4\u6162\u7684\u65B9\u6CD5</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u4E00\u4E2A\u5F88\u5FEB\u7684\u65B9\u6CD5</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fastMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HProfTest</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HProfTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5206\u522B\u8FD0\u884C\u8FD9\u4E9B\u65B9\u6CD5</span>
        test<span class="token punctuation">.</span><span class="token function">fastMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        test<span class="token punctuation">.</span><span class="token function">slowMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        test<span class="token punctuation">.</span><span class="token function">slowerMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u7528\u53C2\u6570 -agentlib:hprof=cpu=times,interval=10 \u8FD0\u884C\u4EE5\u4E0A\u4EE3\u7801\u3002times \u9009\u9879\u5C06\u4F1A\u5728 Java \u51FD\u6570\u7684\u8C03\u7528\u524D\u3001\u540E\u8BB0\u5F55\u51FD\u6570\u7684\u6267\u884C\u65F6\u95F4\uFF0C\u8FDB\u800C\u8BA1\u7B97\u51FD\u6570\u7684\u6267\u884C\u65F6\u95F4\u3002\u5728\u7A0B\u5E8F\u7684\u5F53\u524D\u76EE\u5F55\u4E0B\uFF0C\u4F1A\u751F\u6210 java.hprof.txt \u6587\u4EF6\uFF0C\u8BB0\u5F55\u6027\u80FD\u7EDF\u8BA1\u4FE1\u606F\uFF0C\u5305\u542B\u5982\u4E0B\u5185\u5BB9\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>CPU TIME (ms) BEGIN (total = 11224) Tue Oct 07 13:36:52 2014
rank    self     accum   count    trace     method 
1      89.10%    89.10%     1    303832     geym.zbase.ch6.hold.HprofTest.slowerMethod        
2      8.91%     98.01%     1    301213     geym.zbase.ch6.hold.HprofTest.slowMethod
3      0.12%     98.13%   114    303737     java.util.Properties.saveConvert
4      0.08%     98.21%   3003   303730     java.lang.String.charAt
5      0.08%     98.29%   3313   303732     java.lang.AbstractStringBuilder.append
6      0.0-8%    98.37%   1172   300382     java.lang.Character.toLowerCase
7      0.05%     98.42%   3313   303733     java.lang.StringBuffer.append
\u7701\u7565\u90E8\u5206\u5185\u5BB9
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u7528\u53C2\u6570 -agentlib:hprof=heap=dump,format=b,file=c:\\core.hprof \u8FD0\u884C\u7A0B\u5E8F\uFF0C\u53EF\u4EE5\u5C06\u5E94\u7528\u7A0B\u5E8F\u7684\u5806\u5FEB\u7167\u4FDD\u5B58\u5728\u6307\u5B9A\u6587\u4EF6 c:\\core.hprof \u4E2D\u3002\u4F7F\u7528 MAT \u6216\u8005 VisualVM \u7B49\u5DE5\u5177\u53EF\u4EE5\u5206\u6790\u8FD9\u4E2A\u5806\u6587\u4EF6\u3002</p><p>\u4F7F\u7528\u53C2\u6570 -agentlib:hprof=heap=sites \u8FD0\u884C\u7A0B\u5E8F\uFF0C\u53EF\u4EE5\u8F93\u51FA Java \u5E94\u7528\u7A0B\u5E8F\u4E2D\u6BCF\u4E2A\u8DDF\u8E2A\u70B9\u4E0A\u7684\u7C7B\u6240\u5360\u5185\u5B58\u7684\u767E\u5206\u6BD4\uFF0C\u90E8\u5206\u8F93\u51FA\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>SITES BEGIN (ordered by live bytes) Tue Oct 07 13:39:48 2014
percent        live   alloc&#39;ed stack class 
rank   self   accum  bytes   objs   bytes  objs    trace    name                                                           
1     7.06%   7.06%  32800   2      32800   2     300254    char[]  
2     4.83%   11.89% 22416   174    22416   174   300006    char[]
3     4.10%   15.98% 19040   595    19040   595   300177    java.util.LinkedHashMap$Entry                  
4     3.53%   19.52% 16416   2      16416   2     300251    byte[]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u4EE5 rank3 \u4E3A\u4F8B\uFF0C\u8BF4\u660E\u5728\u8DDF\u8E2A\u70B9 300177\uFF0C\u5206\u914D\u4E86 4.83% \u7684\u603B\u5185\u5B58\uFF0C\u5408\u8BA1\u4F7F\u7528 22416 \u5B57\u8282\u3002\u5728\u8F93\u51FA\u65E5\u5FD7\u4E2D\u67E5\u627E 300177\uFF0C\u53EF\u4EE5\u5F97\u5230\u90E8\u5206\u5806\u6808\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>TRACE 300177:
    java.util.HashMap$Entry.&lt;init&gt;(HashMap.java:814)
    java.util.LinkedHashMap$Entry.&lt;init&gt;(LinkedHashMap.java:325) 
    java.util.LinkedHashMap.createEntry(LinkedHashMap.java:442) 
    java.util.HashMap.addEntry(HashMap.java:888)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-10-\u6269\u5C55-jps-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_6-3-10-\u6269\u5C55-jps-\u547D\u4EE4" aria-hidden="true">#</a> 6.3.10 \u6269\u5C55 jps \u547D\u4EE4</h3><p>\u524D\u6587\u5DF2\u7ECF\u4ECB\u7ECD\u8FC7\uFF0C\u5305\u62EC jps \u5728\u5185\u7684\u547D\u4EE4\u672C\u8D28\u4E0A\u662F\u4F7F\u7528 Java \u5B9E\u73B0\u7684\u3002\u4EE5 jps \u547D\u4EE4\u4E3A\u4F8B\uFF0C\u5B83\u5728\u5B9E\u73B0\u8FC7\u7A0B\u4E2D\uFF0C\u4F7F\u7528 MonitoredVmUtil \u7C7B\u83B7\u5F97\u7ED9\u5B9A\u865A\u62DF\u673A\u7684\u76F8\u5173\u4FE1\u606F\u3002\u800C MonitoredVmUtil \u7684\u4E3B\u8981\u529F\u80FD\u90FD\u6765\u81EA\u4E8E MonitoredVm.findByName() \u65B9\u6CD5\uFF0C\u901A\u8FC7 PerfData \u6570\u636E\u67E5\u8BE2\uFF0C\u53EF\u4EE5\u5F97\u5230\u865A\u62DF\u673A\u7684\u76F8\u5173\u6027\u80FD\u53C2\u6570\u3002</p><p>\u3010\u793A\u4F8B 6-11\u3011\u4E0B\u9762\u7684\u4EE3\u7801\u4F7F\u7528 MonitoredVm.findByName() \u65B9\u6CD5\u67E5\u8BE2\u4E86\u6D3B\u52A8\u7EBF\u7A0B\u6570\u3001\u6D3B\u52A8\u7EBF\u7A0B\u6570\u5CF0\u503C\u548C daemon \u7EBF\u7A0B\u6570\u3002\u5C06\u8FD9\u6BB5\u4EE3\u7801\u52A0\u5728 jps \u7684\u4E3B\u5B9E\u73B0\u4E2D\uFF0C\u5C31\u53EF\u4EE5\u6269\u5C55 jps \u7684\u529F\u80FD\uFF0C\u5728\u679A\u4E3E\u7CFB\u7EDF\u4E2D Java \u8FDB\u7A0B\u7684\u540C\u65F6\uFF0C\u4E5F\u663E\u793A\u6BCF\u4E00\u4E2A Java \u8FDB\u7A0B\u7684\u7EBF\u7A0B\u4FE1\u606F\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">LongMonitor</span> l<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LongMonitor</span><span class="token punctuation">)</span> vm<span class="token punctuation">.</span><span class="token function">findByName</span><span class="token punctuation">(</span><span class="token string">&quot;java.threads.live&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
output<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\u6D3B\u52A8\u7EBF\u7A0B\uFF1A&quot;</span> <span class="token operator">+</span> l<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">LongMonitor</span> str<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LongMonitor</span><span class="token punctuation">)</span> vm<span class="token punctuation">.</span><span class="token function">findByName</span><span class="token punctuation">(</span><span class="token string">&quot;java.threads.livePeak&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
output<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\u6D3B\u52A8\u7EBF\u7A0B\u5CF0\u503C g\uFF1A&quot;</span> <span class="token operator">+</span> str<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LongMonitor</span><span class="token punctuation">)</span> vm<span class="token punctuation">.</span><span class="token function">findByName</span><span class="token punctuation">(</span><span class="token string">&quot;java.threads.daemon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
output<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;daemon \u7EBF\u7A0B\u603B\u6570\uFF1A&quot;</span> <span class="token operator">+</span> str<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD0\u884C\u4FEE\u6539\u540E\u7684 jps\uFF0C\u663E\u793A\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>6020 Jps \u6D3B\u52A8\u7EBF\u7A0B\uFF1A5 \u6D3B\u52A8\u7EBF\u7A0B\u5CF0\u503C g\uFF1A5 daemon \u7EBF\u7A0B\u603B\u6570\uFF1A4
5572 \u6D3B\u52A8\u7EBF\u7A0B\uFF1A31 \u6D3B\u52A8\u7EBF\u7A0B\u5CF0\u503C g\uFF1A31 daemon \u7EBF\u7A0B\u603B\u6570\uFF1A22
6832 DeadLock \u6D3B\u52A8\u7EBF\u7A0B\uFF1A9 \u6D3B\u52A8\u7EBF\u7A0B\u5CF0\u503C g\uFF1A9 daemon \u7EBF\u7A0B\u603B\u6570\uFF1A6
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u9664\u4E86\u663E\u793A\u8FDB\u7A0B ID \u548C MainClass\uFF0C\u8FD8\u663E\u793A\u6BCF\u4E00\u4E2A\u8FDB\u7A0B\u7684\u7EBF\u7A0B\u6570\u91CF\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1A\u672C\u8282\u6240\u7528\u5230\u7684\u7C7B\u5747\u5728 OpenJDK \u6E90\u7801\u4E2D\uFF0C\u8BFB\u8005\u53EF\u4EE5\u4E0B\u8F7D\u6E90\u7801\u5C1D\u8BD5\u4FEE\u6539 jps \u7684\u5B9E\u73B0\u3002</p><h2 id="_6-4-\u6211\u662F\u4F60\u7684\u773C-\u56FE\u5F62\u5316\u865A\u62DF\u673A\u76D1\u63A7\u5DE5\u5177-jconsole" tabindex="-1"><a class="header-anchor" href="#_6-4-\u6211\u662F\u4F60\u7684\u773C-\u56FE\u5F62\u5316\u865A\u62DF\u673A\u76D1\u63A7\u5DE5\u5177-jconsole" aria-hidden="true">#</a> 6.4 \u6211\u662F\u4F60\u7684\u773C\uFF1A\u56FE\u5F62\u5316\u865A\u62DF\u673A\u76D1\u63A7\u5DE5\u5177 JConsole</h2><p>JConsole \u662F JDK \u81EA\u5E26\u7684\u56FE\u5F62\u5316\u6027\u80FD\u76D1\u63A7\u5DE5\u5177\u3002\u901A\u8FC7 JConsole \u5DE5\u5177\uFF0C\u53EF\u4EE5\u67E5\u770B Java \u5E94\u7528\u7A0B\u5E8F\u7684\u8FD0\u884C\u6982\u51B5\uFF0C\u53EF\u4EE5\u76D1\u63A7\u5806\u4FE1\u606F\u3001\u6C38\u4E45\u533A\u4F7F\u7528\u60C5\u51B5\u3001\u7C7B\u52A0\u8F7D\u60C5\u51B5\u7B49\u3002\u672C\u8282\u4E3B\u8981\u4ECB\u7ECD JConsole \u5DE5\u5177\u7684\u57FA\u672C\u4F7F\u7528\u65B9\u6CD5\u3002</p><h3 id="_6-4-1-jconsole-\u8FDE\u63A5-java-\u7A0B\u5E8F" tabindex="-1"><a class="header-anchor" href="#_6-4-1-jconsole-\u8FDE\u63A5-java-\u7A0B\u5E8F" aria-hidden="true">#</a> 6.4.1 JConsole \u8FDE\u63A5 Java \u7A0B\u5E8F</h3><p>JConsole \u7A0B\u5E8F\u5728 %JAVA_HOME%/bin \u76EE\u5F55\u4E0B\uFF0C\u542F\u52A8\u540E\uFF0C\u7A0B\u5E8F\u4FBF\u8981\u6C42\u6307\u5B9A\u8FDE\u63A5 Java \u5E94\u7528\u7A0B\u5E8F\uFF0C\u5982\u56FE6.24 \u6240\u793A\u3002</p><p><img src="`+q+`" alt="\u56FE6-24" loading="lazy"></p><p>\u56FE6.24 JConsole \u8FDE\u63A5 Java \u5E94\u7528</p><p>\u5728\u65B0\u5EFA\u8FDE\u63A5\u5BF9\u8BDD\u6846\u4E2D\uFF0C\u7F57\u5217\u4E86\u6240\u6709\u7684\u672C\u5730 Java \u5E94\u7528\u7A0B\u5E8F\uFF0C\u9009\u62E9\u9700\u8981\u8FDE\u63A5\u7684\u7A0B\u5E8F\u5373\u53EF\u3002\u5728\u672C\u5730\u8FDB\u7A0B\u4E0B\uFF0C\u8FD8\u6709\u4E00\u4E2A\u7528\u4E8E\u8FDE\u63A5\u8FDC\u7A0B\u8FDB\u7A0B\u7684\u6587\u672C\u6846\uFF0C\u8F93\u5165\u6B63\u786E\u7684\u8FDC\u7A0B\u8FDB\u7A0B\u5730\u5740\u5373\u53EF\u8FDE\u63A5\u3002</p><p>\u5982\u679C\u9700\u8981\u4F7F\u7528 JConsole \u8FDE\u63A5\u8FDC\u7A0B\u8FDB\u7A0B\uFF0C\u5219\u53EF\u4EE5\u5728\u8FDC\u7A0B Java \u5E94\u7528\u7A0B\u5E8F\u542F\u52A8\u65F6\u52A0\u4E0A\u5982\u4E0B\u53C2\u6570\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-Djava.rmi.server.hostname=127.0.0.1
-Dcom.sun.management.jmxremote
-Dcom.sun.management.jmxremote.port=8888
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.ssl=false
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>-Djava.rmi.server.hostname \u7528\u4E8E\u6307\u5B9A\u8FD0\u884C Java \u5E94\u7528\u7A0B\u5E8F\u7684\u8BA1\u7B97\u673A\u7684 IP \u5730\u5740\uFF0C-Dcom.sun. management.Jmxremote.port \u7528\u4E8E\u6307\u5B9A\u901A\u8FC7 JMX \u7BA1\u7406\u8BE5\u8FDB\u7A0B\u7684\u7AEF\u53E3\u53F7\u3002\u57FA\u4E8E\u4EE5\u4E0A\u914D\u7F6E\u542F\u52A8\u7684 Java \u5E94\u7528\u7A0B\u5E8F\uFF0C\u901A\u8FC7 JConsole \u5728\u8FDC\u7A0B\u8FDE\u63A5\u65F6\uFF0C\u53EA\u9700\u8981\u586B\u5199\u5982\u4E0B\u8FDC\u7A0B\u8FDB\u7A0B\u5373\u53EF\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>127.0.0.1:8888
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_6-4-2-java-\u7A0B\u5E8F\u6982\u51B5" tabindex="-1"><a class="header-anchor" href="#_6-4-2-java-\u7A0B\u5E8F\u6982\u51B5" aria-hidden="true">#</a> 6.4.2 Java \u7A0B\u5E8F\u6982\u51B5</h3><p>\u5728\u8FDE\u63A5\u4E0A Java \u5E94\u7528\u7A0B\u5E8F\u540E\uFF0C\u4FBF\u53EF\u4EE5\u67E5\u770B\u5E94\u7528\u7A0B\u5E8F\u6982\u51B5\uFF0C\u5982\u56FE6.25 \u6240\u793A\u3002\u56FE\u4E2D 4 \u4E2A\u6298\u7EBF\u56FE\u5206\u522B\u663E\u793A\u4E86\u5806\u5185\u5B58\u4F7F\u7528\u91CF\u3001\u7CFB\u7EDF\u7EBF\u7A0B\u6570\u91CF\u3001\u52A0\u8F7D\u7C7B\u6570\u91CF\u53CA CPU \u5360\u7528\u7387\u3002</p><p><img src="`+L+'" alt="\u56FE6-25" loading="lazy"></p><p>\u56FE6.25 JConsole \u67E5\u770B\u5E94\u7528\u7A0B\u5E8F\u6982\u51B5</p><h3 id="_6-4-3-\u5185\u5B58\u76D1\u63A7" tabindex="-1"><a class="header-anchor" href="#_6-4-3-\u5185\u5B58\u76D1\u63A7" aria-hidden="true">#</a> 6.4.3 \u5185\u5B58\u76D1\u63A7</h3><p>\u5207\u6362\u5230\u5185\u5B58\u76D1\u63A7\u754C\u9762\uFF0C\u53EF\u4EE5\u663E\u793A\u5F53\u524D\u5185\u5B58\u7684\u8BE6\u7EC6\u4FE1\u606F\u3002\u4E0D\u4EC5\u5305\u62EC\u5806\u5185\u5B58\u7684\u6574\u4F53\u4FE1\u606F\uFF0C\u66F4\u7EC6\u5316\u5230 eden \u533A\u3001survivor \u533A\u3001\u8001\u5E74\u4EE3\u7684\u4F7F\u7528\u60C5\u51B5\u3002\u540C\u65F6\uFF0C\u4E5F\u5305\u62EC\u975E\u5806\u533A\uFF0C\u5373\u6C38\u4E45\u4EE3\u7684\u4F7F\u7528\u60C5\u51B5\u3002\u5355\u51FB\u53F3\u4E0A\u89D2\u7684 \u201C\u6267\u884C GC\u201D \u6309\u94AE\uFF0C\u53EF\u4EE5\u5F3A\u5236\u5E94\u7528\u7A0B\u5E8F\u8FDB\u884C\u4E00\u6B21 Full GC\uFF0C\u5982\u56FE6.26 \u6240\u793A\u3002</p><p><img src="'+z+'" alt="\u56FE6-26" loading="lazy"></p><p>\u56FE6.26 JConsole \u67E5\u770B\u5806\u5185\u5B58\u4FE1\u606F</p><p><strong>\u6CE8\u610F</strong>\uFF1A\u5728 JConsole \u4E2D\uFF0C\u53EF\u4EE5\u67E5\u770B\u5806\u7684\u8BE6\u7EC6\u4FE1\u606F\uFF0C\u5305\u62EC\u5806\u7684\u5927\u5C0F\u3001\u4F7F\u7528\u7387\u3001eden \u533A\u5927\u5C0F\u3001survivor \u533A\u5927\u5C0F\u3001\u6C38\u4E45\u533A\u5927\u5C0F\u7B49\u3002</p><h3 id="_6-4-4-\u7EBF\u7A0B\u76D1\u63A7" tabindex="-1"><a class="header-anchor" href="#_6-4-4-\u7EBF\u7A0B\u76D1\u63A7" aria-hidden="true">#</a> 6.4.4 \u7EBF\u7A0B\u76D1\u63A7</h3><p>JConsole \u4E2D\u7684\u7EBF\u7A0B\u9009\u9879\u5361\u5141\u8BB8\u5F00\u53D1\u4EBA\u5458\u76D1\u63A7\u7A0B\u5E8F\u5185\u7684\u7EBF\u7A0B\uFF0C\u5982\u56FE6.27 \u6240\u793A\u3002JConsole \u663E\u793A\u4E86\u7CFB\u7EDF\u5185\u7684\u7EBF\u7A0B\u6570\u91CF\uFF0C\u5E76\u5728\u5C4F\u5E55\u4E0B\u65B9\u663E\u793A\u4E86\u7A0B\u5E8F\u4E2D\u6240\u6709\u7684\u7EBF\u7A0B\u3002\u5355\u51FB\u7EBF\u7A0B\u540D\u79F0\uFF0C\u4FBF\u53EF\u4EE5\u67E5\u770B\u7EBF\u7A0B\u7684\u6808\u4FE1\u606F\u3002</p><p><img src="'+I+'" alt="\u56FE6-27" loading="lazy"></p><p>\u56FE6.27 JConsole\u67E5\u770B\u7EBF\u7A0B\u4FE1\u606F</p><p>\u4F7F\u7528 \u201C\u68C0\u6D4B\u6B7B\u9501\u201D \u6309\u94AE\uFF0C\u8FD8\u53EF\u4EE5\u81EA\u52A8\u68C0\u6D4B\u591A\u7EBF\u7A0B\u5E94\u7528\u7A0B\u5E8F\u7684\u6B7B\u9501\u60C5\u51B5\u3002\u56FE6.28 \u5C55\u793A\u4E86\u7531 JConsole \u68C0\u6D4B\u5230\u7684\u6B7B\u9501\u7EBF\u7A0B\u3002</p><p><img src="'+B+'" alt="\u56FE6-28" loading="lazy"></p><p>\u56FE6.28 JConsole \u6B7B\u9501\u7EBF\u7A0B\u68C0\u67E5</p><p>\u672C\u4F8B\u4E2D\u4F7F\u7528\u7684\u6D4B\u8BD5\u4EE3\u7801\u53EF\u4EE5\u53C2\u8003 6.3.6 \u8282\u4E2D\u7684\u793A\u4F8B\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1A\u4F7F\u7528 JConsole \u53EF\u4EE5\u65B9\u4FBF\u5730\u67E5\u770B\u7CFB\u7EDF\u5185\u7684\u7EBF\u7A0B\u4FE1\u606F\uFF0C\u5E76\u4E14\u53EF\u4EE5\u5FEB\u901F\u5B9A\u4F4D\u6B7B\u9501\u95EE\u9898\u3002</p><h3 id="_6-4-5-\u7C7B\u52A0\u8F7D\u60C5\u51B5" tabindex="-1"><a class="header-anchor" href="#_6-4-5-\u7C7B\u52A0\u8F7D\u60C5\u51B5" aria-hidden="true">#</a> 6.4.5 \u7C7B\u52A0\u8F7D\u60C5\u51B5</h3><p>JConsole \u7684\u7C7B\u9875\u9762\u5982\u56FE6.29 \u6240\u793A\uFF0C\u663E\u793A\u4E86\u7CFB\u7EDF\u5DF2\u7ECF\u88C5\u8F7D\u7C7B\u7684\u6570\u91CF\u3002\u5728\u8BE6\u7EC6\u4FE1\u606F\u680F\u4E2D\uFF0C\u8FD8\u663E\u793A\u4E86\u5DF2\u5378\u8F7D\u7C7B\u7684\u6570\u91CF\u3002</p><p><img src="'+O+'" alt="\u56FE6-29" loading="lazy"></p><p>\u56FE6.29 JConsole \u7684\u7C7B\u9875\u9762</p><h3 id="_6-4-6-\u865A\u62DF\u673A\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#_6-4-6-\u865A\u62DF\u673A\u4FE1\u606F" aria-hidden="true">#</a> 6.4.6 \u865A\u62DF\u673A\u4FE1\u606F</h3><p>\u5728 VM \u6982\u8981\u9875\uFF0CJConsole \u663E\u793A\u4E86\u5F53\u524D\u5E94\u7528\u7A0B\u5E8F\u7684\u8FD0\u884C\u73AF\u5883\uFF0C\u5305\u62EC\u865A\u62DF\u673A\u7C7B\u578B\u3001\u7248\u672C\u3001\u5806\u4FE1\u606F\u53CA\u865A\u62DF\u673A\u53C2\u6570\u7B49\uFF0C\u5982\u56FE6.30 \u6240\u793A\u3002</p><p><img src="'+V+'" alt="\u56FE6-30" loading="lazy"></p><p>\u56FE6.30 JConsole \u5C55\u793A Java \u865A\u62DF\u673A\u865A\u62DF\u673A\u4FE1\u606F</p><p><strong>\u6CE8\u610F</strong>\uFF1AVM \u6982\u8981\u663E\u793A\u4E86\u5F53\u524D Java \u5E94\u7528\u7A0B\u5E8F\u7684\u57FA\u672C\u4FE1\u606F\uFF0C\u5982\u865A\u62DF\u673A\u7C7B\u578B\u3001\u865A\u62DF\u673A\u7248\u672C\u3001\u7CFB\u7EDF\u7EBF\u7A0B\u4FE1\u606F\u3001\u64CD\u4F5C\u7CFB\u7EDF\u5185\u5B58\u4FE1\u606F\u3001\u5806\u4FE1\u606F\u3001\u5783\u573E\u56DE\u6536\u5668\u7C7B\u578B\u3001Java \u865A\u62DF\u673A\u53C2\u6570\u53CA\u7C7B\u8DEF\u5F84\u7B49\u3002</p><h2 id="_6-5-\u4E00\u76EE\u4E86\u7136-\u53EF\u89C6\u5316\u6027\u80FD\u76D1\u63A7\u5DE5\u5177-visualvm" tabindex="-1"><a class="header-anchor" href="#_6-5-\u4E00\u76EE\u4E86\u7136-\u53EF\u89C6\u5316\u6027\u80FD\u76D1\u63A7\u5DE5\u5177-visualvm" aria-hidden="true">#</a> 6.5 \u4E00\u76EE\u4E86\u7136\uFF1A\u53EF\u89C6\u5316\u6027\u80FD\u76D1\u63A7\u5DE5\u5177 VisualVM</h2><p>VisualVM \u662F\u4E00\u4E2A\u529F\u80FD\u5F3A\u5927\u7684\u591A\u5408\u4E00\u6545\u969C\u8BCA\u65AD\u548C\u6027\u80FD\u76D1\u63A7\u53EF\u89C6\u5316\u5DE5\u5177\uFF0C\u5B83\u96C6\u6210\u4E86\u591A\u79CD\u6027\u80FD\u7EDF\u8BA1\u5DE5\u5177\u7684\u529F\u80FD\uFF0C\u4F7F\u7528 VisualVM \u53EF\u4EE5\u4EE3\u66FF jstats\u3001jmap\u3001jhat\u3001jstack\uFF0C\u751A\u81F3\u4EE3\u66FF JConsole\u3002\u5728 JDK 6 \u5347\u7EA7\u5230 JDK 7 \u4EE5\u540E\uFF0CVisualVM \u4FBF\u4F5C\u4E3A JDK \u7684\u4E00\u90E8\u5206\u53D1\u5E03\uFF0C\u5373\u5B83\u5B8C\u5168\u514D\u8D39\u3002</p>',121),On=n("VisualVM \u4E5F\u53EF\u4EE5\u4F5C\u4E3A\u72EC\u7ACB\u7684\u8F6F\u4EF6\u5B89\u88C5\uFF0C\u8BFB\u8005\u53EF\u4EE5\u5728 "),Vn={href:"http://visualvm.java.net",target:"_blank",rel:"noopener noreferrer"},Gn=n("http://visualvm.java.net"),An=n(" \u4E0B\u8F7D\uFF0C\u7136\u540E\u5B89\u88C5 VisualVM \u7684\u6700\u65B0\u7248\u672C\u3002"),Rn=a('<p>VisualVM \u7684\u4E00\u5927\u7279\u70B9\u662F\u652F\u6301\u63D2\u4EF6\u6269\u5C55\uFF0C\u5E76\u4E14\u63D2\u4EF6\u5B89\u88C5\u975E\u5E38\u65B9\u4FBF\u3002\u6211\u4EEC\u65E2\u53EF\u4EE5\u901A\u8FC7\u79BB\u7EBF\u4E0B\u8F7D\u63D2\u4EF6\u6587\u4EF6 *.nbm\uFF0C\u7136\u540E\u5728 Plugin \u5BF9\u8BDD\u6846\u7684\u5DF1\u4E0B\u8F7D\u9875\u9762\u6DFB\u52A0\u5DF1\u4E0B\u8F7D\u7684\u63D2\u4EF6\uFF0C\u4E5F\u53EF\u4EE5\u5728\u53EF\u7528\u63D2\u4EF6\u9875\u9762\u4E0B\uFF0C\u5728\u7EBF\u5B89\u88C5\u63D2\u4EF6\uFF0C\u5982\u56FE6.31 \u6240\u793A\u3002</p><p><img src="'+G+'" alt="\u56FE6-31" loading="lazy"></p><p>\u56FE6.31 VisualVM \u5B89\u88C5\u63D2\u4EF6</p><h3 id="_6-5-1-visualvm-\u8FDE\u63A5\u5E94\u7528\u7A0B\u5E8F" tabindex="-1"><a class="header-anchor" href="#_6-5-1-visualvm-\u8FDE\u63A5\u5E94\u7528\u7A0B\u5E8F" aria-hidden="true">#</a> 6.5.1 VisualVM \u8FDE\u63A5\u5E94\u7528\u7A0B\u5E8F</h3><p>VisualVM \u652F\u6301\u591A\u79CD\u65B9\u5F0F\u8FDE\u63A5\u5E94\u7528\u7A0B\u5E8F\uFF0C\u6700\u5E38\u7528\u7684\u5C31\u662F\u672C\u5730\u8FDE\u63A5\u3002\u53EA\u8981\u672C\u5730\u8BA1\u7B97\u673A\u5185\u6709 Java \u5E94\u7528\u7A0B\u5E8F\u6B63\u5728\u6267\u884C\uFF0C\u5728 VisualVM \u7684 Local \u8282\u70B9\u4E0B\uFF0C\u5C31\u4F1A\u51FA\u73B0\u8FD9\u4E9B\u5E94\u7528\u7A0B\u5E8F\u3002</p><p>\u53CC\u51FB\u5E94\u7528\u7A0B\u5E8F\u6216\u8005\u4F7F\u7528\u9F20\u6807\u53F3\u952E\u6253\u5F00\u5E94\u7528\u7A0B\u5E8F\uFF0C\u5C31\u80FD\u591F\u76D1\u63A7\u5E94\u7528\u7A0B\u5E8F\u8FD0\u884C\uFF0C\u5982\u56FE6.32 \u6240\u793A\u3002\u7531\u4E8E VisualVM \u672C\u8EAB\u4E5F\u662F Java \u5E94\u7528\u7A0B\u5E8F\uFF0C\u6240\u4EE5\u81EA\u8EAB\u4E5F\u5728\u5217\u8868\u5185\u3002</p><p><img src="'+A+`" alt="\u56FE6-32" loading="lazy"></p><p>\u56FE6.32 VisualVM \u76D1\u63A7\u5E94\u7528\u7A0B\u5E8F</p><p>\u9664\u4E86\u672C\u5730\u8FDE\u63A5\uFF0CVisualVM \u4E5F\u652F\u6301\u8FDC\u7A0B JMX \u8FDE\u63A5\u3002Java \u5E94\u7528\u7A0B\u5E8F\u53EF\u4EE5\u901A\u8FC7\u4EE5\u4E0B\u53C2\u6570\u6253\u5F00 JMX \u7AEF\u53E3\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-Djava.rmi.server.hostname=127.0.0.1
-Dcom.sun.management.jmxremote
-Dcom.sun.management.jmxremote.port=8888
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.ssl=false
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u901A\u8FC7\u5982\u56FE6.33 \u6240\u793A\u7684\u64CD\u4F5C\u6765\u6DFB\u52A0 JMX \u8FDE\u63A5\u3002</p><p><img src="`+R+'" alt="\u56FE6-33" loading="lazy"></p><p>\u56FE6.33 VisualVM \u6DFB\u52A0 JMX \u8FDE\u63A5</p><p>\u5728\u5F39\u51FA\u7684\u5BF9\u8BDD\u6846\u4E2D\u586B\u5199\u8FDC\u7A0B\u8BA1\u7B97\u673A\u5730\u5740\u3001\u7AEF\u53E3\uFF0C\u5982\u56FE6.34 \u6240\u793A\u3002\u5982\u679C\u9700\u8981\u9A8C\u8BC1\uFF0C\u5219\u586B\u5199\u7528\u6237\u540D\u548C\u5BC6\u7801\u3002</p><p><img src="'+N+'" alt="\u56FE6-34" loading="lazy"></p><p>\u56FE6.34 VisualVM \u914D\u7F6E JMX \u8FDE\u63A5</p><p>\u6DFB\u52A0\u6210\u529F\u540E\uFF0C\u5728 Local \u8282\u70B9\u4E0B\u5C31\u4F1A\u51FA\u73B0\u4E00\u4E2A JMX \u56FE\u6807\u7684\u5E94\u7528\u7A0B\u5E8F\uFF0C\u5982\u56FE6.35 \u6240\u793A\u3002\u56FE\u4E2D\u4E24\u4E2A\u5E94\u7528\u7A0B\u5E8F\u5206\u522B\u901A\u8FC7\u672C\u5730\u65B9\u5F0F\u4E0E JMX \u65B9\u5F0F\u8FDE\u63A5\uFF0C\u4E24\u8005\u7684\u6807\u8BC6\u56FE\u6807\u662F\u4E0D\u540C\u7684\u3002</p><p><img src="'+H+'" alt="\u56FE6-35" loading="lazy"></p><p>\u56FE6.35 VisualVM \u4E2D\u7684 JMX \u5E94\u7528\u7A0B\u5E8F</p><h3 id="_6-5-2-\u76D1\u63A7\u5E94\u7528\u7A0B\u5E8F\u6982\u51B5" tabindex="-1"><a class="header-anchor" href="#_6-5-2-\u76D1\u63A7\u5E94\u7528\u7A0B\u5E8F\u6982\u51B5" aria-hidden="true">#</a> 6.5.2 \u76D1\u63A7\u5E94\u7528\u7A0B\u5E8F\u6982\u51B5</h3><p>\u901A\u8FC7 VisualVM\uFF0C\u53EF\u4EE5\u67E5\u770B\u5E94\u7528\u7A0B\u5E8F\u7684\u57FA\u672C\u6982\u51B5\uFF0C\u6BD4\u5982\u8FDB\u7A0B ID\u3001Main Class\u3001\u542F\u52A8\u53C2\u6570\u7B49\uFF0C\u5982\u56FE6.36 \u6240\u793A\u3002</p><p><img src="'+E+'" alt="\u56FE6-36" loading="lazy"></p><p>\u56FE6.36 VisualVM \u663E\u793A\u5E94\u7528\u7A0B\u5E8F\u6982\u51B5</p><p>\u5355\u51FB Tab \u9875\u9762\u4E0A\u7684\u76D1\u89C6\u9875\u9762\uFF0C\u5373\u53EF\u76D1\u63A7\u5E94\u7528\u7A0B\u5E8F CPU\u3001\u5806\u3001\u6C38\u4E45\u533A\u3001\u7C7B\u52A0\u8F7D\u548C\u7EBF\u7A0B\u6570\u7684\u603B\u4F53\u60C5\u51B5\u3002\u901A\u8FC7\u9875\u9762\u4E0A\u7684 \u201C\u6267\u884C\u5783\u573E\u56DE\u6536\u201D \u548C \u201C\u5806 Dump\u201D \u6309\u94AE\u8FD8\u53EF\u4EE5\u624B\u5DE5\u6267\u884C Full GC \u548C\u751F\u6210\u5806\u5FEB\u7167\uFF0C\u5982\u56FE6.37 \u6240\u793A\u3002</p><p><img src="'+F+'" alt="\u56FE6-37" loading="lazy"></p><p>\u56FE6.37 VisualVM \u663E\u793A Java \u7A0B\u5E8F\u5185\u5B58\u4FE1\u606F</p><p><strong>\u6CE8\u610F</strong>\uFF1AVisualVM \u5C06 CPU \u4F7F\u7528\u60C5\u51B5\u3001\u5806\u4FE1\u606F\u3001\u6C38\u4E45\u533A\u4FE1\u606F\u3001\u7EBF\u7A0B\u53CA\u7C7B\u52A0\u8F7D\u60C5\u51B5\u505A\u4E86\u53EF\u89C6\u5316\u7684\u5C55\u793A\uFF0C\u65B9\u4FBF\u5F00\u53D1\u4EBA\u5458\u67E5\u770B\u3002</p><h3 id="_6-5-3-thread-dump-\u548C\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_6-5-3-thread-dump-\u548C\u5206\u6790" aria-hidden="true">#</a> 6.5.3 Thread Dump \u548C\u5206\u6790</h3><p>VisualVM \u7684\u7EBF\u7A0B\u9875\u9762\uFF08\u5982\u56FE6.38 \u6240\u793A\uFF09\u53EF\u4EE5\u63D0\u4F9B\u8BE6\u7EC6\u7684\u7EBF\u7A0B\u4FE1\u606F\u3002\u5355\u51FB\u53F3\u4E0A\u89D2\u7684 \u201C\u7EBF\u7A0B Dump\u201D \u6309\u94AE\u53EF\u4EE5\u5BFC\u51FA\u5F53\u524D\u6240\u6709\u7EBF\u7A0B\u7684\u5806\u6808\u4FE1\u606F\uFF08\u76F8\u5F53\u4E8E\u4F7F\u7528 jstack \u547D\u4EE4\uFF09\u3002</p><p><img src="'+W+'" alt="\u56FE6-38" loading="lazy"></p><p>\u56FE6.38 VisualVM \u7684\u7EBF\u7A0B\u9875\u9762</p><p>\u5982\u679C VisualVM \u5728\u5F53\u524D\u7A0B\u5E8F\u4E2D\u627E\u5230\u6B7B\u9501\uFF0C\u5219\u4F1A\u4EE5\u5341\u5206\u663E\u773C\u7684\u65B9\u5F0F\u5728\u7EBF\u7A0B\u9875\u9762\u4E2D\u7ED9\u4E88\u63D0\u793A\uFF0C\u5982\u56FE6.39 \u6240\u793A\u3002</p><p><img src="'+K+'" alt="\u56FE6-39" loading="lazy"></p><p>\u56FE6.39 VisualVM \u7684\u6B7B\u9501\u63D0\u793A</p><p><strong>\u6CE8\u610F</strong>\uFF1AVisualVM \u7684 Thread \u9875\u9762\u63D0\u4F9B\u4E86\u8BE6\u7EC6\u7684\u7EBF\u7A0B\u4FE1\u606F\uFF0C\u8FD8\u4F1A\u8FDB\u884C\u81EA\u52A8\u7684\u6B7B\u9501\u76D1\u6D4B\uFF0C\u4E00\u65E6\u53D1\u73B0\u5B58\u5728\u6B7B\u9501\u4FBF\u4F1A\u63D0\u793A\u7528\u6237\u3002</p><h3 id="_6-5-4-\u6027\u80FD\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_6-5-4-\u6027\u80FD\u5206\u6790" aria-hidden="true">#</a> 6.5.4 \u6027\u80FD\u5206\u6790</h3><p>VisualVM \u6709\u4E24\u4E2A\u91C7\u6837\u5668\uFF0C\u5728 Sampler \u9875\u9762\u663E\u793A\u4E86 CPU \u548C\u5185\u5B58\u4E24\u4E2A\u6027\u80FD\u91C7\u6837\u5668\uFF0C\u7528\u4E8E\u5B9E\u65F6\u76D1\u63A7\u7A0B\u5E8F\u4FE1\u606F\u3002CPU \u91C7\u6837\u5668\u53EF\u4EE5\u5C06 CPU \u5360\u7528\u65F6\u95F4\u5B9A\u4F4D\u5230\u65B9\u6CD5\uFF0C\u5185\u5B58\u91C6\u6837\u5668\u53EF\u4EE5\u67E5\u770B\u5F53\u524D\u7A0B\u5E8F\u7684\u5806\u4FE1\u606F\u3002</p><p>\u901A\u8FC7 VisualVM \u7684\u91C6\u6837\u529F\u80FD\uFF0C\u53EF\u4EE5\u627E\u5230\u8BE5\u7A0B\u5E8F\u4E2D\u5360\u7528 CPU \u65F6\u95F4\u6700\u957F\u7684\u65B9\u6CD5\uFF0C\u5982\u56FE6.40 \u6240\u793A\u3002\u53EF\u4EE5\u770B\u5230 HoldCPUTask.run() \u65B9\u6CD5\u5360\u7528\u4E86\u5927\u91CF\u7684 CPU \u65F6\u95F4\uFF0C\u800C LazyTask.run() \u65B9\u6CD5\u5C31\u975E\u5E38\u7A7A\u95F2\u3002\u901A\u5E38\uFF0C\u53EF\u4EE5\u6839\u636E\u8FD9\u4E2A\u529F\u80FD\uFF0C\u7B80\u5355\u5730\u5B9A\u4F4D\u5230\u7CFB\u7EDF\u4E2D\u6700\u6D88\u8017\u8D44\u6E90\u7684\u65B9\u6CD5\uFF0C\u5E76\u52A0\u4EE5\u6539\u8FDB\u3002</p><p><img src="'+X+'" alt="\u56FE6-40" loading="lazy"></p><p>\u56FE6.40 VisualVM \u65B9\u6CD5\u8017\u65F6\u76D1\u63A7</p><p>\u5728 VisualVM \u7684\u9ED8\u8BA4\u7EDF\u8BA1\u4FE1\u606F\u4E2D\uFF0C\u5E76\u4E0D\u5305\u542B JDK \u7684\u5185\u7F6E\u5BF9\u8C61\u7684\u51FD\u6570\u8C03\u7528\u7EDF\u8BA1\uFF0C\u6BD4\u5982 java.* \u5305\u4E2D\u7684\u7C7B\u3002\u5982\u679C\u9700\u8981\u7EDF\u8BA1 JDK \u5185\u7684\u65B9\u6CD5\u8C03\u7528\u60C5\u51B5\uFF0C\u9700\u8981\u5355\u51FB\u53F3\u4E0A\u89D2\u7684 \u201C\u8BBE\u7F6E\u201D \u9009\u9879\uFF0C\u624B\u5DE5\u8FDB\u884C\u914D\u7F6E\u3002\u5982\u56FE6.41 \u6240\u793A\uFF0C\u589E\u52A0\u4E86 java.util.* \u5305\u5185\u7684\u51FD\u6570\u8C03\u7528\u7EDF\u8BA1\u4FE1\u606F\u3002\u53EF\u4EE5\u770B\u5230\uFF0Cjava.util.Random.next() \u65B9\u6CD5\u6700\u6D88\u8017 CPU \u8D44\u6E90\u3002</p><p><img src="'+$+'" alt="\u56FE6-41" loading="lazy"></p><p>\u56FE6.41\u589E\u52A0\u5BF9 java.util.* \u7684\u76D1\u63A7</p><p>\u901A\u8FC7\u5185\u5B58\u91C7\u6837\u5668\uFF0C\u53EF\u4EE5\u5B9E\u65F6\u67E5\u770B\u7CFB\u7EDF\u4E2D\u5B9E\u4F8B\u7684\u5206\u5E03\u60C5\u51B5\uFF0C\u5982\u56FE6.42 \u6240\u793A\u3002\u968F\u7740\u7A0B\u5E8F\u7684\u8FD0\u884C\uFF0CVisualVM \u4F1A\u5B9E\u65F6\u66F4\u65B0\u8FD9\u4E9B\u6570\u636E\uFF0C\u52A8\u6001\u663E\u793A\u5404\u4E2A class \u6240\u5360\u7684\u5185\u5B58\u5927\u5C0F\u3002</p><p><img src="'+Q+'" alt="\u56FE6-42" loading="lazy"></p><p>\u56FE6.42 VisualVM \u5185\u5B58\u76D1\u63A7</p><h3 id="_6-5-5-\u5185\u5B58\u5FEB\u7167\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_6-5-5-\u5185\u5B58\u5FEB\u7167\u5206\u6790" aria-hidden="true">#</a> 6.5.5 \u5185\u5B58\u5FEB\u7167\u5206\u6790</h3><p>\u4F7F\u7528\u53F3\u952E\u83DC\u5355\u4E2D\u7684 \u201C\u5806 Dump\u201D\uFF0C\u53EF\u4EE5\u7ACB\u5373\u83B7\u5F97\u5F53\u524D\u5E94\u7528\u7A0B\u5E8F\u7684\u5185\u5B58\u5FEB\u7167\uFF0C\u5982\u56FE6.43 \u6240\u793A\uFF08\u76F8\u5F53\u4E8E\u4F7F\u7528 jmap \u547D\u4EE4\uFF09\u3002</p><p><img src="'+Y+'" alt="\u56FE6-43" loading="lazy"></p><p>\u56FE6.43 \u5185\u5B58\u5FEB\u7167\u5206\u6790\u529F\u80FD</p><p>\u5185\u5B58\u5FEB\u7167\u5206\u6790\u5982\u56FE6.44 \u6240\u793A\uFF0C\u4F8B\u6570\u548C OQL \u63A7\u5236\u53F0\u3002\u4E0B\u9762\u5206\u522B\u4ECB\u7ECD\u5B83\u4EEC\u3002</p><p><img src="'+Z+'" alt="\u56FE6-44" loading="lazy"></p><p>\u56FE6.44 \u5185\u5B58\u5FEB\u7167\u5206\u6790</p><ol><li><p>\u6982\u8981\u9875\u9762\u5C55\u793A\u4E86\u5F53\u524D\u5185\u5B58\u7684\u6574\u4F53\u4FE1\u606F\uFF0C\u5305\u62EC\u5185\u5B58\u5927\u5C0F\u3001\u5B9E\u4F8B\u603B\u6570\u3001\u7C7B\u603B\u6570\u7B49\u3002</p></li><li><p>\u5728\u7C7B\u9875\u9762\u4E2D\uFF0C\u4EE5\u7C7B\u4E3A\u7D22\u5F15\uFF0C\u663E\u793A\u4E86\u6BCF\u4E2A\u7C7B\u7684\u5B9E\u4F8B\u6570\u548C\u5360\u7528\u7A7A\u95F4\u3002\u5728\u7C7B\u9875\u9762\u4E2D\uFF0C\u8FD8\u53EF\u4EE5\u5BF9\u4E24\u4E2A\u4E0D\u540C\u7684\u5185\u5B58\u5FEB\u7167\u6587\u4EF6\u8FDB\u884C\u6BD4\u8F83\uFF0C\u8FD9\u4E2A\u529F\u80FD\u53EF\u4EE5\u5E2E\u52A9\u5F00\u53D1\u8005\u5FEB\u901F\u5206\u6790\u540C\u4E00\u5E94\u7528\u7A0B\u5E8F\u5728\u8FD0\u884C\u7684\u4E0D\u540C\u65F6\u523B\uFF0C\u5185\u5B58\u6570\u636E\u4EA7\u751F\u7684\u53D8\u5316\uFF0C\u5982\u56FE6.44 \u6240\u793A\u3002</p><p>\u5728\u8FD9\u4E2A\u7C7B\u5C55\u793A\u7684\u9875\u9762\u4E2D\uFF0C\u5982\u679C\u9700\u8981\u83B7\u53D6\u6307\u5B9A\u7C7B\u7684\u66F4\u591A\u4FE1\u606F\uFF0C\u53EF\u4EE5\u5355\u51FB\u53F3\u952E\uFF0C\u8FDB\u5165\u8BE5\u7C7B\u7684\u5B9E\u4F8B\u9875\u9762\uFF0C\u5982\u56FE6.45 \u6240\u793A\u3002</p><p><img src="'+nn+'" alt="\u56FE6-45" loading="lazy"></p><p>\u56FE6.45 \u8FDB\u5165\u7C7B\u5B9E\u4F8B\u9875\u9762</p></li><li><p>\u5728\u5B9E\u4F8B\u6570\u9875\u9762\u4E2D\uFF0C\u5C06\u663E\u793A\u6307\u5B9A\u7C7B\u7684\u6240\u6709\u5B9E\u4F8B\u3002\u5F00\u53D1\u8005\u53EF\u4EE5\u67E5\u770B\u5F53\u524D\u5185\u5B58\u4E2D\u7684\u5B9E\u9645\u5185\u5BB9\u3002\u56FE6.46 \u663E\u793A\u4E86\u67E5\u770B\u4E00\u4E2A String \u5BF9\u8C61\u5B9E\u4F8B\u9875\u9762\u7684\u90E8\u5206\u5185\u5BB9\u3002\u53EF\u4EE5\u770B\u5230\uFF0C\u7CFB\u7EDF\u4E2D\u6240\u6709\u7684 String \u5BF9\u8C61\u90FD\u4E00\u4E00\u88AB\u5217\u51FA\uFF0C\u5E76\u4E14\u53EF\u4EE5\u770B\u5230\u6240\u6709\u5BF9\u8C61\u7684\u5177\u4F53\u6570\u636E\u3002</p><p><img src="'+sn+'" alt="\u56FE6-46" loading="lazy"></p><p>\u56FE6.46 String \u5BF9\u8C61\u5B9E\u4F8B\u663E\u793A</p><p>\u5728\u53F3\u4E0B\u89D2\u7684\u5F15\u7528\u90E8\u5206\uFF0C\u53EF\u4EE5\u67E5\u770B\u7CFB\u7EDF\u4E2D\u5F15\u7528\u8FD9\u4E2A\u5B9E\u4F8B\u7684\u5BF9\u8C61\uFF0C\u8FDB\u800C\u5C55\u793A\u5BF9\u8C61\u95F4\u7684\u5F15\u7528\u5173\u7CFB\u3002</p></li><li><p>OQL \u63A7\u5236\u53F0\u63D0\u4F9B\u4E86\u66F4\u5F3A\u5927\u7684\u5BF9\u8C61\u67E5\u8BE2\u529F\u80FD\u3002\u6709\u5173 VisualVM \u7684 OQL \u652F\u6301\uFF0C\u5C06\u5728\u540E\u7EED\u7AE0\u8282\u8FDB\u884C\u8BE6\u7EC6\u9610\u8FF0\u3002</p></li></ol><p><strong>\u6CE8\u610F</strong>\uFF1A\u901A\u8FC7 VisualVM \u63D0\u4F9B\u7684\u5185\u5B58\u5FEB\u7167\u5206\u6790\u5DE5\u5177\uFF0C\u53EF\u4EE5\u67E5\u770B\u5806\u5FEB\u7167\u5185\u7684\u7C7B\u4FE1\u606F\u548C\u5BF9\u8C61\u4FE1\u606F\u3002</p><h3 id="_6-5-6-btrace-\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_6-5-6-btrace-\u4ECB\u7ECD" aria-hidden="true">#</a> 6.5.6 BTrace \u4ECB\u7ECD</h3><p>BTrace \u662F\u4E00\u6B3E\u975E\u5E38\u6709\u610F\u601D\u7684\u5DE5\u5177\uFF0C\u5B83\u53EF\u4EE5\u5728\u4E0D\u505C\u673A\u7684\u60C5\u51B5\u4E0B\uFF0C\u901A\u8FC7\u5B57\u8282\u7801\u6CE8\u5165\u52A8\u6001\u76D1\u63A7\u7CFB\u7EDF\u7684\u8FD0\u884C\u60C5\u51B5\uFF0C\u53EF\u4EE5\u8DDF\u8E2A\u6307\u5B9A\u7684\u65B9\u6CD5\u8C03\u7528\u3001\u6784\u9020\u51FD\u6570\u8C03\u7528\u548C\u7CFB\u7EDF\u5185\u5B58\u7B49\u4FE1\u606F\u3002\u672C\u8282\u5728\u53C2\u8003 BTrace \u7528\u6237\u624B\u518C\u7684\u57FA\u7840\u4E0A\uFF0C\u7740\u773C\u4E8E\u5B9E\u9645\u5E94\u7528\uFF0C\u9009\u53D6\u8F83\u4E3A\u5B9E\u7528\u7684\u51E0\u4E2A BTrace \u811A\u672C\uFF0C\u6F14\u793A BTrace \u5DE5\u5177\u5F3A\u5927\u7684\u529F\u80FD\u3002\u5728 VisualVM \u4E2D\u5B89\u88C5 BTrace \u7684\u65B9\u6CD5\u5F88\u7B80\u5355\uFF0C\u5982\u56FE6.47 \u6240\u793A\u3002</p><p><img src="'+an+'" alt="\u56FE6-47" loading="lazy"></p><p>\u56FE6.47 BTrace \u7684\u5B89\u88C5</p><p>\u5728 VisualVM \u4E2D\u5B89\u88C5 BTrace \u63D2\u4EF6\u540E\uFF0C\u4FBF\u53EF\u4EE5\u9488\u5BF9 Java \u5E94\u7528\u7A0B\u5E8F\u6267\u884C BTrace \u811A\u672C\u4E86\u3002\u5728 Java \u5E94\u7528\u7A0B\u5E8F\u8282\u70B9\u4E0A\u5355\u51FB\u53F3\u952E\uFF0C\u9009\u62E9 &quot;Trace application&quot; \u5373\u53EF\u8FDB\u5165 BTrace \u63D2\u4EF6\u754C\u9762\uFF0C\u5982\u56FE6.48 \u6240\u793A\u3002</p><p><img src="'+en+'" alt="\u56FE6-48" loading="lazy"></p><p>\u56FE6.48 \u8FDB\u5165 BTrace \u754C\u9762</p><p>BTrace \u754C\u9762\u4E3B\u8981\u5206\u4E3A\u4E0A\u4E0B\u4E24\u90E8\u5206\u3002\u4E0A\u534A\u90E8\u5206\u4E3A\u4EE3\u7801\u533A\uFF0C\u4E0B\u534A\u90E8\u5206\u4E3A\u8F93\u51FA\u7ED3\u679C\u533A\u3002\u5728\u4EE3\u7801\u533A\u4E2D\u5B8C\u6210 BTrace \u811A\u672C\u7684\u7F16\u5199\uFF0C\u5355\u51FB Start \u6309\u94AE\u5C06 BTrace \u811A\u672C\u6CE8\u5165\u9009\u4E2D\u5E94\u7528\u7A0B\u5E8F\uFF0C\u7A0B\u5E8F\u8F93\u51FA\u7ED3\u679C\u5C06\u5728\u4E0B\u534A\u90E8\u5206\u663E\u793A\uFF0C\u5982\u56FE6.49 \u6240\u793A\u3002</p><p><img src="'+tn+`" alt="\u56FE6-49" loading="lazy"></p><p>\u56FE6.49 BTrace \u63D2\u4EF6\u8FD0\u884C\u754C\u9762</p><p>\u3010\u793A\u4F8B 6-12\u3011\u672C\u8282\u4F7F\u7528\u7684\u76EE\u6807\u6D4B\u8BD5\u7A0B\u5E8F\u5982\u4E0B\uFF0C\u8BE5\u7A0B\u5E8F\u5468\u671F\u6027\u5730\u8FDB\u884C\u7F51\u7EDC\u8BFB\u53D6\u64CD\u4F5C\uFF0C\u4E0B\u6587\u4E2D\u5C06\u4F7F\u7528 BTrace \u5BF9\u8BE5\u7A0B\u5E8F\u8FDB\u884C\u76D1\u63A7\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">HoldNetTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visitWeb</span><span class="token punctuation">(</span><span class="token class-name">String</span> strUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">URL</span> url <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">URLConnection</span> urlcon <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">InputStream</span> is <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>strUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
            urlcon <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            is <span class="token operator">=</span> urlcon<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BufferedReader</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">StringBuffer</span> bs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> l <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>l <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                bs<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\\r\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>is <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    is<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">visitWeb</span><span class="token punctuation">(</span><span class="token string">&quot;http://www.sina.com.cn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><p>\u76D1\u63A7\u6307\u5B9A\u51FD\u6570\u8017\u65F6</p><p>\u4F7F\u7528 BTrace \u811A\u672C\u53EF\u4EE5\u901A\u8FC7\u6B63\u5219\u8868\u8FBE\u5F0F\u6307\u5B9A\u76D1\u63A7\u7279\u5B9A\u7C7B\u7684\u7279\u5B9A\u65B9\u6CD5\u7684\u8017\u65F6\u3002\u4EE5\u4E0B\u4EE3\u7801\u5C06\u76D1\u63A7\u6240\u6709\u7C7B\u4E2D\u540D\u4E3A visitWeb() \u7684\u51FD\u6570\u7684\u6267\u884C\u65F6\u95F4\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span></span><span class="token class-name">BTraceUtils</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * \u76D1\u63A7\u65B9\u6CD5\u8017\u65F6
 *
 */</span>
<span class="token annotation punctuation">@BTrace</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PrintTimes</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * \u5F00\u59CB\u65F6\u95F4
     */</span>
    <span class="token annotation punctuation">@TLS</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u65B9\u6CD5\u5F00\u59CB\u65F6\u8C03\u7528
     */</span>
    <span class="token annotation punctuation">@OnMethod</span><span class="token punctuation">(</span>clazz <span class="token operator">=</span> <span class="token string">&quot;/.+/&quot;</span><span class="token punctuation">,</span>                                   <span class="token comment">// \u76D1\u63A7\u4EFB\u610F\u7C7B</span>
            method <span class="token operator">=</span> <span class="token string">&quot;/visitWeb/&quot;</span><span class="token punctuation">)</span>                              <span class="token comment">// \u76D1\u63A7 visitWeb() \u65B9\u6CD5</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">startMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        startTime <span class="token operator">=</span> <span class="token function">timeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u65B9\u6CD5\u7ED3\u675F\u65F6\u8C03\u7528<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
     * Kind.RETURN \u8FD9\u4E2A\u6CE8\u89E3\u5F88\u91CD\u8981
     */</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;deprecation&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@OnMethod</span><span class="token punctuation">(</span>clazz <span class="token operator">=</span> <span class="token string">&quot;/.+/&quot;</span><span class="token punctuation">,</span>
            method <span class="token operator">=</span> <span class="token string">&quot;/visitWeb/&quot;</span><span class="token punctuation">,</span>
            location <span class="token operator">=</span> <span class="token annotation punctuation">@Location</span><span class="token punctuation">(</span><span class="token class-name">Kind</span><span class="token punctuation">.</span>RETURN<span class="token punctuation">)</span><span class="token punctuation">)</span>                  <span class="token comment">// \u65B9\u6CD5\u8FD4\u56DE\u65F6\u89E6\u53D1</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">endMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token function">probeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">probeMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot; [&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token string">&quot;Time taken: &quot;</span><span class="token punctuation">,</span> <span class="token function">str</span><span class="token punctuation">(</span><span class="token function">timeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE5\u4E0A\u811A\u672C\u4F7F\u7528 @OnMethod \u6CE8\u91CA\u6307\u5B9A\u8981\u76D1\u63A7\u7684\u7C7B\u548C\u65B9\u6CD5\u540D\u79F0\u3002\u5B83\u5728\u51FD\u6570\u5F00\u59CB\u8FD0\u884C\u65F6\u8BB0\u5F55\u51FD\u6570\u7684\u8D77\u59CB\u6267\u884C\u65F6\u95F4\uFF0C\u5728\u51FD\u6570\u8FD4\u56DE\u65F6\u8BB0\u5F55\u51FD\u6570\u7684\u7EC8\u6B62\u65F6\u95F4\uFF0C\u4ECE\u800C\u8BA1\u7B97\u51FD\u6570\u7684\u8FD0\u884C\u8017\u65F6\u3002\u5C06\u8FD9\u6BB5\u811A\u672C\u6CE8\u5165\u6837\u4F8B\u76EE\u6807\u7A0B\u5E8F\uFF0C\u90E8\u5206\u8F93\u51FA\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>geym.zbase.ch6.HoldNetMain_BTrace$HoldNetTask.visitWeb [Time taken : 1343] 
geym.zbase.ch6.HoldNetMain_BTrace$HoldNetTask.visitWeb [Time taken : 1295] 
geym.zbase.ch6.HoldNetMain_BTrace$HoldNetTask.visitWeb [Time taken : 1332] 
geym.zbase.ch6.HoldNetMain_BTrace$HoldNetTask.visitWeb [Time taken : 1293] 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u6CE8\u610F</strong>\uFF1A\u901A\u8FC7 BTrace \u811A\u672C\u53EF\u4EE5\u76D1\u63A7\u6307\u5B9A\u7684\u67D0\u4E00\u4E2A\u51FD\u6570\u7684\u8FD0\u884C\u8017\u65F6\u3002</p></li><li><p>\u76D1\u63A7\u51FD\u6570\u53C2\u6570</p><p>\u5728\u4E0A\u9762\u7684\u793A\u4F8B\u4E2D\uFF0C\u5C55\u793A\u4E86\u5982\u4F55\u901A\u8FC7 BTrace \u76D1\u63A7 visitWeb() \u51FD\u6570\u7684\u6267\u884C\u65F6\u95F4\u3002\u9664\u4E86\u6267\u884C\u65F6\u95F4\uFF0C\u5F53\u524D\u51FD\u6570\u8BBF\u95EE\u54EA\u4E2A\u7F51\u7AD9\u4F9D\u7136\u662F\u4E00\u4E2A\u8BA9\u4EBA\u5F88\u5173\u6CE8\u7684\u4FE1\u606F\u3002\u901A\u8FC7 BTrace \u53EF\u4EE5\u5F88\u5BB9\u6613\u5730\u83B7\u5F97 visitWeb() \u51FD\u6570\u7684\u53C2\u6570\u4FE1\u606F\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span></span><span class="token class-name">BTraceUtils</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span></span><span class="token class-name">AnyType</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * \u76D1\u63A7\u65B9\u6CD5\u8017\u65F6
 * 
 */</span>
<span class="token annotation punctuation">@BTrace</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PrintTimes</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@OnMethod</span><span class="token punctuation">(</span>
            clazz <span class="token operator">=</span> <span class="token string">&quot;/.*HoldNetTask/&quot;</span><span class="token punctuation">,</span>                                   <span class="token comment">// \u8981\u76D1\u63A7\u7684\u7C7B</span>
            method <span class="token operator">=</span> <span class="token string">&quot;/visitWeb/&quot;</span>                                        <span class="token comment">// \u8981\u76D1\u63A7\u7684\u65B9\u6CD5</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">anyWriteFile</span><span class="token punctuation">(</span><span class="token annotation punctuation">@ProbeClassName</span> <span class="token class-name">String</span> pcn<span class="token punctuation">,</span>
                                    <span class="token annotation punctuation">@ProbeMethodName</span> <span class="token class-name">String</span> pmn<span class="token punctuation">,</span>
                                    <span class="token class-name">AnyType</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span>pcn<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                      <span class="token comment">// \u7C7B\u540D\u79F0</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print</span><span class="token punctuation">(</span>pmn<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                      <span class="token comment">// \u65B9\u6CD5\u540D\u79F0</span>
        <span class="token function">printArray</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                <span class="token comment">// \u4F20\u9012\u7ED9\u65B9\u6CD5\u7684\u53C2\u6570</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE5\u4E0A\u811A\u672C\u76D1\u63A7 HoldNetTask \u7C7B\u7684 visitWeb() \u65B9\u6CD5\uFF0C\u5E76\u5728\u6BCF\u6B21\u65B9\u6CD5\u8C03\u7528\u65F6\uFF0C\u8F93\u51FA\u7CFB\u7EDF\u4F20\u9012\u7ED9\u8BE5\u65B9\u6CD5\u7684\u53C2\u6570\u3002\u7A0B\u5E8F\u7684\u90E8\u5206\u8F93\u51FA\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>geym.zbase.ch6.HoldNetMain_BTrace$HoldNetTask.visitWeb[[http://www.sina.com.cn](http://www.sina.com.cn),] 
geym.zbase.ch6.HoldNetMain_BTrace$HoldNetTask.visitWeb[[http://www.sina.com.cn](http://www.sina.com.cn),]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u52A0\u7C97\u90E8\u5206\u5373 visitWeb() \u65B9\u6CD5\u7684\u63A5\u6536\u53C2\u6570\u3002\u901A\u8FC7 BTrace\uFF0C\u5728\u4E0D\u5F71\u54CD\u7CFB\u7EDF\u6B63\u5E38\u8FD0\u884C\u7684\u60C5\u51B5\u4E0B\uFF0C\u6355\u83B7\u4E86\u6240\u6709\u6307\u5B9A\u65B9\u6CD5\u7684\u8C03\u7528\u53CA\u4F20\u5165\u53C2\u6570\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1ABtrace \u53EF\u4EE5\u8DDF\u8E2A\u6307\u5B9A\u65B9\u6CD5\u7684\u4F20\u5165\u53C2\u6570\u3002\u83B7\u53D6\u65B9\u6CD5\u7684\u53C2\u6570\u503C\uFF0C\u5BF9\u4E8E\u73B0\u573A\u95EE\u9898\u6392\u67E5\u4F1A\u5F88\u6709\u5E2E\u52A9\u3002</p></li><li><p>\u53D6\u5F97\u4EFB\u610F\u884C\u4EE3\u7801\u4FE1\u606F</p><p>\u901A\u8FC7 BTrace \u811A\u672C @Location \u6CE8\u91CA\uFF0C\u53EF\u4EE5\u6307\u5B9A\u7A0B\u5E8F\u8FD0\u884C\u5230\u67D0\u4E00\u884C\u4EE3\u7801\u65F6\uFF0C\u89E6\u53D1\u67D0\u4E00\u884C\u4E3A\u3002\u4E0B\u4F8B\u663E\u793A\u4E86\u901A\u8FC7 BTrace \u811A\u672C\u83B7\u53D6 HoldNetTask \u7C7B\u7B2C 27 \u884C\u4EE3\u7801\u7684\u4FE1\u606F\uFF08\u5F53\u76EE\u6807\u7A0B\u5E8F\u8FD0\u884C\u5230\u7B2C 27 \u884C\u65F6\uFF0C\u89E6\u53D1 BTrace \u811A\u672C\uFF09\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span></span><span class="token class-name">BTraceUtils</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@BTrace</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AllLines</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@OnMethod</span><span class="token punctuation">(</span>
            clazz <span class="token operator">=</span> <span class="token string">&quot;/.*HoldNetTask/&quot;</span><span class="token punctuation">,</span>                            <span class="token comment">// \u76D1\u63A7\u4EE5 HoldNetTask \u7ED3\u5C3E\u7684\u7C7B</span>
            location <span class="token operator">=</span> <span class="token annotation punctuation">@Location</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">Kind</span><span class="token punctuation">.</span>LINE<span class="token punctuation">,</span> line <span class="token operator">=</span> <span class="token number">27</span><span class="token punctuation">)</span>    <span class="token comment">// \u6307\u5B9A\u5728\u7B2C 27 \u884C\u89E6\u53D1</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">online</span><span class="token punctuation">(</span><span class="token annotation punctuation">@ProbeClassName</span> <span class="token class-name">String</span> pcn<span class="token punctuation">,</span>
                              <span class="token annotation punctuation">@ProbeMethodName</span> <span class="token class-name">String</span> pmn<span class="token punctuation">,</span>
                              <span class="token keyword">int</span> line<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Strings</span><span class="token punctuation">.</span><span class="token function">strcat</span><span class="token punctuation">(</span>pcn<span class="token punctuation">,</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Strings</span><span class="token punctuation">.</span><span class="token function">strcat</span><span class="token punctuation">(</span>pmn<span class="token punctuation">,</span> <span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">println</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE5\u4E0A\u811A\u672C\u5728\u76EE\u6807\u7A0B\u5E8F\u8FD0\u884C\u5230\u7B2C 27 \u884C\u65F6\u89E6\u53D1\uFF0C\u5E76\u6253\u5370\u8BE5\u884C\u4FE1\u606F\u3002\u8BE5\u811A\u672C\u90E8\u5206\u8F93\u51FA\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>geym.zbase.ch6.HoldNetMain_BTrace$HoldNetTask.visitWeb:27
geym.zbase.ch6.HoldNetMain_BTrace$HoldNetTask.visitWeb:27
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7531\u811A\u672C\u8F93\u51FA\u53EF\u4EE5\u770B\u5230\uFF0CBTrace \u6B63\u786E\u8BC6\u522B\u51FA HoldNetTask \u7C7B\u7684\u7B2C 27 \u884C\u4EE3\u7801\uFF0C\u6B63\u5904\u4E8E visitWeb() \u51FD\u6570\u7684\u8FD0\u884C\u533A\u95F4\u4E2D\u3002\u82E5\u5C06 @Location \u4E2D line \u7684\u503C\u8BBE\u7F6E\u4E3A 1\uFF0C\u5219 BTrace \u811A\u672C\u5C06\u5728\u6BCF\u4E00\u884C\u89E6\u53D1\u3002</p></li><li><p>\u5B9A\u65F6\u89E6\u53D1</p><p>BTrace \u811A\u672C\u652F\u6301\u5B9A\u65F6\u89E6\u53D1\u3002\u53EF\u4EE5\u5468\u671F\u6027\u5730\u6267\u884C\u67D0\u4E00\u884C\u4E3A\uFF0C\u83B7\u53D6\u7CFB\u7EDF\u4FE1\u606F\u3002\u4E0B\u4F8B\u4F7F\u7528 @OnTimer \u6807\u8BB0\u5236\u5B9A\u4E24\u4E2A\u5468\u671F\u6027\u4EFB\u52A1\uFF0C\u5206\u522B\u4E3A\u6BCF\u79D2\u8FD0\u884C\u4E00\u6B21\u548C\u6BCF 3 \u79D2\u8FD0\u884C\u4E00\u6B21\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span></span><span class="token class-name">BTraceUtils</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@BTrace</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Timers</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@OnTimer</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>                                  <span class="token comment">// \u6BCF\u79D2\u8FD0\u884C</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">getUpTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Strings</span><span class="token punctuation">.</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token string">&quot;1000 msec: &quot;</span><span class="token punctuation">,</span>
                <span class="token class-name">Strings</span><span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token class-name">Sys</span><span class="token punctuation">.</span>VM<span class="token punctuation">.</span><span class="token function">vmUptime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// \u865A\u62DF\u673A\u542F\u52A8\u65F6\u95F4</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@OnTimer</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>                                  <span class="token comment">// \u6BCF 3 \u79D2\u8FD0\u884C</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">getStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">jstackAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token comment">// \u5BFC\u51FA\u7EBF\u7A0B\u5806\u6808</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u811A\u672C\u7684\u7B2C 6 \u884C\uFF0C\u6307\u5B9A\u4E00\u4E2A\u6BCF\u79D2\u8FD0\u884C\u4E00\u6B21\u7684\u4EFB\u52A1\uFF0C\u5E76\u6253\u5370\u865A\u62DF\u673A\u7684\u542F\u52A8\u65F6\u95F4\u3002\u5728\u7B2C 12 \u884C\uFF0C\u6307\u5B9A\u4E00\u4E2A\u6BCF 3 \u79D2\u8FD0\u884C\u4E00\u6B21\u7684\u4EFB\u52A1\uFF0C\u6BCF\u6B21\u90FD\u5C06\u5BFC\u51FA\u7CFB\u7EDF\u7684\u7EBF\u7A0B\u5FEB\u7167\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1A\u901A\u8FC7 BTrace \u53EF\u4EE5\u5728\u5F53\u524D\u5E94\u7528\u7A0B\u5E8F\u4E2D\uFF0C\u5B9A\u65F6\u83B7\u53D6\u4E00\u4E9B\u8FD0\u884C\u65F6\u7CFB\u7EDF\u4FE1\u606F\u3002</p></li><li><p>\u83B7\u53D6\u7C7B\u7684\u5C5E\u6027</p><p>\u5728\u7A0B\u5E8F\u8FD0\u884C\u8FC7\u7A0B\u4E2D\uFF0CBTrace \u8FD8\u53EF\u4EE5\u5728\u6307\u5B9A\u7684\u4F4D\u7F6E\u83B7\u5F97\u5BF9\u8C61\u5B9E\u4F8B\u7684\u5B57\u6BB5\u4FE1\u606F\u3002\u6BD4\u5982\u5728\u672C\u5B9E\u4F8B\u4E2D\uFF0C\u53EF\u4EE5\u5728\u8C03\u7528 URL.openConnection() \u65F6\u67E5\u770B\u5B9E\u9645\u6253\u5F00\u7684 URL \u5730\u5740\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span></span><span class="token class-name">BTraceUtils</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@BTrace</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PrintField</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6253\u5370\u5B9E\u4F8B\u5C5E\u6027</span>
    <span class="token annotation punctuation">@OnMethod</span><span class="token punctuation">(</span>clazz <span class="token operator">=</span> <span class="token string">&quot;/.*URL/&quot;</span><span class="token punctuation">,</span>
            method <span class="token operator">=</span> <span class="token string">&quot;/.*openConnection/&quot;</span><span class="token punctuation">,</span> location <span class="token operator">=</span> <span class="token annotation punctuation">@Location</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">Kind</span><span class="token punctuation">.</span>ENTRY<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">visitWebEntry</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Self</span> <span class="token class-name">Object</span> self<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token function">probeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">probeMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">println</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token function">classOf</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;protocolPathProp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// \u53EA\u80FD\u53D6\u503C static</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token function">classOf</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;host&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// \u83B7\u5F97\u5B9E\u4F8B\u53D8\u91CF</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;===========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u76D1\u63A7 URL \u5BF9\u8C61\uFF0C\u5728\u8C03\u7528 openConnection() \u65B9\u6CD5\u65F6\uFF0C\u83B7\u5F97\u5F53\u524D\u5BF9\u8C61\u5B9E\u4F8B self\uFF0C\u7136\u540E\u83B7\u53D6\u5BF9\u5E94\u5B9E\u4F8B\u7684 host \u7B49\u5C5E\u6027\u3002\u8FD9\u6BB5\u4EE3\u7801\u7684\u6267\u884C\u7ED3\u679C\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>java.net.URL.openConnection
http://www.sina.com.cn
java.protocol.handler.pkgs
www.sina.com.cn
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u83B7\u53D6\u65B9\u6CD5\u8C03\u7528</p><p>BTrace \u8FD8\u53EF\u4EE5\u83B7\u5F97\u4E00\u4E2A\u65B9\u6CD5\u7684\u5185\u90E8\u8C03\u7528\u7684\u65B9\u6CD5\u4FE1\u606F\u3002\u6BD4\u5982\uFF0C\u672C\u4F8B\u4E2D\u7684 visitWeb() \u65B9\u6CD5\u5728\u5176\u5185\u90E8\u53C8\u8C03\u7528\u4E86 URL.openConnection()\u3001URLConnection.getInputStream()\u3001BufferedReader.readLine() \u7B49\u65B9\u6CD5\u3002\u901A\u8FC7 BTrace \u53EF\u4EE5\u628A\u8FD9\u4E9B\u8C03\u7528\u7684\u65B9\u6CD5\u4F9D\u6B21\u6253\u5370\u51FA\u6765\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>btrace<span class="token punctuation">.</span></span><span class="token class-name">BTraceUtils</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@BTrace</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PrintField</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@OnMethod</span><span class="token punctuation">(</span>clazz <span class="token operator">=</span> <span class="token string">&quot;/.*HoldNetTask/&quot;</span><span class="token punctuation">,</span>
            method <span class="token operator">=</span> <span class="token string">&quot;visitWeb&quot;</span><span class="token punctuation">,</span> location <span class="token operator">=</span> <span class="token annotation punctuation">@Location</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">Kind</span><span class="token punctuation">.</span>CALL<span class="token punctuation">,</span> clazz <span class="token operator">=</span> <span class="token string">&quot;/.*URL.*/&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;/.*/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">visitWebEntry</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Self</span> <span class="token class-name">Object</span> self<span class="token punctuation">,</span> <span class="token annotation punctuation">@ProbeClassName</span> <span class="token class-name">String</span> pcm<span class="token punctuation">,</span> <span class="token annotation punctuation">@ProbeMethodName</span> <span class="token class-name">String</span> pmn<span class="token punctuation">,</span>
                                     <span class="token annotation punctuation">@TargetInstance</span> <span class="token class-name">Object</span> instance<span class="token punctuation">,</span> <span class="token annotation punctuation">@TargetMethodOrField</span> <span class="token class-name">String</span> method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Strings</span><span class="token punctuation">.</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token string">&quot;Context: &quot;</span><span class="token punctuation">,</span> <span class="token class-name">Strings</span><span class="token punctuation">.</span><span class="token function">strcat</span><span class="token punctuation">(</span>pcm<span class="token punctuation">,</span> <span class="token class-name">Strings</span><span class="token punctuation">.</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token string">&quot;#&quot;</span><span class="token punctuation">,</span> pmn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">classOf</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// \u88AB\u8C03\u7528\u76EE\u6807\u5BF9\u8C61</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Strings</span><span class="token punctuation">.</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// \u88AB\u8C03\u7528\u65B9\u6CD5</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u76D1\u63A7 HoldNetTask.visitWeb() \u65B9\u6CD5\u5185\u90E8\u6240\u8C03\u7528\u5230\u7684\u5305\u542B &quot;URL\u201D \u4E3A\u7C7B\u540D\u7684\u7C7B\u7684\u65B9\u6CD5\uFF0C\u5E76\u7ED9\u51FA\u4E86\u88AB\u8C03\u7528\u65B9\u6CD5\u7684\u540D\u79F0\u3002\u7A0B\u5E8F\u7684\u8F93\u51FA\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Context: geym/zbase/ch6/HoldNetMain_BTrace$HoldNetTask#visitWeb 
class java.net.URL.openConnection
Context: geym/zbase/ch6/HoldNetMain_BTrace$HoldNetTask#visitWeb 
class sun.net.www.protocol.http.HttpURLConnection.getInputstream
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u5728 visitWeb() \u65B9\u6CD5\u7684\u6267\u884C\u8FC7\u7A0B\u4E2D\uFF0C\u5148\u540E\u6267\u884C\u4E86 openConnection() \u548C getInputStream() \u65B9\u6CD5\u3002\u5728\u4F7F\u7528\u8FD9\u79CD\u65B9\u5F0F\u76D1\u63A7\u8C03\u7528\u65F6\uFF0C\u9700\u8981\u6CE8\u610F\u7B5B\u9009\u88AB\u8C03\u7528\u7684\u65B9\u6CD5\uFF0C\u56E0\u4E3A\u5728\u4E00\u6B21\u6267\u884C\u4E2D\uFF0C\u53EF\u80FD\u51FA\u73B0\u6210\u767E\u4E0A\u5343\u6B21\u8C03\u7528\uFF0C\u5982\u679C\u4E0D\u52A0\u4EE5\u7B5B\u9009\uFF0C\u90A3\u4E48\u8F93\u51FA\u7ED3\u679C\u96C6\u53EF\u80FD\u4F1A\u5F02\u5E38\u5E9E\u5927\u800C\u65E0\u6CD5\u5904\u7406\u3002</p></li></ol><h2 id="_6-6-\u6765\u81EA-jrockit-\u7684\u793C\u7269-\u865A\u62DF\u673A\u8BCA\u65AD\u5DE5\u5177-mission-control" tabindex="-1"><a class="header-anchor" href="#_6-6-\u6765\u81EA-jrockit-\u7684\u793C\u7269-\u865A\u62DF\u673A\u8BCA\u65AD\u5DE5\u5177-mission-control" aria-hidden="true">#</a> 6.6 \u6765\u81EA JRockit \u7684\u793C\u7269\uFF1A\u865A\u62DF\u673A\u8BCA\u65AD\u5DE5\u5177 Mission Control</h2><p>\u5728 Oracle \u6536\u8D2D Sun \u4E4B\u524D\uFF0COracle \u7684 JRockit \u865A\u62DF\u673A\u63D0\u4F9B\u4E86\u4E00\u6B3E\u53EB\u4F5C JRockit Mission Control \u7684\u865A\u62DF\u673A\u8BCA\u65AD\u5DE5\u5177\u3002\u5728 Oracle \u6536\u8D2D Sun \u4E4B\u540E\uFF0COracle \u516C\u53F8\u540C\u65F6\u62E5\u6709\u4E86 Sun Hotspot \u548C JRockit \u4E24\u6B3E\u865A\u62DF\u673A\u3002\u6839\u636E Oracle \u5BF9\u4E8E Java \u7684\u6218\u7565\uFF0C\u5728\u4ECA\u540E\u7684\u53D1\u5C55\u4E2D\uFF0C\u4F1A\u5C06 JRockit \u7684\u4F18\u79C0\u7279\u6027\u79FB\u690D\u5230 Hotspot \u4E0A\u3002\u5176\u4E2D\uFF0C\u4E00\u4E2A\u91CD\u8981\u7684\u6539\u8FDB\u5C31\u662F\u5728 Sun \u7684 JDK \u4E2D\u52A0\u5165\u4E86 JRockit \u652F\u6301\u3002\u5728 Oracle JDK 7 Update 40 \u4E4B\u540E\uFF0CMission Control \u8FD9\u6B3E\u5DE5\u5177\u5DF1\u7ECF\u7ED1\u5B9A\u5728 Oracle JDK \u4E2D\u53D1\u5E03\uFF08\u5F88\u4E0D\u5E78\uFF0COpenJDK \u4E2D\u5E76\u6CA1\u6709\u8BE5\u5DE5\u5177\uFF09\u3002</p><p>Mission Control \u7A0B\u5E8F\u4E3A %JAVA_HOME%/bin/jmc.exe\uFF0C\u6253\u5F00\u8FD9\u6B3E\u8F6F\u4EF6\uFF0C\u4E3B\u8981\u754C\u9762\u5982\u56FE6.50 \u6240\u793A\u3002</p><p><img src="`+pn+'" alt="\u56FE6-50" loading="lazy"></p><p>\u56FE6.50 Oracle Java Mission Control \u4E3B\u8981\u754C\u9762</p><h3 id="_6-6-1-mbean-\u670D\u52A1\u5668" tabindex="-1"><a class="header-anchor" href="#_6-6-1-mbean-\u670D\u52A1\u5668" aria-hidden="true">#</a> 6.6.1 MBean \u670D\u52A1\u5668</h3><p>\u5728 Mission Control \u754C\u9762\u5DE6\u4FA7\u7684 JVM \u6D4F\u89C8\u5668\u4E2D\uFF0C\u679A\u4E3E\u4E86\u7CFB\u7EDF\u5185\u6240\u6709\u7684 Java \u8FDB\u7A0B\u3002\u6253\u5F00\u5176\u4E2D\u4E00\u4E2A\u8FDB\u7A0B\u7684 MBean \u670D\u52A1\u5668\uFF0C\u5982\u56FE6.51 \u6240\u793A\u3002</p><p><img src="'+ln+'" alt="\u56FE6-51" loading="lazy"></p><p>\u56FE6.51 Oracle Java Mission Control MBean \u670D\u52A1\u5668</p><p>\u53EF\u4EE5\u770B\u5230\uFF0CMission Control \u7684\u754C\u9762\u975E\u5E38\u6709\u7279\u8272\uFF0C\u5728\u9ED8\u8BA4\u7684\u754C\u9762\u4E2D\uFF0C\u4EE5\u98DE\u673A\u4EEA\u8868\u7684\u89C6\u56FE\u663E\u793A\u4E86 Java \u5806\u4F7F\u7528\u7A7A\u95F4\u3001CPU \u4F7F\u7528\u7387\u548C Live Set + Fragmentation\u3002</p><p>Mission Control \u7684\u4E00\u5927\u7279\u70B9\u662F\u53EF\u4EE5\u81EA\u7531\u8BBE\u7F6E\u56FE\u6807\u5185\u5BB9\u3002\u6BD4\u5982\uFF0C\u5982\u679C\u5E0C\u671B\u5728\u98DE\u673A\u4EEA\u8868\u9762\u677F\u4E2D\u518D\u589E\u52A0\u4E00\u4E2A\u76D1\u63A7\u9879\uFF0C\u53EF\u4EE5\u5355\u51FB\u53F3\u4FA7\u7684\u6DFB\u52A0\u6309\u94AE\u8FDB\u884C\u6DFB\u52A0\uFF0C\u5982\u56FE6.52 \u6240\u793A\u3002</p><p><img src="'+cn+'" alt="\u56FE6-52" loading="lazy"></p><p>\u56FE6.52 \u6DFB\u52A0\u65B0\u7684\u76D1\u63A7\u9879</p><p>\u4F5C\u4E3A\u793A\u4F8B\u8FD9\u91CC\u6DFB\u52A0\u4E86\u4E00\u4E2A\u7EBF\u7A0B\u6570\u91CF\uFF0C\u5982\u56FE6.53 \u6240\u793A\u3002</p><p><img src="'+on+'" alt="\u56FE6-53" loading="lazy"></p><p>\u56FE6.53 \u6DFB\u52A0\u4E86\u7EBF\u7A0B\u6570\u91CF\u98DE\u673A\u4EEA\u8868\u9762\u677F</p><p>\u9664\u4E86\u98DE\u673A\u4EEA\u8868\u9762\u677F\uFF0CMission Control \u7684\u6574\u4E2A\u6982\u89C8\u9762\u677F\u90FD\u662F\u53EF\u4EE5\u8C03\u6574\u7684\u3002\u5982\u56FE6.54 \u6240\u793A\uFF0C\u5728\u9ED8\u8BA4\u7684\u6298\u7EBF\u56FE\u4E2D\uFF0C\u53C8\u6DFB\u52A0\u4E86 eden \u533A\u7684\u4F7F\u7528\u7387\u3002</p><p><img src="'+un+'" alt="\u56FE6-54" loading="lazy"></p><p>\u56FE6.54 \u5728\u6298\u7EBF\u56FE\u4E2D\u6DFB\u52A0\u65B0\u7684\u6027\u80FD\u9009\u9879</p><p>\u5355\u51FB \u201C\u8FD0\u884C\u65F6\u201D \u6309\u94AE\uFF0C\u5982\u56FE6.55 \u6240\u793A\uFF0C\u901A\u8FC7\u5DE6\u4E0B\u4FA7\u7684 Tab \u9875\u5207\u6362\uFF0C\u8FD8\u53EF\u4EE5\u663E\u793A\u5185\u5B58\u3001\u5783\u573E\u6536\u96C6\u3001\u5185\u5B58\u6C60\u3001\u7EBF\u7A0B\u7B49\u4FE1\u606F\u3002</p><p><img src="'+dn+`" alt="\u56FE6-55" loading="lazy"></p><p>\u56FE6.55 \u8FD0\u884C\u65F6\u4FE1\u606F</p><h3 id="_6-6-2-\u98DE\u884C\u8BB0\u5F55\u5668-flight-recorder" tabindex="-1"><a class="header-anchor" href="#_6-6-2-\u98DE\u884C\u8BB0\u5F55\u5668-flight-recorder" aria-hidden="true">#</a> 6.6.2 \u98DE\u884C\u8BB0\u5F55\u5668\uFF08Flight Recorder\uFF09</h3><p>\u98DE\u884C\u8BB0\u5F55\u5668\u662F Mission Control \u63D0\u4F9B\u7684\u53E6\u4E00\u5927\u529F\u80FD\uFF0C\u548C MBean \u670D\u52A1\u5668\u4E0D\u540C\uFF0C\u5B83\u901A\u8FC7\u8BB0\u5F55\u7A0B\u5E8F\u5728\u4E00\u6BB5\u65F6\u95F4\u5185\u7684\u8FD0\u884C\u60C5\u51B5\uFF0C\u5C06\u8BB0\u5F55\u7ED3\u679C\u8FDB\u884C\u5206\u6790\u548C\u5C55\u793A\uFF0C\u53EF\u4EE5\u66F4\u8FDB\u4E00\u6B65\u5BF9\u7CFB\u7EDF\u7684\u6027\u80FD\u8FDB\u884C\u5206\u6790\u548C\u8BCA\u65AD\u3002\u8981\u4F7F\u7528\u98DE\u884C\u8BB0\u5F55\u5668\uFF0C\u8981\u76D1\u63A7\u7684\u7A0B\u5E8F\u5FC5\u987B\u5E26\u4EE5\u4E0B\u53C2\u6570\u542F\u52A8\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-XX:+Unlock.CommercialFeatures -XX:+FlightRecorder
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4ECE\u53C2\u6570\u7684\u547D\u540D\u4E0A\u53EF\u4EE5\u770B\u5230\uFF0C\u8FD9\u4E2A\u529F\u80FD\u5E26\u6709\u5F88\u91CD\u7684\u5546\u4E1A\u8272\u5F69\u3002</p><p>\u5982\u56FE6.56 \u6240\u793A\uFF0C\u5728\u542F\u52A8\u98DE\u884C\u8BB0\u5F55\u5668\u540E\uFF0C\u9ED8\u8BA4\u4F1A\u8FDB\u884C 1 \u5206\u949F\u7684\u7CFB\u7EDF\u6027\u80FD\u6570\u636E\u91C6\u96C6\u3002</p><p><img src="`+rn+'" alt="\u56FE6-56" loading="lazy"></p><p>\u56FE6.56 \u542F\u52A8\u98DE\u884C\u8BB0\u5F55\u5668</p><p>\u8BB0\u5F55\u7ED3\u675F\u540E\uFF0CMission Control \u4F1A\u81EA\u52A8\u6253\u5F00\u521A\u624D\u7684\u8BB0\u5F55\uFF0C\u5982\u56FE6.57 \u6240\u793A\u3002\u53EF\u4EE5\u770B\u5230\uFF0C\u98DE\u884C\u8BB0\u5F55\u5668\u663E\u793A\u4E86\u66F4\u591A\u7684\u4FE1\u606F\u3002</p><p><img src="'+vn+'" alt="\u56FE6-57" loading="lazy"></p><p>\u56FE6.57 \u98DE\u884C\u8BB0\u5F55\u5668</p><p>\u9664\u4E86\u5E38\u89C4\u7684\u5185\u5B58\u548C CPU \u4FE1\u606F\uFF0C\u8FD8\u6709\u4EE3\u7801\u3001\u7EBF\u7A0B\u548C I/O \u7B49\u6BD4\u8F83\u91CD\u8981\u7684\u4FE1\u606F\u3002\u4EE5\u4EE3\u7801\u4E3A\u4F8B\uFF0C\u5B83\u53EF\u4EE5\u663E\u793A\u7CFB\u7EDF\u4E2D\u7684\u70ED\u70B9\u65B9\u6CD5\u53CA\u5176\u5360\u7528\u65F6\u95F4\u3002\u5982\u56FE6.58 \u6240\u793A\uFF0C\u663E\u793A\u4E86\u5360\u7528 CPU \u65F6\u95F4\u6700\u591A\u7684\u65B9\u6CD5\u8C03\u7528\u6811\u4FE1\u606F\u3002</p><p><img src="'+kn+'" alt="\u56FE6-58" loading="lazy"></p><p>\u56FE6.58 \u65B9\u6CD5\u8C03\u7528\u6811\u4FE1\u606F</p><p>\u5728 I/O \u9875\u9762\uFF0C\u8FD8\u53EF\u4EE5\u770B\u5230\u78C1\u76D8\u6587\u4EF6\u7684\u8BFB\u5199\u60C5\u51B5\uFF0C\u4EE5\u53CA\u7F51\u7EDC Socket \u7684\u8BBF\u95EE\u60C5\u51B5\u3002\u8FD9\u91CC\u4EE5\u7F51\u7EDC\u8BBF\u95EE\u4E3A\u4F8B\uFF0C\u56FE6.59 \u663E\u793A\u4E86\u5728\u8BB0\u5F55\u65F6\u95F4\u6BB5\u5185\u7A0B\u5E8F\u901A\u8FC7 Socket \u8BBF\u95EE\u7684\u8FDC\u7A0B\u4E3B\u673A\uFF0C\u4EE5\u53CA\u6570\u636E\u8BFB\u53D6\u6B21\u6570\u548C\u6570\u636E\u8BFB\u53D6\u6570\u91CF\u3002\u9650\u4E8E\u7BC7\u5E45\uFF0C\u66F4\u591A\u8BE6\u7EC6\u7684\u5185\u5BB9\u4E0D\u518D\u4E00\u4E00\u7F57\u5217\uFF0C\u8BFB\u8005\u53EF\u4EE5\u81EA\u884C\u5C1D\u8BD5\u3002</p><p><img src="'+mn+'" alt="\u56FE6-59" loading="lazy"></p><p>\u56FE6.59 \u7A0B\u5E8F\u8FDB\u884C Socket \u8BFB\u53D6\u7684\u4FE1\u606F</p><h2 id="_6-7-\u5C0F\u7ED3" tabindex="-1"><a class="header-anchor" href="#_6-7-\u5C0F\u7ED3" aria-hidden="true">#</a> 6.7 \u5C0F\u7ED3</h2><p>\u672C\u7AE0\u4E3B\u8981\u4ECB\u7ECD\u4E86\u4E00\u4E9B\u76D1\u63A7 Java \u865A\u62DF\u673A\u548C\u64CD\u4F5C\u7CFB\u7EDF\u6027\u80FD\u8868\u73B0\u7684\u5B9E\u7528\u5DE5\u5177\u3002\u9996\u5148\uFF0C\u5728\u64CD\u4F5C\u7CFB\u7EDF\u5C42\u9762\uFF0C\u4E3B\u8981\u6D89\u53CA Linux \u548C Windows \u4E24\u4E2A\u5E73\u53F0\uFF0C\u4ECB\u7ECD\u4E86\u5982\u4F55\u5728\u7CFB\u7EDF\u4E2D\u627E\u5230\u6D88\u8017\u8D44\u6E90\u6700\u591A\u7684\u8FDB\u7A0B\u548C\u7EBF\u7A0B\uFF0C\u8FDB\u800C\u8F85\u52A9\u5B9A\u4F4D\u95EE\u9898\u3002\u5176\u6B21\uFF0C\u8BE6\u7EC6\u4ECB\u7ECD\u4E86\u4E00\u4E9B JDK \u81EA\u5E26\u7684\u6027\u80FD\u8BCA\u65AD\u5DE5\u5177\uFF0C\u901A\u8FC7\u8FD9\u4E9B\u5DE5\u5177\u53EF\u4EE5\u66F4\u7EC6\u81F4\u5730\u89C2\u5BDF\u865A\u62DF\u673A\u7684\u8FD0\u884C\u60C5\u51B5\uFF0C\u540C\u65F6\uFF0C\u7B14\u8005\u629B\u7816\u5F15\u7389\uFF0C\u7ED9\u51FA\u4E86\u4E00\u4E2A\u52A0\u5F3A\u548C\u6539\u8FDB jps \u547D\u4EE4\u7684\u65B9\u6CD5\uFF0C\u6709\u5174\u8DA3\u7684\u8BFB\u8005\u53EF\u4EE5\u5BF9\u6B64\u505A\u66F4\u6DF1\u5165\u7684\u7814\u7A76\uFF0C\u751A\u81F3\u5F00\u53D1\u81EA\u5DF1\u7684\u6027\u80FD\u76D1\u63A7\u5DE5\u5177\u3002</p>',108);function Nn(Hn,En){const e=i("ExternalLinkIcon");return l(),c("div",null,[gn,s("p",null,[hn,s("a",xn,[yn,t(e)]),fn]),jn,s("p",null,[wn,s("a",Cn,[_n,t(e)]),Tn]),Mn,s("p",null,[Sn,s("a",Pn,[Jn,t(e)]),Dn]),Un,s("p",null,[qn,s("a",Ln,[zn,t(e)]),In]),Bn,s("p",null,[On,s("a",Vn,[Gn,t(e)]),An]),Rn])}var Kn=p(bn,[["render",Nn],["__file","\u7B2C6\u7AE0\u6027\u80FD\u76D1\u63A7\u5DE5\u5177.html.vue"]]);export{Kn as default};
