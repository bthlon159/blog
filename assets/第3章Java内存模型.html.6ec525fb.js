import{_ as n}from"./plugin-vue_export-helper.21dcd24c.js";import{o as a,c as s,e as p}from"./app.0d56c066.js";var e="/assets/\u56FE3-1.43123665.png",t="/assets/\u56FE3-2.a39ee480.png",l="/assets/\u56FE3-3.a7c4745c.png",o="/assets/\u88683-1.b4f6fc25.png",i="/assets/\u56FE3-4.11fbef0a.png",c="/assets/\u88683-2.5c115d07.png",r="/assets/\u88683-3.46cacda0.png",u="/assets/\u56FE3-5.ae6f67c6.png",d="/assets/\u88683-4.900cc6dd.png",k="/assets/\u56FE3-6.15806801.png",v="/assets/\u56FE3-7.04a58702.png",m="/assets/\u56FE3-8.ba3d13a0.png",b="/assets/\u56FE3-9.abbb9bcf.png",h="/assets/\u56FE3-10.9483d1a2.png",f="/assets/\u56FE3-11.bc8205ae.png",g="/assets/\u56FE3-12.25645129.png",y="/assets/\u56FE3-13.a2b394a2.png",w="/assets/\u56FE3-14.4dc4df8b.png",_="/assets/\u56FE3-15.f2d5bdb5.png",M="/assets/\u56FE3-16.d2d6d125.png",J="/assets/\u56FE3-17.db94abff.png",A="/assets/\u56FE3-18.1614b14c.png",B="/assets/\u88683-5.06cf0aa1.png",x="/assets/\u56FE3-19.20556fdc.png",j="/assets/\u56FE3-20.9fda86f9.png",S="/assets/\u56FE3-21.5814b7ae.png",z="/assets/\u56FE3-22.1bd81f1a.png",C="/assets/\u56FE3-23.50580cbd.png",L="/assets/\u56FE3-24.d671b73c.png",I="/assets/\u56FE3-25.fee5b78c.png",R="/assets/\u56FE3-26.a3c5aed5.png",T="/assets/\u56FE3-27.fe8191bf.png",E="/assets/\u56FE3-28.fee7a58a.png",F="/assets/\u56FE3-29.6bc6b987.png",O="/assets/\u56FE3-30.d8c215d4.png",D="/assets/\u56FE3-31.6c53968d.png",V="/assets/\u56FE3-32.771351e5.png",X="/assets/\u56FE3-33.04028fb9.png",P="/assets/\u56FE3-34.7a170e0b.png",q="/assets/\u56FE3-35.51da2bd9.png",K="/assets/\u56FE3-36.bdffd4e2.png",H="/assets/\u56FE3-37.1d03d088.png",Q="/assets/\u56FE3-38.cad3ecfa.png",U="/assets/\u88683-6.36a8094b.png",W="/assets/\u56FE3-39.4c0ecc32.png",N="/assets/\u56FE3-40.c32e3bef.png",G="/assets/\u56FE3-41.e59c66ec.png",Y="/assets/\u88683-7.63dc077f.png",Z="/assets/\u56FE3-42.965afb3a.png",$="/assets/\u88683-8.a77bd7c9.png",nn="/assets/\u56FE3-43.401e5594.png",an="/assets/\u88683-9.6d402642.png",sn="/assets/\u56FE3-44.c7d84b7e.png",pn="/assets/\u88683-10.2456d11c.png",en="/assets/\u56FE3-45.3a4cc338.png",tn="/assets/\u56FE3-46.8c88e100.png",ln="/assets/\u88683-11.4bb39147.png",on="/assets/\u56FE3-47.4176b23f.png",cn="/assets/\u88683-12.9481bbfd.png",rn="/assets/\u56FE3-48.ffa2b2b5.png",un="/assets/\u56FE3-49.b5ec8370.png",dn="/assets/\u56FE3-50.2ea3f447.png";const kn={},vn=p('<h1 id="\u7B2C-3-\u7AE0-java-\u5185\u5B58\u6A21\u578B" tabindex="-1"><a class="header-anchor" href="#\u7B2C-3-\u7AE0-java-\u5185\u5B58\u6A21\u578B" aria-hidden="true">#</a> \u7B2C 3 \u7AE0 Java \u5185\u5B58\u6A21\u578B</h1><p>Java \u7EBF\u7A0B\u4E4B\u95F4\u7684\u901A\u4FE1\u5BF9\u7A0B\u5E8F\u5458\u5B8C\u5168\u900F\u660E\uFF0C\u5185\u5B58\u53EF\u89C1\u6027\u95EE\u9898\u5F88\u5BB9\u6613\u56F0\u6270 Java \u7A0B\u5E8F\u5458\uFF0C\u672C\u7AE0\u5C06\u63ED\u5F00 Java \u5185\u5B58\u6A21\u578B\u795E\u79D8\u7684\u9762\u7EB1\u3002\u672C\u7AE0\u5927\u81F4\u5206 4 \u90E8\u5206\uFF1AJava \u5185\u5B58\u6A21\u578B\u7684\u57FA\u7840\uFF0C\u4E3B\u8981\u4ECB\u7ECD\u5185\u5B58\u6A21\u578B\u76F8\u5173\u7684\u57FA\u672C\u6982\u5FF5\uFF1BJava \u5185\u5B58\u6A21\u578B\u4E2D\u7684\u987A\u5E8F\u4E00\u81F4\u6027\uFF0C\u4E3B\u8981\u4ECB\u7ECD\u91CD\u6392\u5E8F\u4E0E\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B\uFF1B\u540C\u6B65\u539F\u8BED\uFF0C\u4E3B\u8981\u4ECB\u7ECD 3 \u4E2A\u540C\u6B65\u539F\u8BED\uFF08synchronized\u3001volatile \u548C final\uFF09\u7684\u5185\u5B58\u8BED\u4E49\u53CA\u91CD\u6392\u5E8F\u89C4\u5219\u5728\u5904\u7406\u5668\u4E2D\u7684\u5B9E\u73B0\uFF1BJava \u5185\u5B58\u6A21\u578B\u7684\u8BBE\u8BA1\uFF0C\u4E3B\u8981\u4ECB\u7ECD Java \u5185\u5B58\u6A21\u578B\u7684\u8BBE\u8BA1\u539F\u7406\uFF0C\u53CA\u5176\u4E0E\u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\u548C\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B\u7684\u5173\u7CFB\u3002</p><h2 id="_3-1-java-\u5185\u5B58\u6A21\u578B\u7684\u57FA\u7840" tabindex="-1"><a class="header-anchor" href="#_3-1-java-\u5185\u5B58\u6A21\u578B\u7684\u57FA\u7840" aria-hidden="true">#</a> 3.1 Java \u5185\u5B58\u6A21\u578B\u7684\u57FA\u7840</h2><h3 id="_3-1-1-\u5E76\u53D1\u7F16\u7A0B\u6A21\u578B\u7684\u4E24\u4E2A\u5173\u952E\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_3-1-1-\u5E76\u53D1\u7F16\u7A0B\u6A21\u578B\u7684\u4E24\u4E2A\u5173\u952E\u95EE\u9898" aria-hidden="true">#</a> 3.1.1 \u5E76\u53D1\u7F16\u7A0B\u6A21\u578B\u7684\u4E24\u4E2A\u5173\u952E\u95EE\u9898</h3><p>\u5728\u5E76\u53D1\u7F16\u7A0B\u4E2D\uFF0C\u9700\u8981\u5904\u7406\u4E24\u4E2A\u5173\u952E\u95EE\u9898\uFF1A\u7EBF\u7A0B\u4E4B\u95F4\u5982\u4F55\u901A\u4FE1\u53CA\u7EBF\u7A0B\u4E4B\u95F4\u5982\u4F55\u540C\u6B65\uFF08\u8FD9\u91CC\u7684\u7EBF\u7A0B\u662F\u6307\u5E76\u53D1\u6267\u884C\u7684\u6D3B\u52A8\u5B9E\u4F53\uFF09\u3002\u901A\u4FE1\u662F\u6307\u7EBF\u7A0B\u4E4B\u95F4\u4EE5\u4F55\u79CD\u673A\u5236\u6765\u4EA4\u6362\u4FE1\u606F\u3002\u5728\u547D\u4EE4\u5F0F\u7F16\u7A0B\u4E2D\uFF0C\u7EBF\u7A0B\u4E4B\u95F4\u7684\u901A\u4FE1\u673A\u5236\u6709\u4E24\u79CD\uFF1A\u5171\u4EAB\u5185\u5B58\u548C\u6D88\u606F\u4F20\u9012\u3002</p><p>\u5728\u5171\u4EAB\u5185\u5B58\u7684\u5E76\u53D1\u6A21\u578B\u91CC\uFF0C\u7EBF\u7A0B\u4E4B\u95F4\u5171\u4EAB\u7A0B\u5E8F\u7684\u516C\u5171\u72B6\u6001\uFF0C\u901A\u8FC7\u5199\u2014\u8BFB\u5185\u5B58\u4E2D\u7684\u516C\u5171\u72B6\u6001\u8FDB\u884C\u9690\u5F0F\u901A\u4FE1\u3002\u5728\u6D88\u606F\u4F20\u9012\u7684\u5E76\u53D1\u6A21\u578B\u91CC\uFF0C\u7EBF\u7A0B\u4E4B\u95F4\u6CA1\u6709\u516C\u5171\u72B6\u6001\uFF0C\u7EBF\u7A0B\u4E4B\u95F4\u5FC5\u987B\u901A\u8FC7\u53D1\u9001\u6D88\u606F\u6765\u663E\u5F0F\u8FDB\u884C\u901A\u4FE1\u3002</p><p>\u540C\u6B65\u662F\u6307\u7A0B\u5E8F\u4E2D\u7528\u4E8E\u63A7\u5236\u4E0D\u540C\u7EBF\u7A0B\u95F4\u64CD\u4F5C\u53D1\u751F\u76F8\u5BF9\u987A\u5E8F\u7684\u673A\u5236\u3002\u5728\u5171\u4EAB\u5185\u5B58\u5E76\u53D1\u6A21\u578B\u91CC\uFF0C\u540C\u6B65\u662F\u663E\u5F0F\u8FDB\u884C\u7684\u3002\u7A0B\u5E8F\u5458\u5FC5\u987B\u663E\u5F0F\u6307\u5B9A\u67D0\u4E2A\u65B9\u6CD5\u6216\u67D0\u6BB5\u4EE3\u7801\u9700\u8981\u5728\u7EBF\u7A0B\u4E4B\u95F4\u4E92\u65A5\u6267\u884C\u3002\u5728\u6D88\u606F\u4F20\u9012\u7684\u5E76\u53D1\u6A21\u578B\u91CC\uFF0C\u7531\u4E8E\u6D88\u606F\u7684\u53D1\u9001\u5FC5\u987B\u5728\u6D88\u606F\u7684\u63A5\u6536\u4E4B\u524D\uFF0C\u56E0\u6B64\u540C\u6B65\u662F\u9690\u5F0F\u8FDB\u884C\u7684\u3002</p><p>Java \u7684\u5E76\u53D1\u91C7\u7528\u7684\u662F\u5171\u4EAB\u5185\u5B58\u6A21\u578B\uFF0CJava \u7EBF\u7A0B\u4E4B\u95F4\u7684\u901A\u4FE1\u603B\u662F\u9690\u5F0F\u8FDB\u884C\uFF0C\u6574\u4E2A\u901A\u4FE1\u8FC7\u7A0B\u5BF9\u7A0B\u5E8F\u5458\u5B8C\u5168\u900F\u660E\u3002\u5982\u679C\u7F16\u5199\u591A\u7EBF\u7A0B\u7A0B\u5E8F\u7684 Java \u7A0B\u5E8F\u5458\u4E0D\u7406\u89E3\u9690\u5F0F\u8FDB\u884C\u7684\u7EBF\u7A0B\u4E4B\u95F4\u901A\u4FE1\u7684\u5DE5\u4F5C\u673A\u5236\uFF0C\u5F88\u53EF\u80FD\u4F1A\u9047\u5230\u5404\u79CD\u5947\u602A\u7684\u5185\u5B58\u53EF\u89C1\u6027\u95EE\u9898\u3002</p><h3 id="_3-1-2-java-\u5185\u5B58\u6A21\u578B\u7684\u62BD\u8C61\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#_3-1-2-java-\u5185\u5B58\u6A21\u578B\u7684\u62BD\u8C61\u7ED3\u6784" aria-hidden="true">#</a> 3.1.2 Java \u5185\u5B58\u6A21\u578B\u7684\u62BD\u8C61\u7ED3\u6784</h3><p>\u5728 Java \u4E2D\uFF0C\u6240\u6709\u5B9E\u4F8B\u57DF\u3001\u9759\u6001\u57DF\u548C\u6570\u7EC4\u5143\u7D20\u90FD\u5B58\u50A8\u5728\u5806\u5185\u5B58\u4E2D\uFF0C\u5806\u5185\u5B58\u5728\u7EBF\u7A0B\u4E4B\u95F4\u5171\u4EAB\uFF08\u672C\u7AE0\u7528 \u201C\u5171\u4EAB\u53D8\u91CF\u201D \u8FD9\u4E2A\u672F\u8BED\u4EE3\u6307\u5B9E\u4F8B\u57DF\uFF0C\u9759\u6001\u57DF\u548C\u6570\u7EC4\u5143\u7D20\uFF09\u3002\u5C40\u90E8\u53D8\u91CF\uFF08Local Variables\uFF09\uFF0C\u65B9\u6CD5\u5B9A\u4E49\u53C2\u6570\uFF08Java \u8BED\u8A00\u89C4\u8303\u79F0\u4E4B\u4E3A Formal Method Parameters\uFF09\u548C\u5F02\u5E38\u5904\u7406\u5668\u53C2\u6570\uFF08Exception Handler Parameters\uFF09\u4E0D\u4F1A\u5728\u7EBF\u7A0B\u4E4B\u95F4\u5171\u4EAB\uFF0C\u5B83\u4EEC\u4E0D\u4F1A\u6709\u5185\u5B58\u53EF\u89C1\u6027\u95EE\u9898\uFF0C\u4E5F\u4E0D\u53D7\u5185\u5B58\u6A21\u578B\u7684\u5F71\u54CD\u3002</p><p>Java \u7EBF\u7A0B\u4E4B\u95F4\u7684\u901A\u4FE1\u7531 Java \u5185\u5B58\u6A21\u578B\uFF08\u672C\u6587\u7B80\u79F0\u4E3A JMM\uFF09\u63A7\u5236\uFF0CJMM \u51B3\u5B9A\u4E00\u4E2A\u7EBF\u7A0B\u5BF9\u5171\u4EAB\u53D8\u91CF\u7684\u5199\u5165\u4F55\u65F6\u5BF9\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u53EF\u89C1\u3002\u4ECE\u62BD\u8C61\u7684\u89D2\u5EA6\u6765\u770B\uFF0CJMM \u5B9A\u4E49\u4E86\u7EBF\u7A0B\u548C\u4E3B\u5185\u5B58\u4E4B\u95F4\u7684\u62BD\u8C61\u5173\u7CFB\uFF1A\u7EBF\u7A0B\u4E4B\u95F4\u7684\u5171\u4EAB\u53D8\u91CF\u5B58\u50A8\u5728\u4E3B\u5185\u5B58\uFF08Main Memory\uFF09\u4E2D\uFF0C\u6BCF\u4E2A\u7EBF\u7A0B\u90FD\u6709\u4E00\u4E2A\u79C1\u6709\u7684\u672C\u5730\u5185\u5B58\uFF08Local Memory\uFF09\uFF0C\u672C\u5730\u5185\u5B58\u4E2D\u5B58\u50A8\u4E86\u8BE5\u7EBF\u7A0B\u4EE5\u8BFB / \u5199\u5171\u4EAB\u53D8\u91CF\u7684\u526F\u672C\u3002\u672C\u5730\u5185\u5B58\u662F JMM \u7684\u4E00\u4E2A\u62BD\u8C61\u6982\u5FF5\uFF0C\u5E76\u4E0D\u771F\u5B9E\u5B58\u5728\u3002\u5B83\u6DB5\u76D6\u4E86\u7F13\u5B58\u3001\u5199\u7F13\u51B2\u533A\u3001\u5BC4\u5B58\u5668\u4EE5\u53CA\u5176\u4ED6\u7684\u786C\u4EF6\u548C\u7F16\u8BD1\u5668\u4F18\u5316\u3002Java \u5185\u5B58\u6A21\u578B\u7684\u62BD\u8C61\u793A\u610F\u5982\u56FE3-1 \u6240\u793A\u3002</p><p><img src="'+e+'" alt="\u56FE3-1" loading="lazy"></p><p>\u56FE3-1 Java \u5185\u5B58\u6A21\u578B\u7684\u62BD\u8C61\u7ED3\u6784\u793A\u610F\u56FE</p><p>\u4ECE\u56FE3-1 \u6765\u770B\uFF0C\u5982\u679C\u7EBF\u7A0B A \u4E0E\u7EBF\u7A0B B \u4E4B\u95F4\u8981\u901A\u4FE1\u7684\u8BDD\uFF0C\u5FC5\u987B\u8981\u7ECF\u5386\u4E0B\u9762 2 \u4E2A\u6B65\u9AA4\u3002</p><ol><li><p>\u7EBF\u7A0B A \u628A\u672C\u5730\u5185\u5B58 A \u4E2D\u66F4\u65B0\u8FC7\u7684\u5171\u4EAB\u53D8\u91CF\u5237\u65B0\u5230\u4E3B\u5185\u5B58\u4E2D\u53BB\u3002</p></li><li><p>\u7EBF\u7A0B B \u5230\u4E3B\u5185\u5B58\u4E2D\u53BB\u8BFB\u53D6\u7EBF\u7A0B A \u4E4B\u524D\u5DF2\u66F4\u65B0\u8FC7\u7684\u5171\u4EAB\u53D8\u91CF\u3002</p></li></ol><p>\u4E0B\u9762\u901A\u8FC7\u793A\u610F\u56FE\uFF08\u89C1\u56FE3-2\uFF09\u6765\u8BF4\u660E\u8FD9\u4E24\u4E2A\u6B65\u9AA4\u3002</p><p><img src="'+t+'" alt="\u56FE3-2" loading="lazy"></p><p>\u56FE3-2 \u7EBF\u7A0B\u4E4B\u95F4\u7684\u901A\u4FE1\u56FE</p><p>\u5982\u56FE3-2 \u6240\u793A\uFF0C\u672C\u5730\u5185\u5B58 A \u548C\u672C\u5730\u5185\u5B58 B \u7531\u4E3B\u5185\u5B58\u4E2D\u5171\u4EAB\u53D8\u91CF x \u7684\u526F\u672C\u3002\u5047\u8BBE\u521D\u59CB\u65F6\uFF0C\u8FD9 3 \u4E2A\u5185\u5B58\u4E2D\u7684 x \u503C\u90FD\u4E3A 0\u3002\u7EBF\u7A0B A \u5728\u6267\u884C\u65F6\uFF0C\u628A\u66F4\u65B0\u540E\u7684 x \u503C\uFF08\u5047\u8BBE\u503C\u4E3A 1\uFF09\u4E34\u65F6\u5B58\u653E\u5728\u81EA\u5DF1\u7684\u672C\u5730\u5185\u5B58 A \u4E2D\u3002\u5F53\u7EBF\u7A0B A \u548C\u7EBF\u7A0B B \u9700\u8981\u901A\u4FE1\u65F6\uFF0C\u7EBF\u7A0B A \u9996\u5148\u4F1A\u628A\u81EA\u5DF1\u672C\u5730\u5185\u5B58\u4E2D\u4FEE\u6539\u540E\u7684 x \u503C\u5237\u65B0\u5230\u4E3B\u5185\u5B58\u4E2D\uFF0C\u6B64\u65F6\u4E3B\u5185\u5B58\u4E2D\u7684 x \u503C\u53D8\u4E3A\u4E86 1\u3002\u968F\u540E\uFF0C\u7EBF\u7A0B B \u5230\u4E3B\u5185\u5B58\u4E2D\u53BB\u8BFB\u53D6\u7EBF\u7A0B A \u66F4\u65B0\u540E\u7684 x \u503C\uFF0C\u6B64\u65F6\u7EBF\u7A0B B \u7684\u672C\u5730\u5185\u5B58\u7684 x \u503C\u4E5F\u53D8\u4E3A\u4E86 1\u3002</p><p>\u4ECE\u6574\u4F53\u6765\u770B\uFF0C\u8FD9\u4E24\u4E2A\u6B65\u9AA4\u5B9E\u8D28\u4E0A\u662F\u7EBF\u7A0B A \u5728\u5411\u7EBF\u7A0B B \u53D1\u9001\u6D88\u606F\uFF0C\u800C\u4E14\u8FD9\u4E2A\u901A\u4FE1\u8FC7\u7A0B\u5FC5\u987B\u8981\u7ECF\u8FC7\u4E3B\u5185\u5B58\u3002JMM \u901A\u8FC7\u63A7\u5236\u4E3B\u5185\u5B58\u4E0E\u6BCF\u4E2A\u7EBF\u7A0B\u7684\u672C\u5730\u5185\u5B58\u4E4B\u95F4\u7684\u4EA4\u4E92\uFF0C\u6765\u4E3A Java \u7A0B\u5E8F\u5458\u63D0\u4F9B\u5185\u5B58\u53EF\u89C1\u6027\u4FDD\u8BC1\u3002</p><h3 id="_3-1-3-\u4ECE\u6E90\u4EE3\u7801\u5230\u6307\u4EE4\u5E8F\u5217\u7684\u91CD\u6392\u5E8F" tabindex="-1"><a class="header-anchor" href="#_3-1-3-\u4ECE\u6E90\u4EE3\u7801\u5230\u6307\u4EE4\u5E8F\u5217\u7684\u91CD\u6392\u5E8F" aria-hidden="true">#</a> 3.1.3 \u4ECE\u6E90\u4EE3\u7801\u5230\u6307\u4EE4\u5E8F\u5217\u7684\u91CD\u6392\u5E8F</h3><p>\u5728\u6267\u884C\u7A0B\u5E8F\u65F6\uFF0C\u4E3A\u4E86\u63D0\u9AD8\u6027\u80FD\uFF0C\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u5E38\u5E38\u4F1A\u5BF9\u6307\u4EE4\u505A\u91CD\u6392\u5E8F\u3002\u91CD\u6392\u5E8F\u5206 3 \u79CD\u7C7B\u578B\u3002</p><ol><li><p>\u7F16\u8BD1\u5668\u4F18\u5316\u7684\u91CD\u6392\u5E8F\u3002\u7F16\u8BD1\u5668\u5728\u4E0D\u6539\u53D8\u5355\u7EBF\u7A0B\u7A0B\u5E8F\u8BED\u4E49\u7684\u524D\u63D0\u4E0B\uFF0C\u53EF\u4EE5\u91CD\u65B0\u5B89\u6392\u8BED\u53E5\u7684\u6267\u884C\u987A\u5E8F\u3002</p></li><li><p>\u6307\u4EE4\u7EA7\u5E76\u884C\u7684\u91CD\u6392\u5E8F\u3002\u73B0\u4EE3\u5904\u7406\u5668\u91C7\u7528\u4E86\u6307\u4EE4\u7EA7\u5E76\u884C\u6280\u672F\uFF08Instruction-Level Parallelism\uFF0CILP\uFF09\u6765\u5C06\u591A\u6761\u6307\u4EE4\u91CD\u53E0\u6267\u884C\u3002\u5982\u679C\u4E0D\u5B58\u5728\u6570\u636E\u4F9D\u8D56\u6027\uFF0C\u5904\u7406\u5668\u53EF\u4EE5\u6539\u53D8\u8BED\u53E5\u5BF9\u5E94\u673A\u5668\u6307\u4EE4\u7684\u6267\u884C\u987A\u5E8F\u3002</p></li><li><p>\u5185\u5B58\u7CFB\u7EDF\u7684\u91CD\u6392\u5E8F\u3002\u7531\u4E8E\u5904\u7406\u5668\u4F7F\u7528\u7F13\u5B58\u548C\u8BFB / \u5199\u7F13\u51B2\u533A\uFF0C\u8FD9\u4F7F\u5F97\u52A0\u8F7D\u548C\u5B58\u50A8\u64CD\u4F5C\u770B\u4E0A\u53BB\u53EF\u80FD\u662F\u5728\u4E71\u5E8F\u6267\u884C\u3002</p></li></ol><p>\u4ECE Java \u6E90\u4EE3\u7801\u5230\u6700\u7EC8\u5B9E\u9645\u6267\u884C\u7684\u6307\u4EE4\u5E8F\u5217\uFF0C\u4F1A\u5206\u522B\u7ECF\u5386\u4E0B\u9762 3 \u79CD\u91CD\u6392\u5E8F\uFF0C\u5982\u56FE3-3 \u6240\u793A\u3002</p><p><img src="'+l+'" alt="\u56FE3-3" loading="lazy"></p><p>\u56FE3-3 \u4ECE\u6E90\u7801\u5230\u6700\u7EC8\u6267\u884C\u7684\u6307\u4EE4\u5E8F\u5217\u7684\u793A\u610F\u56FE</p><p>\u4E0A\u8FF0\u7684 1 \u5C5E\u4E8E\u7F16\u8BD1\u5668\u91CD\u6392\u5E8F\uFF0C2 \u548C 3 \u5C5E\u4E8E\u5904\u7406\u5668\u91CD\u6392\u5E8F\u3002\u8FD9\u4E9B\u91CD\u6392\u5E8F\u53EF\u80FD\u4F1A\u5BFC\u81F4\u591A\u7EBF\u7A0B\u7A0B\u5E8F\u51FA\u73B0\u5185\u5B58\u53EF\u89C1\u6027\u95EE\u9898\u3002\u5BF9\u4E8E\u7F16\u8BD1\u5668\uFF0CJMM \u7684\u7F16\u8BD1\u5668\u91CD\u6392\u5E8F\u89C4\u5219\u4F1A\u7981\u6B62\u7279\u5B9A\u7C7B\u578B\u7684\u7F16\u8BD1\u5668\u91CD\u6392\u5E8F\uFF08\u4E0D\u662F\u6240\u6709\u7684\u7F16\u8BD1\u5668\u91CD\u6392\u5E8F\u90FD\u8981\u7981\u6B62\uFF09\u3002\u5BF9\u4E8E\u5904\u7406\u5668\u91CD\u6392\u5E8F\uFF0CJMM \u7684\u5904\u7406\u5668\u91CD\u6392\u5E8F\u89C4\u5219\u4F1A\u8981\u6C42 Java \u7F16\u8BD1\u5668\u5728\u751F\u6210\u6307\u4EE4\u5E8F\u5217\u65F6\uFF0C\u63D2\u5165\u7279\u5B9A\u7C7B\u578B\u7684\u5185\u5B58\u5C4F\u969C\uFF08Memory Barriers\uFF0CIntel \u79F0\u4E4B\u4E3A Memory Fence\uFF09\u6307\u4EE4\uFF0C\u901A\u8FC7\u5185\u5B58\u5C4F\u969C\u6307\u4EE4\u6765\u7981\u6B62\u7279\u5B9A\u7C7B\u578B\u7684\u5904\u7406\u5668\u91CD\u6392\u5E8F\u3002</p><p>JMM \u5C5E\u4E8E\u8BED\u8A00\u7EA7\u7684\u5185\u5B58\u6A21\u578B\uFF0C\u5B83\u786E\u4FDD\u5728\u4E0D\u540C\u7684\u7F16\u8BD1\u5668\u548C\u4E0D\u540C\u7684\u5904\u7406\u5668\u5E73\u53F0\u4E4B\u4E0A\uFF0C\u901A\u8FC7\u7981\u6B62\u7279\u5B9A\u7C7B\u578B\u7684\u7F16\u8BD1\u5668\u91CD\u6392\u5E8F\u548C\u5904\u7406\u5668\u91CD\u6392\u5E8F\uFF0C\u4E3A\u7A0B\u5E8F\u5458\u63D0\u4F9B\u4E00\u81F4\u7684\u5185\u5B58\u53EF\u89C1\u6027\u4FDD\u8BC1\u3002</p><h3 id="_3-1-4-\u5E76\u53D1\u7F16\u7A0B\u6A21\u578B\u7684\u5206\u7C7B" tabindex="-1"><a class="header-anchor" href="#_3-1-4-\u5E76\u53D1\u7F16\u7A0B\u6A21\u578B\u7684\u5206\u7C7B" aria-hidden="true">#</a> 3.1.4 \u5E76\u53D1\u7F16\u7A0B\u6A21\u578B\u7684\u5206\u7C7B</h3><p>\u73B0\u4EE3\u7684\u5904\u7406\u5668\u4F7F\u7528\u5199\u7F13\u51B2\u533A\u4E34\u65F6\u4FDD\u5B58\u5411\u5185\u5B58\u5199\u5165\u7684\u6570\u636E\u3002\u5199\u7F13\u51B2\u533A\u53EF\u4EE5\u4FDD\u8BC1\u6307\u4EE4\u6D41\u6C34\u7EBF\u6301\u7EED\u8FD0\u884C\uFF0C\u5B83\u53EF\u4EE5\u907F\u514D\u7531\u4E8E\u5904\u7406\u5668\u505C\u987F\u4E0B\u6765\u7B49\u5F85\u5411\u5185\u5B58\u5199\u5165\u6570\u636E\u800C\u4EA7\u751F\u7684\u5EF6\u8FDF\u3002\u540C\u65F6\uFF0C\u901A\u8FC7\u4EE5\u6279\u5904\u7406\u7684\u65B9\u5F0F\u5237\u65B0\u5199\u7F13\u51B2\u533A\uFF0C\u4EE5\u53CA\u5408\u5E76\u5199\u7F13\u51B2\u533A\u4E2D\u5BF9\u540C\u4E00\u5185\u5B58\u5730\u5740\u7684\u591A\u6B21\u5199\uFF0C\u51CF\u5C11\u5BF9\u5185\u5B58\u603B\u7EBF\u7684\u5360\u7528\u3002\u867D\u7136\u5199\u7F13\u51B2\u533A\u6709\u8FD9\u4E48\u591A\u597D\u5904\uFF0C\u4F46\u6BCF\u4E2A\u5904\u7406\u5668\u4E0A\u7684\u5199\u7F13\u51B2\u533A\uFF0C\u4EC5\u4EC5\u5BF9\u5B83\u6240\u5728\u7684\u5904\u7406\u5668\u53EF\u89C1\u3002\u8FD9\u4E2A\u7279\u6027\u4F1A\u5BF9\u5185\u5B58\u64CD\u4F5C\u7684\u6267\u884C\u987A\u5E8F\u4EA7\u751F\u91CD\u8981\u7684\u5F71\u54CD\uFF1A\u5904\u7406\u5668\u5BF9\u5185\u5B58\u7684\u8BFB / \u5199\u64CD\u4F5C\u7684\u6267\u884C\u987A\u5E8F\uFF0C\u4E0D\u4E00\u5B9A\u4E0E\u5185\u5B58\u5B9E\u9645\u53D1\u751F\u7684\u8BFB / \u5199\u64CD\u4F5C\u987A\u5E8F\u4E00\u81F4\uFF01\u4E3A\u4E86\u5177\u4F53\u8BF4\u660E\uFF0C\u8BF7\u770B\u4E0B\u9762\u7684\u8868 3-1\u3002</p><p>\u88683-1 \u5904\u7406\u5668\u64CD\u4F5C\u5185\u5B58\u7684\u6267\u884C\u7ED3\u679C</p><p><img src="'+o+'" alt="\u88683-1" loading="lazy"></p><p>\u5047\u8BBE\u5904\u7406\u5668A \u548C\u5904\u7406\u5668 B \u6309\u7A0B\u5E8F\u7684\u987A\u5E8F\u5E76\u884C\u6267\u884C\u5185\u5B58\u8BBF\u95EE\uFF0C\u6700\u7EC8\u53EF\u80FD\u5F97\u5230 x = y = 0 \u7684\u7ED3\u679C\u3002\u5177\u4F53\u7684\u539F\u56E0\u5982\u56FE3-4 \u6240\u793A\u3002</p><p><img src="'+i+'" alt="\u56FE3-4" loading="lazy"></p><p>\u56FE3-4 \u5904\u7406\u5668\u548C\u5185\u5B58\u7684\u4EA4\u4E92</p><p>\u8FD9\u91CC\u5904\u7406\u5668 A \u548C\u5904\u7406\u5668 B \u53EF\u4EE5\u540C\u65F6\u628A\u5171\u4EAB\u53D8\u91CF\u5199\u5165\u81EA\u5DF1\u7684\u5199\u7F13\u51B2\u533A\uFF08A1\uFF0CB1\uFF09\uFF0C\u7136\u540E\u4ECE\u5185\u5B58\u4E2D\u8BFB\u53D6\u53E6\u4E00\u4E2A\u5171\u4EAB\u53D8\u91CF\uFF08A2\uFF0CB2\uFF09\uFF0C\u6700\u540E\u624D\u628A\u81EA\u5DF1\u5199\u7F13\u5B58\u533A\u4E2D\u4FDD\u5B58\u7684\u810F\u6570\u636E\u5237\u65B0\u5230\u5185\u5B58\u4E2D\uFF08A3\uFF0CB3\uFF09\u3002\u5F53\u4EE5\u8FD9\u79CD\u65F6\u5E8F\u6267\u884C\u65F6\uFF0C\u7A0B\u5E8F\u5C31\u53EF\u4EE5\u5F97\u5230 x = y = 0 \u7684\u7ED3\u679C\u3002</p><p>\u4ECE\u5185\u5B58\u64CD\u4F5C\u5B9E\u9645\u53D1\u751F\u7684\u987A\u5E8F\u6765\u770B\uFF0C\u76F4\u5230\u5904\u7406\u5668 A \u6267\u884C A3 \u6765\u5237\u65B0\u81EA\u5DF1\u7684\u5199\u7F13\u5B58\u533A\uFF0C\u5199\u64CD\u4F5C A1 \u624D\u7B97\u771F\u6B63\u6267\u884C\u4E86\u3002\u867D\u7136\u5904\u7406\u5668 A \u6267\u884C\u5185\u5B58\u64CD\u4F5C\u7684\u987A\u5E8F\u4E3A\uFF1AA1 -&gt; A2\uFF0C\u4F46\u5185\u5B58\u64CD\u4F5C\u5B9E\u9645\u53D1\u751F\u7684\u987A\u5E8F\u5374\u662F A2 -&gt; A1\u3002\u6B64\u65F6\uFF0C\u5904\u7406\u5668 A \u7684\u5185\u5B58\u64CD\u4F5C\u987A\u5E8F\u88AB\u91CD\u6392\u5E8F\u4E86\uFF08\u5904\u7406\u5668 B \u7684\u60C5\u51B5\u548C\u5904\u7406\u5668 A \u4E00\u6837\uFF0C\u8FD9\u91CC\u5C31\u4E0D\u8D58\u8FF0\u4E86\uFF09\u3002</p><p>\u8FD9\u91CC\u7684\u5173\u952E\u662F\uFF0C\u7531\u4E8E\u5199\u7F13\u51B2\u533A\u4EC5\u5BF9\u81EA\u5DF1\u7684\u5904\u7406\u5668\u53EF\u89C1\uFF0C\u5B83\u4F1A\u5BFC\u81F4\u5904\u7406\u5668\u6267\u884C\u5185\u5B58\u64CD\u4F5C\u7684\u987A\u5E8F\u53EF\u80FD\u4F1A\u4E0E\u5185\u5B58\u5B9E\u9645\u7684\u64CD\u4F5C\u6267\u884C\u987A\u5E8F\u4E0D\u4E00\u81F4\u3002\u7531\u4E8E\u73B0\u4EE3\u7684\u5904\u7406\u5668\u90FD\u4F1A\u4F7F\u7528\u5199\u7F13\u51B2\u533A\uFF0C\u56E0\u6B64\u73B0\u4EE3\u7684\u5904\u7406\u5668\u90FD\u4F1A\u5141\u8BB8\u5BF9\u5199\u2014\u8BFB\u64CD\u4F5C\u8FDB\u884C\u91CD\u6392\u5E8F\u3002</p><p>\u88683-2 \u662F\u5E38\u89C1\u5904\u7406\u5668\u5141\u8BB8\u7684\u91CD\u6392\u5E8F\u7C7B\u578B\u7684\u5217\u8868\u3002</p><p>\u88683-2 \u5904\u7406\u5668\u7684\u91CD\u6392\u5E8F\u89C4\u5219</p><p><img src="'+c+'" alt="\u88683-2" loading="lazy"></p><p>\u6CE8\u610F\uFF0C\u88683-2 \u5355\u5143\u683C\u4E2D\u7684 &quot;N\u201D \u8868\u793A\u5904\u7406\u5668\u4E0D\u5141\u8BB8\u4E24\u4E2A\u64CD\u4F5C\u91CD\u6392\u5E8F\uFF0C&quot;Y\u201D \u8868\u793A\u5141\u8BB8\u91CD\u6392\u5E8F\u3002</p><p>\u4ECE\u88683-2 \u6211\u4EEC\u53EF\u4EE5\u770B\u51FA\uFF1A\u5E38\u89C1\u7684\u5904\u7406\u5668\u90FD\u5141\u8BB8 Store-Load \u91CD\u6392\u5E8F\uFF1B\u5E38\u89C1\u7684\u5904\u7406\u5668\u90FD\u4E0D\u5141\u8BB8\u5BF9\u5B58\u5728\u6570\u636E\u4F9D\u8D56\u7684\u64CD\u4F5C\u505A\u91CD\u6392\u5E8F\u3002sparc-TSO \u548C X86 \u62E5\u6709\u76F8\u5BF9\u8F83\u5F3A\u7684\u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\uFF0C\u5B83\u4EEC\u4EC5\u5141\u8BB8\u5BF9\u5199\u2014\u8BFB\u64CD\u4F5C\u505A\u91CD\u6392\u5E8F\uFF08\u56E0\u4E3A\u5B83\u4EEC\u90FD\u4F7F\u7528\u4E86\u5199\u7F13\u51B2\u533A\uFF09\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1A</p><ul><li><p>sparc-TSO \u662F\u6307\u4EE5 TSO\uFF08Total Store Order\uFF09\u5185\u5B58\u6A21\u578B\u8FD0\u884C\u65F6 sparc \u5904\u7406\u5668\u7684\u7279\u6027\u3002</p></li><li><p>\u88683-2 \u4E2D\u7684 X86 \u5305\u62EC X64 \u53CA AMD64\u3002</p></li><li><p>\u7531\u4E8E ARM \u5904\u7406\u5668\u7684\u5185\u5B58\u6A21\u578B\u4E0E PowerPC \u5904\u7406\u5668\u7684\u5185\u5B58\u6A21\u578B\u975E\u5E38\u7C7B\u4F3C\uFF0C\u672C\u6587\u5C06\u5FFD\u7565\u5B83\u3002</p></li><li><p>\u6570\u636E\u4F9D\u8D56\u6027\u540E\u6587\u4F1A\u4E13\u95E8\u8BF4\u660E\u3002</p></li></ul><p>\u4E3A\u4E86\u4FDD\u8BC1\u5185\u5B58\u53EF\u89C1\u6027\uFF0CJava \u7F16\u8BD1\u5668\u5728\u751F\u6210\u6307\u4EE4\u5E8F\u5217\u7684\u9002\u5F53\u4F4D\u7F6E\u4F1A\u63D2\u5165\u5185\u5B58\u5C4F\u969C\u6307\u4EE4\u6765\u7981\u6B62\u7279\u5B9A\u7C7B\u578B\u7684\u5904\u7406\u5668\u91CD\u6392\u5E8F\u3002JMM \u628A\u5185\u5B58\u5C4F\u969C\u6307\u4EE4\u5206\u4E3A 4 \u7C7B\uFF0C\u5982\u88683-3 \u6240\u793A\u3002</p><p>\u88683-3 \u5185\u5B58\u5C4F\u969C\u7C7B\u578B\u8868</p><p><img src="'+r+'" alt="\u88683-3" loading="lazy"></p><p>StoreLoad Barriers \u662F\u4E00\u4E2A \u201C\u5168\u80FD\u578B\u201D \u7684\u5C4F\u969C\uFF0C\u5B83\u540C\u65F6\u5177\u6709\u5176\u4ED6 3 \u4E2A\u5C4F\u969C\u7684\u6548\u679C\u3002\u73B0\u4EE3\u7684\u591A\u5904\u7406\u5668\u5927\u591A\u652F\u6301\u8BE5\u5C4F\u969C\uFF08\u5176\u4ED6\u7C7B\u578B\u7684\u5C4F\u969C\u4E0D\u4E00\u5B9A\u88AB\u6240\u6709\u5904\u7406\u5668\u652F\u6301\uFF09\u3002\u6267\u884C\u8BE5\u5C4F\u969C\u5F00\u9500\u4F1A\u5F88\u6602\u8D35\uFF0C\u56E0\u4E3A\u5F53\u524D\u5904\u7406\u5668\u901A\u5E38\u8981\u628A\u5199\u7F13\u51B2\u533A\u4E2D\u7684\u6570\u636E\u5168\u90E8\u5237\u65B0\u5230\u5185\u5B58\u4E2D\uFF08Buffer Fully Flush\uFF09\u3002</p><h3 id="_3-1-5-happens-before-\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#_3-1-5-happens-before-\u7B80\u4ECB" aria-hidden="true">#</a> 3.1.5 happens-before \u7B80\u4ECB</h3><p>\u4ECE JDK 5 \u5F00\u59CB\uFF0CJava \u4F7F\u7528\u65B0\u7684 JSR-133 \u5185\u5B58\u6A21\u578B\uFF08\u9664\u975E\u7279\u522B\u8BF4\u660E\uFF0C\u672C\u6587\u9488\u5BF9\u7684\u90FD\u662F JSR-133 \u5185\u5B58\u6A21\u578B\uFF09\u3002JSR-133 \u4F7F\u7528 happens-before \u7684\u6982\u5FF5\u6765\u9610\u8FF0\u64CD\u4F5C\u4E4B\u95F4\u7684\u5185\u5B58\u53EF\u89C1\u6027\u3002\u5728 JMM \u4E2D\uFF0C\u5982\u679C\u4E00\u4E2A\u64CD\u4F5C\u6267\u884C\u7684\u7ED3\u679C\u9700\u8981\u5BF9\u53E6\u4E00\u4E2A\u64CD\u4F5C\u53EF\u89C1\uFF0C\u90A3\u4E48\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u4E4B\u95F4\u5FC5\u987B\u8981\u5B58\u5728 happens-before \u5173\u7CFB\u3002\u8FD9\u91CC\u63D0\u5230\u7684\u4E24\u4E2A\u64CD\u4F5C\u65E2\u53EF\u4EE5\u662F\u5728\u4E00\u4E2A\u7EBF\u7A0B\u4E4B\u5185\uFF0C\u4E5F\u53EF\u4EE5\u662F\u5728\u4E0D\u540C\u7EBF\u7A0B\u4E4B\u95F4\u3002</p><p>\u4E0E\u7A0B\u5E8F\u5458\u5BC6\u5207\u76F8\u5173\u7684 happens-before \u89C4\u5219\u5982\u4E0B\u3002</p><ul><li><p>\u7A0B\u5E8F\u987A\u5E8F\u89C4\u5219\uFF1A\u4E00\u4E2A\u7EBF\u7A0B\u4E2D\u7684\u6BCF\u4E2A\u64CD\u4F5C\uFF0Chappens-before \u4E8E\u8BE5\u7EBF\u7A0B\u4E2D\u7684\u4EFB\u610F\u540E\u7EED\u64CD\u4F5C\u3002</p></li><li><p>\u76D1\u89C6\u5668\u9501\u89C4\u5219\uFF1A\u5BF9\u4E00\u4E2A\u9501\u7684\u89E3\u9501\uFF0Chappens-before \u4E8E\u968F\u540E\u5BF9\u8FD9\u4E2A\u9501\u7684\u52A0\u9501\u3002</p></li><li><p>volatile \u53D8\u91CF\u89C4\u5219\uFF1A\u5BF9\u4E00\u4E2A volatile \u57DF\u7684\u5199\uFF0Chappens-before \u4E8E\u4EFB\u610F\u540E\u7EED\u5BF9\u8FD9\u4E2A volatile \u57DF\u7684\u8BFB\u3002</p></li><li><p>\u4F20\u9012\u6027\uFF1A\u5982\u679C A happens-before B\uFF0C\u4E14 B happens-before C\uFF0C\u90A3\u4E48 A happens-before C\u3002</p></li></ul><p><strong>\u6CE8\u610F</strong>\uFF1A\u4E24\u4E2A\u64CD\u4F5C\u4E4B\u95F4\u5177\u6709 happens-before \u5173\u7CFB\uFF0C\u5E76\u4E0D\u610F\u5473\u7740\u524D\u4E00\u4E2A\u64CD\u4F5C\u5FC5\u987B\u8981\u5728\u540E\u4E00\u4E2A\u64CD\u4F5C\u4E4B\u524D\u6267\u884C\uFF01happens-before \u4EC5\u4EC5\u8981\u6C42\u524D\u4E00\u4E2A\u64CD\u4F5C\uFF08\u6267\u884C\u7684\u7ED3\u679C\uFF09\u5BF9\u540E\u4E00\u4E2A\u64CD\u4F5C\u53EF\u89C1\uFF0C\u4E14\u524D\u4E00\u4E2A\u64CD\u4F5C\u6309\u987A\u5E8F\u6392\u5728\u7B2C\u4E8C\u4E2A\u64CD\u4F5C\u4E4B\u524D\uFF08the first is visible to and ordered before the second\uFF09\u3002happens-before \u7684\u5B9A\u4E49\u5F88\u5FAE\u5999\uFF0C\u540E\u6587\u4F1A\u5177\u4F53\u8BF4\u660E happens-before \u4E3A\u4EC0\u4E48\u8981\u8FD9\u4E48\u5B9A\u4E49\u3002</p><p>happens-before \u4E0E JMM \u7684\u5173\u7CFB\u5982\u56FE3-5 \u6240\u793A\u3002</p><p><img src="'+u+'" alt="\u56FE3-5" loading="lazy"></p><p>\u56FE3-5 happens-before \u4E0E JMM \u7684\u5173\u7CFB</p><p>\u5982\u56FE3-5\u6240\u793A\uFF0C\u4E00\u4E2A happens-before \u89C4\u5219\u5BF9\u5E94\u4E8E\u4E00\u4E2A\u6216\u591A\u4E2A\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u91CD\u6392\u5E8F\u89C4\u5219\u3002\u5BF9\u4E8E Java \u7A0B\u5E8F\u5458\u6765\u8BF4\uFF0Chappens-before \u89C4\u5219\u7B80\u5355\u6613\u61C2\uFF0C\u5B83\u907F\u514D Java \u7A0B\u5E8F\u5458\u4E3A\u4E86\u7406\u89E3 JMM \u63D0\u4F9B\u7684\u5185\u5B58\u53EF\u89C1\u6027\u4FDD\u8BC1\u800C\u53BB\u5B66\u4E60\u590D\u6742\u7684\u91CD\u6392\u5E8F\u89C4\u5219\u4EE5\u53CA\u8FD9\u4E9B\u89C4\u5219\u7684\u5177\u4F53\u5B9E\u73B0\u65B9\u6CD5\u3002</p><h2 id="_3-2-\u91CD\u6392\u5E8F" tabindex="-1"><a class="header-anchor" href="#_3-2-\u91CD\u6392\u5E8F" aria-hidden="true">#</a> 3.2 \u91CD\u6392\u5E8F</h2><p>\u91CD\u6392\u5E8F\u662F\u6307\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u4E3A\u4E86\u4F18\u5316\u7A0B\u5E8F\u6027\u80FD\u800C\u5BF9\u6307\u4EE4\u5E8F\u5217\u8FDB\u884C\u91CD\u65B0\u6392\u5E8F\u7684\u4E00\u79CD\u624B\u6BB5\u3002</p><h3 id="_3-2-1-\u6570\u636E\u4F9D\u8D56\u6027" tabindex="-1"><a class="header-anchor" href="#_3-2-1-\u6570\u636E\u4F9D\u8D56\u6027" aria-hidden="true">#</a> 3.2.1 \u6570\u636E\u4F9D\u8D56\u6027</h3><p>\u5982\u679C\u4E24\u4E2A\u64CD\u4F5C\u8BBF\u95EE\u540C\u4E00\u4E2A\u53D8\u91CF\uFF0C\u4E14\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u4E2D\u6709\u4E00\u4E2A\u4E3A\u5199\u64CD\u4F5C\uFF0C\u6B64\u65F6\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u4E4B\u95F4\u5C31\u5B58\u5728\u6570\u636E\u4F9D\u8D56\u6027\u3002\u6570\u636E\u4F9D\u8D56\u5206\u4E3A\u4E0B\u5217 3 \u79CD\u7C7B\u578B\uFF0C\u5982\u88683-4 \u6240\u793A\u3002</p><p>\u88683-4 \u6570\u636E\u4F9D\u8D56\u7C7B\u578B\u8868</p><p><img src="'+d+`" alt="\u88683-4" loading="lazy"></p><p>\u4E0A\u9762 3 \u79CD\u60C5\u51B5\uFF0C\u53EA\u8981\u91CD\u6392\u5E8F\u4E24\u4E2A\u64CD\u4F5C\u7684\u6267\u884C\u987A\u5E8F\uFF0C\u7A0B\u5E8F\u7684\u6267\u884C\u7ED3\u679C\u5C31\u4F1A\u88AB\u6539\u53D8\u3002</p><p>\u524D\u9762\u63D0\u5230\u8FC7\uFF0C\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u53EF\u80FD\u4F1A\u5BF9\u64CD\u4F5C\u505A\u91CD\u6392\u5E8F\u3002\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u5728\u91CD\u6392\u5E8F\u65F6\uFF0C\u4F1A\u9075\u5B88\u6570\u636E\u4F9D\u8D56\u6027\uFF0C\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u4E0D\u4F1A\u6539\u53D8\u5B58\u5728\u6570\u636E\u4F9D\u8D56\u5173\u7CFB\u7684\u4E24\u4E2A\u64CD\u4F5C\u7684\u6267\u884C\u987A\u5E8F\u3002</p><p>\u8FD9\u91CC\u6240\u8BF4\u7684\u6570\u636E\u4F9D\u8D56\u6027\u4EC5\u9488\u5BF9\u5355\u4E2A\u5904\u7406\u5668\u4E2D\u6267\u884C\u7684\u6307\u4EE4\u5E8F\u5217\u548C\u5355\u4E2A\u7EBF\u7A0B\u4E2D\u6267\u884C\u7684\u64CD\u4F5C\uFF0C\u4E0D\u540C\u5904\u7406\u5668\u4E4B\u95F4\u548C\u4E0D\u540C\u7EBF\u7A0B\u4E4B\u95F4\u7684\u6570\u636E\u4F9D\u8D56\u6027\u4E0D\u88AB\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u8003\u8651\u3002</p><h3 id="_3-2-2-as-if-serial-\u8BED\u4E49" tabindex="-1"><a class="header-anchor" href="#_3-2-2-as-if-serial-\u8BED\u4E49" aria-hidden="true">#</a> 3.2.2 as-if-serial \u8BED\u4E49</h3><p>as-if-serial \u8BED\u4E49\u7684\u610F\u601D\u662F\uFF1A\u4E0D\u7BA1\u600E\u4E48\u91CD\u6392\u5E8F\uFF08\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u4E3A\u4E86\u63D0\u9AD8\u5E76\u884C\u5EA6\uFF09\uFF0C\uFF08\u5355\u7EBF\u7A0B\uFF09\u7A0B\u5E8F\u7684\u6267\u884C\u7ED3\u679C\u4E0D\u80FD\u88AB\u6539\u53D8\u3002\u7F16\u8BD1\u5668\u3001runtime \u548C\u5904\u7406\u5668\u90FD\u5FC5\u987B\u9075\u5B88 as-if-serial \u8BED\u4E49\u3002</p><p>\u4E3A\u4E86\u9075\u5B88 as-if-serial \u8BED\u4E49\uFF0C\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u4E0D\u4F1A\u5BF9\u5B58\u5728\u6570\u636E\u4F9D\u8D56\u5173\u7CFB\u7684\u64CD\u4F5C\u505A\u91CD\u6392\u5E8F\uFF0C\u56E0\u4E3A\u8FD9\u79CD\u91CD\u6392\u5E8F\u4F1A\u6539\u53D8\u6267\u884C\u7ED3\u679C\u3002\u4F46\u662F\uFF0C\u5982\u679C\u64CD\u4F5C\u4E4B\u95F4\u4E0D\u5B58\u5728\u6570\u636E\u4F9D\u8D56\u5173\u7CFB\uFF0C\u8FD9\u4E9B\u64CD\u4F5C\u5C31\u53EF\u80FD\u88AB\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u91CD\u6392\u5E8F\u3002\u4E3A\u4E86\u5177\u4F53\u8BF4\u660E\uFF0C\u8BF7\u770B\u4E0B\u9762\u8BA1\u7B97\u5706\u9762\u79EF\u7684\u4EE3\u7801\u793A\u4F8B\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">double</span> pi <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span> 			<span class="token comment">// A  </span>
<span class="token keyword">double</span> r <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span> 			<span class="token comment">// B  </span>
<span class="token keyword">double</span> area <span class="token operator">=</span> pi <span class="token operator">*</span> r <span class="token operator">*</span> r<span class="token punctuation">;</span>	<span class="token comment">// C</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762 3 \u4E2A\u64CD\u4F5C\u7684\u6570\u636E\u4F9D\u8D56\u5173\u7CFB\u5982\u56FE3-6 \u6240\u793A\u3002</p><p><img src="`+k+'" alt="\u56FE3-6" loading="lazy"></p><p>\u56FE3-6 3 \u4E2A\u64CD\u4F5C\u4E4B\u95F4\u7684\u4F9D\u8D56\u5173\u7CFB</p><p>\u5982\u56FE3-6 \u6240\u793A\uFF0CA \u548C C \u4E4B\u95F4\u5B58\u5728\u6570\u636E\u4F9D\u8D56\u5173\u7CFB\uFF0C\u540C\u65F6 B \u548C C \u4E4B\u95F4\u4E5F\u5B58\u5728\u6570\u636E\u4F9D\u8D56\u5173\u7CFB\u3002\u56E0\u6B64\u5728\u6700\u7EC8\u6267\u884C\u7684\u6307\u4EE4\u5E8F\u5217\u4E2D\uFF0CC \u4E0D\u80FD\u88AB\u91CD\u6392\u5E8F\u5230 A \u548C B \u7684\u524D\u9762\uFF08C \u6392\u5230 A \u548C B \u7684\u524D\u9762\uFF0C\u7A0B\u5E8F\u7684\u7ED3\u679C\u5C06\u4F1A\u88AB\u6539\u53D8\uFF09\u3002\u4F46 A \u548C B \u4E4B\u95F4\u6CA1\u6709\u6570\u636E\u4F9D\u8D56\u5173\u7CFB\uFF0C\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u53EF\u4EE5\u91CD\u6392\u5E8F A \u548C B \u4E4B\u95F4\u7684\u6267\u884C\u987A\u5E8F\u3002\u56FE3-7 \u662F\u8BE5\u7A0B\u5E8F\u7684\u4E24\u79CD\u6267\u884C\u987A\u5E8F\u3002</p><p><img src="'+v+`" alt="\u56FE3-7" loading="lazy"></p><p>\u56FE3-7 \u7A0B\u5E8F\u7684\u4E24\u79CD\u6267\u884C\u987A\u5E8F</p><p>as-if-serial \u8BED\u4E49\u628A\u5355\u7EBF\u7A0B\u7A0B\u5E8F\u4FDD\u62A4\u4E86\u8D77\u6765\uFF0C\u9075\u5B88 as-if-serial \u8BED\u4E49\u7684\u7F16\u8BD1\u5668\u3001runtime \u548C\u5904\u7406\u5668\u5171\u540C\u4E3A\u7F16\u5199\u5355\u7EBF\u7A0B\u7A0B\u5E8F\u7684\u7A0B\u5E8F\u5458\u521B\u5EFA\u4E86\u4E00\u4E2A\u5E7B\u89C9\uFF1A\u5355\u7EBF\u7A0B\u7A0B\u5E8F\u662F\u6309\u7A0B\u5E8F\u7684\u987A\u5E8F\u6765\u6267\u884C\u7684\u3002as- if-serial \u8BED\u4E49\u4F7F\u5355\u7EBF\u7A0B\u7A0B\u5E8F\u5458\u65E0\u9700\u62C5\u5FC3\u91CD\u6392\u5E8F\u4F1A\u5E72\u6270\u4ED6\u4EEC\uFF0C\u4E5F\u65E0\u9700\u62C5\u5FC3\u5185\u5B58\u53EF\u89C1\u6027\u95EE\u9898\u3002</p><h3 id="_3-2-3-\u7A0B\u5E8F\u987A\u5E8F\u89C4\u5219" tabindex="-1"><a class="header-anchor" href="#_3-2-3-\u7A0B\u5E8F\u987A\u5E8F\u89C4\u5219" aria-hidden="true">#</a> 3.2.3 \u7A0B\u5E8F\u987A\u5E8F\u89C4\u5219</h3><p>\u6839\u636E happens-before \u7684\u7A0B\u5E8F\u987A\u5E8F\u89C4\u5219\uFF0C\u4E0A\u9762\u8BA1\u7B97\u5706\u7684\u9762\u79EF\u7684\u793A\u4F8B\u4EE3\u7801\u5B58\u5728 3 \u4E2A happens-before \u5173\u7CFB\u3002</p><ol><li><p>A happens-before B\u3002</p></li><li><p>B happens-before C\u3002</p></li><li><p>A happens-before C\u3002</p></li></ol><p>\u8FD9\u91CC\u7684\u7B2C 3 \u4E2A happens-before \u5173\u7CFB\uFF0C\u662F\u6839\u636E happens-before \u7684\u4F20\u9012\u6027\u63A8\u5BFC\u51FA\u6765\u7684\u3002</p><p>\u8FD9\u91CC A happens-before B\uFF0C\u4F46\u5B9E\u9645\u6267\u884C\u65F6 B \u5374\u53EF\u4EE5\u6392\u5728 A \u4E4B\u524D\u6267\u884C\uFF08\u770B\u4E0A\u9762\u7684\u91CD\u6392\u5E8F\u540E\u7684\u6267\u884C\u987A\u5E8F\uFF09\u3002\u5982\u679C A happens-before B\uFF0CJMM \u5E76\u4E0D\u8981\u6C42 A \u4E00\u5B9A\u8981\u5728 B \u4E4B\u524D\u6267\u884C\u3002JMM \u4EC5\u4EC5\u8981\u6C42\u524D\u4E00\u4E2A\u64CD\u4F5C\uFF08\u6267\u884C\u7684\u7ED3\u679C\uFF09\u5BF9\u540E\u4E00\u4E2A\u64CD\u4F5C\u53EF\u89C1\uFF0C\u4E14\u524D\u4E00\u4E2A\u64CD\u4F5C\u6309\u987A\u5E8F\u6392\u5728\u7B2C\u4E8C\u4E2A\u64CD\u4F5C\u4E4B\u524D\u3002\u8FD9\u91CC\u64CD\u4F5C A \u7684\u6267\u884C\u7ED3\u679C\u4E0D\u9700\u8981\u5BF9\u64CD\u4F5C B \u53EF\u89C1\uFF1B\u800C\u4E14\u91CD\u6392\u5E8F\u64CD\u4F5C A \u548C\u64CD\u4F5C B \u540E\u7684\u6267\u884C\u7ED3\u679C\uFF0C\u4E0E\u64CD\u4F5C A \u548C\u64CD\u4F5C B \u6309 happens-before \u987A\u5E8F\u6267\u884C\u7684\u7ED3\u679C\u4E00\u81F4\u3002\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0CJMM \u4F1A\u8BA4\u4E3A\u8FD9\u79CD\u91CD\u6392\u5E8F\u5E76\u4E0D\u975E\u6CD5\uFF08not illegal\uFF09\uFF0CJMM \u5141\u8BB8\u8FD9\u79CD\u91CD\u6392\u5E8F\u3002</p><p>\u5728\u8BA1\u7B97\u673A\u4E2D\uFF0C\u8F6F\u4EF6\u6280\u672F\u548C\u786C\u4EF6\u6280\u672F\u6709\u4E00\u4E2A\u5171\u540C\u7684\u76EE\u6807\uFF1A\u5728\u4E0D\u6539\u53D8\u7A0B\u5E8F\u6267\u884C\u7ED3\u679C\u7684\u524D\u63D0\u4E0B\uFF0C\u5C3D\u53EF\u80FD\u63D0\u9AD8\u5E76\u884C\u5EA6\u3002\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u9075\u4ECE\u8FD9\u4E00\u76EE\u6807\uFF0C\u4ECE happens-before \u7684\u5B9A\u4E49\u6211\u4EEC\u53EF\u4EE5\u770B\u51FA\uFF0CJMM \u540C\u6837\u9075\u4ECE\u8FD9\u4E00\u76EE\u6807\u3002</p><h3 id="_3-2-4-\u91CD\u6392\u5E8F\u5BF9\u591A\u7EBF\u7A0B\u7684\u5F71\u54CD" tabindex="-1"><a class="header-anchor" href="#_3-2-4-\u91CD\u6392\u5E8F\u5BF9\u591A\u7EBF\u7A0B\u7684\u5F71\u54CD" aria-hidden="true">#</a> 3.2.4 \u91CD\u6392\u5E8F\u5BF9\u591A\u7EBF\u7A0B\u7684\u5F71\u54CD</h3><p>\u73B0\u5728\u8BA9\u6211\u4EEC\u6765\u770B\u770B\uFF0C\u91CD\u6392\u5E8F\u662F\u5426\u4F1A\u6539\u53D8\u591A\u7EBF\u7A0B\u7A0B\u5E8F\u7684\u6267\u884C\u7ED3\u679C\u3002\u8BF7\u770B\u4E0B\u9762\u7684\u793A\u4F8B\u4EE3\u7801\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">ReorderExample</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>          		<span class="token comment">//1</span>
        flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>       		<span class="token comment">//2</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Public</span> <span class="token keyword">void</span> <span class="token function">reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>      		<span class="token comment">//3</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> a <span class="token operator">*</span> a<span class="token punctuation">;</span>   	<span class="token comment">//4</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>flag \u53D8\u91CF\u662F\u4E2A\u6807\u8BB0\uFF0C\u7528\u6765\u6807\u8BC6\u53D8\u91CF a \u662F\u5426\u5DF2\u88AB\u5199\u5165\u3002\u8FD9\u91CC\u5047\u8BBE\u6709\u4E24\u4E2A\u7EBF\u7A0B A \u548C B\uFF0CA \u9996\u5148\u6267\u884C writer() \u65B9\u6CD5\uFF0C\u968F\u540E B \u7EBF\u7A0B\u63A5\u7740\u6267\u884C reader() \u65B9\u6CD5\u3002\u7EBF\u7A0B B \u5728\u6267\u884C\u64CD\u4F5C 4 \u65F6\uFF0C\u80FD\u5426\u770B\u5230\u7EBF\u7A0B A \u5728\u64CD\u4F5C 1 \u5BF9\u5171\u4EAB\u53D8\u91CF a \u7684\u5199\u5165\u5462\uFF1F</p><p>\u7B54\u6848\u662F\uFF1A\u4E0D\u4E00\u5B9A\u80FD\u770B\u5230\u3002</p><p>\u7531\u4E8E\u64CD\u4F5C 1 \u548C\u64CD\u4F5C 2 \u6CA1\u6709\u6570\u636E\u4F9D\u8D56\u5173\u7CFB\uFF0C\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u53EF\u4EE5\u5BF9\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u91CD\u6392\u5E8F\uFF1B\u540C\u6837\uFF0C\u64CD\u4F5C 3 \u548C\u64CD\u4F5C 4 \u6CA1\u6709\u6570\u636E\u4F9D\u8D56\u5173\u7CFB\uFF0C\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u4E5F\u53EF\u4EE5\u5BF9\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u91CD\u6392\u5E8F\u3002\u8BA9\u6211\u4EEC\u5148\u6765\u770B\u770B\uFF0C\u5F53\u64CD\u4F5C 1 \u548C\u64CD\u4F5C 2 \u91CD\u6392\u5E8F\u65F6\uFF0C\u53EF\u80FD\u4F1A\u4EA7\u751F\u4EC0\u4E48\u6548\u679C\uFF1F\u8BF7\u770B\u4E0B\u9762\u7684\u7A0B\u5E8F\u6267\u884C\u65F6\u5E8F\u56FE\uFF0C\u5982\u56FE3-8 \u6240\u793A\u3002</p><p><img src="`+m+'" alt="\u56FE3-8" loading="lazy"></p><p>\u56FE3-8 \u7A0B\u5E8F\u6267\u884C\u65F6\u5E8F\u56FE</p><p>\u5982\u56FE3-8 \u6240\u793A\uFF0C\u64CD\u4F5C 1 \u548C\u64CD\u4F5C 2 \u505A\u4E86\u91CD\u6392\u5E8F\u3002\u7A0B\u5E8F\u6267\u884C\u65F6\uFF0C\u7EBF\u7A0B A \u9996\u5148\u5199\u6807\u8BB0\u53D8\u91CF flag\uFF0C\u968F\u540E\u7EBF\u7A0B B \u8BFB\u8FD9\u4E2A\u53D8\u91CF\u3002\u7531\u4E8E\u6761\u4EF6\u5224\u65AD\u4E3A\u771F\uFF0C\u7EBF\u7A0B B \u5C06\u8BFB\u53D6\u53D8\u91CF a\u3002\u6B64\u65F6\uFF0C\u53D8\u91CF a \u8FD8\u6CA1\u6709\u88AB\u7EBF\u7A0B A \u5199\u5165\uFF0C\u5728\u8FD9\u91CC\u591A\u7EBF\u7A0B\u7A0B\u5E8F\u7684\u8BED\u4E49\u88AB\u91CD\u6392\u5E8F\u7834\u574F\u4E86\uFF01</p><p><strong>\u6CE8\u610F</strong>\uFF1A\u672C\u6587\u7EDF\u4E00\u7528\u865A\u7BAD\u7EBF\u6807\u8BC6\u9519\u8BEF\u7684\u8BFB\u64CD\u4F5C\uFF0C\u7528\u5B9E\u7BAD\u7EBF\u6807\u8BC6\u6B63\u786E\u7684\u8BFB\u64CD\u4F5C\u3002</p><p>\u4E0B\u9762\u518D\u8BA9\u6211\u4EEC\u770B\u770B\uFF0C\u5F53\u64CD\u4F5C 3 \u548C\u64CD\u4F5C 4 \u91CD\u6392\u5E8F\u65F6\u4F1A\u4EA7\u751F\u4EC0\u4E48\u6548\u679C\uFF08\u501F\u52A9\u8FD9\u4E2A\u91CD\u6392\u5E8F\uFF0C\u53EF\u4EE5\u987A\u4FBF\u8BF4\u660E\u63A7\u5236\u4F9D\u8D56\u6027\uFF09\u3002\u4E0B\u9762\u662F\u64CD\u4F5C 3 \u548C\u64CD\u4F5C 4 \u91CD\u6392\u5E8F\u540E\uFF0C\u7A0B\u5E8F\u6267\u884C\u7684\u65F6\u5E8F\u56FE\uFF0C\u5982\u56FE3-9 \u6240\u793A\u3002</p><p><img src="'+b+'" alt="\u56FE3-9" loading="lazy"></p><p>\u56FE3-9 \u7A0B\u5E8F\u7684\u6267\u884C\u65F6\u5E8F\u56FE</p><p>\u5728\u7A0B\u5E8F\u4E2D\uFF0C\u64CD\u4F5C 3 \u548C\u64CD\u4F5C 4 \u5B58\u5728\u63A7\u5236\u4F9D\u8D56\u5173\u7CFB\u3002\u5F53\u4EE3\u7801\u4E2D\u5B58\u5728\u63A7\u5236\u4F9D\u8D56\u6027\u65F6\uFF0C\u4F1A\u5F71\u54CD\u6307\u4EE4\u5E8F\u5217\u6267\u884C\u7684\u5E76\u884C\u5EA6\u3002\u4E3A\u6B64\uFF0C\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u4F1A\u91C7\u7528\u731C\u6D4B\uFF08Speculation\uFF09\u6267\u884C\u6765\u514B\u670D\u63A7\u5236\u76F8\u5173\u6027\u5BF9\u5E76\u884C\u5EA6\u7684\u5F71\u54CD\u3002\u4EE5\u5904\u7406\u5668\u7684\u731C\u6D4B\u6267\u884C\u4E3A\u4F8B\uFF0C\u6267\u884C\u7EBF\u7A0B B \u7684\u5904\u7406\u5668\u53EF\u4EE5\u63D0\u524D\u8BFB\u53D6\u5E76\u8BA1\u7B97 a * a\uFF0C\u7136\u540E\u628A\u8BA1\u7B97\u7ED3\u679C\u4E34\u65F6\u4FDD\u5B58\u5230\u4E00\u4E2A\u540D\u4E3A\u91CD\u6392\u5E8F\u7F13\u51B2\uFF08Reorder Buffer\uFF0CROB\uFF09\u7684\u786C\u4EF6\u7F13\u5B58\u4E2D\u3002\u5F53\u64CD\u4F5C 3 \u7684\u6761\u4EF6\u5224\u65AD\u4E3A\u771F\u65F6\uFF0C\u5C31\u628A\u8BE5\u8BA1\u7B97\u7ED3\u679C\u5199\u5165\u53D8\u91CFi\u4E2D\u3002</p><p>\u4ECE\u56FE3-9 \u4E2D\u6211\u4EEC\u53EF\u4EE5\u770B\u51FA\uFF0C\u731C\u6D4B\u6267\u884C\u5B9E\u8D28\u4E0A\u5BF9\u64CD\u4F5C 3 \u548C 4 \u505A\u4E86\u91CD\u6392\u5E8F\u3002\u91CD\u6392\u5E8F\u5728\u8FD9\u91CC\u7834\u574F\u4E86\u591A\u7EBF\u7A0B\u7A0B\u5E8F\u7684\u8BED\u4E49\uFF01</p><p>\u5728\u5355\u7EBF\u7A0B\u7A0B\u5E8F\u4E2D\uFF0C\u5BF9\u5B58\u5728\u63A7\u5236\u4F9D\u8D56\u7684\u64CD\u4F5C\u91CD\u6392\u5E8F\uFF0C\u4E0D\u4F1A\u6539\u53D8\u6267\u884C\u7ED3\u679C\uFF08\u8FD9\u4E5F\u662F as-if-serial \u8BED\u4E49\u5141\u8BB8\u5BF9\u5B58\u5728\u63A7\u5236\u4F9D\u8D56\u7684\u64CD\u4F5C\u505A\u91CD\u6392\u5E8F\u7684\u539F\u56E0\uFF09\uFF1B\u4F46\u5728\u591A\u7EBF\u7A0B\u7A0B\u5E8F\u4E2D\uFF0C\u5BF9\u5B58\u5728\u63A7\u5236\u4F9D\u8D56\u7684\u64CD\u4F5C\u91CD\u6392\u5E8F\uFF0C\u53EF\u80FD\u4F1A\u6539\u53D8\u7A0B\u5E8F\u7684\u6267\u884C\u7ED3\u679C\u3002</p><h2 id="_3-3-\u987A\u5E8F\u4E00\u81F4\u6027" tabindex="-1"><a class="header-anchor" href="#_3-3-\u987A\u5E8F\u4E00\u81F4\u6027" aria-hidden="true">#</a> 3.3 \u987A\u5E8F\u4E00\u81F4\u6027</h2><p>\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B\u662F\u4E00\u4E2A\u7406\u8BBA\u53C2\u8003\u6A21\u578B\uFF0C\u5728\u8BBE\u8BA1\u7684\u65F6\u5019\uFF0C\u5904\u7406\u5668\u7684\u5185\u5B58\u6A21\u578B\u548C\u7F16\u7A0B\u8BED\u8A00\u7684\u5185\u5B58\u6A21\u578B\u90FD\u4F1A\u4EE5\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B\u4F5C\u4E3A\u53C2\u7167\u3002</p><h3 id="_3-3-1-\u6570\u636E\u7ADE\u4E89\u4E0E\u987A\u5E8F\u4E00\u81F4\u6027" tabindex="-1"><a class="header-anchor" href="#_3-3-1-\u6570\u636E\u7ADE\u4E89\u4E0E\u987A\u5E8F\u4E00\u81F4\u6027" aria-hidden="true">#</a> 3.3.1 \u6570\u636E\u7ADE\u4E89\u4E0E\u987A\u5E8F\u4E00\u81F4\u6027</h3><p>\u5F53\u7A0B\u5E8F\u672A\u6B63\u786E\u540C\u6B65\u65F6\uFF0C\u5C31\u53EF\u80FD\u4F1A\u5B58\u5728\u6570\u636E\u7ADE\u4E89\u3002Java \u5185\u5B58\u6A21\u578B\u89C4\u8303\u5BF9\u6570\u636E\u7ADE\u4E89\u7684\u5B9A\u4E49\u5982\u4E0B\u3002</p><p>\u5728\u4E00\u4E2A\u7EBF\u7A0B\u4E2D\u5199\u4E00\u4E2A\u53D8\u91CF\uFF0C</p><p>\u5728\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u8BFB\u540C\u4E00\u4E2A\u53D8\u91CF\uFF0C</p><p>\u800C\u4E14\u5199\u548C\u8BFB\u6CA1\u6709\u901A\u8FC7\u540C\u6B65\u6765\u6392\u5E8F\u3002</p><p>\u5F53\u4EE3\u7801\u4E2D\u5305\u542B\u6570\u636E\u7ADE\u4E89\u65F6\uFF0C\u7A0B\u5E8F\u7684\u6267\u884C\u5F80\u5F80\u4EA7\u751F\u8FDD\u53CD\u76F4\u89C9\u7684\u7ED3\u679C\uFF08\u524D\u4E00\u7AE0\u7684\u793A\u4F8B\u6B63\u662F\u5982\u6B64\uFF09\u3002\u5982\u679C\u4E00\u4E2A\u591A\u7EBF\u7A0B\u7A0B\u5E8F\u80FD\u6B63\u786E\u540C\u6B65\uFF0C\u8FD9\u4E2A\u7A0B\u5E8F\u5C06\u662F\u4E00\u4E2A\u6CA1\u6709\u6570\u636E\u7ADE\u4E89\u7684\u7A0B\u5E8F\u3002</p><p>JMM \u5BF9\u6B63\u786E\u540C\u6B65\u7684\u591A\u7EBF\u7A0B\u7A0B\u5E8F\u7684\u5185\u5B58\u4E00\u81F4\u6027\u505A\u4E86\u5982\u4E0B\u4FDD\u8BC1\u3002</p><p>\u5982\u679C\u7A0B\u5E8F\u662F\u6B63\u786E\u540C\u6B65\u7684\uFF0C\u7A0B\u5E8F\u7684\u6267\u884C\u5C06\u5177\u6709\u987A\u5E8F\u4E00\u81F4\u6027\uFF08Sequentially Consistent\uFF09\u2014\u2014\u5373\u7A0B\u5E8F\u7684\u6267\u884C\u7ED3\u679C\u4E0E\u8BE5\u7A0B\u5E8F\u5728\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B\u4E2D\u7684\u6267\u884C\u7ED3\u679C\u76F8\u540C\u3002\u9A6C\u4E0A\u6211\u4EEC\u5C31\u4F1A\u770B\u5230\uFF0C\u8FD9\u5BF9\u4E8E\u7A0B\u5E8F\u5458\u6765\u8BF4\u662F\u4E00\u4E2A\u6781\u5F3A\u7684\u4FDD\u8BC1\u3002\u8FD9\u91CC\u7684\u540C\u6B65\u662F\u6307\u5E7F\u4E49\u4E0A\u7684\u540C\u6B65\uFF0C\u5305\u62EC\u5BF9\u5E38\u7528\u540C\u6B65\u539F\u8BED\uFF08synchronized\u3001volatile \u548C final\uFF09\u7684\u6B63\u786E\u4F7F\u7528\u3002</p><h3 id="_3-3-2-\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B" tabindex="-1"><a class="header-anchor" href="#_3-3-2-\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B" aria-hidden="true">#</a> 3.3.2 \u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B</h3><p>\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B\u662F\u4E00\u4E2A\u88AB\u8BA1\u7B97\u673A\u79D1\u5B66\u5BB6\u7406\u60F3\u5316\u4E86\u7684\u7406\u8BBA\u53C2\u8003\u6A21\u578B\uFF0C\u5B83\u4E3A\u7A0B\u5E8F\u5458\u63D0\u4F9B\u4E86\u6781\u5F3A\u7684\u5185\u5B58\u53EF\u89C1\u6027\u4FDD\u8BC1\u3002\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B\u6709\u4E24\u5927\u7279\u6027\u3002</p><ol><li><p>\u4E00\u4E2A\u7EBF\u7A0B\u4E2D\u7684\u6240\u6709\u64CD\u4F5C\u5FC5\u987B\u6309\u7167\u7A0B\u5E8F\u7684\u987A\u5E8F\u6765\u6267\u884C\u3002</p></li><li><p>\uFF08\u4E0D\u7BA1\u7A0B\u5E8F\u662F\u5426\u540C\u6B65\uFF09\u6240\u6709\u7EBF\u7A0B\u90FD\u53EA\u80FD\u770B\u5230\u4E00\u4E2A\u5355\u4E00\u7684\u64CD\u4F5C\u6267\u884C\u987A\u5E8F\u3002\u5728\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B\u4E2D\uFF0C\u6BCF\u4E2A\u64CD\u4F5C\u90FD\u5FC5\u987B\u539F\u5B50\u6267\u884C\u4E14\u7ACB\u523B\u5BF9\u6240\u6709\u7EBF\u7A0B\u53EF\u89C1\u3002</p></li></ol><p>\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B\u4E3A\u7A0B\u5E8F\u5458\u63D0\u4F9B\u7684\u89C6\u56FE\u5982\u56FE3-10\u6240\u793A\u3002</p><p><img src="'+h+'" alt="\u56FE3-10" loading="lazy"></p><p>\u56FE3-10 \u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B\u7684\u89C6\u56FE</p><p>\u5728\u6982\u5FF5\u4E0A\uFF0C\u987A\u5E8F\u4E00\u81F4\u6027\u6A21\u578B\u6709\u4E00\u4E2A\u5355\u4E00\u7684\u5168\u5C40\u5185\u5B58\uFF0C\u8FD9\u4E2A\u5185\u5B58\u901A\u8FC7\u4E00\u4E2A\u5DE6\u53F3\u6446\u52A8\u7684\u5F00\u5173\u53EF\u4EE5\u8FDE\u63A5\u5230\u4EFB\u610F\u4E00\u4E2A\u7EBF\u7A0B\uFF0C\u540C\u65F6\u6BCF\u4E00\u4E2A\u7EBF\u7A0B\u5FC5\u987B\u6309\u7167\u7A0B\u5E8F\u7684\u987A\u5E8F\u6765\u6267\u884C\u5185\u5B58\u8BFB / \u5199\u64CD\u4F5C\u3002\u4ECE\u4E0A\u9762\u7684\u793A\u610F\u56FE\u53EF\u4EE5\u770B\u51FA\uFF0C\u5728\u4EFB\u610F\u65F6\u95F4\u70B9\u6700\u591A\u53EA\u80FD\u6709\u4E00\u4E2A\u7EBF\u7A0B\u53EF\u4EE5\u8FDE\u63A5\u5230\u5185\u5B58\u3002\u5F53\u591A\u4E2A\u7EBF\u7A0B\u5E76\u53D1\u6267\u884C\u65F6\uFF0C\u56FE\u4E2D\u7684\u5F00\u5173\u88C5\u7F6E\u80FD\u628A\u6240\u6709\u7EBF\u7A0B\u7684\u6240\u6709\u5185\u5B58\u8BFB / \u5199\u64CD\u4F5C\u4E32\u884C\u5316\uFF08\u5373\u5728\u987A\u5E8F\u4E00\u81F4\u6027\u6A21\u578B\u4E2D\uFF0C\u6240\u6709\u64CD\u4F5C\u4E4B\u95F4\u5177\u6709\u5168\u5E8F\u5173\u7CFB\uFF09\u3002</p><p>\u4E3A\u4E86\u66F4\u597D\u8FDB\u884C\u7406\u89E3\uFF0C\u4E0B\u9762\u901A\u8FC7\u4E24\u4E2A\u793A\u610F\u56FE\u6765\u5BF9\u987A\u5E8F\u4E00\u81F4\u6027\u6A21\u578B\u7684\u7279\u6027\u505A\u8FDB\u4E00\u6B65\u7684\u8BF4\u660E\u3002</p><p>\u5047\u8BBE\u6709\u4E24\u4E2A\u7EBF\u7A0B A \u548C B \u5E76\u53D1\u6267\u884C\u3002\u5176\u4E2D A \u7EBF\u7A0B\u6709 3 \u4E2A\u64CD\u4F5C\uFF0C\u5B83\u4EEC\u5728\u7A0B\u5E8F\u4E2D\u7684\u987A\u5E8F\u662F\uFF1AA1 -&gt; A2 -&gt; A3\u3002B \u7EBF\u7A0B\u4E5F\u6709 3 \u4E2A\u64CD\u4F5C\uFF0C\u5B83\u4EEC\u5728\u7A0B\u5E8F\u4E2D\u7684\u987A\u5E8F\u662F\uFF1AB1 -&gt; B2 -&gt; B3\u3002</p><p>\u5047\u8BBE\u8FD9\u4E24\u4E2A\u7EBF\u7A0B\u4F7F\u7528\u76D1\u89C6\u5668\u9501\u6765\u6B63\u786E\u540C\u6B65\uFF1AA \u7EBF\u7A0B\u7684 3 \u4E2A\u64CD\u4F5C\u6267\u884C\u540E\u91CA\u653E\u76D1\u89C6\u5668\u9501\uFF0C\u968F\u540E B \u7EBF\u7A0B\u83B7\u53D6\u540C\u4E00\u4E2A\u76D1\u89C6\u5668\u9501\u3002\u90A3\u4E48\u7A0B\u5E8F\u5728\u987A\u5E8F\u4E00\u81F4\u6027\u6A21\u578B\u4E2D\u7684\u6267\u884C\u6548\u679C\u5C06\u5982\u56FE3-11 \u6240\u793A\u3002</p><p><img src="'+f+'" alt="\u56FE3-11" loading="lazy"></p><p>\u56FE3-11 \u987A\u5E8F\u4E00\u81F4\u6027\u6A21\u578B\u7684\u4E00\u79CD\u6267\u884C\u6548\u679C</p><p>\u73B0\u5728\u6211\u4EEC\u518D\u5047\u8BBE\u8FD9\u4E24\u4E2A\u7EBF\u7A0B\u6CA1\u6709\u505A\u540C\u6B65\uFF0C\u4E0B\u9762\u662F\u8FD9\u4E2A\u672A\u540C\u6B65\u7A0B\u5E8F\u5728\u987A\u5E8F\u4E00\u81F4\u6027\u6A21\u578B\u4E2D\u7684\u6267\u884C\u793A\u610F\u56FE\uFF0C\u5982\u56FE3-12 \u6240\u793A\u3002</p><p><img src="'+g+`" alt="\u56FE3-12" loading="lazy"></p><p>\u56FE3-12 \u987A\u5E8F\u4E00\u81F4\u6027\u6A21\u578B\u4E2D\u7684\u53E6\u4E00\u79CD\u6267\u884C\u6548\u679C</p><p>\u672A\u540C\u6B65\u7A0B\u5E8F\u5728\u987A\u5E8F\u4E00\u81F4\u6027\u6A21\u578B\u4E2D\u867D\u7136\u6574\u4F53\u6267\u884C\u987A\u5E8F\u662F\u65E0\u5E8F\u7684\uFF0C\u4F46\u6240\u6709\u7EBF\u7A0B\u90FD\u53EA\u80FD\u770B\u5230\u4E00\u4E2A\u4E00\u81F4\u7684\u6574\u4F53\u6267\u884C\u987A\u5E8F\u3002\u4EE5\u4E0A\u56FE\u4E3A\u4F8B\uFF0C\u7EBF\u7A0B A \u548C B \u770B\u5230\u7684\u6267\u884C\u987A\u5E8F\u90FD\u662F\uFF1AB1 -&gt; A1 -&gt; A2 -&gt; B2 -&gt; A3 -&gt; B3\u3002\u4E4B\u6240\u4EE5\u80FD\u5F97\u5230\u8FD9\u4E2A\u4FDD\u8BC1\u662F\u56E0\u4E3A\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B\u4E2D\u7684\u6BCF\u4E2A\u64CD\u4F5C\u5FC5\u987B\u7ACB\u5373\u5BF9\u4EFB\u610F\u7EBF\u7A0B\u53EF\u89C1\u3002</p><p>\u4F46\u662F\uFF0C\u5728 JMM \u4E2D\u5C31\u6CA1\u6709\u8FD9\u4E2A\u4FDD\u8BC1\u3002\u672A\u540C\u6B65\u7A0B\u5E8F\u5728 JMM \u4E2D\u4E0D\u4F46\u6574\u4F53\u7684\u6267\u884C\u987A\u5E8F\u662F\u65E0\u5E8F\u7684\uFF0C\u800C\u4E14\u6240\u6709\u7EBF\u7A0B\u770B\u5230\u7684\u64CD\u4F5C\u6267\u884C\u987A\u5E8F\u4E5F\u53EF\u80FD\u4E0D\u4E00\u81F4\u3002\u6BD4\u5982\uFF0C\u5728\u5F53\u524D\u7EBF\u7A0B\u628A\u5199\u8FC7\u7684\u6570\u636E\u7F13\u5B58\u5728\u672C\u5730\u5185\u5B58\u4E2D\uFF0C\u5728\u6CA1\u6709\u5237\u65B0\u5230\u4E3B\u5185\u5B58\u4E4B\u524D\uFF0C\u8FD9\u4E2A\u5199\u64CD\u4F5C\u4EC5\u5BF9\u5F53\u524D\u7EBF\u7A0B\u53EF\u89C1\uFF1B\u4ECE\u5176\u4ED6\u7EBF\u7A0B\u7684\u89D2\u5EA6\u6765\u89C2\u5BDF\uFF0C\u4F1A\u8BA4\u4E3A\u8FD9\u4E2A\u5199\u64CD\u4F5C\u6839\u672C\u6CA1\u6709\u88AB\u5F53\u524D\u7EBF\u7A0B\u6267\u884C\u3002\u53EA\u6709\u5F53\u524D\u7EBF\u7A0B\u628A\u672C\u5730\u5185\u5B58\u4E2D\u5199\u8FC7\u7684\u6570\u636E\u5237\u65B0\u5230\u4E3B\u5185\u5B58\u4E4B\u540E\uFF0C\u8FD9\u4E2A\u5199\u64CD\u4F5C\u624D\u80FD\u5BF9\u5176\u4ED6\u7EBF\u7A0B\u53EF\u89C1\u3002\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0C\u5F53\u524D\u7EBF\u7A0B\u548C\u5176\u4ED6\u7EBF\u7A0B\u770B\u5230\u7684\u64CD\u4F5C\u6267\u884C\u987A\u5E8F\u5C06\u4E0D\u4E00\u81F4\u3002</p><h3 id="_3-3-3-\u540C\u6B65\u7A0B\u5E8F\u7684\u987A\u5E8F\u4E00\u81F4\u6027\u6548\u679C" tabindex="-1"><a class="header-anchor" href="#_3-3-3-\u540C\u6B65\u7A0B\u5E8F\u7684\u987A\u5E8F\u4E00\u81F4\u6027\u6548\u679C" aria-hidden="true">#</a> 3.3.3 \u540C\u6B65\u7A0B\u5E8F\u7684\u987A\u5E8F\u4E00\u81F4\u6027\u6548\u679C</h3><p>\u4E0B\u9762\uFF0C\u5BF9\u524D\u9762\u7684\u793A\u4F8B\u7A0B\u5E8F ReorderExample \u7528\u9501\u6765\u540C\u6B65\uFF0C\u770B\u770B\u6B63\u786E\u540C\u6B65\u7684\u7A0B\u5E8F\u5982\u4F55\u5177\u6709\u987A\u5E8F\u4E00\u81F4\u6027\u3002</p><p>\u8BF7\u770B\u4E0B\u9762\u7684\u793A\u4F8B\u4EE3\u7801\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">SynchronizedExample</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    	<span class="token comment">//\u83B7\u53D6\u9501</span>
        a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>                     					<span class="token comment">//\u91CA\u653E\u9501</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    	<span class="token comment">//\u83B7\u53D6\u9501</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> a<span class="token punctuation">;</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>                   				<span class="token comment">//\u91CA\u653E\u9501</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u4E0A\u9762\u793A\u4F8B\u4EE3\u7801\u4E2D\uFF0C\u5047\u8BBE A \u7EBF\u7A0B\u6267\u884C writer() \u65B9\u6CD5\u540E\uFF0CB \u7EBF\u7A0B\u6267\u884C reader() \u65B9\u6CD5\u3002\u8FD9\u662F\u4E00\u4E2A\u6B63\u786E\u540C\u6B65\u7684\u591A\u7EBF\u7A0B\u7A0B\u5E8F\u3002\u6839\u636E JMM \u89C4\u8303\uFF0C\u8BE5\u7A0B\u5E8F\u7684\u6267\u884C\u7ED3\u679C\u5C06\u4E0E\u8BE5\u7A0B\u5E8F\u5728\u987A\u5E8F\u4E00\u81F4\u6027\u6A21\u578B\u4E2D\u7684\u6267\u884C\u7ED3\u679C\u76F8\u540C\u3002\u4E0B\u9762\u662F\u8BE5\u7A0B\u5E8F\u5728\u4E24\u4E2A\u5185\u5B58\u6A21\u578B\u4E2D\u7684\u6267\u884C\u65F6\u5E8F\u5BF9\u6BD4\u56FE\uFF0C\u5982\u56FE3-13 \u6240\u793A\u3002</p><p><img src="`+y+'" alt="\u56FE3-13" loading="lazy"></p><p>\u56FE3-13 \u4E24\u4E2A\u5185\u5B58\u6A21\u578B\u4E2D\u7684\u6267\u884C\u65F6\u5E8F\u5BF9\u6BD4\u56FE</p><p>\u987A\u5E8F\u4E00\u81F4\u6027\u6A21\u578B\u4E2D\uFF0C\u6240\u6709\u64CD\u4F5C\u5B8C\u5168\u6309\u7A0B\u5E8F\u7684\u987A\u5E8F\u4E32\u884C\u6267\u884C\u3002\u800C\u5728 JMM \u4E2D\uFF0C\u4E34\u754C\u533A\u5185\u7684\u4EE3\u7801\u53EF\u4EE5\u91CD\u6392\u5E8F\uFF08\u4F46 JMM \u4E0D\u5141\u8BB8\u4E34\u754C\u533A\u5185\u7684\u4EE3\u7801 \u201C\u9038\u51FA\u201D \u5230\u4E34\u754C\u533A\u4E4B\u5916\uFF0C\u90A3\u6837\u4F1A\u7834\u574F\u76D1\u89C6\u5668\u7684\u8BED\u4E49\uFF09\u3002JMM \u4F1A\u5728\u9000\u51FA\u4E34\u754C\u533A\u548C\u8FDB\u5165\u4E34\u754C\u533A\u8FD9\u4E24\u4E2A\u5173\u952E\u65F6\u95F4\u70B9\u505A\u4E00\u4E9B\u7279\u522B\u5904\u7406\uFF0C\u4F7F\u5F97\u7EBF\u7A0B\u5728\u8FD9\u4E24\u4E2A\u65F6\u95F4\u70B9\u5177\u6709\u4E0E\u987A\u5E8F\u4E00\u81F4\u6027\u6A21\u578B\u76F8\u540C\u7684\u5185\u5B58\u89C6\u56FE\uFF08\u5177\u4F53\u7EC6\u8282\u540E\u6587\u4F1A\u8BF4\u660E\uFF09\u3002\u867D\u7136\u7EBF\u7A0B A \u5728\u4E34\u754C\u533A\u5185\u505A\u4E86\u91CD\u6392\u5E8F\uFF0C\u4F46\u7531\u4E8E\u76D1\u89C6\u5668\u4E92\u65A5\u6267\u884C\u7684\u7279\u6027\uFF0C\u8FD9\u91CC\u7684\u7EBF\u7A0B B \u6839\u672C\u65E0\u6CD5 \u201C\u89C2\u5BDF\u201D \u5230\u7EBF\u7A0B A \u5728\u4E34\u754C\u533A\u5185\u7684\u91CD\u6392\u5E8F\u3002\u8FD9\u79CD\u91CD\u6392\u5E8F\u65E2\u63D0\u9AD8\u4E86\u6267\u884C\u6548\u7387\uFF0C\u53C8\u6CA1\u6709\u6539\u53D8\u7A0B\u5E8F\u7684\u6267\u884C\u7ED3\u679C\u3002</p><p>\u4ECE\u8FD9\u91CC\u6211\u4EEC\u53EF\u4EE5\u770B\u5230\uFF0CJMM \u5728\u5177\u4F53\u5B9E\u73B0\u4E0A\u7684\u57FA\u672C\u65B9\u9488\u4E3A\uFF1A\u5728\u4E0D\u6539\u53D8\uFF08\u6B63\u786E\u540C\u6B65\u7684\uFF09\u7A0B\u5E8F\u6267\u884C\u7ED3\u679C\u7684\u524D\u63D0\u4E0B\uFF0C\u5C3D\u53EF\u80FD\u5730\u4E3A\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u7684\u4F18\u5316\u6253\u5F00\u65B9\u4FBF\u4E4B\u95E8\u3002</p><h3 id="_3-3-4-\u672A\u540C\u6B65\u7A0B\u5E8F\u7684\u6267\u884C\u7279\u6027" tabindex="-1"><a class="header-anchor" href="#_3-3-4-\u672A\u540C\u6B65\u7A0B\u5E8F\u7684\u6267\u884C\u7279\u6027" aria-hidden="true">#</a> 3.3.4 \u672A\u540C\u6B65\u7A0B\u5E8F\u7684\u6267\u884C\u7279\u6027</h3><p>\u5BF9\u4E8E\u672A\u540C\u6B65\u6216\u672A\u6B63\u786E\u540C\u6B65\u7684\u591A\u7EBF\u7A0B\u7A0B\u5E8F\uFF0CJMM \u53EA\u63D0\u4F9B\u6700\u5C0F\u5B89\u5168\u6027\uFF1A\u7EBF\u7A0B\u6267\u884C\u65F6\u8BFB\u53D6\u5230\u7684\u503C\uFF0C\u8981\u4E48\u662F\u4E4B\u524D\u67D0\u4E2A\u7EBF\u7A0B\u5199\u5165\u7684\u503C\uFF0C\u8981\u4E48\u662F\u9ED8\u8BA4\u503C\uFF080\uFF0Cnull\uFF0Cfalse\uFF09\uFF0CJMM \u4FDD\u8BC1\u7EBF\u7A0B\u8BFB\u64CD\u4F5C\u8BFB\u53D6\u5230\u7684\u503C\u4E0D\u4F1A\u65E0\u4E2D\u751F\u6709\uFF08Out Of Thin Air\uFF09\u7684\u5192\u51FA\u6765\u3002\u4E3A\u4E86\u5B9E\u73B0\u6700\u5C0F\u5B89\u5168\u6027\uFF0CJVM \u5728\u5806\u4E0A\u5206\u914D\u5BF9\u8C61\u65F6\uFF0C\u9996\u5148\u4F1A\u5BF9\u5185\u5B58\u7A7A\u95F4\u8FDB\u884C\u6E05\u96F6\uFF0C\u7136\u540E\u624D\u4F1A\u5728\u4E0A\u9762\u5206\u914D\u5BF9\u8C61\uFF08JVM \u5185\u90E8\u4F1A\u540C\u6B65\u8FD9\u4E24\u4E2A\u64CD\u4F5C\uFF09\u3002\u56E0\u6B64\uFF0C\u5728\u5DF2\u6E05\u96F6\u7684\u5185\u5B58\u7A7A\u95F4\uFF08Pre-zeroed Memory\uFF09\u5206\u914D\u5BF9\u8C61\u65F6\uFF0C\u57DF\u7684\u9ED8\u8BA4\u521D\u59CB\u5316\u5DF2\u7ECF\u5B8C\u6210\u4E86\u3002</p><p>JMM \u4E0D\u4FDD\u8BC1\u672A\u540C\u6B65\u7A0B\u5E8F\u7684\u6267\u884C\u7ED3\u679C\u4E0E\u8BE5\u7A0B\u5E8F\u5728\u987A\u5E8F\u4E00\u81F4\u6027\u6A21\u578B\u4E2D\u7684\u6267\u884C\u7ED3\u679C\u4E00\u81F4\u3002\u56E0\u4E3A\u5982\u679C\u60F3\u8981\u4FDD\u8BC1\u6267\u884C\u7ED3\u679C\u4E00\u81F4\uFF0CJMM \u9700\u8981\u7981\u6B62\u5927\u91CF\u7684\u5904\u7406\u5668\u548C\u7F16\u8BD1\u5668\u7684\u4F18\u5316\uFF0C\u8FD9\u5BF9\u7A0B\u5E8F\u7684\u6267\u884C\u6027\u80FD\u4F1A\u4EA7\u751F\u5F88\u5927\u7684\u5F71\u54CD\u3002\u800C\u4E14\u672A\u540C\u6B65\u7A0B\u5E8F\u5728\u987A\u5E8F\u4E00\u81F4\u6027\u6A21\u578B\u4E2D\u6267\u884C\u65F6\uFF0C\u6574\u4F53\u662F\u65E0\u5E8F\u7684\uFF0C\u5176\u6267\u884C\u7ED3\u679C\u5F80\u5F80\u65E0\u6CD5\u9884\u77E5\u3002\u800C\u4E14\uFF0C\u4FDD\u8BC1\u672A\u540C\u6B65\u7A0B\u5E8F\u5728\u8FD9\u4E24\u4E2A\u6A21\u578B\u4E2D\u7684\u6267\u884C\u7ED3\u679C\u4E00\u81F4\u6CA1\u4EC0\u4E48\u610F\u4E49\u3002</p><p>\u672A\u540C\u6B65\u7A0B\u5E8F\u5728 JMM \u4E2D\u7684\u6267\u884C\u65F6\uFF0C\u6574\u4F53\u4E0A\u662F\u65E0\u5E8F\u7684\uFF0C\u5176\u6267\u884C\u7ED3\u679C\u65E0\u6CD5\u9884\u77E5\u3002\u672A\u540C\u6B65\u7A0B\u5E8F\u5728\u4E24\u4E2A\u6A21\u578B\u4E2D\u7684\u6267\u884C\u7279\u6027\u6709\u5982\u4E0B\u51E0\u4E2A\u5DEE\u5F02\u3002</p><ol><li><p>\u987A\u5E8F\u4E00\u81F4\u6027\u6A21\u578B\u4FDD\u8BC1\u5355\u7EBF\u7A0B\u5185\u7684\u64CD\u4F5C\u4F1A\u6309\u7A0B\u5E8F\u7684\u987A\u5E8F\u6267\u884C\uFF0C\u800C JMM \u4E0D\u4FDD\u8BC1\u5355\u7EBF\u7A0B\u5185\u7684\u64CD\u4F5C\u4F1A\u6309\u7A0B\u5E8F\u7684\u987A\u5E8F\u6267\u884C\uFF08\u6BD4\u5982\u4E0A\u9762\u6B63\u786E\u540C\u6B65\u7684\u591A\u7EBF\u7A0B\u7A0B\u5E8F\u5728\u4E34\u754C\u533A\u5185\u7684\u91CD\u6392\u5E8F\uFF09\u3002\u8FD9\u4E00\u70B9\u524D\u9762\u5DF2\u7ECF\u8BB2\u8FC7\u4E86\uFF0C\u8FD9\u91CC\u5C31\u4E0D\u518D\u8D58\u8FF0\u3002</p></li><li><p>\u987A\u5E8F\u4E00\u81F4\u6027\u6A21\u578B\u4FDD\u8BC1\u6240\u6709\u7EBF\u7A0B\u53EA\u80FD\u770B\u5230\u4E00\u81F4\u7684\u64CD\u4F5C\u6267\u884C\u987A\u5E8F\uFF0C\u800C JMM \u4E0D\u4FDD\u8BC1\u6240\u6709\u7EBF\u7A0B\u80FD\u770B\u5230\u4E00\u81F4\u7684\u64CD\u4F5C\u6267\u884C\u987A\u5E8F\u3002\u8FD9\u4E00\u70B9\u524D\u9762\u4E5F\u5DF2\u7ECF\u8BB2\u8FC7\uFF0C\u8FD9\u91CC\u5C31\u4E0D\u518D\u8D58\u8FF0\u3002</p></li><li><p>JMM \u4E0D\u4FDD\u8BC1\u5BF9 64 \u4F4D\u7684 long \u578B\u548C double \u578B\u53D8\u91CF\u7684\u5199\u64CD\u4F5C\u5177\u6709\u539F\u5B50\u6027\uFF0C\u800C\u987A\u5E8F\u4E00\u81F4\u6027\u6A21\u578B\u4FDD\u8BC1\u5BF9\u6240\u6709\u7684\u5185\u5B58\u8BFB / \u5199\u64CD\u4F5C\u90FD\u5177\u6709\u539F\u5B50\u6027\u3002</p></li></ol><p>\u7B2C 3 \u4E2A\u5DEE\u5F02\u4E0E\u5904\u7406\u5668\u603B\u7EBF\u7684\u5DE5\u4F5C\u673A\u5236\u5BC6\u5207\u76F8\u5173\u3002\u5728\u8BA1\u7B97\u673A\u4E2D\uFF0C\u6570\u636E\u901A\u8FC7\u603B\u7EBF\u5728\u5904\u7406\u5668\u548C\u5185\u5B58\u4E4B\u95F4\u4F20\u9012\u3002\u6BCF\u6B21\u5904\u7406\u5668\u548C\u5185\u5B58\u4E4B\u95F4\u7684\u6570\u636E\u4F20\u9012\u90FD\u662F\u901A\u8FC7\u4E00\u7CFB\u5217\u6B65\u9AA4\u6765\u5B8C\u6210\u7684\uFF0C\u8FD9\u4E00\u7CFB\u5217\u6B65\u9AA4\u79F0\u4E4B\u4E3A\u603B\u7EBF\u4E8B\u52A1\uFF08Bus Transaction\uFF09\u3002\u603B\u7EBF\u4E8B\u52A1\u5305\u62EC\u8BFB\u4E8B\u52A1\uFF08Read Transaction\uFF09\u548C\u5199\u4E8B\u52A1\uFF08Write Transaction\uFF09\u3002\u8BFB\u4E8B\u52A1\u4ECE\u5185\u5B58\u4F20\u9001\u6570\u636E\u5230\u5904\u7406\u5668\uFF0C\u5199\u4E8B\u52A1\u4ECE\u5904\u7406\u5668\u4F20\u9001\u6570\u636E\u5230\u5185\u5B58\uFF0C\u6BCF\u4E2A\u4E8B\u52A1\u4F1A\u8BFB / \u5199\u5185\u5B58\u4E2D\u4E00\u4E2A\u6216\u591A\u4E2A\u7269\u7406\u4E0A\u8FDE\u7EED\u7684\u5B57\u3002\u8FD9\u91CC\u7684\u5173\u952E\u662F\uFF0C\u603B\u7EBF\u4F1A\u540C\u6B65\u8BD5\u56FE\u5E76\u53D1\u4F7F\u7528\u603B\u7EBF\u7684\u4E8B\u52A1\u3002\u5728\u4E00\u4E2A\u5904\u7406\u5668\u6267\u884C\u603B\u7EBF\u4E8B\u52A1\u671F\u95F4\uFF0C\u603B\u7EBF\u4F1A\u7981\u6B62\u5176\u4ED6\u7684\u5904\u7406\u5668\u548C I/O \u8BBE\u5907\u6267\u884C\u5185\u5B58\u7684\u8BFB / \u5199\u3002\u4E0B\u9762\uFF0C\u8BA9\u6211\u4EEC\u901A\u8FC7\u4E00\u4E2A\u793A\u610F\u56FE\u6765\u8BF4\u660E\u603B\u7EBF\u7684\u5DE5\u4F5C\u673A\u5236\uFF0C\u5982\u56FE3-14 \u6240\u793A\u3002</p><p><img src="'+w+'" alt="\u56FE3-14" loading="lazy"></p><p>\u56FE3-14 \u603B\u7EBF\u7684\u5DE5\u4F5C\u673A\u5236</p><p>\u7531\u56FE\u53EF\u77E5\uFF0C\u5047\u8BBE\u5904\u7406\u5668 A\uFF0CB \u548C C \u540C\u65F6\u5411\u603B\u7EBF\u53D1\u8D77\u603B\u7EBF\u4E8B\u52A1\uFF0C\u8FD9\u65F6\u603B\u7EBF\u4EF2\u88C1\uFF08Bus Arbitration\uFF09\u4F1A\u5BF9\u7ADE\u4E89\u505A\u51FA\u88C1\u51B3\uFF0C\u8FD9\u91CC\u5047\u8BBE\u603B\u7EBF\u5728\u4EF2\u88C1\u540E\u5224\u5B9A\u5904\u7406\u5668 A \u5728\u7ADE\u4E89\u4E2D\u83B7\u80DC\uFF08\u603B\u7EBF\u4EF2\u88C1\u4F1A\u786E\u4FDD\u6240\u6709\u5904\u7406\u5668\u90FD\u80FD\u516C\u5E73\u7684\u8BBF\u95EE\u5185\u5B58\uFF09\u3002\u6B64\u65F6\u5904\u7406\u5668 A \u7EE7\u7EED\u5B83\u7684\u603B\u7EBF\u4E8B\u52A1\uFF0C\u800C\u5176\u4ED6\u4E24\u4E2A\u5904\u7406\u5668\u5219\u8981\u7B49\u5F85\u5904\u7406\u5668 A \u7684\u603B\u7EBF\u4E8B\u52A1\u5B8C\u6210\u540E\u624D\u80FD\u518D\u6B21\u6267\u884C\u5185\u5B58\u8BBF\u95EE\u3002\u5047\u8BBE\u5728\u5904\u7406\u5668 A \u6267\u884C\u603B\u7EBF\u4E8B\u52A1\u671F\u95F4\uFF08\u4E0D\u7BA1\u8FD9\u4E2A\u603B\u7EBF\u4E8B\u52A1\u662F\u8BFB\u4E8B\u52A1\u8FD8\u662F\u5199\u4E8B\u52A1\uFF09\uFF0C\u5904\u7406\u5668 D \u5411\u603B\u7EBF\u53D1\u8D77\u4E86\u603B\u7EBF\u4E8B\u52A1\uFF0C\u6B64\u65F6\u5904\u7406\u5668 D \u7684\u8BF7\u6C42\u4F1A\u88AB\u603B\u7EBF\u7981\u6B62\u3002</p><p>\u603B\u7EBF\u7684\u8FD9\u4E9B\u5DE5\u4F5C\u673A\u5236\u53EF\u4EE5\u628A\u6240\u6709\u5904\u7406\u5668\u5BF9\u5185\u5B58\u7684\u8BBF\u95EE\u4EE5\u4E32\u884C\u5316\u7684\u65B9\u5F0F\u6765\u6267\u884C\u3002\u5728\u4EFB\u610F\u65F6\u95F4\u70B9\uFF0C\u6700\u591A\u53EA\u80FD\u6709\u4E00\u4E2A\u5904\u7406\u5668\u53EF\u4EE5\u8BBF\u95EE\u5185\u5B58\u3002\u8FD9\u4E2A\u7279\u6027\u786E\u4FDD\u4E86\u5355\u4E2A\u603B\u7EBF\u4E8B\u52A1\u4E4B\u4E2D\u7684\u5185\u5B58\u8BFB / \u5199\u64CD\u4F5C\u5177\u6709\u539F\u5B50\u6027\u3002</p><p>\u5728\u4E00\u4E9B 32 \u4F4D\u7684\u5904\u7406\u5668\u4E0A\uFF0C\u5982\u679C\u8981\u6C42\u5BF9 64 \u4F4D\u6570\u636E\u7684\u5199\u64CD\u4F5C\u5177\u6709\u539F\u5B50\u6027\uFF0C\u4F1A\u6709\u6BD4\u8F83\u5927\u7684\u5F00\u9500\u3002\u4E3A\u4E86\u7167\u987E\u8FD9\u79CD\u5904\u7406\u5668\uFF0CJava \u8BED\u8A00\u89C4\u8303\u9F13\u52B1\u4F46\u4E0D\u5F3A\u6C42 JVM \u5BF9 64 \u4F4D\u7684 long \u578B\u53D8\u91CF\u548C double \u578B\u53D8\u91CF\u7684\u5199\u64CD\u4F5C\u5177\u6709\u539F\u5B50\u6027\u3002\u5F53 JVM \u5728\u8FD9\u79CD\u5904\u7406\u5668\u4E0A\u8FD0\u884C\u65F6\uFF0C\u53EF\u80FD\u4F1A\u628A\u4E00\u4E2A 64 \u4F4D long / double \u578B\u53D8\u91CF\u7684\u5199\u64CD\u4F5C\u62C6\u5206\u4E3A\u4E24\u4E2A 32 \u4F4D\u7684\u5199\u64CD\u4F5C\u6765\u6267\u884C\u3002\u8FD9\u4E24\u4E2A 32 \u4F4D\u7684\u5199\u64CD\u4F5C\u53EF\u80FD\u4F1A\u88AB\u5206\u914D\u5230\u4E0D\u540C\u7684\u603B\u7EBF\u4E8B\u52A1\u4E2D\u6267\u884C\uFF0C\u6B64\u65F6\u5BF9\u8FD9\u4E2A 64 \u4F4D\u53D8\u91CF\u7684\u5199\u64CD\u4F5C\u5C06\u4E0D\u5177\u6709\u539F\u5B50\u6027\u3002</p><p>\u5F53\u5355\u4E2A\u5185\u5B58\u64CD\u4F5C\u4E0D\u5177\u6709\u539F\u5B50\u6027\u65F6\uFF0C\u53EF\u80FD\u4F1A\u4EA7\u751F\u610F\u60F3\u4E0D\u5230\u540E\u679C\u3002\u8BF7\u770B\u793A\u610F\u56FE\uFF0C\u5982\u56FE3-15 \u6240\u793A\u3002</p><p><img src="'+_+`" alt="\u56FE3-15" loading="lazy"></p><p>\u56FE3-15 \u603B\u7EBF\u4E8B\u52A1\u6267\u884C\u7684\u65F6\u5E8F\u56FE</p><p>\u5982\u4E0A\u56FE\u6240\u793A\uFF0C\u5047\u8BBE\u5904\u7406\u5668 A \u5199\u4E00\u4E2A long \u578B\u53D8\u91CF\uFF0C\u540C\u65F6\u5904\u7406\u5668 B \u8981\u8BFB\u8FD9\u4E2A long \u578B\u53D8\u91CF\u3002\u5904\u7406\u5668 A \u4E2D 64 \u4F4D\u7684\u5199\u64CD\u4F5C\u88AB\u62C6\u5206\u4E3A\u4E24\u4E2A 32 \u4F4D\u7684\u5199\u64CD\u4F5C\uFF0C\u4E14\u8FD9\u4E24\u4E2A 32 \u4F4D\u7684\u5199\u64CD\u4F5C\u88AB\u5206\u914D\u5230\u4E0D\u540C\u7684\u5199\u4E8B\u52A1\u4E2D\u6267\u884C\u3002\u540C\u65F6\uFF0C\u5904\u7406\u5668 B \u4E2D 64 \u4F4D\u7684\u8BFB\u64CD\u4F5C\u88AB\u5206\u914D\u5230\u5355\u4E2A\u7684\u8BFB\u4E8B\u52A1\u4E2D\u6267\u884C\u3002\u5F53\u5904\u7406\u5668 A \u548C B \u6309\u4E0A\u56FE\u7684\u65F6\u5E8F\u6765\u6267\u884C\u65F6\uFF0C\u5904\u7406\u5668 B \u5C06\u770B\u5230\u4EC5\u4EC5\u88AB\u5904\u7406\u5668 A \u201C\u5199\u4E86\u4E00\u534A\u201D \u7684\u65E0\u6548\u503C\u3002</p><p>\u6CE8\u610F\uFF0C\u5728 JSR-133 \u4E4B\u524D\u7684\u65E7\u5185\u5B58\u6A21\u578B\u4E2D\uFF0C\u4E00\u4E2A 64 \u4F4Dlong / double \u578B\u53D8\u91CF\u7684\u8BFB / \u5199\u64CD\u4F5C\u53EF\u4EE5\u88AB\u62C6\u5206\u4E3A\u4E24\u4E2A 32 \u4F4D\u7684\u8BFB / \u5199\u64CD\u4F5C\u6765\u6267\u884C\u3002\u4ECE JSR-133 \u5185\u5B58\u6A21\u578B\u5F00\u59CB\uFF08\u5373\u4ECE JDK 5 \u5F00\u59CB\uFF09\uFF0C\u4EC5\u4EC5\u53EA\u5141\u8BB8\u628A\u4E00\u4E2A 64 \u4F4D long / double \u578B\u53D8\u91CF\u7684\u5199\u64CD\u4F5C\u62C6\u5206\u4E3A\u4E24\u4E2A 32 \u4F4D\u7684\u5199\u64CD\u4F5C\u6765\u6267\u884C\uFF0C\u4EFB\u610F\u7684\u8BFB\u64CD\u4F5C\u5728 JSR-133 \u4E2D\u90FD\u5FC5\u987B\u5177\u6709\u539F\u5B50\u6027\uFF08\u5373\u4EFB\u610F\u8BFB\u64CD\u4F5C\u5FC5\u987B\u8981\u5728\u5355\u4E2A\u8BFB\u4E8B\u52A1\u4E2D\u6267\u884C\uFF09\u3002</p><h2 id="_3-4-volatile-\u7684\u5185\u5B58\u8BED\u4E49" tabindex="-1"><a class="header-anchor" href="#_3-4-volatile-\u7684\u5185\u5B58\u8BED\u4E49" aria-hidden="true">#</a> 3.4 volatile \u7684\u5185\u5B58\u8BED\u4E49</h2><p>\u5F53\u58F0\u660E\u5171\u4EAB\u53D8\u91CF\u4E3A volatile \u540E\uFF0C\u5BF9\u8FD9\u4E2A\u53D8\u91CF\u7684\u8BFB / \u5199\u5C06\u4F1A\u5F88\u7279\u522B\u3002\u4E3A\u4E86\u63ED\u5F00 volatile \u7684\u795E\u79D8\u9762\u7EB1\uFF0C\u4E0B\u9762\u5C06\u4ECB\u7ECD volatile \u7684\u5185\u5B58\u8BED\u4E49\u53CA volatile \u5185\u5B58\u8BED\u4E49\u7684\u5B9E\u73B0\u3002</p><h3 id="_3-4-1-volatile-\u7684\u7279\u6027" tabindex="-1"><a class="header-anchor" href="#_3-4-1-volatile-\u7684\u7279\u6027" aria-hidden="true">#</a> 3.4.1 volatile \u7684\u7279\u6027</h3><p>\u7406\u89E3 volatile \u7279\u6027\u7684\u4E00\u4E2A\u597D\u65B9\u6CD5\u662F\u628A\u5BF9 volatile \u53D8\u91CF\u7684\u5355\u4E2A\u8BFB / \u5199\uFF0C\u770B\u6210\u662F\u4F7F\u7528\u540C\u4E00\u4E2A\u9501\u5BF9\u8FD9\u4E9B\u5355\u4E2A\u8BFB / \u5199\u64CD\u4F5C\u505A\u4E86\u540C\u6B65\u3002\u4E0B\u9762\u901A\u8FC7\u5177\u4F53\u7684\u793A\u4F8B\u6765\u8BF4\u660E\uFF0C\u793A\u4F8B\u4EE3\u7801\u5982\u4E0B\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">VolatileFeaturesExample</span> <span class="token punctuation">{</span>
    <span class="token keyword">volatile</span> <span class="token keyword">long</span> vl <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>            			<span class="token comment">// \u4F7F\u7528 volatile \u58F0\u660E 64 \u4F4D\u7684 long \u578B\u53D8\u91CF</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">long</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        vl <span class="token operator">=</span> l<span class="token punctuation">;</span>                 				<span class="token comment">// \u5355\u4E2A volatile \u53D8\u91CF\u7684\u5199</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> getAndIncrement <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        vl<span class="token operator">++</span><span class="token punctuation">;</span>                  					<span class="token comment">// \u590D\u5408\uFF08\u591A\u4E2A\uFF09volatile \u53D8\u91CF\u7684\u8BFB / \u5199</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> vl<span class="token punctuation">;</span>                				<span class="token comment">// \u5355\u4E2A volatile \u53D8\u91CF\u7684\u8BFB</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u5047\u8BBE\u6709\u591A\u4E2A\u7EBF\u7A0B\u5206\u522B\u8C03\u7528\u4E0A\u9762\u7A0B\u5E8F\u7684 3 \u4E2A\u65B9\u6CD5\uFF0C\u8FD9\u4E2A\u7A0B\u5E8F\u5728\u8BED\u4E49\u4E0A\u548C\u4E0B\u9762\u7A0B\u5E8F\u7B49\u4EF7\u3002</span>
<span class="token keyword">class</span> <span class="token class-name">VolatileFeaturesExample</span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> vl <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>                				<span class="token comment">// 64 \u4F4D\u7684 long \u578B\u666E\u901A\u53D8\u91CF</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">long</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span>    	<span class="token comment">// \u5BF9\u5355\u4E2A\u7684\u666E\u901A\u53D8\u91CF\u7684\u5199\u7528\u540C\u4E00\u4E2A\u9501\u540C\u6B65</span>
        vl <span class="token operator">=</span> l<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> getAndIncrement <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>       		<span class="token comment">// \u666E\u901A\u65B9\u6CD5\u8C03\u7528</span>
        <span class="token keyword">long</span> temp <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            			<span class="token comment">// \u8C03\u7528\u5DF2\u540C\u6B65\u7684\u8BFB\u65B9\u6CD5</span>
        temp <span class="token operator">+=</span> <span class="token number">1L</span><span class="token punctuation">;</span>               				<span class="token comment">// \u666E\u901A\u5199\u64CD\u4F5C</span>
        <span class="token function">set</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>                				<span class="token comment">// \u8C03\u7528\u5DF2\u540C\u6B65\u7684\u5199\u65B9\u6CD5</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">long</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>       		<span class="token comment">// \u5BF9\u5355\u4E2A\u7684\u666E\u901A\u53D8\u91CF\u7684\u8BFB\u7528\u540C\u4E00\u4E2A\u9501\u540C\u6B65</span>
        <span class="token keyword">return</span> vl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5982\u4E0A\u9762\u793A\u4F8B\u7A0B\u5E8F\u6240\u793A\uFF0C\u4E00\u4E2A volatile \u53D8\u91CF\u7684\u5355\u4E2A\u8BFB / \u5199\u64CD\u4F5C\uFF0C\u4E0E\u4E00\u4E2A\u666E\u901A\u53D8\u91CF\u7684\u8BFB / \u5199\u64CD\u4F5C\u90FD\u662F\u4F7F\u7528\u540C\u4E00\u4E2A\u9501\u6765\u540C\u6B65\uFF0C\u5B83\u4EEC\u4E4B\u95F4\u7684\u6267\u884C\u6548\u679C\u76F8\u540C\u3002</p><p>\u9501\u7684 happens-before \u89C4\u5219\u4FDD\u8BC1\u91CA\u653E\u9501\u548C\u83B7\u53D6\u9501\u7684\u4E24\u4E2A\u7EBF\u7A0B\u4E4B\u95F4\u7684\u5185\u5B58\u53EF\u89C1\u6027\uFF0C\u8FD9\u610F\u5473\u7740\u5BF9\u4E00\u4E2A volatile \u53D8\u91CF\u7684\u8BFB\uFF0C\u603B\u662F\u80FD\u770B\u5230\uFF08\u4EFB\u610F\u7EBF\u7A0B\uFF09\u5BF9\u8FD9\u4E2A volatile \u53D8\u91CF\u6700\u540E\u7684\u5199\u5165\u3002</p><p>\u9501\u7684\u8BED\u4E49\u51B3\u5B9A\u4E86\u4E34\u754C\u533A\u4EE3\u7801\u7684\u6267\u884C\u5177\u6709\u539F\u5B50\u6027\u3002\u8FD9\u610F\u5473\u7740\uFF0C\u5373\u4F7F\u662F 64 \u4F4D\u7684 long \u578B\u548C double \u578B\u53D8\u91CF\uFF0C\u53EA\u8981\u5B83\u662F volatile \u53D8\u91CF\uFF0C\u5BF9\u8BE5\u53D8\u91CF\u7684\u8BFB / \u5199\u5C31\u5177\u6709\u539F\u5B50\u6027\u3002\u5982\u679C\u662F\u591A\u4E2A volatile \u64CD\u4F5C\u6216\u7C7B\u4F3C\u4E8E volatile++ \u8FD9\u79CD\u590D\u5408\u64CD\u4F5C\uFF0C\u8FD9\u4E9B\u64CD\u4F5C\u6574\u4F53\u4E0A\u4E0D\u5177\u6709\u539F\u5B50\u6027\u3002</p><p>\u7B80\u800C\u8A00\u4E4B\uFF0Cvolatile \u53D8\u91CF\u81EA\u8EAB\u5177\u6709\u4E0B\u5217\u7279\u6027\u3002</p><ul><li><p>\u53EF\u89C1\u6027\u3002\u5BF9\u4E00\u4E2A volatile \u53D8\u91CF\u7684\u8BFB\uFF0C\u603B\u662F\u80FD\u770B\u5230\uFF08\u4EFB\u610F\u7EBF\u7A0B\uFF09\u5BF9\u8FD9\u4E2A volatile \u53D8\u91CF\u6700\u540E\u7684\u5199\u5165\u3002</p></li><li><p>\u539F\u5B50\u6027\uFF1A\u5BF9\u4EFB\u610F\u5355\u4E2A volatile \u53D8\u91CF\u7684\u8BFB / \u5199\u5177\u6709\u539F\u5B50\u6027\uFF0C\u4F46\u7C7B\u4F3C\u4E8E volatile++ \u8FD9\u79CD\u590D\u5408\u64CD\u4F5C\u4E0D\u5177\u6709\u539F\u5B50\u6027\u3002</p></li></ul><h3 id="_3-4-2-volatile-\u5199\u2014\u8BFB\u5EFA\u7ACB\u7684-happens-before-\u5173\u7CFB" tabindex="-1"><a class="header-anchor" href="#_3-4-2-volatile-\u5199\u2014\u8BFB\u5EFA\u7ACB\u7684-happens-before-\u5173\u7CFB" aria-hidden="true">#</a> 3.4.2 volatile \u5199\u2014\u8BFB\u5EFA\u7ACB\u7684 happens-before \u5173\u7CFB</h3><p>\u4E0A\u9762\u8BB2\u7684\u662F volatile \u53D8\u91CF\u81EA\u8EAB\u7684\u7279\u6027\uFF0C\u5BF9\u7A0B\u5E8F\u5458\u6765\u8BF4\uFF0Cvolatile \u5BF9\u7EBF\u7A0B\u7684\u5185\u5B58\u53EF\u89C1\u6027\u7684\u5F71\u54CD\u6BD4 volatile \u81EA\u8EAB\u7684\u7279\u6027\u66F4\u4E3A\u91CD\u8981\uFF0C\u4E5F\u66F4\u9700\u8981\u6211\u4EEC\u53BB\u5173\u6CE8\u3002</p><p>\u4ECE JSR-133 \u5F00\u59CB\uFF08\u5373\u4ECE JDK 5 \u5F00\u59CB\uFF09\uFF0Cvolatile \u53D8\u91CF\u7684\u5199\u2014\u8BFB\u53EF\u4EE5\u5B9E\u73B0\u7EBF\u7A0B\u4E4B\u95F4\u7684\u901A\u4FE1\u3002</p><p>\u4ECE\u5185\u5B58\u8BED\u4E49\u7684\u89D2\u5EA6\u6765\u8BF4\uFF0Cvolatile \u7684\u5199\u2014\u8BFB\u4E0E\u9501\u7684\u91CA\u653E\u2014\u83B7\u53D6\u6709\u76F8\u540C\u7684\u5185\u5B58\u6548\u679C\uFF1Avolatile \u5199\u548C\u9501\u7684\u91CA\u653E\u6709\u76F8\u540C\u7684\u5185\u5B58\u8BED\u4E49\uFF1Bvolatile \u8BFB\u4E0E\u9501\u7684\u83B7\u53D6\u6709\u76F8\u540C\u7684\u5185\u5B58\u8BED\u4E49\u3002</p><p>\u8BF7\u770B\u4E0B\u9762\u4F7F\u7528 volatile \u53D8\u91CF\u7684\u793A\u4F8B\u4EE3\u7801\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">VolatileExample</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>          		<span class="token comment">// 1</span>
        flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>       		<span class="token comment">// 2</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>       		<span class="token comment">// 3</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> a<span class="token punctuation">;</span>     		<span class="token comment">// 4</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5047\u8BBE\u7EBF\u7A0B A \u6267\u884C writer() \u65B9\u6CD5\u4E4B\u540E\uFF0C\u7EBF\u7A0B B \u6267\u884C reader() \u65B9\u6CD5\u3002\u6839\u636E happens-before \u89C4\u5219\uFF0C\u8FD9\u4E2A\u8FC7\u7A0B\u5EFA\u7ACB\u7684 happens-before \u5173\u7CFB\u53EF\u4EE5\u5206\u4E3A 3 \u7C7B\uFF1A</p><ol><li><p>\u6839\u636E\u7A0B\u5E8F\u6B21\u5E8F\u89C4\u5219\uFF0C1 happens-before 2; 3 happens-before 4\u3002</p></li><li><p>\u6839\u636E volatile \u89C4\u5219\uFF0C2 happens-before 3\u3002</p></li><li><p>\u6839\u636E happens-before \u7684\u4F20\u9012\u6027\u89C4\u5219\uFF0C1 happens-before 4\u3002</p></li></ol><p>\u4E0A\u8FF0 happens-before \u5173\u7CFB\u7684\u56FE\u5F62\u5316\u8868\u73B0\u5F62\u5F0F\u5982\u4E0B\u3002</p><p><img src="`+M+'" alt="\u56FE3-16" loading="lazy"></p><p>\u56FE3-16 happens-before \u5173\u7CFB</p><p>\u5728\u4E0A\u56FE\u4E2D\uFF0C\u6BCF\u4E00\u4E2A\u7BAD\u5934\u94FE\u63A5\u7684\u4E24\u4E2A\u8282\u70B9\uFF0C\u4EE3\u8868\u4E86\u4E00\u4E2A happens-before \u5173\u7CFB\u3002\u9ED1\u8272\u7BAD\u5934\u8868\u793A\u7A0B\u5E8F\u987A\u5E8F\u89C4\u5219\uFF1B\u6A59\u8272\u7BAD\u5934\u8868\u793A volatile \u89C4\u5219\uFF1B\u84DD\u8272\u7BAD\u5934\u8868\u793A\u7EC4\u5408\u8FD9\u4E9B\u89C4\u5219\u540E\u63D0\u4F9B\u7684 happens-before \u4FDD\u8BC1\u3002</p><p>\u8FD9\u91CC A \u7EBF\u7A0B\u5199\u4E00\u4E2A volatile \u53D8\u91CF\u540E\uFF0CB \u7EBF\u7A0B\u8BFB\u540C\u4E00\u4E2A volatile \u53D8\u91CF\u3002A \u7EBF\u7A0B\u5728\u5199 volatile \u53D8\u91CF\u4E4B\u524D\u6240\u6709\u53EF\u89C1\u7684\u5171\u4EAB\u53D8\u91CF\uFF0C\u5728 B \u7EBF\u7A0B\u8BFB\u540C\u4E00\u4E2A volatile \u53D8\u91CF\u540E\uFF0C\u5C06\u7ACB\u5373\u53D8\u5F97\u5BF9 B \u7EBF\u7A0B\u53EF\u89C1\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1A\u672C\u6587\u7EDF\u4E00\u7528\u7C97\u5B9E\u7EBF\u6807\u8BC6\u7EC4\u5408\u540E\u4EA7\u751F\u7684 happens-before \u5173\u7CFB\u3002</p><h3 id="_3-4-3-volatile-\u5199\u2014\u8BFB\u7684\u5185\u5B58\u8BED\u4E49" tabindex="-1"><a class="header-anchor" href="#_3-4-3-volatile-\u5199\u2014\u8BFB\u7684\u5185\u5B58\u8BED\u4E49" aria-hidden="true">#</a> 3.4.3 volatile \u5199\u2014\u8BFB\u7684\u5185\u5B58\u8BED\u4E49</h3><p>volatile \u5199\u7684\u5185\u5B58\u8BED\u4E49\u5982\u4E0B\u3002</p><p>\u5F53\u5199\u4E00\u4E2A volatile \u53D8\u91CF\u65F6\uFF0CJMM \u4F1A\u628A\u8BE5\u7EBF\u7A0B\u5BF9\u5E94\u7684\u672C\u5730\u5185\u5B58\u4E2D\u7684\u5171\u4EAB\u53D8\u91CF\u503C\u5237\u65B0\u5230\u4E3B\u5185\u5B58\u3002</p><p>\u4EE5\u4E0A\u9762\u793A\u4F8B\u7A0B\u5E8F VolatileExample \u4E3A\u4F8B\uFF0C\u5047\u8BBE\u7EBF\u7A0B A \u9996\u5148\u6267\u884C writer() \u65B9\u6CD5\uFF0C\u968F\u540E\u7EBF\u7A0B B \u6267\u884C reader() \u65B9\u6CD5\uFF0C\u521D\u59CB\u65F6\u4E24\u4E2A\u7EBF\u7A0B\u7684\u672C\u5730\u5185\u5B58\u4E2D\u7684 flag \u548C a \u90FD\u662F\u521D\u59CB\u72B6\u6001\u3002\u56FE3-17 \u662F\u7EBF\u7A0B A \u6267\u884C volatile \u5199\u540E\uFF0C\u5171\u4EAB\u53D8\u91CF\u7684\u72B6\u6001\u793A\u610F\u56FE\u3002</p><p><img src="'+J+'" alt="\u56FE3-17" loading="lazy"></p><p>\u56FE3-17 \u5171\u4EAB\u53D8\u91CF\u7684\u72B6\u6001\u793A\u610F\u56FE</p><p>\u5982\u56FE3-17 \u6240\u793A\uFF0C\u7EBF\u7A0B A \u5728\u5199 flag \u53D8\u91CF\u540E\uFF0C\u672C\u5730\u5185\u5B58 A \u4E2D\u88AB\u7EBF\u7A0B A \u66F4\u65B0\u8FC7\u7684\u4E24\u4E2A\u5171\u4EAB\u53D8\u91CF\u7684\u503C\u88AB\u5237\u65B0\u5230\u4E3B\u5185\u5B58\u4E2D\u3002\u6B64\u65F6\uFF0C\u672C\u5730\u5185\u5B58 A \u548C\u4E3B\u5185\u5B58\u4E2D\u7684\u5171\u4EAB\u53D8\u91CF\u7684\u503C\u662F\u4E00\u81F4\u7684\u3002</p><p>volatile \u8BFB\u7684\u5185\u5B58\u8BED\u4E49\u5982\u4E0B\u3002</p><p>\u5F53\u8BFB\u4E00\u4E2A volatile \u53D8\u91CF\u65F6\uFF0CJMM \u4F1A\u628A\u8BE5\u7EBF\u7A0B\u5BF9\u5E94\u7684\u672C\u5730\u5185\u5B58\u7F6E\u4E3A\u65E0\u6548\u3002\u7EBF\u7A0B\u63A5\u4E0B\u6765\u5C06\u4ECE\u4E3B\u5185\u5B58\u4E2D\u8BFB\u53D6\u5171\u4EAB\u53D8\u91CF\u3002</p><p>\u56FE3-18 \u4E3A\u7EBF\u7A0B B \u8BFB\u540C\u4E00\u4E2A volatile \u53D8\u91CF\u540E\uFF0C\u5171\u4EAB\u53D8\u91CF\u7684\u72B6\u6001\u793A\u610F\u56FE\u3002</p><p><img src="'+A+'" alt="\u56FE3-18" loading="lazy"></p><p>\u56FE3-18 \u5171\u4EAB\u53D8\u91CF\u7684\u72B6\u6001\u793A\u610F\u56FE</p><p>\u5982\u56FE\u6240\u793A\uFF0C\u5728\u8BFB flag \u53D8\u91CF\u540E\uFF0C\u672C\u5730\u5185\u5B58 B \u5305\u542B\u7684\u503C\u5DF2\u7ECF\u88AB\u7F6E\u4E3A\u65E0\u6548\u3002\u6B64\u65F6\uFF0C\u7EBF\u7A0B B \u5FC5\u987B\u4ECE\u4E3B\u5185\u5B58\u4E2D\u8BFB\u53D6\u5171\u4EAB\u53D8\u91CF\u3002\u7EBF\u7A0B B \u7684\u8BFB\u53D6\u64CD\u4F5C\u5C06\u5BFC\u81F4\u672C\u5730\u5185\u5B58 B \u4E0E\u4E3B\u5185\u5B58\u4E2D\u7684\u5171\u4EAB\u53D8\u91CF\u7684\u503C\u53D8\u6210\u4E00\u81F4\u3002</p><p>\u5982\u679C\u6211\u4EEC\u628A volatile \u5199\u548C volatile \u8BFB\u4E24\u4E2A\u6B65\u9AA4\u7EFC\u5408\u8D77\u6765\u770B\u7684\u8BDD\uFF0C\u5728\u8BFB\u7EBF\u7A0B B \u8BFB\u4E00\u4E2A volatile \u53D8\u91CF\u540E\uFF0C\u5199\u7EBF\u7A0B A \u5728\u5199\u8FD9\u4E2A volatile \u53D8\u91CF\u4E4B\u524D\u6240\u6709\u53EF\u89C1\u7684\u5171\u4EAB\u53D8\u91CF\u7684\u503C\u90FD\u5C06\u7ACB\u5373\u53D8\u5F97\u5BF9\u8BFB\u7EBF\u7A0B B \u53EF\u89C1\u3002</p><p>\u4E0B\u9762\u5BF9 volatile \u5199\u548C volatile \u8BFB\u7684\u5185\u5B58\u8BED\u4E49\u505A\u4E2A\u603B\u7ED3\u3002</p><ul><li><p>\u7EBF\u7A0B A \u5199\u4E00\u4E2A volatile \u53D8\u91CF\uFF0C\u5B9E\u8D28\u4E0A\u662F\u7EBF\u7A0B A \u5411\u63A5\u4E0B\u6765\u5C06\u8981\u8BFB\u8FD9\u4E2A volatile \u53D8\u91CF\u7684\u67D0\u4E2A\u7EBF\u7A0B\u53D1\u51FA\u4E86\uFF08\u5176\u5BF9\u5171\u4EAB\u53D8\u91CF\u6240\u505A\u4FEE\u6539\u7684\uFF09\u6D88\u606F\u3002</p></li><li><p>\u7EBF\u7A0B B \u8BFB\u4E00\u4E2A volatile \u53D8\u91CF\uFF0C\u5B9E\u8D28\u4E0A\u662F\u7EBF\u7A0B B \u63A5\u6536\u4E86\u4E4B\u524D\u67D0\u4E2A\u7EBF\u7A0B\u53D1\u51FA\u7684\uFF08\u5728\u5199\u8FD9\u4E2A volatile \u53D8\u91CF\u4E4B\u524D\u5BF9\u5171\u4EAB\u53D8\u91CF\u6240\u505A\u4FEE\u6539\u7684\uFF09\u6D88\u606F\u3002</p></li><li><p>\u7EBF\u7A0B A \u5199\u4E00\u4E2A volatile \u53D8\u91CF\uFF0C\u968F\u540E\u7EBF\u7A0B B \u8BFB\u8FD9\u4E2A volatile \u53D8\u91CF\uFF0C\u8FD9\u4E2A\u8FC7\u7A0B\u5B9E\u8D28\u4E0A\u662F\u7EBF\u7A0B A \u901A\u8FC7\u4E3B\u5185\u5B58\u5411\u7EBF\u7A0B B \u53D1\u9001\u6D88\u606F\u3002</p></li></ul><h3 id="_3-4-4-volatile-\u5185\u5B58\u8BED\u4E49\u7684\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_3-4-4-volatile-\u5185\u5B58\u8BED\u4E49\u7684\u5B9E\u73B0" aria-hidden="true">#</a> 3.4.4 volatile \u5185\u5B58\u8BED\u4E49\u7684\u5B9E\u73B0</h3><p>\u4E0B\u9762\u6765\u770B\u770B JMM \u5982\u4F55\u5B9E\u73B0 volatile \u5199/\u8BFB\u7684\u5185\u5B58\u8BED\u4E49\u3002</p><p>\u524D\u6587\u63D0\u5230\u8FC7\u91CD\u6392\u5E8F\u5206\u4E3A\u7F16\u8BD1\u5668\u91CD\u6392\u5E8F\u548C\u5904\u7406\u5668\u91CD\u6392\u5E8F\u3002\u4E3A\u4E86\u5B9E\u73B0 volatile \u5185\u5B58\u8BED\u4E49\uFF0CJMM \u4F1A\u5206\u522B\u9650\u5236\u8FD9\u4E24\u79CD\u7C7B\u578B\u7684\u91CD\u6392\u5E8F\u7C7B\u578B\u3002\u88683-5 \u662F JMM \u9488\u5BF9\u7F16\u8BD1\u5668\u5236\u5B9A\u7684 volatile \u91CD\u6392\u5E8F\u89C4\u5219\u8868\u3002</p><p>\u88683-5 volatile \u91CD\u6392\u5E8F\u89C4\u5219\u8868</p><p><img src="'+B+'" alt="\u88683-5" loading="lazy"></p><p>\u4E3E\u4F8B\u6765\u8BF4\uFF0C\u7B2C\u4E09\u884C\u6700\u540E\u4E00\u4E2A\u5355\u5143\u683C\u7684\u610F\u601D\u662F\uFF1A\u5728\u7A0B\u5E8F\u4E2D\uFF0C\u5F53\u7B2C\u4E00\u4E2A\u64CD\u4F5C\u4E3A\u666E\u901A\u53D8\u91CF\u7684\u8BFB\u6216\u5199\u65F6\uFF0C\u5982\u679C\u7B2C\u4E8C\u4E2A\u64CD\u4F5C\u4E3A volatile \u5199\uFF0C\u5219\u7F16\u8BD1\u5668\u4E0D\u80FD\u91CD\u6392\u5E8F\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u3002</p><p>\u4ECE\u88683-5 \u6211\u4EEC\u53EF\u4EE5\u770B\u51FA\u3002</p><ul><li><p>\u5F53\u7B2C\u4E8C\u4E2A\u64CD\u4F5C\u662F volatile \u5199\u65F6\uFF0C\u4E0D\u7BA1\u7B2C\u4E00\u4E2A\u64CD\u4F5C\u662F\u4EC0\u4E48\uFF0C\u90FD\u4E0D\u80FD\u91CD\u6392\u5E8F\u3002\u8FD9\u4E2A\u89C4\u5219\u786E\u4FDD volatile \u5199\u4E4B\u524D\u7684\u64CD\u4F5C\u4E0D\u4F1A\u88AB\u7F16\u8BD1\u5668\u91CD\u6392\u5E8F\u5230 volatile \u5199\u4E4B\u540E\u3002</p></li><li><p>\u5F53\u7B2C\u4E00\u4E2A\u64CD\u4F5C\u662F volatile \u8BFB\u65F6\uFF0C\u4E0D\u7BA1\u7B2C\u4E8C\u4E2A\u64CD\u4F5C\u662F\u4EC0\u4E48\uFF0C\u90FD\u4E0D\u80FD\u91CD\u6392\u5E8F\u3002\u8FD9\u4E2A\u89C4\u5219\u786E\u4FDD volatile \u8BFB\u4E4B\u540E\u7684\u64CD\u4F5C\u4E0D\u4F1A\u88AB\u7F16\u8BD1\u5668\u91CD\u6392\u5E8F\u5230 volatile \u8BFB\u4E4B\u524D\u3002</p></li><li><p>\u5F53\u7B2C\u4E00\u4E2A\u64CD\u4F5C\u662F volatile \u5199\uFF0C\u7B2C\u4E8C\u4E2A\u64CD\u4F5C\u662F volatile \u8BFB\u65F6\uFF0C\u4E0D\u80FD\u91CD\u6392\u5E8F\u3002</p></li></ul><p>\u4E3A\u4E86\u5B9E\u73B0 volatile \u7684\u5185\u5B58\u8BED\u4E49\uFF0C\u7F16\u8BD1\u5668\u5728\u751F\u6210\u5B57\u8282\u7801\u65F6\uFF0C\u4F1A\u5728\u6307\u4EE4\u5E8F\u5217\u4E2D\u63D2\u5165\u5185\u5B58\u5C4F\u969C\u6765\u7981\u6B62\u7279\u5B9A\u7C7B\u578B\u7684\u5904\u7406\u5668\u91CD\u6392\u5E8F\u3002\u5BF9\u4E8E\u7F16\u8BD1\u5668\u6765\u8BF4\uFF0C\u53D1\u73B0\u4E00\u4E2A\u6700\u4F18\u5E03\u7F6E\u6765\u6700\u5C0F\u5316\u63D2\u5165\u5C4F\u969C\u7684\u603B\u6570\u51E0\u4E4E\u4E0D\u53EF\u80FD\u3002\u4E3A\u6B64\uFF0CJMM \u91C7\u53D6\u4FDD\u5B88\u7B56\u7565\u3002\u4E0B\u9762\u662F\u57FA\u4E8E\u4FDD\u5B88\u7B56\u7565\u7684 JMM \u5185\u5B58\u5C4F\u969C\u63D2\u5165\u7B56\u7565\u3002</p><ul><li><p>\u5728\u6BCF\u4E2A volatile \u5199\u64CD\u4F5C\u7684\u524D\u9762\u63D2\u5165\u4E00\u4E2A StoreStore \u5C4F\u969C\u3002</p></li><li><p>\u5728\u6BCF\u4E2A volatile \u5199\u64CD\u4F5C\u7684\u540E\u9762\u63D2\u5165\u4E00\u4E2A StoreLoad \u5C4F\u969C\u3002</p></li><li><p>\u5728\u6BCF\u4E2A volatile \u8BFB\u64CD\u4F5C\u7684\u540E\u9762\u63D2\u5165\u4E00\u4E2A LoadLoad \u5C4F\u969C\u3002</p></li><li><p>\u5728\u6BCF\u4E2A volatile \u8BFB\u64CD\u4F5C\u7684\u540E\u9762\u63D2\u5165\u4E00\u4E2A LoadStore \u5C4F\u969C\u3002</p></li></ul><p>\u4E0A\u8FF0\u5185\u5B58\u5C4F\u969C\u63D2\u5165\u7B56\u7565\u975E\u5E38\u4FDD\u5B88\uFF0C\u4F46\u5B83\u53EF\u4EE5\u4FDD\u8BC1\u5728\u4EFB\u610F\u5904\u7406\u5668\u5E73\u53F0\uFF0C\u4EFB\u610F\u7684\u7A0B\u5E8F\u4E2D\u90FD\u80FD\u5F97\u5230\u6B63\u786E\u7684 volatile \u5185\u5B58\u8BED\u4E49\u3002</p><p>\u4E0B\u9762\u662F\u4FDD\u5B88\u7B56\u7565\u4E0B\uFF0Cvolatile \u5199\u63D2\u5165\u5185\u5B58\u5C4F\u969C\u540E\u751F\u6210\u7684\u6307\u4EE4\u5E8F\u5217\u793A\u610F\u56FE\uFF0C\u5982\u56FE3-19 \u6240\u793A\u3002</p><p><img src="'+x+'" alt="\u56FE3-19" loading="lazy"></p><p>\u56FE3-19 \u6307\u4EE4\u5E8F\u5217\u793A\u610F\u56FE</p><p>\u56FE3-19 \u4E2D\u7684 StoreStore \u5C4F\u969C\u53EF\u4EE5\u4FDD\u8BC1\u5728 volatile \u5199\u4E4B\u524D\uFF0C\u5176\u524D\u9762\u7684\u6240\u6709\u666E\u901A\u5199\u64CD\u4F5C\u5DF2\u7ECF\u5BF9\u4EFB\u610F\u5904\u7406\u5668\u53EF\u89C1\u4E86\u3002\u8FD9\u662F\u56E0\u4E3A StoreStore \u5C4F\u969C\u5C06\u4FDD\u969C\u4E0A\u9762\u6240\u6709\u7684\u666E\u901A\u5199\u5728 volatile \u5199\u4E4B\u524D\u5237\u65B0\u5230\u4E3B\u5185\u5B58\u3002</p><p>\u8FD9\u91CC\u6BD4\u8F83\u6709\u610F\u601D\u7684\u662F\uFF0Cvolatile \u5199\u540E\u9762\u7684 StoreLoad \u5C4F\u969C\u3002\u6B64\u5C4F\u969C\u7684\u4F5C\u7528\u662F\u907F\u514D volatile \u5199\u4E0E\u540E\u9762\u53EF\u80FD\u6709\u7684 volatile \u8BFB / \u5199\u64CD\u4F5C\u91CD\u6392\u5E8F\u3002\u56E0\u4E3A\u7F16\u8BD1\u5668\u5E38\u5E38\u65E0\u6CD5\u51C6\u786E\u5224\u65AD\u5728\u4E00\u4E2A volatile \u5199\u7684\u540E\u9762\u662F\u5426\u9700\u8981\u63D2\u5165\u4E00\u4E2A StoreLoad \u5C4F\u969C\uFF08\u6BD4\u5982\uFF0C\u4E00\u4E2A volatile \u5199\u4E4B\u540E\u65B9\u6CD5\u7ACB\u5373 return\uFF09\u3002\u4E3A\u4E86\u4FDD\u8BC1\u80FD\u6B63\u786E\u5B9E\u73B0 volatile \u7684\u5185\u5B58\u8BED\u4E49\uFF0CJMM \u5728\u91C7\u53D6\u4E86\u4FDD\u5B88\u7B56\u7565\uFF1A\u5728\u6BCF\u4E2A volatile \u5199\u7684\u540E\u9762\uFF0C\u6216\u8005\u5728\u6BCF\u4E2A volatile \u8BFB\u7684\u524D\u9762\u63D2\u5165\u4E00\u4E2A StoreLoad \u5C4F\u969C\u3002\u4ECE\u6574\u4F53\u6267\u884C\u6548\u7387\u7684\u89D2\u5EA6\u8003\u8651\uFF0CJMM \u6700\u7EC8\u9009\u62E9\u4E86\u5728\u6BCF\u4E2A volatile \u5199\u7684\u540E\u9762\u63D2\u5165\u4E00\u4E2A StoreLoad \u5C4F\u969C\u3002\u56E0\u4E3A volatile \u5199\u2014\u8BFB\u5185\u5B58\u8BED\u4E49\u7684\u5E38\u89C1\u4F7F\u7528\u6A21\u5F0F\u662F\uFF1A\u4E00\u4E2A\u5199\u7EBF\u7A0B\u5199 volatile \u53D8\u91CF\uFF0C\u591A\u4E2A\u8BFB\u7EBF\u7A0B\u8BFB\u540C\u4E00\u4E2A volatile \u53D8\u91CF\u3002\u5F53\u8BFB\u7EBF\u7A0B\u7684\u6570\u91CF\u5927\u5927\u8D85\u8FC7\u5199\u7EBF\u7A0B\u65F6\uFF0C\u9009\u62E9\u5728 volatile \u5199\u4E4B\u540E\u63D2\u5165 StoreLoad \u5C4F\u969C\u5C06\u5E26\u6765\u53EF\u89C2\u7684\u6267\u884C\u6548\u7387\u7684\u63D0\u5347\u3002\u4ECE\u8FD9\u91CC\u53EF\u4EE5\u770B\u5230 JMM \u5728\u5B9E\u73B0\u4E0A\u7684\u4E00\u4E2A\u7279\u70B9\uFF1A\u9996\u5148\u786E\u4FDD\u6B63\u786E\u6027\uFF0C\u7136\u540E\u518D\u53BB\u8FFD\u6C42\u6267\u884C\u6548\u7387\u3002</p><p>\u4E0B\u9762\u662F\u5728\u4FDD\u5B88\u7B56\u7565\u4E0B\uFF0Cvolatile \u8BFB\u63D2\u5165\u5185\u5B58\u5C4F\u969C\u540E\u751F\u6210\u7684\u6307\u4EE4\u5E8F\u5217\u793A\u610F\u56FE\uFF0C\u5982\u56FE3-20 \u6240\u793A\u3002</p><p><img src="'+j+`" alt="\u56FE3-20" loading="lazy"></p><p>\u56FE3-20 \u6307\u4EE4\u5E8F\u5217\u793A\u610F\u56FE</p><p>\u56FE3-20 \u4E2D\u7684 LoadLoad \u5C4F\u969C\u7528\u6765\u7981\u6B62\u5904\u7406\u5668\u628A\u4E0A\u9762\u7684 volatile \u8BFB\u4E0E\u4E0B\u9762\u7684\u666E\u901A\u8BFB\u91CD\u6392\u5E8F\u3002LoadStore \u5C4F\u969C\u7528\u6765\u7981\u6B62\u5904\u7406\u5668\u628A\u4E0A\u9762\u7684 volatile \u8BFB\u4E0E\u4E0B\u9762\u7684\u666E\u901A\u5199\u91CD\u6392\u5E8F\u3002</p><p>\u4E0A\u8FF0 volatile \u5199\u548C volatile \u8BFB\u7684\u5185\u5B58\u5C4F\u969C\u63D2\u5165\u7B56\u7565\u975E\u5E38\u4FDD\u5B88\u3002\u5728\u5B9E\u9645\u6267\u884C\u65F6\uFF0C\u53EA\u8981\u4E0D\u6539\u53D8 volatile \u5199\u2014\u8BFB\u7684\u5185\u5B58\u8BED\u4E49\uFF0C\u7F16\u8BD1\u5668\u53EF\u4EE5\u6839\u636E\u5177\u4F53\u60C5\u51B5\u7701\u7565\u4E0D\u5FC5\u8981\u7684\u5C4F\u969C\u3002\u4E0B\u9762\u901A\u8FC7\u5177\u4F53\u7684\u793A\u4F8B\u4EE3\u7801\u8FDB\u884C\u8BF4\u660E\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">VolatileBarrierExample</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> a<span class="token punctuation">;</span>
    <span class="token keyword">volatile</span> <span class="token keyword">int</span> v1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">volatile</span> <span class="token keyword">int</span> v2 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">readAndWrite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> v1<span class="token punctuation">;</span>   	<span class="token comment">// \u7B2C\u4E00\u4E2A volatile \u8BFB</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span> v2<span class="token punctuation">;</span>   	<span class="token comment">// \u7B2C\u4E8C\u4E2A volatile \u8BFB</span>
        a <span class="token operator">=</span> i <span class="token operator">+</span> j<span class="token punctuation">;</span>    	<span class="token comment">// \u666E\u901A\u5199</span>
        v1 <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>   	<span class="token comment">// \u7B2C\u4E00\u4E2A volatile \u5199</span>
        v2 <span class="token operator">=</span> j <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>		<span class="token comment">// \u7B2C\u4E8C\u4E2A volatile \u5199</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...           	// \u5176\u4ED6\u65B9\u6CD5</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u9488\u5BF9 readAndWrite() \u65B9\u6CD5\uFF0C\u7F16\u8BD1\u5668\u5728\u751F\u6210\u5B57\u8282\u7801\u65F6\u53EF\u4EE5\u505A\u5982\u4E0B\u7684\u4F18\u5316\u3002</p><p><img src="`+S+'" alt="\u56FE3-21" loading="lazy"></p><p>\u56FE3-21 \u6307\u4EE4\u5E8F\u5217\u793A\u610F\u56FE</p><p>\u6CE8\u610F\uFF0C\u6700\u540E\u7684 StoreLoad \u5C4F\u969C\u4E0D\u80FD\u7701\u7565\u3002\u56E0\u4E3A\u7B2C\u4E8C\u4E2A volatile \u5199\u4E4B\u540E\uFF0C\u65B9\u6CD5\u7ACB\u5373 return\u3002\u6B64\u65F6\u7F16\u8BD1\u5668\u53EF\u80FD\u65E0\u6CD5\u51C6\u786E\u65AD\u5B9A\u540E\u9762\u662F\u5426\u4F1A\u6709 volatile \u8BFB\u6216\u5199\uFF0C\u4E3A\u4E86\u5B89\u5168\u8D77\u89C1\uFF0C\u7F16\u8BD1\u5668\u901A\u5E38\u4F1A\u5728\u8FD9\u91CC\u63D2\u5165\u4E00\u4E2A StoreLoad \u5C4F\u969C\u3002</p><p>\u4E0A\u9762\u7684\u4F18\u5316\u9488\u5BF9\u4EFB\u610F\u5904\u7406\u5668\u5E73\u53F0\uFF0C\u7531\u4E8E\u4E0D\u540C\u7684\u5904\u7406\u5668\u6709\u4E0D\u540C \u201C\u677E\u7D27\u5EA6\u201D \u7684\u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\uFF0C\u5185\u5B58\u5C4F\u969C\u7684\u63D2\u5165\u8FD8\u53EF\u4EE5\u6839\u636E\u5177\u4F53\u7684\u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\u7EE7\u7EED\u4F18\u5316\u3002\u4EE5 X86 \u5904\u7406\u5668\u4E3A\u4F8B\uFF0C\u56FE3-21 \u4E2D\u9664\u6700\u540E\u7684 StoreLoad \u5C4F\u969C\u5916\uFF0C\u5176\u4ED6\u7684\u5C4F\u969C\u90FD\u4F1A\u88AB\u7701\u7565\u3002</p><p>\u524D\u9762\u4FDD\u5B88\u7B56\u7565\u4E0B\u7684 volatile \u8BFB\u548C\u5199\uFF0C\u5728 X86 \u5904\u7406\u5668\u5E73\u53F0\u53EF\u4EE5\u4F18\u5316\u6210\u5982\u56FE3-22 \u6240\u793A\u3002</p><p><img src="'+z+'" alt="\u56FE3-22" loading="lazy"></p><p>\u56FE3-22 \u6307\u4EE4\u5E8F\u5217\u793A\u610F\u56FE</p><p>\u524D\u6587\u63D0\u5230\u8FC7\uFF0CX86 \u5904\u7406\u5668\u4EC5\u4F1A\u5BF9\u5199\u2014\u8BFB\u64CD\u4F5C\u505A\u91CD\u6392\u5E8F\u3002X86 \u4E0D\u4F1A\u5BF9\u8BFB\u2014\u8BFB\u3001\u8BFB\u2014\u5199\u548C\u5199\u2014\u5199\u64CD\u4F5C\u505A\u91CD\u6392\u5E8F\uFF0C\u56E0\u6B64\u5728 X86 \u5904\u7406\u5668\u4E2D\u4F1A\u7701\u7565\u6389\u8FD9 3 \u79CD\u64CD\u4F5C\u7C7B\u578B\u5BF9\u5E94\u7684\u5185\u5B58\u5C4F\u969C\u3002\u5728 X86 \u4E2D\uFF0CJMM \u4EC5\u9700\u5728 volatile \u5199\u540E\u9762\u63D2\u5165\u4E00\u4E2A StoreLoad \u5C4F\u969C\u5373\u53EF\u6B63\u786E\u5B9E\u73B0 volatile \u5199\u2014\u8BFB\u7684\u5185\u5B58\u8BED\u4E49\u3002\u8FD9\u610F\u5473\u7740\u5728 X86 \u5904\u7406\u5668\u4E2D\uFF0Cvolatile \u5199\u7684\u5F00\u9500\u6BD4 volatile \u8BFB\u7684\u5F00\u9500\u4F1A\u5927\u5F88\u591A\uFF08\u56E0\u4E3A\u6267\u884C StoreLoad \u5C4F\u969C\u5F00\u9500\u4F1A\u6BD4\u8F83\u5927\uFF09\u3002</p><h3 id="_3-4-5-jsr-133-\u4E3A\u4EC0\u4E48\u8981\u589E\u5F3A-volatile-\u7684\u5185\u5B58\u8BED\u4E49" tabindex="-1"><a class="header-anchor" href="#_3-4-5-jsr-133-\u4E3A\u4EC0\u4E48\u8981\u589E\u5F3A-volatile-\u7684\u5185\u5B58\u8BED\u4E49" aria-hidden="true">#</a> 3.4.5 JSR-133 \u4E3A\u4EC0\u4E48\u8981\u589E\u5F3A volatile \u7684\u5185\u5B58\u8BED\u4E49</h3><p>\u5728 JSR-133 \u4E4B\u524D\u7684\u65E7 Java \u5185\u5B58\u6A21\u578B\u4E2D\uFF0C\u867D\u7136\u4E0D\u5141\u8BB8 volatile \u53D8\u91CF\u4E4B\u95F4\u91CD\u6392\u5E8F\uFF0C\u4F46\u65E7\u7684 Java \u5185\u5B58\u6A21\u578B\u5141\u8BB8 volatile \u53D8\u91CF\u4E0E\u666E\u901A\u53D8\u91CF\u91CD\u6392\u5E8F\u3002\u5728\u65E7\u7684\u5185\u5B58\u6A21\u578B\u4E2D\uFF0CVolatileExample \u793A\u4F8B\u7A0B\u5E8F\u53EF\u80FD\u88AB\u91CD\u6392\u5E8F\u6210\u4E0B\u5217\u65F6\u5E8F\u6765\u6267\u884C\uFF0C\u5982\u56FE3-23 \u6240\u793A\u3002</p><p><img src="'+C+`" alt="\u56FE3-23" loading="lazy"></p><p>\u56FE3-23 \u7EBF\u7A0B\u6267\u884C\u65F6\u5E8F\u56FE</p><p>\u5728\u65E7\u7684\u5185\u5B58\u6A21\u578B\u4E2D\uFF0C\u5F53 1 \u548C 2 \u4E4B\u95F4\u6CA1\u6709\u6570\u636E\u4F9D\u8D56\u5173\u7CFB\u65F6\uFF0C1 \u548C 2 \u4E4B\u95F4\u5C31\u53EF\u80FD\u88AB\u91CD\u6392\u5E8F\uFF083 \u548C 4 \u7C7B\u4F3C\uFF09\u3002\u5176\u7ED3\u679C\u5C31\u662F\uFF1A\u8BFB\u7EBF\u7A0B B \u6267\u884C 4 \u65F6\uFF0C\u4E0D\u4E00\u5B9A\u80FD\u770B\u5230\u5199\u7EBF\u7A0B A \u5728\u6267\u884C 1 \u65F6\u5BF9\u5171\u4EAB\u53D8\u91CF\u7684\u4FEE\u6539\u3002</p><p>\u56E0\u6B64\uFF0C\u5728\u65E7\u7684\u5185\u5B58\u6A21\u578B\u4E2D\uFF0Cvolatile \u7684\u5199\u2014\u8BFB\u6CA1\u6709\u9501\u7684\u91CA\u653E\u2014\u83B7\u6240\u5177\u6709\u7684\u5185\u5B58\u8BED\u4E49\u3002\u4E3A\u4E86\u63D0\u4F9B\u4E00\u79CD\u6BD4\u9501\u66F4\u8F7B\u91CF\u7EA7\u7684\u7EBF\u7A0B\u4E4B\u95F4\u901A\u4FE1\u7684\u673A\u5236\uFF0CJSR-133 \u4E13\u5BB6\u7EC4\u51B3\u5B9A\u589E\u5F3A volatile \u7684\u5185\u5B58\u8BED\u4E49\uFF1A\u4E25\u683C\u9650\u5236\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u5BF9 volatile \u53D8\u91CF\u4E0E\u666E\u901A\u53D8\u91CF\u7684\u91CD\u6392\u5E8F\uFF0C\u786E\u4FDD volatile \u7684\u5199\u2014\u8BFB\u548C\u9501\u7684\u91CA\u653E\u2014\u83B7\u53D6\u5177\u6709\u76F8\u540C\u7684\u5185\u5B58\u8BED\u4E49\u3002\u4ECE\u7F16\u8BD1\u5668\u91CD\u6392\u5E8F\u89C4\u5219\u548C\u5904\u7406\u5668\u5185\u5B58\u5C4F\u969C\u63D2\u5165\u7B56\u7565\u6765\u770B\uFF0C\u53EA\u8981 volatile \u53D8\u91CF\u4E0E\u666E\u901A\u53D8\u91CF\u4E4B\u95F4\u7684\u91CD\u6392\u5E8F\u53EF\u80FD\u4F1A\u7834\u574F volatile \u7684\u5185\u5B58\u8BED\u4E49\uFF0C\u8FD9\u79CD\u91CD\u6392\u5E8F\u5C31\u4F1A\u88AB\u7F16\u8BD1\u5668\u91CD\u6392\u5E8F\u89C4\u5219\u548C\u5904\u7406\u5668\u5185\u5B58\u5C4F\u969C\u63D2\u5165\u7B56\u7565\u7981\u6B62\u3002</p><p>\u7531\u4E8E volatile \u4EC5\u4EC5\u4FDD\u8BC1\u5BF9\u5355\u4E2A volatile \u53D8\u91CF\u7684\u8BFB / \u5199\u5177\u6709\u539F\u5B50\u6027\uFF0C\u800C\u9501\u7684\u4E92\u65A5\u6267\u884C\u7684\u7279\u6027\u53EF\u4EE5\u786E\u4FDD\u5BF9\u6574\u4E2A\u4E34\u754C\u533A\u4EE3\u7801\u7684\u6267\u884C\u5177\u6709\u539F\u5B50\u6027\u3002\u5728\u529F\u80FD\u4E0A\uFF0C\u9501\u6BD4 volatile \u66F4\u5F3A\u5927\uFF1B\u5728\u53EF\u4F38\u7F29\u6027\u548C\u6267\u884C\u6027\u80FD\u4E0A\uFF0Cvolatile \u66F4\u6709\u4F18\u52BF\u3002\u5982\u679C\u8BFB\u8005\u60F3\u5728\u7A0B\u5E8F\u4E2D\u7528 volatile \u4EE3\u66FF\u9501\uFF0C\u8BF7\u4E00\u5B9A\u8C28\u614E\uFF0C\u5177\u4F53\u8BE6\u60C5\u8BF7\u53C2\u9605 Brian Goetz \u7684\u6587\u7AE0\u300AJava \u7406\u8BBA\u4E0E\u5B9E\u8DF5\uFF1A\u6B63\u786E\u4F7F\u7528 Volatile \u53D8\u91CF\u300B\u3002</p><h2 id="_3-5-\u9501\u7684\u5185\u5B58\u8BED\u4E49" tabindex="-1"><a class="header-anchor" href="#_3-5-\u9501\u7684\u5185\u5B58\u8BED\u4E49" aria-hidden="true">#</a> 3.5 \u9501\u7684\u5185\u5B58\u8BED\u4E49</h2><p>\u4F17\u6240\u5468\u77E5\uFF0C\u9501\u53EF\u4EE5\u8BA9\u4E34\u754C\u533A\u4E92\u65A5\u6267\u884C\u3002\u8FD9\u91CC\u5C06\u4ECB\u7ECD\u9501\u7684\u53E6\u4E00\u4E2A\u540C\u6837\u91CD\u8981\uFF0C\u4F46\u5E38\u5E38\u88AB\u5FFD\u89C6\u7684\u529F\u80FD\uFF1A\u9501\u7684\u5185\u5B58\u8BED\u4E49\u3002</p><h3 id="_3-5-1-\u9501\u7684\u91CA\u653E\u2014\u83B7\u53D6\u5EFA\u7ACB\u7684-happens-before-\u5173\u7CFB" tabindex="-1"><a class="header-anchor" href="#_3-5-1-\u9501\u7684\u91CA\u653E\u2014\u83B7\u53D6\u5EFA\u7ACB\u7684-happens-before-\u5173\u7CFB" aria-hidden="true">#</a> 3.5.1 \u9501\u7684\u91CA\u653E\u2014\u83B7\u53D6\u5EFA\u7ACB\u7684 happens-before \u5173\u7CFB</h3><p>\u9501\u662F Java \u5E76\u53D1\u7F16\u7A0B\u4E2D\u6700\u91CD\u8981\u7684\u540C\u6B65\u673A\u5236\u3002\u9501\u9664\u4E86\u8BA9\u4E34\u754C\u533A\u4E92\u65A5\u6267\u884C\u5916\uFF0C\u8FD8\u53EF\u4EE5\u8BA9\u91CA\u653E\u9501\u7684\u7EBF\u7A0B\u5411\u83B7\u53D6\u540C\u4E00\u4E2A\u9501\u7684\u7EBF\u7A0B\u53D1\u9001\u6D88\u606F\u3002</p><p>\u4E0B\u9762\u662F\u9501\u91CA\u653E\u2014\u83B7\u53D6\u7684\u793A\u4F8B\u4EE3\u7801\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">MonitorExample</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    	<span class="token comment">// 1</span>
        a<span class="token operator">++</span><span class="token punctuation">;</span>                  				<span class="token comment">// 2</span>
    <span class="token punctuation">}</span>                     					<span class="token comment">// 3</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    	<span class="token comment">// 4</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> a<span class="token punctuation">;</span>               			<span class="token comment">// 5</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>                     					<span class="token comment">// 6</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5047\u8BBE\u7EBF\u7A0B A \u6267\u884C writer() \u65B9\u6CD5\uFF0C\u968F\u540E\u7EBF\u7A0B B \u6267\u884C reader() \u65B9\u6CD5\u3002\u6839\u636E happens-before \u89C4\u5219\uFF0C\u8FD9\u4E2A\u8FC7\u7A0B\u5305\u542B\u7684 happens-before \u5173\u7CFB\u53EF\u4EE5\u5206\u4E3A 3 \u7C7B\u3002</p><ol><li><p>\u6839\u636E\u7A0B\u5E8F\u6B21\u5E8F\u89C4\u5219\uFF0C1 happens-before 2, 2 happens-before 3; 4 happens-before 5, 5 happens-before 6\u3002</p></li><li><p>\u6839\u636E\u76D1\u89C6\u5668\u9501\u89C4\u5219\uFF0C3 happens-before 4\u3002</p></li><li><p>\u6839\u636E happens-before \u7684\u4F20\u9012\u6027\uFF0C2 happens-before 5\u3002</p></li></ol><p>\u4E0A\u8FF0 happens-before \u5173\u7CFB\u7684\u56FE\u5F62\u5316\u8868\u73B0\u5F62\u5F0F\u5982\u56FE3-24 \u6240\u793A\u3002</p><p><img src="`+L+'" alt="\u56FE3-24" loading="lazy"></p><p>\u56FE3-24 happens-before \u5173\u7CFB\u56FE</p><p>\u5728\u56FE3-24 \u4E2D\uFF0C\u6BCF\u4E00\u4E2A\u7BAD\u5934\u94FE\u63A5\u7684\u4E24\u4E2A\u8282\u70B9\uFF0C\u4EE3\u8868\u4E86\u4E00\u4E2A happens-before \u5173\u7CFB\u3002\u9ED1\u8272\u7BAD\u5934\u8868\u793A\u7A0B\u5E8F\u987A\u5E8F\u89C4\u5219\uFF1B\u6A59\u8272\u7BAD\u5934\u8868\u793A\u76D1\u89C6\u5668\u9501\u89C4\u5219\uFF1B\u84DD\u8272\u7BAD\u5934\u8868\u793A\u7EC4\u5408\u8FD9\u4E9B\u89C4\u5219\u540E\u63D0\u4F9B\u7684 happens-before \u4FDD\u8BC1\u3002</p><p>\u56FE3-24 \u8868\u793A\u5728\u7EBF\u7A0B A \u91CA\u653E\u4E86\u9501\u4E4B\u540E\uFF0C\u968F\u540E\u7EBF\u7A0B B \u83B7\u53D6\u540C\u4E00\u4E2A\u9501\u3002\u5728\u4E0A\u56FE\u4E2D\uFF0C2 happens-before 5\u3002\u56E0\u6B64\uFF0C\u7EBF\u7A0B A \u5728\u91CA\u653E\u9501\u4E4B\u524D\u6240\u6709\u53EF\u89C1\u7684\u5171\u4EAB\u53D8\u91CF\uFF0C\u5728\u7EBF\u7A0B B \u83B7\u53D6\u540C\u4E00\u4E2A\u9501\u4E4B\u540E\uFF0C\u5C06\u7ACB\u523B\u53D8\u5F97\u5BF9 B \u7EBF\u7A0B\u53EF\u89C1\u3002</p><h3 id="_3-5-2-\u9501\u7684\u91CA\u653E\u548C\u83B7\u53D6\u7684\u5185\u5B58\u8BED\u4E49" tabindex="-1"><a class="header-anchor" href="#_3-5-2-\u9501\u7684\u91CA\u653E\u548C\u83B7\u53D6\u7684\u5185\u5B58\u8BED\u4E49" aria-hidden="true">#</a> 3.5.2 \u9501\u7684\u91CA\u653E\u548C\u83B7\u53D6\u7684\u5185\u5B58\u8BED\u4E49</h3><p>\u5F53\u7EBF\u7A0B\u91CA\u653E\u9501\u65F6\uFF0CJMM \u4F1A\u628A\u8BE5\u7EBF\u7A0B\u5BF9\u5E94\u7684\u672C\u5730\u5185\u5B58\u4E2D\u7684\u5171\u4EAB\u53D8\u91CF\u5237\u65B0\u5230\u4E3B\u5185\u5B58\u4E2D\u3002\u4EE5\u4E0A\u9762\u7684 MonitorExample \u7A0B\u5E8F\u4E3A\u4F8B\uFF0CA \u7EBF\u7A0B\u91CA\u653E\u9501\u540E\uFF0C\u5171\u4EAB\u6570\u636E\u7684\u72B6\u6001\u793A\u610F\u56FE\u5982\u56FE3-25 \u6240\u793A\u3002</p><p><img src="'+I+'" alt="\u56FE3-25" loading="lazy"></p><p>\u56FE3-25 \u5171\u4EAB\u6570\u636E\u7684\u72B6\u6001\u793A\u610F\u56FE</p><p>\u5F53\u7EBF\u7A0B\u83B7\u53D6\u9501\u65F6\uFF0CJMM \u4F1A\u628A\u8BE5\u7EBF\u7A0B\u5BF9\u5E94\u7684\u672C\u5730\u5185\u5B58\u7F6E\u4E3A\u65E0\u6548\u3002\u4ECE\u800C\u4F7F\u5F97\u88AB\u76D1\u89C6\u5668\u4FDD\u62A4\u7684\u4E34\u754C\u533A\u4EE3\u7801\u5FC5\u987B\u4ECE\u4E3B\u5185\u5B58\u4E2D\u8BFB\u53D6\u5171\u4EAB\u53D8\u91CF\u3002\u56FE3-26 \u662F\u9501\u83B7\u53D6\u7684\u72B6\u6001\u793A\u610F\u56FE\u3002</p><p><img src="'+R+`" alt="\u56FE3-26" loading="lazy"></p><p>\u56FE3-26 \u9501\u83B7\u53D6\u7684\u72B6\u6001\u793A\u610F\u56FE</p><p>\u5BF9\u6BD4\u9501\u91CA\u653E\u2014\u83B7\u53D6\u7684\u5185\u5B58\u8BED\u4E49\u4E0E volatile \u5199\u2014\u8BFB\u7684\u5185\u5B58\u8BED\u4E49\u53EF\u4EE5\u770B\u51FA\uFF1A\u9501\u91CA\u653E\u4E0E volatile \u5199\u6709\u76F8\u540C\u7684\u5185\u5B58\u8BED\u4E49\uFF1B\u9501\u83B7\u53D6\u4E0E volatile \u8BFB\u6709\u76F8\u540C\u7684\u5185\u5B58\u8BED\u4E49\u3002</p><p>\u4E0B\u9762\u5BF9\u9501\u91CA\u653E\u548C\u9501\u83B7\u53D6\u7684\u5185\u5B58\u8BED\u4E49\u505A\u4E2A\u603B\u7ED3\u3002</p><ul><li><p>\u7EBF\u7A0B A \u91CA\u653E\u4E00\u4E2A\u9501\uFF0C\u5B9E\u8D28\u4E0A\u662F\u7EBF\u7A0B A \u5411\u63A5\u4E0B\u6765\u5C06\u8981\u83B7\u53D6\u8FD9\u4E2A\u9501\u7684\u67D0\u4E2A\u7EBF\u7A0B\u53D1\u51FA\u4E86\uFF08\u7EBF\u7A0B A \u5BF9\u5171\u4EAB\u53D8\u91CF\u6240\u505A\u4FEE\u6539\u7684\uFF09\u6D88\u606F\u3002</p></li><li><p>\u7EBF\u7A0B B \u83B7\u53D6\u4E00\u4E2A\u9501\uFF0C\u5B9E\u8D28\u4E0A\u662F\u7EBF\u7A0B B \u63A5\u6536\u4E86\u4E4B\u524D\u67D0\u4E2A\u7EBF\u7A0B\u53D1\u51FA\u7684\uFF08\u5728\u91CA\u653E\u8FD9\u4E2A\u9501\u4E4B\u524D\u5BF9\u5171\u4EAB\u53D8\u91CF\u6240\u505A\u4FEE\u6539\u7684\uFF09\u6D88\u606F\u3002</p></li><li><p>\u7EBF\u7A0B A \u91CA\u653E\u9501\uFF0C\u968F\u540E\u7EBF\u7A0B B \u83B7\u53D6\u8FD9\u4E2A\u9501\uFF0C\u8FD9\u4E2A\u8FC7\u7A0B\u5B9E\u8D28\u4E0A\u662F\u7EBF\u7A0B A \u901A\u8FC7\u4E3B\u5185\u5B58\u5411\u7EBF\u7A0B B \u53D1\u9001\u6D88\u606F\u3002</p></li></ul><h3 id="_3-5-3-\u9501\u5185\u5B58\u8BED\u4E49\u7684\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_3-5-3-\u9501\u5185\u5B58\u8BED\u4E49\u7684\u5B9E\u73B0" aria-hidden="true">#</a> 3.5.3 \u9501\u5185\u5B58\u8BED\u4E49\u7684\u5B9E\u73B0</h3><p>\u672C\u6587\u5C06\u501F\u52A9 ReentrantLock \u7684\u6E90\u4EE3\u7801\uFF0C\u6765\u5206\u6790\u9501\u5185\u5B58\u8BED\u4E49\u7684\u5177\u4F53\u5B9E\u73B0\u673A\u5236\u3002</p><p>\u8BF7\u770B\u4E0B\u9762\u7684\u793A\u4F8B\u4EE3\u7801\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">ReentrantLockExample</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       		<span class="token comment">// \u83B7\u53D6\u9501</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            a<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   	<span class="token comment">// \u91CA\u653E\u9501</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> reader <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       		<span class="token comment">// \u83B7\u53D6\u9501</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> a<span class="token punctuation">;</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   	<span class="token comment">// \u91CA\u653E\u9501</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728 ReentrantLock \u4E2D\uFF0C\u8C03\u7528 lock() \u65B9\u6CD5\u83B7\u53D6\u9501\uFF1B\u8C03\u7528 unlock() \u65B9\u6CD5\u91CA\u653E\u9501\u3002</p><p>ReentrantLock \u7684\u5B9E\u73B0\u4F9D\u8D56\u4E8E Java \u540C\u6B65\u5668\u6846\u67B6 AbstractQueuedSynchronizer\uFF08\u672C\u6587\u7B80\u79F0\u4E4B\u4E3A AQS\uFF09\u3002AQS \u4F7F\u7528\u4E00\u4E2A\u6574\u578B\u7684 volatile \u53D8\u91CF\uFF08\u547D\u540D\u4E3A state\uFF09\u6765\u7EF4\u62A4\u540C\u6B65\u72B6\u6001\uFF0C\u9A6C\u4E0A\u6211\u4EEC\u4F1A\u770B\u5230\uFF0C\u8FD9\u4E2A volatile \u53D8\u91CF\u662F ReentrantLock \u5185\u5B58\u8BED\u4E49\u5B9E\u73B0\u7684\u5173\u952E\u3002</p><p>\u56FE3-27 \u662F ReentrantLock \u7684\u7C7B\u56FE\uFF08\u4EC5\u753B\u51FA\u4E0E\u672C\u6587\u76F8\u5173\u7684\u90E8\u5206\uFF09\u3002</p><p><img src="`+T+`" alt="\u56FE3-27" loading="lazy"></p><p>\u56FE3-27 ReentrantLock \u7684\u7C7B\u56FE</p><p>ReentrantLock \u5206\u4E3A\u516C\u5E73\u9501\u548C\u975E\u516C\u5E73\u9501\uFF0C\u6211\u4EEC\u9996\u5148\u5206\u6790\u516C\u5E73\u9501\u3002</p><p>\u4F7F\u7528\u516C\u5E73\u9501\u65F6\uFF0C\u52A0\u9501\u65B9\u6CD5 lock() \u8C03\u7528\u8F68\u8FF9\u5982\u4E0B\u3002</p><ol><li><p>ReentrantLock: lock()\u3002</p></li><li><p>FairSync: lock()\u3002</p></li><li><p>AbstractQueuedSynchronizer: acquire(int arg)\u3002</p></li><li><p>ReentrantLock: tryAcquire(int acquires)\u3002</p></li></ol><p>\u5728\u7B2C 4 \u6B65\u771F\u6B63\u5F00\u59CB\u52A0\u9501\uFF0C\u4E0B\u9762\u662F\u8BE5\u65B9\u6CD5\u7684\u6E90\u4EE3\u7801\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> acquires<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">Thread</span> current <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     			<span class="token comment">// \u83B7\u53D6\u9501\u7684\u5F00\u59CB\uFF0C\u9996\u5148\u8BFB volatile \u53D8\u91CF state</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFirst</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
            <span class="token function">compareAndSetState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> acquires<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setExclusiveOwnerThread</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">==</span> <span class="token function">getExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> nextc <span class="token operator">=</span> c <span class="token operator">+</span> acquires<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nextc <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Maximum lock count exceeded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setState</span><span class="token punctuation">(</span>nextc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECE\u4E0A\u9762\u6E90\u4EE3\u7801\u4E2D\u6211\u4EEC\u53EF\u4EE5\u770B\u51FA\uFF0C\u52A0\u9501\u65B9\u6CD5\u9996\u5148\u8BFB volatile \u53D8\u91CF state\u3002</p><p>\u5728\u4F7F\u7528\u516C\u5E73\u9501\u65F6\uFF0C\u89E3\u9501\u65B9\u6CD5unlock()\u8C03\u7528\u8F68\u8FF9\u5982\u4E0B\u3002</p><ol><li><p>ReentrantLock: unlock()\u3002</p></li><li><p>AbstractQueuedSynchronizer: release(int arg)\u3002</p></li><li><p>Sync: tryRelease(int releases)\u3002</p></li></ol><p>\u5728\u7B2C 3 \u6B65\u771F\u6B63\u5F00\u59CB\u91CA\u653E\u9501\uFF0C\u4E0B\u9762\u662F\u8BE5\u65B9\u6CD5\u7684\u6E90\u4EE3\u7801\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">tryRelease</span><span class="token punctuation">(</span><span class="token keyword">int</span> releases<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> releases<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">getExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalMonitorStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> free <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        free <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token function">setExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">setState</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>         	<span class="token comment">// \u91CA\u653E\u9501\u7684\u6700\u540E\uFF0C\u5199 volatile \u53D8\u91CF state</span>
    <span class="token keyword">return</span> free<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECE\u4E0A\u9762\u7684\u6E90\u4EE3\u7801\u53EF\u4EE5\u770B\u51FA\uFF0C\u5728\u91CA\u653E\u9501\u7684\u6700\u540E\u5199 volatile \u53D8\u91CF state\u3002</p><p>\u516C\u5E73\u9501\u5728\u91CA\u653E\u9501\u7684\u6700\u540E\u5199 volatile \u53D8\u91CF state\uFF0C\u5728\u83B7\u53D6\u9501\u65F6\u9996\u5148\u8BFB\u8FD9\u4E2A volatile \u53D8\u91CF\u3002\u6839\u636E volatile \u7684 happens-before \u89C4\u5219\uFF0C\u91CA\u653E\u9501\u7684\u7EBF\u7A0B\u5728\u5199 volatile \u53D8\u91CF\u4E4B\u524D\u53EF\u89C1\u7684\u5171\u4EAB\u53D8\u91CF\uFF0C\u5728\u83B7\u53D6\u9501\u7684\u7EBF\u7A0B\u8BFB\u53D6\u540C\u4E00\u4E2A volatile \u53D8\u91CF\u540E\u5C06\u7ACB\u5373\u53D8\u5F97\u5BF9\u83B7\u53D6\u9501\u7684\u7EBF\u7A0B\u53EF\u89C1\u3002</p><p>\u73B0\u5728\u6211\u4EEC\u6765\u5206\u6790\u975E\u516C\u5E73\u9501\u7684\u5185\u5B58\u8BED\u4E49\u7684\u5B9E\u73B0\u3002\u975E\u516C\u5E73\u9501\u7684\u91CA\u653E\u548C\u516C\u5E73\u9501\u5B8C\u5168\u4E00\u6837\uFF0C\u6240\u4EE5\u8FD9\u91CC\u4EC5\u4EC5\u5206\u6790\u975E\u516C\u5E73\u9501\u7684\u83B7\u53D6\u3002</p><p>\u4F7F\u7528\u975E\u516C\u5E73\u9501\u65F6\uFF0C\u52A0\u9501\u65B9\u6CD5 lock() \u8C03\u7528\u8F68\u8FF9\u5982\u4E0B\u3002</p><ol><li><p>ReentrantLock: lock()\u3002</p></li><li><p>NonfairSync: lock()\u3002</p></li><li><p>AbstractQueuedSynchronizer: compareAndSetState(int expect,int update)\u3002</p></li></ol><p>\u5728\u7B2C 3 \u6B65\u771F\u6B63\u5F00\u59CB\u52A0\u9501\uFF0C\u4E0B\u9762\u662F\u8BE5\u65B9\u6CD5\u7684\u6E90\u4EE3\u7801\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">compareAndSetState</span><span class="token punctuation">(</span><span class="token keyword">int</span> expect<span class="token punctuation">,</span> <span class="token keyword">int</span> update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> unsafe<span class="token punctuation">.</span><span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> stateOffset<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8BE5\u65B9\u6CD5\u4EE5\u539F\u5B50\u64CD\u4F5C\u7684\u65B9\u5F0F\u66F4\u65B0 state \u53D8\u91CF\uFF0C\u672C\u6587\u628A Java \u7684 compareAndSet() \u65B9\u6CD5\u8C03\u7528\u7B80\u79F0\u4E3A CAS\u3002JDK \u6587\u6863\u5BF9\u8BE5\u65B9\u6CD5\u7684\u8BF4\u660E\u5982\u4E0B\uFF1A\u5982\u679C\u5F53\u524D\u72B6\u6001\u503C\u7B49\u4E8E\u9884\u671F\u503C\uFF0C\u5219\u4EE5\u539F\u5B50\u65B9\u5F0F\u5C06\u540C\u6B65\u72B6\u6001\u8BBE\u7F6E\u4E3A\u7ED9\u5B9A\u7684\u66F4\u65B0\u503C\u3002\u6B64\u64CD\u4F5C\u5177\u6709 volatile \u8BFB\u548C\u5199\u7684\u5185\u5B58\u8BED\u4E49\u3002</p><p>\u8FD9\u91CC\u6211\u4EEC\u5206\u522B\u4ECE\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u7684\u89D2\u5EA6\u6765\u5206\u6790\uFF0CCAS \u5982\u4F55\u540C\u65F6\u5177\u6709 volatile \u8BFB\u548C volatile \u5199\u7684\u5185\u5B58\u8BED\u4E49\u3002</p><p>\u524D\u6587\u6211\u4EEC\u63D0\u5230\u8FC7\uFF0C\u7F16\u8BD1\u5668\u4E0D\u4F1A\u5BF9 volatile \u8BFB\u4E0E volatile \u8BFB\u540E\u9762\u7684\u4EFB\u610F\u5185\u5B58\u64CD\u4F5C\u91CD\u6392\u5E8F\uFF1B\u7F16\u8BD1\u5668\u4E0D\u4F1A\u5BF9 volatile \u5199\u4E0E volatile \u5199\u524D\u9762\u7684\u4EFB\u610F\u5185\u5B58\u64CD\u4F5C\u91CD\u6392\u5E8F\u3002\u7EC4\u5408\u8FD9\u4E24\u4E2A\u6761\u4EF6\uFF0C\u610F\u5473\u7740\u4E3A\u4E86\u540C\u65F6\u5B9E\u73B0 volatile \u8BFB\u548C volatile \u5199\u7684\u5185\u5B58\u8BED\u4E49\uFF0C\u7F16\u8BD1\u5668\u4E0D\u80FD\u5BF9 CAS \u4E0E CAS \u524D\u9762\u548C\u540E\u9762\u7684\u4EFB\u610F\u5185\u5B58\u64CD\u4F5C\u91CD\u6392\u5E8F\u3002</p><p>\u4E0B\u9762\u6211\u4EEC\u6765\u5206\u6790\u5728\u5E38\u89C1\u7684 intel X86 \u5904\u7406\u5668\u4E2D\uFF0CCAS \u662F\u5982\u4F55\u540C\u65F6\u5177\u6709 volatile \u8BFB\u548C volatile \u5199\u7684\u5185\u5B58\u8BED\u4E49\u7684\u3002</p><p>\u4E0B\u9762\u662F sun.misc.Unsafe \u7C7B\u7684 compareAndSwapInt() \u65B9\u6CD5\u7684\u6E90\u4EE3\u7801\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">native</span> <span class="token keyword">boolean</span> <span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token keyword">long</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> expected<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u8FD9\u662F\u4E00\u4E2A\u672C\u5730\u65B9\u6CD5\u8C03\u7528\u3002\u8FD9\u4E2A\u672C\u5730\u65B9\u6CD5\u5728 openjdk \u4E2D\u4F9D\u6B21\u8C03\u7528\u7684 c++ \u4EE3\u7801\u4E3A\uFF1Aunsafe.cpp\uFF0Catomic.cpp \u548C atomic_windows_x86.inline.hpp\u3002\u8FD9\u4E2A\u672C\u5730\u65B9\u6CD5\u7684\u6700\u7EC8\u5B9E\u73B0\u5728 openjdk \u7684\u5982\u4E0B\u4F4D\u7F6E\uFF1Aopenjdk-7-fcs-src-b147-27_jun_2011\\openjdk\\hotspot\\src\\os_cpu\\windows_x86\\vm\\atomic_windows_x86.inline.hpp\uFF08\u5BF9\u5E94\u4E8E Windows \u64CD\u4F5C\u7CFB\u7EDF\uFF0CX86 \u5904\u7406\u5668\uFF09\u3002\u4E0B\u9762\u662F\u5BF9\u5E94\u4E8E intel X86 \u5904\u7406\u5668\u7684\u6E90\u4EE3\u7801\u7684\u7247\u6BB5\u3002</p><div class="language-c++ ext-c++ line-numbers-mode"><pre class="language-c++"><code>inline jint Atomic::cmpxchg (jint exchange_value, volatile jint* dest, jint compare_value) {
    // alternative for InterlockedCompareExchange
    int mp = os::is_MP();
    __asm {
        mov edx, dest
            mov ecx, exchange_value
            mov eax, compare_value
            LOCK_IF_MP(mp)
            cmpxchg dword ptr [edx], ecx
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5982\u4E0A\u9762\u6E90\u4EE3\u7801\u6240\u793A\uFF0C\u7A0B\u5E8F\u4F1A\u6839\u636E\u5F53\u524D\u5904\u7406\u5668\u7684\u7C7B\u578B\u6765\u51B3\u5B9A\u662F\u5426\u4E3A cmpxchg \u6307\u4EE4\u6DFB\u52A0 lock \u524D\u7F00\u3002\u5982\u679C\u7A0B\u5E8F\u662F\u5728\u591A\u5904\u7406\u5668\u4E0A\u8FD0\u884C\uFF0C\u5C31\u4E3A cmpxchg \u6307\u4EE4\u52A0\u4E0A lock \u524D\u7F00\uFF08Lock Cmpxchg\uFF09\u3002\u53CD\u4E4B\uFF0C\u5982\u679C\u7A0B\u5E8F\u662F\u5728\u5355\u5904\u7406\u5668\u4E0A\u8FD0\u884C\uFF0C\u5C31\u7701\u7565 lock \u524D\u7F00\uFF08\u5355\u5904\u7406\u5668\u81EA\u8EAB\u4F1A\u7EF4\u62A4\u5355\u5904\u7406\u5668\u5185\u7684\u987A\u5E8F\u4E00\u81F4\u6027\uFF0C\u4E0D\u9700\u8981 lock \u524D\u7F00\u63D0\u4F9B\u7684\u5185\u5B58\u5C4F\u969C\u6548\u679C\uFF09\u3002</p><p>intel \u7684\u624B\u518C\u5BF9 lock \u524D\u7F00\u7684\u8BF4\u660E\u5982\u4E0B\u3002</p><ol><li><p>\u786E\u4FDD\u5BF9\u5185\u5B58\u7684\u8BFB\u2014\u6539\u2014\u5199\u64CD\u4F5C\u539F\u5B50\u6267\u884C\u3002\u5728 Pentium \u53CA Pentium \u4E4B\u524D\u7684\u5904\u7406\u5668\u4E2D\uFF0C\u5E26\u6709 lock \u524D\u7F00\u7684\u6307\u4EE4\u5728\u6267\u884C\u671F\u95F4\u4F1A\u9501\u4F4F\u603B\u7EBF\uFF0C\u4F7F\u5F97\u5176\u4ED6\u5904\u7406\u5668\u6682\u65F6\u65E0\u6CD5\u901A\u8FC7\u603B\u7EBF\u8BBF\u95EE\u5185\u5B58\u3002\u5F88\u663E\u7136\uFF0C\u8FD9\u4F1A\u5E26\u6765\u6602\u8D35\u7684\u5F00\u9500\u3002\u4ECE Pentium 4\u3001Intel Xeon \u53CA P6 \u5904\u7406\u5668\u5F00\u59CB\uFF0CIntel \u4F7F\u7528\u7F13\u5B58\u9501\u5B9A\uFF08Cache Locking\uFF09\u6765\u4FDD\u8BC1\u6307\u4EE4\u6267\u884C\u7684\u539F\u5B50\u6027\u3002\u7F13\u5B58\u9501\u5B9A\u5C06\u5927\u5927\u964D\u4F4E lock \u524D\u7F00\u6307\u4EE4\u7684\u6267\u884C\u5F00\u9500\u3002</p></li><li><p>\u7981\u6B62\u8BE5\u6307\u4EE4\uFF0C\u4E0E\u4E4B\u524D\u548C\u4E4B\u540E\u7684\u8BFB\u548C\u5199\u6307\u4EE4\u91CD\u6392\u5E8F\u3002</p></li><li><p>\u628A\u5199\u7F13\u51B2\u533A\u4E2D\u7684\u6240\u6709\u6570\u636E\u5237\u65B0\u5230\u5185\u5B58\u4E2D\u3002</p></li></ol><p>\u4E0A\u9762\u7684\u7B2C 2 \u70B9\u548C\u7B2C 3 \u70B9\u6240\u5177\u6709\u7684\u5185\u5B58\u5C4F\u969C\u6548\u679C\uFF0C\u8DB3\u4EE5\u540C\u65F6\u5B9E\u73B0 volatile \u8BFB\u548C volatile \u5199\u7684\u5185\u5B58\u8BED\u4E49\u3002</p><p>\u7ECF\u8FC7\u4E0A\u9762\u7684\u5206\u6790\uFF0C\u73B0\u5728\u6211\u4EEC\u7EC8\u4E8E\u80FD\u660E\u767D\u4E3A\u4EC0\u4E48 JDK \u6587\u6863\u8BF4 CAS \u540C\u65F6\u5177\u6709 volatile \u8BFB\u548C volatile \u5199\u7684\u5185\u5B58\u8BED\u4E49\u4E86\u3002</p><p>\u73B0\u5728\u5BF9\u516C\u5E73\u9501\u548C\u975E\u516C\u5E73\u9501\u7684\u5185\u5B58\u8BED\u4E49\u505A\u4E2A\u603B\u7ED3\u3002</p><ul><li><p>\u516C\u5E73\u9501\u548C\u975E\u516C\u5E73\u9501\u91CA\u653E\u65F6\uFF0C\u6700\u540E\u90FD\u8981\u5199\u4E00\u4E2A volatile \u53D8\u91CF state\u3002</p></li><li><p>\u516C\u5E73\u9501\u83B7\u53D6\u65F6\uFF0C\u9996\u5148\u4F1A\u53BB\u8BFB volatile \u53D8\u91CF\u3002</p></li><li><p>\u975E\u516C\u5E73\u9501\u83B7\u53D6\u65F6\uFF0C\u9996\u5148\u4F1A\u7528 CAS \u66F4\u65B0 volatile \u53D8\u91CF\uFF0C\u8FD9\u4E2A\u64CD\u4F5C\u540C\u65F6\u5177\u6709 volatile \u8BFB\u548C volatile \u5199\u7684\u5185\u5B58\u8BED\u4E49\u3002</p></li></ul><p>\u4ECE\u672C\u6587\u5BF9 ReentrantLock \u7684\u5206\u6790\u53EF\u4EE5\u770B\u51FA\uFF0C\u9501\u91CA\u653E\u2014\u83B7\u53D6\u7684\u5185\u5B58\u8BED\u4E49\u7684\u5B9E\u73B0\u81F3\u5C11\u6709\u4E0B\u9762\u4E24\u79CD\u65B9\u5F0F\u3002</p><ol><li><p>\u5229\u7528 volatile \u53D8\u91CF\u7684\u5199\u2014\u8BFB\u6240\u5177\u6709\u7684\u5185\u5B58\u8BED\u4E49\u3002</p></li><li><p>\u5229\u7528 CAS \u6240\u9644\u5E26\u7684 volatile \u8BFB\u548C volatile \u5199\u7684\u5185\u5B58\u8BED\u4E49\u3002</p></li></ol><h3 id="_3-5-4-concurrent-\u5305\u7684\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_3-5-4-concurrent-\u5305\u7684\u5B9E\u73B0" aria-hidden="true">#</a> 3.5.4 concurrent \u5305\u7684\u5B9E\u73B0</h3><p>\u7531\u4E8E Java \u7684 CAS \u540C\u65F6\u5177\u6709 volatile \u8BFB\u548C volatile \u5199\u7684\u5185\u5B58\u8BED\u4E49\uFF0C\u56E0\u6B64 Java \u7EBF\u7A0B\u4E4B\u95F4\u7684\u901A\u4FE1\u73B0\u5728\u6709\u4E86\u4E0B\u9762 4 \u79CD\u65B9\u5F0F\u3002</p><ol><li><p>A \u7EBF\u7A0B\u5199 volatile \u53D8\u91CF\uFF0C\u968F\u540E B \u7EBF\u7A0B\u8BFB\u8FD9\u4E2A volatile \u53D8\u91CF\u3002</p></li><li><p>A \u7EBF\u7A0B\u5199 volatile \u53D8\u91CF\uFF0C\u968F\u540E B \u7EBF\u7A0B\u7528 CAS \u66F4\u65B0\u8FD9\u4E2A volatile \u53D8\u91CF\u3002</p></li><li><p>A \u7EBF\u7A0B\u7528 CAS \u66F4\u65B0\u4E00\u4E2A volatile \u53D8\u91CF\uFF0C\u968F\u540E B \u7EBF\u7A0B\u7528 CAS \u66F4\u65B0\u8FD9\u4E2A volatile \u53D8\u91CF\u3002</p></li><li><p>A \u7EBF\u7A0B\u7528 CAS \u66F4\u65B0\u4E00\u4E2A volatile \u53D8\u91CF\uFF0C\u968F\u540E B \u7EBF\u7A0B\u8BFB\u8FD9\u4E2A volatile \u53D8\u91CF\u3002</p></li></ol><p>Java \u7684 CAS \u4F1A\u4F7F\u7528\u73B0\u4EE3\u5904\u7406\u5668\u4E0A\u63D0\u4F9B\u7684\u9AD8\u6548\u673A\u5668\u7EA7\u522B\u7684\u539F\u5B50\u6307\u4EE4\uFF0C\u8FD9\u4E9B\u539F\u5B50\u6307\u4EE4\u4EE5\u539F\u5B50\u65B9\u5F0F\u5BF9\u5185\u5B58\u6267\u884C\u8BFB\u2014\u6539\u2014\u5199\u64CD\u4F5C\uFF0C\u8FD9\u662F\u5728\u591A\u5904\u7406\u5668\u4E2D\u5B9E\u73B0\u540C\u6B65\u7684\u5173\u952E\uFF08\u4ECE\u672C\u8D28\u4E0A\u6765\u8BF4\uFF0C\u80FD\u591F\u652F\u6301\u539F\u5B50\u6027\u8BFB\u2014\u6539\u2014\u5199\u6307\u4EE4\u7684\u8BA1\u7B97\u673A\uFF0C\u662F\u987A\u5E8F\u8BA1\u7B97\u56FE\u7075\u673A\u7684\u5F02\u6B65\u7B49\u4EF7\u673A\u5668\uFF0C\u56E0\u6B64\u4EFB\u4F55\u73B0\u4EE3\u7684\u591A\u5904\u7406\u5668\u90FD\u4F1A\u53BB\u652F\u6301\u67D0\u79CD\u80FD\u5BF9\u5185\u5B58\u6267\u884C\u539F\u5B50\u6027\u8BFB\u2014\u6539\u2014\u5199\u64CD\u4F5C\u7684\u539F\u5B50\u6307\u4EE4\uFF09\u3002\u540C\u65F6\uFF0Cvolatile \u53D8\u91CF\u7684\u8BFB / \u5199\u548C CAS \u53EF\u4EE5\u5B9E\u73B0\u7EBF\u7A0B\u4E4B\u95F4\u7684\u901A\u4FE1\u3002\u628A\u8FD9\u4E9B\u7279\u6027\u6574\u5408\u5728\u4E00\u8D77\uFF0C\u5C31\u5F62\u6210\u4E86\u6574\u4E2A concurrent \u5305\u5F97\u4EE5\u5B9E\u73B0\u7684\u57FA\u77F3\u3002\u5982\u679C\u6211\u4EEC\u4ED4\u7EC6\u5206\u6790 concurrent \u5305\u7684\u6E90\u4EE3\u7801\u5B9E\u73B0\uFF0C\u4F1A\u53D1\u73B0\u4E00\u4E2A\u901A\u7528\u5316\u7684\u5B9E\u73B0\u6A21\u5F0F\u3002</p><p>\u9996\u5148\uFF0C\u58F0\u660E\u5171\u4EAB\u53D8\u91CF\u4E3A volatile\u3002</p><p>\u7136\u540E\uFF0C\u4F7F\u7528 CAS \u7684\u539F\u5B50\u6761\u4EF6\u66F4\u65B0\u6765\u5B9E\u73B0\u7EBF\u7A0B\u4E4B\u95F4\u7684\u540C\u6B65\u3002</p><p>\u540C\u65F6\uFF0C\u914D\u5408\u4EE5 volatile \u7684\u8BFB / \u5199\u548C CAS \u6240\u5177\u6709\u7684 volatile \u8BFB\u548C\u5199\u7684\u5185\u5B58\u8BED\u4E49\u6765\u5B9E\u73B0\u7EBF\u7A0B\u4E4B\u95F4\u7684\u901A\u4FE1\u3002</p><p>AQS\uFF0C\u975E\u963B\u585E\u6570\u636E\u7ED3\u6784\u548C\u539F\u5B50\u53D8\u91CF\u7C7B\uFF08java.util.concurrent.atomic \u5305\u4E2D\u7684\u7C7B\uFF09\uFF0C\u8FD9\u4E9B concurrent \u5305\u4E2D\u7684\u57FA\u7840\u7C7B\u90FD\u662F\u4F7F\u7528\u8FD9\u79CD\u6A21\u5F0F\u6765\u5B9E\u73B0\u7684\uFF0C\u800C concurrent \u5305\u4E2D\u7684\u9AD8\u5C42\u7C7B\u53C8\u662F\u4F9D\u8D56\u4E8E\u8FD9\u4E9B\u57FA\u7840\u7C7B\u6765\u5B9E\u73B0\u7684\u3002\u4ECE\u6574\u4F53\u6765\u770B\uFF0Cconcurrent \u5305\u7684\u5B9E\u73B0\u793A\u610F\u56FE\u59823-28 \u6240\u793A\u3002</p><p><img src="`+E+`" alt="\u56FE3-28" loading="lazy"></p><p>\u56FE3-28 concurrent \u5305\u7684\u5B9E\u73B0\u793A\u610F\u56FE</p><h2 id="_3-6-final-\u57DF\u7684\u5185\u5B58\u8BED\u4E49" tabindex="-1"><a class="header-anchor" href="#_3-6-final-\u57DF\u7684\u5185\u5B58\u8BED\u4E49" aria-hidden="true">#</a> 3.6 final \u57DF\u7684\u5185\u5B58\u8BED\u4E49</h2><p>\u4E0E\u524D\u9762\u4ECB\u7ECD\u7684\u9501\u548C volatile \u76F8\u6BD4\uFF0C\u5BF9 final \u57DF\u7684\u8BFB\u548C\u5199\u66F4\u50CF\u662F\u666E\u901A\u7684\u53D8\u91CF\u8BBF\u95EE\u3002\u4E0B\u9762\u5C06\u4ECB\u7ECD final \u57DF\u7684\u5185\u5B58\u8BED\u4E49\u3002</p><h3 id="_3-6-1-final-\u57DF\u7684\u91CD\u6392\u5E8F\u89C4\u5219" tabindex="-1"><a class="header-anchor" href="#_3-6-1-final-\u57DF\u7684\u91CD\u6392\u5E8F\u89C4\u5219" aria-hidden="true">#</a> 3.6.1 final \u57DF\u7684\u91CD\u6392\u5E8F\u89C4\u5219</h3><p>\u5BF9\u4E8E final \u57DF\uFF0C\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u8981\u9075\u5B88\u4E24\u4E2A\u91CD\u6392\u5E8F\u89C4\u5219\u3002</p><ol><li><p>\u5728\u6784\u9020\u51FD\u6570\u5185\u5BF9\u4E00\u4E2A final \u57DF\u7684\u5199\u5165\uFF0C\u4E0E\u968F\u540E\u628A\u8FD9\u4E2A\u88AB\u6784\u9020\u5BF9\u8C61\u7684\u5F15\u7528\u8D4B\u503C\u7ED9\u4E00\u4E2A\u5F15\u7528\u53D8\u91CF\uFF0C\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u4E4B\u95F4\u4E0D\u80FD\u91CD\u6392\u5E8F\u3002</p></li><li><p>\u521D\u6B21\u8BFB\u4E00\u4E2A\u5305\u542B final \u57DF\u7684\u5BF9\u8C61\u7684\u5F15\u7528\uFF0C\u4E0E\u968F\u540E\u521D\u6B21\u8BFB\u8FD9\u4E2A final \u57DF\uFF0C\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u4E4B\u95F4\u4E0D\u80FD\u91CD\u6392\u5E8F\u3002</p></li></ol><p>\u4E0B\u9762\u901A\u8FC7\u4E00\u4E9B\u793A\u4F8B\u6027\u7684\u4EE3\u7801\u6765\u5206\u522B\u8BF4\u660E\u8FD9\u4E24\u4E2A\u89C4\u5219\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FinalExample</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>                				<span class="token comment">// \u666E\u901A\u53D8\u91CF</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> j<span class="token punctuation">;</span>             			<span class="token comment">// final \u53D8\u91CF</span>
    <span class="token keyword">static</span> <span class="token class-name">FinalExample</span> obj<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">FinalExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>       		<span class="token comment">// \u6784\u9020\u51FD\u6570</span>
        i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>              			<span class="token comment">// \u5199\u666E\u901A\u57DF</span>
        j <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>              			<span class="token comment">// \u5199 final \u57DF</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    	<span class="token comment">// \u5199\u7EBF\u7A0B A \u6267\u884C</span>
        obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FinalExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    	<span class="token comment">// \u8BFB\u7EBF\u7A0B B \u6267\u884C</span>
        <span class="token class-name">FinalExample</span> object <span class="token operator">=</span> obj<span class="token punctuation">;</span>    	<span class="token comment">// \u8BFB\u5BF9\u8C61\u5F15\u7528</span>
        <span class="token keyword">int</span> a <span class="token operator">=</span> object<span class="token punctuation">.</span>i<span class="token punctuation">;</span>        		<span class="token comment">// \u8BFB\u666E\u901A\u57DF</span>
        <span class="token keyword">int</span> b <span class="token operator">=</span> object<span class="token punctuation">.</span>j<span class="token punctuation">;</span>        		<span class="token comment">// \u8BFB final \u57DF</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u5047\u8BBE\u4E00\u4E2A\u7EBF\u7A0B A \u6267\u884C writer() \u65B9\u6CD5\uFF0C\u968F\u540E\u53E6\u4E00\u4E2A\u7EBF\u7A0B B \u6267\u884C reader() \u65B9\u6CD5\u3002\u4E0B\u9762\u6211\u4EEC\u901A\u8FC7\u8FD9\u4E24\u4E2A\u7EBF\u7A0B\u7684\u4EA4\u4E92\u6765\u8BF4\u660E\u8FD9\u4E24\u4E2A\u89C4\u5219\u3002</p><h3 id="_3-6-2-\u5199-final-\u57DF\u7684\u91CD\u6392\u5E8F\u89C4\u5219" tabindex="-1"><a class="header-anchor" href="#_3-6-2-\u5199-final-\u57DF\u7684\u91CD\u6392\u5E8F\u89C4\u5219" aria-hidden="true">#</a> 3.6.2 \u5199 final \u57DF\u7684\u91CD\u6392\u5E8F\u89C4\u5219</h3><p>\u5199 final \u57DF\u7684\u91CD\u6392\u5E8F\u89C4\u5219\u7981\u6B62\u628A final \u57DF\u7684\u5199\u91CD\u6392\u5E8F\u5230\u6784\u9020\u51FD\u6570\u4E4B\u5916\u3002\u8FD9\u4E2A\u89C4\u5219\u7684\u5B9E\u73B0\u5305\u542B\u4E0B\u9762 2 \u4E2A\u65B9\u9762\u3002</p><ol><li><p>JMM \u7981\u6B62\u7F16\u8BD1\u5668\u628A final \u57DF\u7684\u5199\u91CD\u6392\u5E8F\u5230\u6784\u9020\u51FD\u6570\u4E4B\u5916\u3002</p></li><li><p>\u7F16\u8BD1\u5668\u4F1A\u5728 final \u57DF\u7684\u5199\u4E4B\u540E\uFF0C\u6784\u9020\u51FD\u6570 return \u4E4B\u524D\uFF0C\u63D2\u5165\u4E00\u4E2A StoreStore \u5C4F\u969C\u3002\u8FD9\u4E2A\u5C4F\u969C\u7981\u6B62\u5904\u7406\u5668\u628A final \u57DF\u7684\u5199\u91CD\u6392\u5E8F\u5230\u6784\u9020\u51FD\u6570\u4E4B\u5916\u3002</p></li></ol><p>\u73B0\u5728\u8BA9\u6211\u4EEC\u5206\u6790 writer() \u65B9\u6CD5\u3002writer() \u65B9\u6CD5\u53EA\u5305\u542B\u4E00\u884C\u4EE3\u7801\uFF1Afinal Example = new FinalExample()\u3002\u8FD9\u884C\u4EE3\u7801\u5305\u542B\u4E24\u4E2A\u6B65\u9AA4\uFF0C\u5982\u4E0B\u3002</p><ol><li><p>\u6784\u9020\u4E00\u4E2A FinalExample \u7C7B\u578B\u7684\u5BF9\u8C61\u3002</p></li><li><p>\u628A\u8FD9\u4E2A\u5BF9\u8C61\u7684\u5F15\u7528\u8D4B\u503C\u7ED9\u5F15\u7528\u53D8\u91CF obj\u3002</p></li></ol><p>\u5047\u8BBE\u7EBF\u7A0B B \u8BFB\u5BF9\u8C61\u5F15\u7528\u4E0E\u8BFB\u5BF9\u8C61\u7684\u6210\u5458\u57DF\u4E4B\u95F4\u6CA1\u6709\u91CD\u6392\u5E8F\uFF08\u9A6C\u4E0A\u4F1A\u8BF4\u660E\u4E3A\u4EC0\u4E48\u9700\u8981\u8FD9\u4E2A\u5047\u8BBE\uFF09\uFF0C\u56FE3-29 \u662F\u4E00\u79CD\u53EF\u80FD\u7684\u6267\u884C\u65F6\u5E8F\u3002</p><p><img src="`+F+'" alt="\u56FE3-29" loading="lazy"></p><p>\u56FE3-29 \u7EBF\u7A0B\u6267\u884C\u65F6\u5E8F\u56FE</p><p>\u5728\u56FE3-29 \u4E2D\uFF0C\u5199\u666E\u901A\u57DF\u7684\u64CD\u4F5C\u88AB\u7F16\u8BD1\u5668\u91CD\u6392\u5E8F\u5230\u4E86\u6784\u9020\u51FD\u6570\u4E4B\u5916\uFF0C\u8BFB\u7EBF\u7A0B B \u9519\u8BEF\u5730\u8BFB\u53D6\u4E86\u666E\u901A\u53D8\u91CF i \u521D\u59CB\u5316\u4E4B\u524D\u7684\u503C\u3002\u800C\u5199 final \u57DF\u7684\u64CD\u4F5C\uFF0C\u88AB\u5199 final \u57DF\u7684\u91CD\u6392\u5E8F\u89C4\u5219 \u201C\u9650\u5B9A\u201D \u5728\u4E86\u6784\u9020\u51FD\u6570\u4E4B\u5185\uFF0C\u8BFB\u7EBF\u7A0B B \u6B63\u786E\u5730\u8BFB\u53D6\u4E86 final \u53D8\u91CF\u521D\u59CB\u5316\u4E4B\u540E\u7684\u503C\u3002</p><p>\u5199 final \u57DF\u7684\u91CD\u6392\u5E8F\u89C4\u5219\u53EF\u4EE5\u786E\u4FDD\uFF1A\u5728\u5BF9\u8C61\u5F15\u7528\u4E3A\u4EFB\u610F\u7EBF\u7A0B\u53EF\u89C1\u4E4B\u524D\uFF0C\u5BF9\u8C61\u7684 final \u57DF\u5DF2\u7ECF\u88AB\u6B63\u786E\u521D\u59CB\u5316\u8FC7\u4E86\uFF0C\u800C\u666E\u901A\u57DF\u4E0D\u5177\u6709\u8FD9\u4E2A\u4FDD\u969C\u3002\u4EE5\u4E0A\u56FE\u4E3A\u4F8B\uFF0C\u5728\u8BFB\u7EBF\u7A0B B \u201C\u770B\u5230\u201D \u5BF9\u8C61\u5F15\u7528 obj \u65F6\uFF0C\u5F88\u53EF\u80FD obj \u5BF9\u8C61\u8FD8\u6CA1\u6709\u6784\u9020\u5B8C\u6210\uFF08\u5BF9\u666E\u901A\u57DF i \u7684\u5199\u64CD\u4F5C\u88AB\u91CD\u6392\u5E8F\u5230\u6784\u9020\u51FD\u6570\u5916\uFF0C\u6B64\u65F6\u521D\u59CB\u503C 1 \u8FD8\u6CA1\u6709\u5199\u5165\u666E\u901A\u57DF i\uFF09\u3002</p><h3 id="_3-6-3-\u8BFB-final-\u57DF\u7684\u91CD\u6392\u5E8F\u89C4\u5219" tabindex="-1"><a class="header-anchor" href="#_3-6-3-\u8BFB-final-\u57DF\u7684\u91CD\u6392\u5E8F\u89C4\u5219" aria-hidden="true">#</a> 3.6.3 \u8BFB final \u57DF\u7684\u91CD\u6392\u5E8F\u89C4\u5219</h3><p>\u8BFB final \u57DF\u7684\u91CD\u6392\u5E8F\u89C4\u5219\u662F\uFF0C\u5728\u4E00\u4E2A\u7EBF\u7A0B\u4E2D\uFF0C\u521D\u6B21\u8BFB\u5BF9\u8C61\u5F15\u7528\u4E0E\u521D\u6B21\u8BFB\u8BE5\u5BF9\u8C61\u5305\u542B\u7684 final \u57DF\uFF0CJMM \u7981\u6B62\u5904\u7406\u5668\u91CD\u6392\u5E8F\u8FD9\u4E24\u4E2A\u64CD\u4F5C\uFF08\u6CE8\u610F\uFF0C\u8FD9\u4E2A\u89C4\u5219\u4EC5\u4EC5\u9488\u5BF9\u5904\u7406\u5668\uFF09\u3002\u7F16\u8BD1\u5668\u4F1A\u5728\u8BFB final \u57DF\u64CD\u4F5C\u7684\u524D\u9762\u63D2\u5165\u4E00\u4E2A LoadLoad \u5C4F\u969C\u3002</p><p>\u521D\u6B21\u8BFB\u5BF9\u8C61\u5F15\u7528\u4E0E\u521D\u6B21\u8BFB\u8BE5\u5BF9\u8C61\u5305\u542B\u7684 final \u57DF\uFF0C\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u4E4B\u95F4\u5B58\u5728\u95F4\u63A5\u4F9D\u8D56\u5173\u7CFB\u3002\u7531\u4E8E\u7F16\u8BD1\u5668\u9075\u5B88\u95F4\u63A5\u4F9D\u8D56\u5173\u7CFB\uFF0C\u56E0\u6B64\u7F16\u8BD1\u5668\u4E0D\u4F1A\u91CD\u6392\u5E8F\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u3002\u5927\u591A\u6570\u5904\u7406\u5668\u4E5F\u4F1A\u9075\u5B88\u95F4\u63A5\u4F9D\u8D56\uFF0C\u4E5F\u4E0D\u4F1A\u91CD\u6392\u5E8F\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u3002\u4F46\u6709\u5C11\u6570\u5904\u7406\u5668\u5141\u8BB8\u5BF9\u5B58\u5728\u95F4\u63A5\u4F9D\u8D56\u5173\u7CFB\u7684\u64CD\u4F5C\u505A\u91CD\u6392\u5E8F\uFF08\u6BD4\u5982 alpha \u5904\u7406\u5668\uFF09\uFF0C\u8FD9\u4E2A\u89C4\u5219\u5C31\u662F\u4E13\u95E8\u7528\u6765\u9488\u5BF9\u8FD9\u79CD\u5904\u7406\u5668\u7684\u3002</p><p>reader() \u65B9\u6CD5\u5305\u542B 3 \u4E2A\u64CD\u4F5C\u3002</p><ul><li><p>\u521D\u6B21\u8BFB\u5F15\u7528\u53D8\u91CF obj\u3002</p></li><li><p>\u521D\u6B21\u8BFB\u5F15\u7528\u53D8\u91CF obj \u6307\u5411\u5BF9\u8C61\u7684\u666E\u901A\u57DF i\u3002</p></li><li><p>\u521D\u6B21\u8BFB\u5F15\u7528\u53D8\u91CF obj \u6307\u5411\u5BF9\u8C61\u7684 final \u57DF j\u3002</p></li></ul><p>\u73B0\u5728\u5047\u8BBE\u5199\u7EBF\u7A0B A \u6CA1\u6709\u53D1\u751F\u4EFB\u4F55\u91CD\u6392\u5E8F\uFF0C\u540C\u65F6\u7A0B\u5E8F\u5728\u4E0D\u9075\u5B88\u95F4\u63A5\u4F9D\u8D56\u7684\u5904\u7406\u5668\u4E0A\u6267\u884C\uFF0C\u56FE3-30 \u6240\u793A\u662F\u4E00\u79CD\u53EF\u80FD\u7684\u6267\u884C\u65F6\u5E8F\u3002</p><p><img src="'+O+`" alt="\u56FE3-30" loading="lazy"></p><p>\u56FE3-30 \u7EBF\u7A0B\u6267\u884C\u65F6\u5E8F\u56FE</p><p>\u5728\u56FE3-30 \u4E2D\uFF0C\u8BFB\u5BF9\u8C61\u7684\u666E\u901A\u57DF\u7684\u64CD\u4F5C\u88AB\u5904\u7406\u5668\u91CD\u6392\u5E8F\u5230\u8BFB\u5BF9\u8C61\u5F15\u7528\u4E4B\u524D\u3002\u8BFB\u666E\u901A\u57DF\u65F6\uFF0C\u8BE5\u57DF\u8FD8\u6CA1\u6709\u88AB\u5199\u7EBF\u7A0B A \u5199\u5165\uFF0C\u8FD9\u662F\u4E00\u4E2A\u9519\u8BEF\u7684\u8BFB\u53D6\u64CD\u4F5C\u3002\u800C\u8BFB final \u57DF\u7684\u91CD\u6392\u5E8F\u89C4\u5219\u4F1A\u628A\u8BFB\u5BF9\u8C61 final \u57DF\u7684\u64CD\u4F5C \u201C\u9650\u5B9A\u201D \u5728\u8BFB\u5BF9\u8C61\u5F15\u7528\u4E4B\u540E\uFF0C\u6B64\u65F6\u8BE5 final \u57DF\u5DF2\u7ECF\u88AB A \u7EBF\u7A0B\u521D\u59CB\u5316\u8FC7\u4E86\uFF0C\u8FD9\u662F\u4E00\u4E2A\u6B63\u786E\u7684\u8BFB\u53D6\u64CD\u4F5C\u3002</p><p>\u8BFB final \u57DF\u7684\u91CD\u6392\u5E8F\u89C4\u5219\u53EF\u4EE5\u786E\u4FDD\uFF1A\u5728\u8BFB\u4E00\u4E2A\u5BF9\u8C61\u7684 final \u57DF\u4E4B\u524D\uFF0C\u4E00\u5B9A\u4F1A\u5148\u8BFB\u5305\u542B\u8FD9\u4E2A final \u57DF\u7684\u5BF9\u8C61\u7684\u5F15\u7528\u3002\u5728\u8FD9\u4E2A\u793A\u4F8B\u7A0B\u5E8F\u4E2D\uFF0C\u5982\u679C\u8BE5\u5F15\u7528\u4E0D\u4E3A null\uFF0C\u90A3\u4E48\u5F15\u7528\u5BF9\u8C61\u7684 final \u57DF\u4E00\u5B9A\u5DF2\u7ECF\u88AB A \u7EBF\u7A0B\u521D\u59CB\u5316\u8FC7\u4E86\u3002</p><h3 id="_3-6-4-final-\u57DF\u4E3A\u5F15\u7528\u7C7B\u578B" tabindex="-1"><a class="header-anchor" href="#_3-6-4-final-\u57DF\u4E3A\u5F15\u7528\u7C7B\u578B" aria-hidden="true">#</a> 3.6.4 final \u57DF\u4E3A\u5F15\u7528\u7C7B\u578B</h3><p>\u4E0A\u9762\u6211\u4EEC\u770B\u5230\u7684 final \u57DF\u662F\u57FA\u7840\u6570\u636E\u7C7B\u578B\uFF0C\u5982\u679C final \u57DF\u662F\u5F15\u7528\u7C7B\u578B\uFF0C\u5C06\u4F1A\u6709\u4EC0\u4E48\u6548\u679C\uFF1F\u8BF7\u770B\u4E0B\u5217\u793A\u4F8B\u4EE3\u7801\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FinalReferenceExample</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> intArray<span class="token punctuation">;</span>           			<span class="token comment">// final \u662F\u5F15\u7528\u7C7B\u578B</span>
    <span class="token keyword">static</span> <span class="token class-name">FinalReferenceExample</span> obj<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">FinalReferenceExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     		<span class="token comment">// \u6784\u9020\u51FD\u6570</span>
        intArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>         			<span class="token comment">// 1</span>
        intArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>            			<span class="token comment">// 2</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">writerOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     		<span class="token comment">// \u5199\u7EBF\u7A0B A \u6267\u884C</span>
        obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FinalReferenceExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  	<span class="token comment">// 3</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">writerTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     		<span class="token comment">// \u5199\u7EBF\u7A0B B \u6267\u884C</span>
        obj<span class="token punctuation">.</span>intArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>          			<span class="token comment">// 4</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>       		<span class="token comment">// \u8BFB\u7EBF\u7A0B C \u6267\u884C</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           			<span class="token comment">// 5</span>
            <span class="token keyword">int</span> temp1 <span class="token operator">=</span> obj<span class="token punctuation">.</span>intArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    	<span class="token comment">// 6</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u672C\u4F8B final \u57DF\u4E3A\u4E00\u4E2A\u5F15\u7528\u7C7B\u578B\uFF0C\u5B83\u5F15\u7528\u4E00\u4E2A int \u578B\u7684\u6570\u7EC4\u5BF9\u8C61\u3002\u5BF9\u4E8E\u5F15\u7528\u7C7B\u578B\uFF0C\u5199 final \u57DF\u7684\u91CD\u6392\u5E8F\u89C4\u5219\u5BF9\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u589E\u52A0\u4E86\u5982\u4E0B\u7EA6\u675F\uFF1A\u5728\u6784\u9020\u51FD\u6570\u5185\u5BF9\u4E00\u4E2A final \u5F15\u7528\u7684\u5BF9\u8C61\u7684\u6210\u5458\u57DF\u7684\u5199\u5165\uFF0C\u4E0E\u968F\u540E\u5728\u6784\u9020\u51FD\u6570\u5916\u628A\u8FD9\u4E2A\u88AB\u6784\u9020\u5BF9\u8C61\u7684\u5F15\u7528\u8D4B\u503C\u7ED9\u4E00\u4E2A\u5F15\u7528\u53D8\u91CF\uFF0C\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u4E4B\u95F4\u4E0D\u80FD\u91CD\u6392\u5E8F\u3002</p><p>\u5BF9\u4E0A\u9762\u7684\u793A\u4F8B\u7A0B\u5E8F\uFF0C\u5047\u8BBE\u9996\u5148\u7EBF\u7A0B A \u6267\u884C writerOne() \u65B9\u6CD5\uFF0C\u6267\u884C\u5B8C\u540E\u7EBF\u7A0B B \u6267\u884C writerTwo() \u65B9\u6CD5\uFF0C\u6267\u884C\u5B8C\u540E\u7EBF\u7A0B C \u6267\u884C reader() \u65B9\u6CD5\u3002\u56FE3-31 \u662F\u4E00\u79CD\u53EF\u80FD\u7684\u7EBF\u7A0B\u6267\u884C\u65F6\u5E8F\u3002</p><p><img src="`+D+`" alt="\u56FE3-31" loading="lazy"></p><p>\u56FE3-31 \u5F15\u7528\u578B final \u7684\u6267\u884C\u65F6\u5E8F\u56FE</p><p>\u5728\u56FE3-31 \u4E2D\uFF0C1 \u662F\u5BF9 final \u57DF\u7684\u5199\u5165\uFF0C2 \u662F\u5BF9\u8FD9\u4E2A final \u57DF\u5F15\u7528\u7684\u5BF9\u8C61\u7684\u6210\u5458\u57DF\u7684\u5199\u5165\uFF0C3 \u662F\u628A\u88AB\u6784\u9020\u7684\u5BF9\u8C61\u7684\u5F15\u7528\u8D4B\u503C\u7ED9\u67D0\u4E2A\u5F15\u7528\u53D8\u91CF\u3002\u8FD9\u91CC\u9664\u4E86\u524D\u9762\u63D0\u5230\u7684 1 \u4E0D\u80FD\u548C 3 \u91CD\u6392\u5E8F\u5916\uFF0C2 \u548C 3 \u4E5F\u4E0D\u80FD\u91CD\u6392\u5E8F\u3002</p><p>JMM \u53EF\u4EE5\u786E\u4FDD\u8BFB\u7EBF\u7A0B C \u81F3\u5C11\u80FD\u770B\u5230\u5199\u7EBF\u7A0B A \u5728\u6784\u9020\u51FD\u6570\u4E2D\u5BF9 final \u5F15\u7528\u5BF9\u8C61\u7684\u6210\u5458\u57DF\u7684\u5199\u5165\u3002\u5373 C \u81F3\u5C11\u80FD\u770B\u5230\u6570\u7EC4\u4E0B\u6807 0 \u7684\u503C\u4E3A 1\u3002\u800C\u5199\u7EBF\u7A0B B \u5BF9\u6570\u7EC4\u5143\u7D20\u7684\u5199\u5165\uFF0C\u8BFB\u7EBF\u7A0B C \u53EF\u80FD\u770B\u5F97\u5230\uFF0C\u4E5F\u53EF\u80FD\u770B\u4E0D\u5230\u3002JMM \u4E0D\u4FDD\u8BC1\u7EBF\u7A0B B \u7684\u5199\u5165\u5BF9\u8BFB\u7EBF\u7A0B C \u53EF\u89C1\uFF0C\u56E0\u4E3A\u5199\u7EBF\u7A0B B \u548C\u8BFB\u7EBF\u7A0B C \u4E4B\u95F4\u5B58\u5728\u6570\u636E\u7ADE\u4E89\uFF0C\u6B64\u65F6\u7684\u6267\u884C\u7ED3\u679C\u4E0D\u53EF\u9884\u77E5\u3002</p><p>\u5982\u679C\u60F3\u8981\u786E\u4FDD\u8BFB\u7EBF\u7A0B C \u770B\u5230\u5199\u7EBF\u7A0B B \u5BF9\u6570\u7EC4\u5143\u7D20\u7684\u5199\u5165\uFF0C\u5199\u7EBF\u7A0B B \u548C\u8BFB\u7EBF\u7A0B C \u4E4B\u95F4\u9700\u8981\u4F7F\u7528\u540C\u6B65\u539F\u8BED\uFF08lock \u6216 volatile\uFF09\u6765\u786E\u4FDD\u5185\u5B58\u53EF\u89C1\u6027\u3002</p><h3 id="_3-6-5-\u4E3A\u4EC0\u4E48-final-\u5F15\u7528\u4E0D\u80FD\u4ECE\u6784\u9020\u51FD\u6570\u5185-\u6EA2\u51FA" tabindex="-1"><a class="header-anchor" href="#_3-6-5-\u4E3A\u4EC0\u4E48-final-\u5F15\u7528\u4E0D\u80FD\u4ECE\u6784\u9020\u51FD\u6570\u5185-\u6EA2\u51FA" aria-hidden="true">#</a> 3.6.5 \u4E3A\u4EC0\u4E48 final \u5F15\u7528\u4E0D\u80FD\u4ECE\u6784\u9020\u51FD\u6570\u5185 \u201C\u6EA2\u51FA\u201D</h3><p>\u524D\u9762\u6211\u4EEC\u63D0\u5230\u8FC7\uFF0C\u5199 final \u57DF\u7684\u91CD\u6392\u5E8F\u89C4\u5219\u53EF\u4EE5\u786E\u4FDD\uFF1A\u5728\u5F15\u7528\u53D8\u91CF\u4E3A\u4EFB\u610F\u7EBF\u7A0B\u53EF\u89C1\u4E4B\u524D\uFF0C\u8BE5\u5F15\u7528\u53D8\u91CF\u6307\u5411\u7684\u5BF9\u8C61\u7684 final \u57DF\u5DF2\u7ECF\u5728\u6784\u9020\u51FD\u6570\u4E2D\u88AB\u6B63\u786E\u521D\u59CB\u5316\u8FC7\u4E86\u3002\u5176\u5B9E\uFF0C\u8981\u5F97\u5230\u8FD9\u4E2A\u6548\u679C\uFF0C\u8FD8\u9700\u8981\u4E00\u4E2A\u4FDD\u8BC1\uFF1A\u5728\u6784\u9020\u51FD\u6570\u5185\u90E8\uFF0C\u4E0D\u80FD\u8BA9\u8FD9\u4E2A\u88AB\u6784\u9020\u5BF9\u8C61\u7684\u5F15\u7528\u4E3A\u5176\u4ED6\u7EBF\u7A0B\u6240\u89C1\uFF0C\u4E5F\u5C31\u662F\u5BF9\u8C61\u5F15\u7528\u4E0D\u80FD\u5728\u6784\u9020\u51FD\u6570\u4E2D \u201C\u9038\u51FA\u201D\u3002\u4E3A\u4E86\u8BF4\u660E\u95EE\u9898\uFF0C\u8BA9\u6211\u4EEC\u6765\u770B\u4E0B\u9762\u7684\u793A\u4F8B\u4EE3\u7801\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FinalReferenceEscapeExample</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">FinalReferenceEscapeExample</span> obj<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">FinalReferenceEscapeExample</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>              				<span class="token comment">// 1 \u5199 final \u57DF</span>
        obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>           				<span class="token comment">// 2 this \u5F15\u7528\u5728\u6B64 &quot;\u9038\u51FA&quot;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">FinalReferenceEscapeExample</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>       			<span class="token comment">// 3</span>
            <span class="token keyword">int</span> temp <span class="token operator">=</span> obj<span class="token punctuation">.</span>i<span class="token punctuation">;</span>      			<span class="token comment">// 4</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5047\u8BBE\u4E00\u4E2A\u7EBF\u7A0B A \u6267\u884C writer() \u65B9\u6CD5\uFF0C\u53E6\u4E00\u4E2A\u7EBF\u7A0B B \u6267\u884C reader() \u65B9\u6CD5\u3002\u8FD9\u91CC\u7684\u64CD\u4F5C 2 \u4F7F\u5F97\u5BF9\u8C61\u8FD8\u672A\u5B8C\u6210\u6784\u9020\u524D\u5C31\u4E3A\u7EBF\u7A0B B \u53EF\u89C1\u3002\u5373\u4F7F\u8FD9\u91CC\u7684\u64CD\u4F5C 2 \u662F\u6784\u9020\u51FD\u6570\u7684\u6700\u540E\u4E00\u6B65\uFF0C\u4E14\u5728\u7A0B\u5E8F\u4E2D\u64CD\u4F5C 2 \u6392\u5728\u64CD\u4F5C 1 \u540E\u9762\uFF0C\u6267\u884C read() \u65B9\u6CD5\u7684\u7EBF\u7A0B\u4ECD\u7136\u53EF\u80FD\u65E0\u6CD5\u770B\u5230 final \u57DF\u88AB\u521D\u59CB\u5316\u540E\u7684\u503C\uFF0C\u56E0\u4E3A\u8FD9\u91CC\u7684\u64CD\u4F5C 1 \u548C\u64CD\u4F5C 2 \u4E4B\u95F4\u53EF\u80FD\u88AB\u91CD\u6392\u5E8F\u3002\u5B9E\u9645\u7684\u6267\u884C\u65F6\u5E8F\u53EF\u80FD\u5982\u56FE3-32 \u6240\u793A\u3002</p><p><img src="`+V+`" alt="\u56FE3-32" loading="lazy"></p><p>\u56FE3-32 \u591A\u7EBF\u7A0B\u6267\u884C\u65F6\u5E8F\u56FE</p><p>\u4ECE\u56FE3-32 \u53EF\u4EE5\u770B\u51FA\uFF1A\u5728\u6784\u9020\u51FD\u6570\u8FD4\u56DE\u524D\uFF0C\u88AB\u6784\u9020\u5BF9\u8C61\u7684\u5F15\u7528\u4E0D\u80FD\u4E3A\u5176\u4ED6\u7EBF\u7A0B\u6240\u89C1\uFF0C\u56E0\u4E3A\u6B64\u65F6\u7684 final \u57DF\u53EF\u80FD\u8FD8\u6CA1\u6709\u88AB\u521D\u59CB\u5316\u3002\u5728\u6784\u9020\u51FD\u6570\u8FD4\u56DE\u540E\uFF0C\u4EFB\u610F\u7EBF\u7A0B\u90FD\u5C06\u4FDD\u8BC1\u80FD\u770B\u5230 final \u57DF\u6B63\u786E\u521D\u59CB\u5316\u4E4B\u540E\u7684\u503C\u3002</p><h3 id="_3-6-6-final-\u8BED\u4E49\u5728\u5904\u7406\u5668\u4E2D\u7684\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_3-6-6-final-\u8BED\u4E49\u5728\u5904\u7406\u5668\u4E2D\u7684\u5B9E\u73B0" aria-hidden="true">#</a> 3.6.6 final \u8BED\u4E49\u5728\u5904\u7406\u5668\u4E2D\u7684\u5B9E\u73B0</h3><p>\u73B0\u5728\u6211\u4EEC\u4EE5 X86 \u5904\u7406\u5668\u4E3A\u4F8B\uFF0C\u8BF4\u660E final \u8BED\u4E49\u5728\u5904\u7406\u5668\u4E2D\u7684\u5177\u4F53\u5B9E\u73B0\u3002</p><p>\u4E0A\u9762\u6211\u4EEC\u63D0\u5230\uFF0C\u5199 final \u57DF\u7684\u91CD\u6392\u5E8F\u89C4\u5219\u4F1A\u8981\u6C42\u7F16\u8BD1\u5668\u5728 final \u57DF\u7684\u5199\u4E4B\u540E\uFF0C\u6784\u9020\u51FD\u6570 return \u4E4B\u524D\u63D2\u5165\u4E00\u4E2A StoreStore \u969C\u5C4F\u3002\u8BFB final \u57DF\u7684\u91CD\u6392\u5E8F\u89C4\u5219\u8981\u6C42\u7F16\u8BD1\u5668\u5728\u8BFB final \u57DF\u7684\u64CD\u4F5C\u524D\u9762\u63D2\u5165\u4E00\u4E2A LoadLoad \u5C4F\u969C\u3002</p><p>\u7531\u4E8E X86 \u5904\u7406\u5668\u4E0D\u4F1A\u5BF9\u5199\u2014\u5199\u64CD\u4F5C\u505A\u91CD\u6392\u5E8F\uFF0C\u6240\u4EE5\u5728 X86 \u5904\u7406\u5668\u4E2D\uFF0C\u5199 final \u57DF\u9700\u8981\u7684 StoreStore \u969C\u5C4F\u4F1A\u88AB\u7701\u7565\u6389\u3002\u540C\u6837\uFF0C\u7531\u4E8E X86 \u5904\u7406\u5668\u4E0D\u4F1A\u5BF9\u5B58\u5728\u95F4\u63A5\u4F9D\u8D56\u5173\u7CFB\u7684\u64CD\u4F5C\u505A\u91CD\u6392\u5E8F\uFF0C\u6240\u4EE5\u5728 X86 \u5904\u7406\u5668\u4E2D\uFF0C\u8BFB final \u57DF\u9700\u8981\u7684 LoadLoad \u5C4F\u969C\u4E5F\u4F1A\u88AB\u7701\u7565\u6389\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C\u5728 X86 \u5904\u7406\u5668\u4E2D\uFF0Cfinal \u57DF\u7684\u8BFB / \u5199\u4E0D\u4F1A\u63D2\u5165\u4EFB\u4F55\u5185\u5B58\u5C4F\u969C\uFF01</p><h3 id="_3-6-7-jsr-133-\u4E3A\u4EC0\u4E48\u8981\u589E\u5F3A-final-\u7684\u8BED\u4E49" tabindex="-1"><a class="header-anchor" href="#_3-6-7-jsr-133-\u4E3A\u4EC0\u4E48\u8981\u589E\u5F3A-final-\u7684\u8BED\u4E49" aria-hidden="true">#</a> 3.6.7 JSR-133 \u4E3A\u4EC0\u4E48\u8981\u589E\u5F3A final \u7684\u8BED\u4E49</h3><p>\u5728\u65E7\u7684 Java \u5185\u5B58\u6A21\u578B\u4E2D\uFF0C\u4E00\u4E2A\u6700\u4E25\u91CD\u7684\u7F3A\u9677\u5C31\u662F\u7EBF\u7A0B\u53EF\u80FD\u770B\u5230 final \u57DF\u7684\u503C\u4F1A\u6539\u53D8\u3002\u6BD4\u5982\uFF0C\u4E00\u4E2A\u7EBF\u7A0B\u5F53\u524D\u770B\u5230\u4E00\u4E2A\u6574\u578B final \u57DF\u7684\u503C\u4E3A 0\uFF08\u8FD8\u672A\u521D\u59CB\u5316\u4E4B\u524D\u7684\u9ED8\u8BA4\u503C\uFF09\uFF0C\u8FC7\u4E00\u6BB5\u65F6\u95F4\u4E4B\u540E\u8FD9\u4E2A\u7EBF\u7A0B\u518D\u53BB\u8BFB\u8FD9\u4E2A final \u57DF\u7684\u503C\u65F6\uFF0C\u5374\u53D1\u73B0\u503C\u53D8\u4E3A 1\uFF08\u88AB\u67D0\u4E2A\u7EBF\u7A0B\u521D\u59CB\u5316\u4E4B\u540E\u7684\u503C\uFF09\u3002\u6700\u5E38\u89C1\u7684\u4F8B\u5B50\u5C31\u662F\u5728\u65E7\u7684 Java \u5185\u5B58\u6A21\u578B\u4E2D\uFF0CString \u7684\u503C\u53EF\u80FD\u4F1A\u6539\u53D8\u3002</p><p>\u4E3A\u4E86\u4FEE\u8865\u8FD9\u4E2A\u6F0F\u6D1E\uFF0CJSR-133 \u4E13\u5BB6\u7EC4\u589E\u5F3A\u4E86 final \u7684\u8BED\u4E49\u3002\u901A\u8FC7\u4E3A final \u57DF\u589E\u52A0\u5199\u548C\u8BFB\u91CD\u6392\u5E8F\u89C4\u5219\uFF0C\u53EF\u4EE5\u4E3A Java \u7A0B\u5E8F\u5458\u63D0\u4F9B\u521D\u59CB\u5316\u5B89\u5168\u4FDD\u8BC1\uFF1A\u53EA\u8981\u5BF9\u8C61\u662F\u6B63\u786E\u6784\u9020\u7684\uFF08\u88AB\u6784\u9020\u5BF9\u8C61\u7684\u5F15\u7528\u5728\u6784\u9020\u51FD\u6570\u4E2D\u6CA1\u6709 \u201C\u9038\u51FA\u201D\uFF09\uFF0C\u90A3\u4E48\u4E0D\u9700\u8981\u4F7F\u7528\u540C\u6B65\uFF08\u6307 lock \u548C volatile \u7684\u4F7F\u7528\uFF09\u5C31\u53EF\u4EE5\u4FDD\u8BC1\u4EFB\u610F\u7EBF\u7A0B\u90FD\u80FD\u770B\u5230\u8FD9\u4E2A final \u57DF\u5728\u6784\u9020\u51FD\u6570\u4E2D\u88AB\u521D\u59CB\u5316\u4E4B\u540E\u7684\u503C\u3002</p><h2 id="_3-7-happens-before" tabindex="-1"><a class="header-anchor" href="#_3-7-happens-before" aria-hidden="true">#</a> 3.7 happens-before</h2><p>happens-before \u662F JMM \u6700\u6838\u5FC3\u7684\u6982\u5FF5\u3002\u5BF9\u5E94 Java \u7A0B\u5E8F\u5458\u6765\u8BF4\uFF0C\u7406\u89E3 happens-before \u662F\u7406\u89E3 JMM \u7684\u5173\u952E\u3002</p><h3 id="_3-7-1-jmm-\u7684\u8BBE\u8BA1" tabindex="-1"><a class="header-anchor" href="#_3-7-1-jmm-\u7684\u8BBE\u8BA1" aria-hidden="true">#</a> 3.7.1 JMM \u7684\u8BBE\u8BA1</h3><p>\u9996\u5148\uFF0C\u8BA9\u6211\u4EEC\u6765\u770B JMM \u7684\u8BBE\u8BA1\u610F\u56FE\u3002\u4ECE JMM \u8BBE\u8BA1\u8005\u7684\u89D2\u5EA6\uFF0C\u5728\u8BBE\u8BA1 JMM \u65F6\uFF0C\u9700\u8981\u8003\u8651\u4E24\u4E2A\u5173\u952E\u56E0\u7D20\u3002</p><ul><li><p>\u7A0B\u5E8F\u5458\u5BF9\u5185\u5B58\u6A21\u578B\u7684\u4F7F\u7528\u3002\u7A0B\u5E8F\u5458\u5E0C\u671B\u5185\u5B58\u6A21\u578B\u6613\u4E8E\u7406\u89E3\u3001\u6613\u4E8E\u7F16\u7A0B\u3002\u7A0B\u5E8F\u5458\u5E0C\u671B\u57FA\u4E8E\u4E00\u4E2A\u5F3A\u5185\u5B58\u6A21\u578B\u6765\u7F16\u5199\u4EE3\u7801\u3002</p></li><li><p>\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u5BF9\u5185\u5B58\u6A21\u578B\u7684\u5B9E\u73B0\u3002\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u5E0C\u671B\u5185\u5B58\u6A21\u578B\u5BF9\u5B83\u4EEC\u7684\u675F\u7F1A\u8D8A\u5C11\u8D8A\u597D\uFF0C\u8FD9\u6837\u5B83\u4EEC\u5C31\u53EF\u4EE5\u505A\u5C3D\u53EF\u80FD\u591A\u7684\u4F18\u5316\u6765\u63D0\u9AD8\u6027\u80FD\u3002\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u5E0C\u671B\u5B9E\u73B0\u4E00\u4E2A\u5F31\u5185\u5B58\u6A21\u578B\u3002</p></li></ul><p>\u7531\u4E8E\u8FD9\u4E24\u4E2A\u56E0\u7D20\u4E92\u76F8\u77DB\u76FE\uFF0C\u6240\u4EE5 JSR-133 \u4E13\u5BB6\u7EC4\u5728\u8BBE\u8BA1 JMM \u65F6\u7684\u6838\u5FC3\u76EE\u6807\u5C31\u662F\u627E\u5230\u4E00\u4E2A\u597D\u7684\u5E73\u8861\u70B9\uFF1A\u4E00\u65B9\u9762\uFF0C\u8981\u4E3A\u7A0B\u5E8F\u5458\u63D0\u4F9B\u8DB3\u591F\u5F3A\u7684\u5185\u5B58\u53EF\u89C1\u6027\u4FDD\u8BC1\uFF1B\u53E6\u4E00\u65B9\u9762\uFF0C\u5BF9\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u7684\u9650\u5236\u8981\u5C3D\u53EF\u80FD\u5730\u653E\u677E\u3002\u4E0B\u9762\u8BA9\u6211\u4EEC\u6765\u770B JSR-133 \u662F\u5982\u4F55\u5B9E\u73B0\u8FD9\u4E00\u76EE\u6807\u7684\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">double</span> pi <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span>     		<span class="token comment">// A</span>
<span class="token keyword">double</span> r <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>     		<span class="token comment">// B</span>
<span class="token keyword">double</span> area <span class="token operator">=</span> pi <span class="token operator">*</span> r <span class="token operator">*</span> r<span class="token punctuation">;</span>	<span class="token comment">// C</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762\u8BA1\u7B97\u5706\u7684\u9762\u79EF\u7684\u793A\u4F8B\u4EE3\u7801\u5B58\u5728 3 \u4E2A happens-before \u5173\u7CFB\uFF0C\u5982\u4E0B\u3002</p><ul><li><p>A happens-before B\u3002</p></li><li><p>B happens-before C\u3002</p></li><li><p>A happens-before C\u3002</p></li></ul><p>\u5728 3 \u4E2A happens-before \u5173\u7CFB\u4E2D\uFF0C2 \u548C 3 \u662F\u5FC5\u9700\u7684\uFF0C\u4F46 1 \u662F\u4E0D\u5FC5\u8981\u7684\u3002\u56E0\u6B64\uFF0CJMM \u628A happens-before \u8981\u6C42\u7981\u6B62\u7684\u91CD\u6392\u5E8F\u5206\u4E3A\u4E86\u4E0B\u9762\u4E24\u7C7B\u3002</p><ul><li><p>\u4F1A\u6539\u53D8\u7A0B\u5E8F\u6267\u884C\u7ED3\u679C\u7684\u91CD\u6392\u5E8F\u3002</p></li><li><p>\u4E0D\u4F1A\u6539\u53D8\u7A0B\u5E8F\u6267\u884C\u7ED3\u679C\u7684\u91CD\u6392\u5E8F\u3002</p></li></ul><p>JMM \u5BF9\u8FD9\u4E24\u79CD\u4E0D\u540C\u6027\u8D28\u7684\u91CD\u6392\u5E8F\uFF0C\u91C7\u53D6\u4E86\u4E0D\u540C\u7684\u7B56\u7565\uFF0C\u5982\u4E0B\u3002</p><ul><li><p>\u5BF9\u4E8E\u4F1A\u6539\u53D8\u7A0B\u5E8F\u6267\u884C\u7ED3\u679C\u7684\u91CD\u6392\u5E8F\uFF0CJMM \u8981\u6C42\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u5FC5\u987B\u7981\u6B62\u8FD9\u79CD\u91CD\u6392\u5E8F\u3002</p></li><li><p>\u5BF9\u4E8E\u4E0D\u4F1A\u6539\u53D8\u7A0B\u5E8F\u6267\u884C\u7ED3\u679C\u7684\u91CD\u6392\u5E8F\uFF0CJMM \u5BF9\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u4E0D\u505A\u8981\u6C42\uFF08JMM \u5141\u8BB8\u8FD9\u79CD\u91CD\u6392\u5E8F\uFF09\u3002</p></li></ul><p>\u56FE3-33\u662F JMM \u7684\u8BBE\u8BA1\u793A\u610F\u56FE\u3002</p><p><img src="`+X+'" alt="\u56FE3-33" loading="lazy"></p><p>\u56FE3-33 JMM \u7684\u8BBE\u8BA1\u793A\u610F\u56FE</p><p>\u4ECE\u56FE3-33 \u53EF\u4EE5\u770B\u51FA\u4E24\u70B9\uFF0C\u5982\u4E0B\u3002</p><ul><li><p>JMM \u5411\u7A0B\u5E8F\u5458\u63D0\u4F9B\u7684 happens-before \u89C4\u5219\u80FD\u6EE1\u8DB3\u7A0B\u5E8F\u5458\u7684\u9700\u6C42\u3002JMM \u7684 happens-before \u89C4\u5219\u4E0D\u4F46\u7B80\u5355\u6613\u61C2\uFF0C\u800C\u4E14\u4E5F\u5411\u7A0B\u5E8F\u5458\u63D0\u4F9B\u4E86\u8DB3\u591F\u5F3A\u7684\u5185\u5B58\u53EF\u89C1\u6027\u4FDD\u8BC1\uFF08\u6709\u4E9B\u5185\u5B58\u53EF\u89C1\u6027\u4FDD\u8BC1\u5176\u5B9E\u5E76\u4E0D\u4E00\u5B9A\u771F\u5B9E\u5B58\u5728\uFF0C\u6BD4\u5982\u4E0A\u9762\u7684 A happens-before B\uFF09\u3002</p></li><li><p>JMM \u5BF9\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u7684\u675F\u7F1A\u5DF2\u7ECF\u5C3D\u53EF\u80FD\u5C11\u3002\u4ECE\u4E0A\u9762\u7684\u5206\u6790\u53EF\u4EE5\u770B\u51FA\uFF0CJMM \u5176\u5B9E\u662F\u5728\u9075\u5FAA\u4E00\u4E2A\u57FA\u672C\u539F\u5219\uFF1A\u53EA\u8981\u4E0D\u6539\u53D8\u7A0B\u5E8F\u7684\u6267\u884C\u7ED3\u679C\uFF08\u6307\u7684\u662F\u5355\u7EBF\u7A0B\u7A0B\u5E8F\u548C\u6B63\u786E\u540C\u6B65\u7684\u591A\u7EBF\u7A0B\u7A0B\u5E8F\uFF09\uFF0C\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u600E\u4E48\u4F18\u5316\u90FD\u884C\u3002\u4F8B\u5982\uFF0C\u5982\u679C\u7F16\u8BD1\u5668\u7ECF\u8FC7\u7EC6\u81F4\u7684\u5206\u6790\u540E\uFF0C\u8BA4\u5B9A\u4E00\u4E2A\u9501\u53EA\u4F1A\u88AB\u5355\u4E2A\u7EBF\u7A0B\u8BBF\u95EE\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u9501\u53EF\u4EE5\u88AB\u6D88\u9664\u3002\u518D\u5982\uFF0C\u5982\u679C\u7F16\u8BD1\u5668\u7ECF\u8FC7\u7EC6\u81F4\u7684\u5206\u6790\u540E\uFF0C\u8BA4\u5B9A\u4E00\u4E2A volatile \u53D8\u91CF\u53EA\u4F1A\u88AB\u5355\u4E2A\u7EBF\u7A0B\u8BBF\u95EE\uFF0C\u90A3\u4E48\u7F16\u8BD1\u5668\u53EF\u4EE5\u628A\u8FD9\u4E2A volatile \u53D8\u91CF\u5F53\u4F5C\u4E00\u4E2A\u666E\u901A\u53D8\u91CF\u6765\u5BF9\u5F85\u3002\u8FD9\u4E9B\u4F18\u5316\u65E2\u4E0D\u4F1A\u6539\u53D8\u7A0B\u5E8F\u7684\u6267\u884C\u7ED3\u679C\uFF0C\u53C8\u80FD\u63D0\u9AD8\u7A0B\u5E8F\u7684\u6267\u884C\u6548\u7387\u3002</p></li></ul><h3 id="_3-7-2-happens-before-\u7684\u5B9A\u4E49" tabindex="-1"><a class="header-anchor" href="#_3-7-2-happens-before-\u7684\u5B9A\u4E49" aria-hidden="true">#</a> 3.7.2 happens-before \u7684\u5B9A\u4E49</h3><p>happens-before \u7684\u6982\u5FF5\u6700\u521D\u7531 Leslie Lamport \u5728\u5176\u4E00\u7BC7\u5F71\u54CD\u6DF1\u8FDC\u7684\u8BBA\u6587\uFF08\u300ATime, Clocks and the Ordering of Events in a Distributed System\u300B\uFF09\u4E2D\u63D0\u51FA\u3002Leslie Lamport \u4F7F\u7528 happens-before \u6765\u5B9A\u4E49\u5206\u5E03\u5F0F\u7CFB\u7EDF\u4E2D\u4E8B\u4EF6\u4E4B\u95F4\u7684\u504F\u5E8F\u5173\u7CFB\uFF08partial ordering\uFF09\u3002Leslie Lamport \u5728\u8FD9\u7BC7\u8BBA\u6587\u4E2D\u7ED9\u51FA\u4E86\u4E00\u4E2A\u5206\u5E03\u5F0F\u7B97\u6CD5\uFF0C\u8BE5\u7B97\u6CD5\u53EF\u4EE5\u5C06\u8BE5\u504F\u5E8F\u5173\u7CFB\u6269\u5C55\u4E3A\u67D0\u79CD\u5168\u5E8F\u5173\u7CFB\u3002</p><p>JSR-133 \u4F7F\u7528 happens-before \u7684\u6982\u5FF5\u6765\u6307\u5B9A\u4E24\u4E2A\u64CD\u4F5C\u4E4B\u95F4\u7684\u6267\u884C\u987A\u5E8F\u3002\u7531\u4E8E\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u53EF\u4EE5\u5728\u4E00\u4E2A\u7EBF\u7A0B\u4E4B\u5185\uFF0C\u4E5F\u53EF\u4EE5\u662F\u5728\u4E0D\u540C\u7EBF\u7A0B\u4E4B\u95F4\u3002\u56E0\u6B64\uFF0CJMM \u53EF\u4EE5\u901A\u8FC7 happens-before \u5173\u7CFB\u5411\u7A0B\u5E8F\u5458\u63D0\u4F9B\u8DE8\u7EBF\u7A0B\u7684\u5185\u5B58\u53EF\u89C1\u6027\u4FDD\u8BC1\uFF08\u5982\u679C A \u7EBF\u7A0B\u7684\u5199\u64CD\u4F5C a \u4E0E B \u7EBF\u7A0B\u7684\u8BFB\u64CD\u4F5C b \u4E4B\u95F4\u5B58\u5728 happens-before \u5173\u7CFB\uFF0C\u5C3D\u7BA1 a \u64CD\u4F5C\u548C b \u64CD\u4F5C\u5728\u4E0D\u540C\u7684\u7EBF\u7A0B\u4E2D\u6267\u884C\uFF0C\u4F46 JMM \u5411\u7A0B\u5E8F\u5458\u4FDD\u8BC1 a \u64CD\u4F5C\u5C06\u5BF9 b \u64CD\u4F5C\u53EF\u89C1\uFF09\u3002</p><p>\u300AJSR-133: Java Memory Model and Thread Specification\u300B\u5BF9 happens-before \u5173\u7CFB\u7684\u5B9A\u4E49\u5982\u4E0B\u3002</p><ol><li><p>\u5982\u679C\u4E00\u4E2A\u64CD\u4F5C happens-before \u53E6\u4E00\u4E2A\u64CD\u4F5C\uFF0C\u90A3\u4E48\u7B2C\u4E00\u4E2A\u64CD\u4F5C\u7684\u6267\u884C\u7ED3\u679C\u5C06\u5BF9\u7B2C\u4E8C\u4E2A\u64CD\u4F5C\u53EF\u89C1\uFF0C\u800C\u4E14\u7B2C\u4E00\u4E2A\u64CD\u4F5C\u7684\u6267\u884C\u987A\u5E8F\u6392\u5728\u7B2C\u4E8C\u4E2A\u64CD\u4F5C\u4E4B\u524D\u3002</p></li><li><p>\u4E24\u4E2A\u64CD\u4F5C\u4E4B\u95F4\u5B58\u5728 happens-before \u5173\u7CFB\uFF0C\u5E76\u4E0D\u610F\u5473\u7740 Java \u5E73\u53F0\u7684\u5177\u4F53\u5B9E\u73B0\u5FC5\u987B\u8981\u6309\u7167 happens-before \u5173\u7CFB\u6307\u5B9A\u7684\u987A\u5E8F\u6765\u6267\u884C\u3002\u5982\u679C\u91CD\u6392\u5E8F\u4E4B\u540E\u7684\u6267\u884C\u7ED3\u679C\uFF0C\u4E0E\u6309 happens-before \u5173\u7CFB\u6765\u6267\u884C\u7684\u7ED3\u679C\u4E00\u81F4\uFF0C\u90A3\u4E48\u8FD9\u79CD\u91CD\u6392\u5E8F\u5E76\u4E0D\u975E\u6CD5\uFF08\u4E5F\u5C31\u662F\u8BF4\uFF0CJMM \u5141\u8BB8\u8FD9\u79CD\u91CD\u6392\u5E8F\uFF09\u3002</p></li></ol><p>\u4E0A\u9762\u7684 1 \u662F JMM \u5BF9\u7A0B\u5E8F\u5458\u7684\u627F\u8BFA\u3002\u4ECE\u7A0B\u5E8F\u5458\u7684\u89D2\u5EA6\u6765\u8BF4\uFF0C\u53EF\u4EE5\u8FD9\u6837\u7406\u89E3 happens-before \u5173\u7CFB\uFF1A\u5982\u679C A happens-before B\uFF0C\u90A3\u4E48 Java \u5185\u5B58\u6A21\u578B\u5C06\u5411\u7A0B\u5E8F\u5458\u4FDD\u8BC1\u2014\u2014A \u64CD\u4F5C\u7684\u7ED3\u679C\u5C06\u5BF9 B \u53EF\u89C1\uFF0C\u4E14 A \u7684\u6267\u884C\u987A\u5E8F\u6392\u5728 B \u4E4B\u524D\u3002\u6CE8\u610F\uFF0C\u8FD9\u53EA\u662F Java \u5185\u5B58\u6A21\u578B\u5411\u7A0B\u5E8F\u5458\u505A\u51FA\u7684\u4FDD\u8BC1\uFF01</p><p>\u4E0A\u9762\u7684 2 \u662F JMM \u5BF9\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u91CD\u6392\u5E8F\u7684\u7EA6\u675F\u539F\u5219\u3002\u6B63\u5982\u524D\u9762\u6240\u8A00\uFF0CJMM \u5176\u5B9E\u662F\u5728\u9075\u5FAA\u4E00\u4E2A\u57FA\u672C\u539F\u5219\uFF1A\u53EA\u8981\u4E0D\u6539\u53D8\u7A0B\u5E8F\u7684\u6267\u884C\u7ED3\u679C\uFF08\u6307\u7684\u662F\u5355\u7EBF\u7A0B\u7A0B\u5E8F\u548C\u6B63\u786E\u540C\u6B65\u7684\u591A\u7EBF\u7A0B\u7A0B\u5E8F\uFF09\uFF0C\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u600E\u4E48\u4F18\u5316\u90FD\u884C\u3002JMM \u8FD9\u4E48\u505A\u7684\u539F\u56E0\u662F\uFF1A\u7A0B\u5E8F\u5458\u5BF9\u4E8E\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u662F\u5426\u771F\u7684\u88AB\u91CD\u6392\u5E8F\u5E76\u4E0D\u5173\u5FC3\uFF0C\u7A0B\u5E8F\u5458\u5173\u5FC3\u7684\u662F\u7A0B\u5E8F\u6267\u884C\u65F6\u7684\u8BED\u4E49\u4E0D\u80FD\u88AB\u6539\u53D8\uFF08\u5373\u6267\u884C\u7ED3\u679C\u4E0D\u80FD\u88AB\u6539\u53D8\uFF09\u3002\u56E0\u6B64\uFF0Chappens-before \u5173\u7CFB\u672C\u8D28\u4E0A\u548C as-if-serial \u8BED\u4E49\u662F\u4E00\u56DE\u4E8B\u3002</p><ul><li><p>as-if-serial \u8BED\u4E49\u4FDD\u8BC1\u5355\u7EBF\u7A0B\u5185\u7A0B\u5E8F\u7684\u6267\u884C\u7ED3\u679C\u4E0D\u88AB\u6539\u53D8\uFF0Chappens-before \u5173\u7CFB\u4FDD\u8BC1\u6B63\u786E\u540C\u6B65\u7684\u591A\u7EBF\u7A0B\u7A0B\u5E8F\u7684\u6267\u884C\u7ED3\u679C\u4E0D\u88AB\u6539\u53D8\u3002</p></li><li><p>as-if-serial \u8BED\u4E49\u7ED9\u7F16\u5199\u5355\u7EBF\u7A0B\u7A0B\u5E8F\u7684\u7A0B\u5E8F\u5458\u521B\u9020\u4E86\u4E00\u4E2A\u5E7B\u5883\uFF1A\u5355\u7EBF\u7A0B\u7A0B\u5E8F\u662F\u6309\u7A0B\u5E8F\u7684\u987A\u5E8F\u6765\u6267\u884C\u7684\u3002happens-before \u5173\u7CFB\u7ED9\u7F16\u5199\u6B63\u786E\u540C\u6B65\u7684\u591A\u7EBF\u7A0B\u7A0B\u5E8F\u7684\u7A0B\u5E8F\u5458\u521B\u9020\u4E86\u4E00\u4E2A\u5E7B\u5883\uFF1A\u6B63\u786E\u540C\u6B65\u7684\u591A\u7EBF\u7A0B\u7A0B\u5E8F\u662F\u6309 happens-before \u6307\u5B9A\u7684\u987A\u5E8F\u6765\u6267\u884C\u7684\u3002</p></li></ul><p>as-if-serial \u8BED\u4E49\u548C happens-before \u8FD9\u4E48\u505A\u7684\u76EE\u7684\uFF0C\u90FD\u662F\u4E3A\u4E86\u5728\u4E0D\u6539\u53D8\u7A0B\u5E8F\u6267\u884C\u7ED3\u679C\u7684\u524D\u63D0\u4E0B\uFF0C\u5C3D\u53EF\u80FD\u5730\u63D0\u9AD8\u7A0B\u5E8F\u6267\u884C\u7684\u5E76\u884C\u5EA6\u3002</p><h3 id="_3-7-3-happens-before-\u89C4\u5219" tabindex="-1"><a class="header-anchor" href="#_3-7-3-happens-before-\u89C4\u5219" aria-hidden="true">#</a> 3.7.3 happens-before \u89C4\u5219</h3><p>\u300AJSR-133: Java Memory Model and Thread Specification\u300B\u5B9A\u4E49\u4E86\u5982\u4E0B happens-before \u89C4\u5219\u3002</p><ol><li><p>\u7A0B\u5E8F\u987A\u5E8F\u89C4\u5219\uFF1A\u4E00\u4E2A\u7EBF\u7A0B\u4E2D\u7684\u6BCF\u4E2A\u64CD\u4F5C\uFF0Chappens-before \u4E8E\u8BE5\u7EBF\u7A0B\u4E2D\u7684\u4EFB\u610F\u540E\u7EED\u64CD\u4F5C\u3002</p></li><li><p>\u76D1\u89C6\u5668\u9501\u89C4\u5219\uFF1A\u5BF9\u4E00\u4E2A\u9501\u7684\u89E3\u9501\uFF0Chappens-before \u4E8E\u968F\u540E\u5BF9\u8FD9\u4E2A\u9501\u7684\u52A0\u9501\u3002</p></li><li><p>volatile \u53D8\u91CF\u89C4\u5219\uFF1A\u5BF9\u4E00\u4E2A volatile \u57DF\u7684\u5199\uFF0Chappens-before \u4E8E\u4EFB\u610F\u540E\u7EED\u5BF9\u8FD9\u4E2A volatile \u57DF\u7684\u8BFB\u3002</p></li><li><p>\u4F20\u9012\u6027\uFF1A\u5982\u679C A happens-before B\uFF0C\u4E14 B happens-before C\uFF0C\u90A3\u4E48 A happens-before C\u3002</p></li><li><p>start() \u89C4\u5219\uFF1A\u5982\u679C\u7EBF\u7A0B A \u6267\u884C\u64CD\u4F5C ThreadB.start()\uFF08\u542F\u52A8\u7EBF\u7A0B B\uFF09\uFF0C\u90A3\u4E48 A \u7EBF\u7A0B\u7684 ThreadB.start() \u64CD\u4F5C happens-before \u4E8E\u7EBF\u7A0B B \u4E2D\u7684\u4EFB\u610F\u64CD\u4F5C\u3002</p></li><li><p>join() \u89C4\u5219\uFF1A\u5982\u679C\u7EBF\u7A0B A \u6267\u884C\u64CD\u4F5C ThreadB.join() \u5E76\u6210\u529F\u8FD4\u56DE\uFF0C\u90A3\u4E48\u7EBF\u7A0B B \u4E2D\u7684\u4EFB\u610F\u64CD\u4F5C happens-before \u4E8E\u7EBF\u7A0B A \u4ECE ThreadB.join() \u64CD\u4F5C\u6210\u529F\u8FD4\u56DE\u3002</p></li></ol><p>\u8FD9\u91CC\u7684\u89C4\u5219 1\u30012\u30013 \u548C4 \u524D\u9762\u90FD\u8BB2\u5230\u8FC7\uFF0C\u8FD9\u91CC\u518D\u505A\u4E2A\u603B\u7ED3\u3002\u7531\u4E8E 2 \u548C 3 \u60C5\u51B5\u7C7B\u4F3C\uFF0C\u8FD9\u91CC\u53EA\u4EE5 1\u30013 \u548C 4 \u4E3A\u4F8B\u6765\u8BF4\u660E\u3002\u56FE3-34 \u662F volatile \u5199\u2014\u8BFB\u5EFA\u7ACB\u7684 happens-before \u5173\u7CFB\u56FE\u3002</p><p><img src="'+P+'" alt="\u56FE3-34" loading="lazy"></p><p>\u56FE3-34 happens-before \u5173\u7CFB\u7684\u793A\u610F\u56FE</p><p>\u7ED3\u5408\u56FE3-34\uFF0C\u6211\u4EEC\u505A\u4EE5\u4E0B\u5206\u6790\u3002</p><ul><li>1 happens-before 2 \u548C 3 happens-before 4 \u7531\u7A0B\u5E8F\u987A\u5E8F\u89C4\u5219\u4EA7\u751F\u3002\u7531\u4E8E\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u90FD\u8981\u9075\u5B88 as-if-serial \u8BED\u4E49\uFF0C\u4E5F\u5C31\u662F\u8BF4\uFF0Cas-if-serial \u8BED\u4E49\u4FDD\u8BC1\u4E86\u7A0B\u5E8F\u987A\u5E8F\u89C4\u5219\u3002\u56E0\u6B64\uFF0C\u53EF\u4EE5\u628A\u7A0B\u5E8F\u987A\u5E8F\u89C4\u5219\u770B\u6210\u662F\u5BF9 as-if-serial \u8BED\u4E49\u7684 \u201C\u5C01\u88C5\u201D\u3002</li><li>2 happens-before 3 \u662F\u7531 volatile \u89C4\u5219\u4EA7\u751F\u3002\u524D\u9762\u63D0\u5230\u8FC7\uFF0C\u5BF9\u4E00\u4E2A volatile \u53D8\u91CF\u7684\u8BFB\uFF0C\u603B\u662F\u80FD\u770B\u5230\uFF08\u4EFB\u610F\u7EBF\u7A0B\uFF09\u4E4B\u524D\u5BF9\u8FD9\u4E2A volatile \u53D8\u91CF\u6700\u540E\u7684\u5199\u5165\u3002\u56E0\u6B64\uFF0Cvolatile \u7684\u8FD9\u4E2A\u7279\u6027\u53EF\u4EE5\u4FDD\u8BC1\u5B9E\u73B0 volatile \u89C4\u5219\u3002</li><li>1 happens-before 4\u662F\u7531\u4F20\u9012\u6027\u89C4\u5219\u4EA7\u751F\u7684\u3002\u8FD9\u91CC\u7684\u4F20\u9012\u6027\u662F\u7531 volatile \u7684\u5185\u5B58\u5C4F\u969C\u63D2\u5165\u7B56\u7565\u548C volatile \u7684\u7F16\u8BD1\u5668\u91CD\u6392\u5E8F\u89C4\u5219\u5171\u540C\u6765\u4FDD\u8BC1\u7684\u3002</li></ul><p>\u4E0B\u9762\u6211\u4EEC\u6765\u770B start() \u89C4\u5219\u3002\u5047\u8BBE\u7EBF\u7A0B A \u5728\u6267\u884C\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u901A\u8FC7\u6267\u884C ThreadB.start() \u6765\u542F\u52A8\u7EBF\u7A0B B\uFF1B\u540C\u65F6\uFF0C\u5047\u8BBE\u7EBF\u7A0B A \u5728\u6267\u884C ThreadB.start() \u4E4B\u524D\u4FEE\u6539\u4E86\u4E00\u4E9B\u5171\u4EAB\u53D8\u91CF\uFF0C\u7EBF\u7A0B B \u5728\u5F00\u59CB\u6267\u884C\u540E\u4F1A\u8BFB\u8FD9\u4E9B\u5171\u4EAB\u53D8\u91CF\u3002\u56FE3-35 \u662F\u8BE5\u7A0B\u5E8F\u5BF9\u5E94\u7684 happens-before \u5173\u7CFB\u56FE\u3002</p><p><img src="'+q+'" alt="\u56FE3-35" loading="lazy"></p><p>\u56FE3-35 happens-before \u5173\u7CFB\u7684\u793A\u610F\u56FE</p><p>\u5728\u56FE3-35 \u4E2D\uFF0C1 happens-before 2 \u7531\u7A0B\u5E8F\u987A\u5E8F\u89C4\u5219\u4EA7\u751F\u30022 happens-before 4 \u7531 start() \u89C4\u5219\u4EA7\u751F\u3002\u6839\u636E\u4F20\u9012\u6027\uFF0C\u5C06\u6709 1 happens-before 4\u3002\u8FD9\u5B9E\u610F\u5473\u7740\uFF0C\u7EBF\u7A0B A \u5728\u6267\u884C ThreadB.start() \u4E4B\u524D\u5BF9\u5171\u4EAB\u53D8\u91CF\u6240\u505A\u7684\u4FEE\u6539\uFF0C\u63A5\u4E0B\u6765\u5728\u7EBF\u7A0B B \u5F00\u59CB\u6267\u884C\u540E\u90FD\u5C06\u786E\u4FDD\u5BF9\u7EBF\u7A0B B \u53EF\u89C1\u3002</p><p>\u4E0B\u9762\u6211\u4EEC\u6765\u770B join() \u89C4\u5219\u3002\u5047\u8BBE\u7EBF\u7A0B A \u5728\u6267\u884C\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u901A\u8FC7\u6267\u884C ThreadB.join() \u6765\u7B49\u5F85\u7EBF\u7A0B B \u7EC8\u6B62\uFF1B\u540C\u65F6\uFF0C\u5047\u8BBE\u7EBF\u7A0B B \u5728\u7EC8\u6B62\u4E4B\u524D\u4FEE\u6539\u4E86\u4E00\u4E9B\u5171\u4EAB\u53D8\u91CF\uFF0C\u7EBF\u7A0B A \u4ECE ThreadB.join() \u8FD4\u56DE\u540E\u4F1A\u8BFB\u8FD9\u4E9B\u5171\u4EAB\u53D8\u91CF\u3002\u56FE3-36 \u662F\u8BE5\u7A0B\u5E8F\u5BF9\u5E94\u7684 happens-before \u5173\u7CFB\u56FE\u3002</p><p><img src="'+K+`" alt="\u56FE3-36" loading="lazy"></p><p>\u56FE3-36 happens-before\u5173\u7CFB\u7684\u793A\u610F\u56FE</p><p>\u5728\u56FE3-36 \u4E2D\uFF0C2 happens-before 4 \u7531 join() \u89C4\u5219\u4EA7\u751F\uFF1B4 happens-before 5 \u7531\u7A0B\u5E8F\u987A\u5E8F\u89C4\u5219\u4EA7\u751F\u3002\u6839\u636E\u4F20\u9012\u6027\u89C4\u5219\uFF0C\u5C06\u6709 2 happens-before 5\u3002\u8FD9\u610F\u5473\u7740\uFF0C\u7EBF\u7A0B A \u6267\u884C\u64CD\u4F5C ThreadB.join() \u5E76\u6210\u529F\u8FD4\u56DE\u540E\uFF0C\u7EBF\u7A0B B \u4E2D\u7684\u4EFB\u610F\u64CD\u4F5C\u90FD\u5C06\u5BF9\u7EBF\u7A0B A \u53EF\u89C1\u3002</p><h2 id="_3-8-\u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\u4E0E\u5EF6\u8FDF\u521D\u59CB\u5316" tabindex="-1"><a class="header-anchor" href="#_3-8-\u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\u4E0E\u5EF6\u8FDF\u521D\u59CB\u5316" aria-hidden="true">#</a> 3.8 \u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\u4E0E\u5EF6\u8FDF\u521D\u59CB\u5316</h2><p>\u5728 Java \u591A\u7EBF\u7A0B\u7A0B\u5E8F\u4E2D\uFF0C\u6709\u65F6\u5019\u9700\u8981\u91C7\u7528\u5EF6\u8FDF\u521D\u59CB\u5316\u6765\u964D\u4F4E\u521D\u59CB\u5316\u7C7B\u548C\u521B\u5EFA\u5BF9\u8C61\u7684\u5F00\u9500\u3002\u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\u662F\u5E38\u89C1\u7684\u5EF6\u8FDF\u521D\u59CB\u5316\u6280\u672F\uFF0C\u4F46\u5B83\u662F\u4E00\u4E2A\u9519\u8BEF\u7684\u7528\u6CD5\u3002\u672C\u6587\u5C06\u5206\u6790\u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\u7684\u9519\u8BEF\u6839\u6E90\uFF0C\u4EE5\u53CA\u4E24\u79CD\u7EBF\u7A0B\u5B89\u5168\u7684\u5EF6\u8FDF\u521D\u59CB\u5316\u65B9\u6848\u3002</p><h3 id="_3-8-1-\u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\u7684\u7531\u6765" tabindex="-1"><a class="header-anchor" href="#_3-8-1-\u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\u7684\u7531\u6765" aria-hidden="true">#</a> 3.8.1 \u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\u7684\u7531\u6765</h3><p>\u5728 Java \u7A0B\u5E8F\u4E2D\uFF0C\u6709\u65F6\u5019\u53EF\u80FD\u9700\u8981\u63A8\u8FDF\u4E00\u4E9B\u9AD8\u5F00\u9500\u7684\u5BF9\u8C61\u521D\u59CB\u5316\u64CD\u4F5C\uFF0C\u5E76\u4E14\u53EA\u6709\u5728\u4F7F\u7528\u8FD9\u4E9B\u5BF9\u8C61\u65F6\u624D\u8FDB\u884C\u521D\u59CB\u5316\u3002\u6B64\u65F6\uFF0C\u7A0B\u5E8F\u5458\u53EF\u80FD\u4F1A\u91C7\u7528\u5EF6\u8FDF\u521D\u59CB\u5316\u3002\u4F46\u8981\u6B63\u786E\u5B9E\u73B0\u7EBF\u7A0B\u5B89\u5168\u7684\u5EF6\u8FDF\u521D\u59CB\u5316\u9700\u8981\u4E00\u4E9B\u6280\u5DE7\uFF0C\u5426\u5219\u5F88\u5BB9\u6613\u51FA\u73B0\u95EE\u9898\u3002\u6BD4\u5982\uFF0C\u4E0B\u9762\u662F\u975E\u7EBF\u7A0B\u5B89\u5168\u7684\u5EF6\u8FDF\u521D\u59CB\u5316\u5BF9\u8C61\u7684\u793A\u4F8B\u4EE3\u7801\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnsafeLazyInitialization</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Instance</span> instance<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Instance</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>             		<span class="token comment">// 1\uFF1AA \u7EBF\u7A0B\u6267\u884C</span>
            instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         	<span class="token comment">// 2\uFF1AB \u7EBF\u7A0B\u6267\u884C</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728 UnsafeLazyInitialization \u7C7B\u4E2D\uFF0C\u5047\u8BBE A \u7EBF\u7A0B\u6267\u884C\u4EE3\u7801 1 \u7684\u540C\u65F6\uFF0CB \u7EBF\u7A0B\u6267\u884C\u4EE3\u7801 2\u3002\u6B64\u65F6\uFF0C\u7EBF\u7A0B A \u53EF\u80FD\u4F1A\u770B\u5230 instance \u5F15\u7528\u7684\u5BF9\u8C61\u8FD8\u6CA1\u6709\u5B8C\u6210\u521D\u59CB\u5316\uFF08\u51FA\u73B0\u8FD9\u79CD\u60C5\u51B5\u7684\u539F\u56E0\u89C13.8.2 \u8282\uFF09\u3002</p><p>\u5BF9\u4E8E UnsafeLazyInitialization \u7C7B\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5BF9 getInstance() \u65B9\u6CD5\u505A\u540C\u6B65\u5904\u7406\u6765\u5B9E\u73B0\u7EBF\u7A0B\u5B89\u5168\u7684\u5EF6\u8FDF\u521D\u59CB\u5316\u3002\u793A\u4F8B\u4EE3\u7801\u5982\u4E0B\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SafeLazyInitialization</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Instance</span> instance<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token class-name">Instance</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7531\u4E8E\u5BF9 getInstance() \u65B9\u6CD5\u505A\u4E86\u540C\u6B65\u5904\u7406\uFF0Csynchronized \u5C06\u5BFC\u81F4\u6027\u80FD\u5F00\u9500\u3002\u5982\u679C getInstance() \u65B9\u6CD5\u88AB\u591A\u4E2A\u7EBF\u7A0B\u9891\u7E41\u7684\u8C03\u7528\uFF0C\u5C06\u4F1A\u5BFC\u81F4\u7A0B\u5E8F\u6267\u884C\u6027\u80FD\u7684\u4E0B\u964D\u3002\u53CD\u4E4B\uFF0C\u5982\u679C getInstance() \u65B9\u6CD5\u4E0D\u4F1A\u88AB\u591A\u4E2A\u7EBF\u7A0B\u9891\u7E41\u7684\u8C03\u7528\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u5EF6\u8FDF\u521D\u59CB\u5316\u65B9\u6848\u5C06\u80FD\u63D0\u4F9B\u4EE4\u4EBA\u6EE1\u610F\u7684\u6027\u80FD\u3002</p><p>\u5728\u65E9\u671F\u7684 JVM \u4E2D\uFF0Csynchronized\uFF08\u751A\u81F3\u662F\u65E0\u7ADE\u4E89\u7684 synchronized\uFF09\u5B58\u5728\u5DE8\u5927\u7684\u6027\u80FD\u5F00\u9500\u3002\u56E0\u6B64\uFF0C\u4EBA\u4EEC\u60F3\u51FA\u4E86\u4E00\u4E2A \u201C\u806A\u660E\u201D \u7684\u6280\u5DE7\uFF1A\u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\uFF08Double-Checked Locking\uFF09\u3002\u4EBA\u4EEC\u60F3\u901A\u8FC7\u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\u6765\u964D\u4F4E\u540C\u6B65\u7684\u5F00\u9500\u3002\u4E0B\u9762\u662F\u4F7F\u7528\u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\u6765\u5B9E\u73B0\u5EF6\u8FDF\u521D\u59CB\u5316\u7684\u793A\u4F8B\u4EE3\u7801\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DoubleCheckedLocking</span> <span class="token punctuation">{</span>            				<span class="token comment">// 1</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Instance</span> instance<span class="token punctuation">;</span>           			<span class="token comment">// 2</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Instance</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        			<span class="token comment">// 3</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              				<span class="token comment">// 4\uFF1A\u7B2C\u4E00\u6B21\u68C0\u67E5</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">DoubleCheckedLocking</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 	<span class="token comment">// 5\uFF1A\u52A0\u9501</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>          				<span class="token comment">// 6\uFF1A\u7B2C\u4E8C\u6B21\u68C0\u67E5</span>
                    instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    			<span class="token comment">// 7\uFF1A\u95EE\u9898\u7684\u6839\u6E90\u51FA\u5728\u8FD9\u91CC</span>
            <span class="token punctuation">}</span>                      							<span class="token comment">// 8</span>
        <span class="token punctuation">}</span>                         							<span class="token comment">// 9</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>                 					<span class="token comment">// 10</span>
    <span class="token punctuation">}</span>                           							<span class="token comment">// 11</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5982\u4E0A\u9762\u4EE3\u7801\u6240\u793A\uFF0C\u5982\u679C\u7B2C\u4E00\u6B21\u68C0\u67E5 instance \u4E0D\u4E3A null\uFF0C\u90A3\u4E48\u5C31\u4E0D\u9700\u8981\u6267\u884C\u4E0B\u9762\u7684\u52A0\u9501\u548C\u521D\u59CB\u5316\u64CD\u4F5C\u3002\u56E0\u6B64\uFF0C\u53EF\u4EE5\u5927\u5E45\u964D\u4F4E synchronized \u5E26\u6765\u7684\u6027\u80FD\u5F00\u9500\u3002\u4E0A\u9762\u4EE3\u7801\u8868\u9762\u4E0A\u770B\u8D77\u6765\uFF0C\u4F3C\u4E4E\u4E24\u5168\u5176\u7F8E\u3002</p><ul><li><p>\u591A\u4E2A\u7EBF\u7A0B\u8BD5\u56FE\u5728\u540C\u4E00\u65F6\u95F4\u521B\u5EFA\u5BF9\u8C61\u65F6\uFF0C\u4F1A\u901A\u8FC7\u52A0\u9501\u6765\u4FDD\u8BC1\u53EA\u6709\u4E00\u4E2A\u7EBF\u7A0B\u80FD\u521B\u5EFA\u5BF9\u8C61\u3002</p></li><li><p>\u5728\u5BF9\u8C61\u521B\u5EFA\u597D\u4E4B\u540E\uFF0C\u6267\u884C getInstance() \u65B9\u6CD5\u5C06\u4E0D\u9700\u8981\u83B7\u53D6\u9501\uFF0C\u76F4\u63A5\u8FD4\u56DE\u5DF2\u521B\u5EFA\u597D\u7684\u5BF9\u8C61\u3002</p></li></ul><p>\u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\u770B\u8D77\u6765\u4F3C\u4E4E\u5F88\u5B8C\u7F8E\uFF0C\u4F46\u8FD9\u662F\u4E00\u4E2A\u9519\u8BEF\u7684\u4F18\u5316\uFF01\u5728\u7EBF\u7A0B\u6267\u884C\u5230\u7B2C 4 \u884C\uFF0C\u4EE3\u7801\u8BFB\u53D6\u5230 instance \u4E0D\u4E3A null \u65F6\uFF0Cinstance \u5F15\u7528\u7684\u5BF9\u8C61\u6709\u53EF\u80FD\u8FD8\u6CA1\u6709\u5B8C\u6210\u521D\u59CB\u5316\u3002</p><h3 id="_3-8-2-\u95EE\u9898\u7684\u6839\u6E90" tabindex="-1"><a class="header-anchor" href="#_3-8-2-\u95EE\u9898\u7684\u6839\u6E90" aria-hidden="true">#</a> 3.8.2 \u95EE\u9898\u7684\u6839\u6E90</h3><p>\u524D\u9762\u7684\u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\u793A\u4F8B\u4EE3\u7801\u7684\u7B2C 7 \u884C\uFF08instance = new Singleton();\uFF09\u521B\u5EFA\u4E86\u4E00\u4E2A\u5BF9\u8C61\u3002\u8FD9\u4E00\u884C\u4EE3\u7801\u53EF\u4EE5\u5206\u89E3\u4E3A\u5982\u4E0B\u7684 3 \u884C\u4F2A\u4EE3\u7801\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>memory <span class="token operator">=</span> <span class="token function">allocate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   	<span class="token comment">// 1\uFF1A\u5206\u914D\u5BF9\u8C61\u7684\u5185\u5B58\u7A7A\u95F4</span>
<span class="token function">ctorInstance</span><span class="token punctuation">(</span>memory<span class="token punctuation">)</span><span class="token punctuation">;</span>  	<span class="token comment">// 2\uFF1A\u521D\u59CB\u5316\u5BF9\u8C61</span>
instance <span class="token operator">=</span> memory<span class="token punctuation">;</span>    	<span class="token comment">// 3\uFF1A\u8BBE\u7F6E instance \u6307\u5411\u521A\u5206\u914D\u7684\u5185\u5B58\u5730\u5740</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762 3 \u884C\u4F2A\u4EE3\u7801\u4E2D\u7684 2 \u548C 3 \u4E4B\u95F4\uFF0C\u53EF\u80FD\u4F1A\u88AB\u91CD\u6392\u5E8F\uFF08\u5728\u4E00\u4E9B JIT \u7F16\u8BD1\u5668\u4E0A\uFF0C\u8FD9\u79CD\u91CD\u6392\u5E8F\u662F\u771F\u5B9E\u53D1\u751F\u7684\uFF0C\u8BE6\u60C5\u89C1\u53C2\u8003\u6587\u732E 1 \u7684 &quot;Out-of-order writes\u201D \u90E8\u5206\uFF09\u30022 \u548C 3 \u4E4B\u95F4\u91CD\u6392\u5E8F\u4E4B\u540E\u7684\u6267\u884C\u65F6\u5E8F\u5982\u4E0B\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>memory <span class="token operator">=</span> <span class="token function">allocate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   	<span class="token comment">// 1\uFF1A\u5206\u914D\u5BF9\u8C61\u7684\u5185\u5B58\u7A7A\u95F4</span>
instance <span class="token operator">=</span> memory<span class="token punctuation">;</span>    	<span class="token comment">// 3\uFF1A\u8BBE\u7F6E instance \u6307\u5411\u521A\u5206\u914D\u7684\u5185\u5B58\u5730\u5740</span>
<span class="token comment">// \u6CE8\u610F\uFF0C\u6B64\u65F6\u5BF9\u8C61\u8FD8\u6CA1\u6709\u88AB\u521D\u59CB\u5316\uFF01</span>
<span class="token function">ctorInstance</span><span class="token punctuation">(</span>memory<span class="token punctuation">)</span><span class="token punctuation">;</span>  	<span class="token comment">// 2\uFF1A\u521D\u59CB\u5316\u5BF9\u8C61</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6839\u636E\u300AThe Java Language Specification, Java SE 7 Edition\u300B\uFF08\u540E\u6587\u7B80\u79F0\u4E3A Java \u8BED\u8A00\u89C4\u8303\uFF09\uFF0C\u6240\u6709\u7EBF\u7A0B\u5728\u6267\u884C Java \u7A0B\u5E8F\u65F6\u5FC5\u987B\u8981\u9075\u5B88 intra-thread semantics\u3002intra-thread semantics \u4FDD\u8BC1\u91CD\u6392\u5E8F\u4E0D\u4F1A\u6539\u53D8\u5355\u7EBF\u7A0B\u5185\u7684\u7A0B\u5E8F\u6267\u884C\u7ED3\u679C\u3002\u6362\u53E5\u8BDD\u8BF4\uFF0Cintra-thread semantics \u5141\u8BB8\u90A3\u4E9B\u5728\u5355\u7EBF\u7A0B\u5185\uFF0C\u4E0D\u4F1A\u6539\u53D8\u5355\u7EBF\u7A0B\u7A0B\u5E8F\u6267\u884C\u7ED3\u679C\u7684\u91CD\u6392\u5E8F\u3002\u4E0A\u9762 3 \u884C\u4F2A\u4EE3\u7801\u7684 2 \u548C 3 \u4E4B\u95F4\u867D\u7136\u88AB\u91CD\u6392\u5E8F\u4E86\uFF0C\u4F46\u8FD9\u4E2A\u91CD\u6392\u5E8F\u5E76\u4E0D\u4F1A\u8FDD\u53CD intra-thread semantics\u3002\u8FD9\u4E2A\u91CD\u6392\u5E8F\u5728\u6CA1\u6709\u6539\u53D8\u5355\u7EBF\u7A0B\u7A0B\u5E8F\u6267\u884C\u7ED3\u679C\u7684\u524D\u63D0\u4E0B\uFF0C\u53EF\u4EE5\u63D0\u9AD8\u7A0B\u5E8F\u7684\u6267\u884C\u6027\u80FD\u3002</p><p>\u4E3A\u4E86\u66F4\u597D\u5730\u7406\u89E3 intra-thread semantics\uFF0C\u8BF7\u770B\u5982\u56FE3-37 \u6240\u793A\u7684\u793A\u610F\u56FE\uFF08\u5047\u8BBE\u4E00\u4E2A\u7EBF\u7A0B A \u5728\u6784\u9020\u5BF9\u8C61\u540E\uFF0C\u7ACB\u5373\u8BBF\u95EE\u8FD9\u4E2A\u5BF9\u8C61\uFF09\u3002</p><p><img src="`+H+'" alt="\u56FE3-37" loading="lazy"></p><p>\u56FE3-37 \u7EBF\u7A0B\u6267\u884C\u65F6\u5E8F\u56FE</p><p>\u5982\u56FE3-37 \u6240\u793A\uFF0C\u53EA\u8981\u4FDD\u8BC1 2 \u6392\u5728 4 \u7684\u524D\u9762\uFF0C\u5373\u4F7F 2 \u548C 3 \u4E4B\u95F4\u91CD\u6392\u5E8F\u4E86\uFF0C\u4E5F\u4E0D\u4F1A\u8FDD\u53CD intra-thread semantics\u3002</p><p>\u4E0B\u9762\uFF0C\u518D\u8BA9\u6211\u4EEC\u67E5\u770B\u591A\u7EBF\u7A0B\u5E76\u53D1\u6267\u884C\u7684\u60C5\u51B5\u3002\u5982\u56FE3-38 \u6240\u793A\u3002</p><p><img src="'+Q+'" alt="\u56FE3-38" loading="lazy"></p><p>\u56FE3-38 \u591A\u7EBF\u7A0B\u6267\u884C\u65F6\u5E8F\u56FE</p><p>\u7531\u4E8E\u5355\u7EBF\u7A0B\u5185\u8981\u9075\u5B88 intra-thread semantics\uFF0C\u4ECE\u800C\u80FD\u4FDD\u8BC1 A \u7EBF\u7A0B\u7684\u6267\u884C\u7ED3\u679C\u4E0D\u4F1A\u88AB\u6539\u53D8\u3002\u4F46\u662F\uFF0C\u5F53\u7EBF\u7A0B A \u548C B \u6309\u56FE3-38 \u7684\u65F6\u5E8F\u6267\u884C\u65F6\uFF0CB \u7EBF\u7A0B\u5C06\u770B\u5230\u4E00\u4E2A\u8FD8\u6CA1\u6709\u88AB\u521D\u59CB\u5316\u7684\u5BF9\u8C61\u3002</p><p>\u56DE\u5230\u672C\u6587\u7684\u4E3B\u9898\uFF0CDoubleCheckedLocking \u793A\u4F8B\u4EE3\u7801\u7684\u7B2C 7 \u884C\uFF08instance = new Singleton();\uFF09\u5982\u679C\u53D1\u751F\u91CD\u6392\u5E8F\uFF0C\u53E6\u4E00\u4E2A\u5E76\u53D1\u6267\u884C\u7684\u7EBF\u7A0B B \u5C31\u6709\u53EF\u80FD\u5728\u7B2C 4 \u884C\u5224\u65AD instance \u4E0D\u4E3A null\u3002\u7EBF\u7A0B B \u63A5\u4E0B\u6765\u5C06\u8BBF\u95EE instance \u6240\u5F15\u7528\u7684\u5BF9\u8C61\uFF0C\u4F46\u6B64\u65F6\u8FD9\u4E2A\u5BF9\u8C61\u53EF\u80FD\u8FD8\u6CA1\u6709\u88AB A \u7EBF\u7A0B\u521D\u59CB\u5316\uFF01\u88683-6 \u662F\u8FD9\u4E2A\u573A\u666F\u7684\u5177\u4F53\u6267\u884C\u65F6\u5E8F\u3002</p><p>\u88683-6 \u591A\u7EBF\u7A0B\u6267\u884C\u65F6\u5E8F\u8868</p><p><img src="'+U+`" alt="\u88683-6" loading="lazy"></p><p>\u8FD9\u91CC A2 \u548C A3 \u867D\u7136\u91CD\u6392\u5E8F\u4E86\uFF0C\u4F46 Java \u5185\u5B58\u6A21\u578B\u7684 intra-thread semantics \u5C06\u786E\u4FDD A2 \u4E00\u5B9A\u4F1A\u6392\u5728 A4 \u524D\u9762\u6267\u884C\u3002\u56E0\u6B64\uFF0C\u7EBF\u7A0B A \u7684 intra-thread semantics \u6CA1\u6709\u6539\u53D8\uFF0C\u4F46 A2 \u548C A3 \u7684\u91CD\u6392\u5E8F\uFF0C\u5C06\u5BFC\u81F4\u7EBF\u7A0B B \u5728 B1 \u5904\u5224\u65AD\u51FA instance \u4E0D\u4E3A\u7A7A\uFF0C\u7EBF\u7A0B B \u63A5\u4E0B\u6765\u5C06\u8BBF\u95EE instance \u5F15\u7528\u7684\u5BF9\u8C61\u3002\u6B64\u65F6\uFF0C\u7EBF\u7A0B B \u5C06\u4F1A\u8BBF\u95EE\u5230\u4E00\u4E2A\u8FD8\u672A\u521D\u59CB\u5316\u7684\u5BF9\u8C61\u3002</p><p>\u5728\u77E5\u6653\u4E86\u95EE\u9898\u53D1\u751F\u7684\u6839\u6E90\u4E4B\u540E\uFF0C\u6211\u4EEC\u53EF\u4EE5\u60F3\u51FA\u4E24\u4E2A\u529E\u6CD5\u6765\u5B9E\u73B0\u7EBF\u7A0B\u5B89\u5168\u7684\u5EF6\u8FDF\u521D\u59CB\u5316\u3002</p><ol><li><p>\u4E0D\u5141\u8BB8 2 \u548C 3 \u91CD\u6392\u5E8F\u3002</p></li><li><p>\u5141\u8BB8 2 \u548C 3 \u91CD\u6392\u5E8F\uFF0C\u4F46\u4E0D\u5141\u8BB8\u5176\u4ED6\u7EBF\u7A0B \u201C\u770B\u5230\u201D \u8FD9\u4E2A\u91CD\u6392\u5E8F\u3002</p></li></ol><p>\u540E\u6587\u4ECB\u7ECD\u7684\u4E24\u4E2A\u89E3\u51B3\u65B9\u6848\uFF0C\u5206\u522B\u5BF9\u5E94\u4E8E\u4E0A\u9762\u8FD9\u4E24\u70B9\u3002</p><h3 id="_3-8-3-\u57FA\u4E8E-volatile-\u7684\u89E3\u51B3\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#_3-8-3-\u57FA\u4E8E-volatile-\u7684\u89E3\u51B3\u65B9\u6848" aria-hidden="true">#</a> 3.8.3 \u57FA\u4E8E volatile \u7684\u89E3\u51B3\u65B9\u6848</h3><p>\u5BF9\u4E8E\u524D\u9762\u7684\u57FA\u4E8E\u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\u6765\u5B9E\u73B0\u5EF6\u8FDF\u521D\u59CB\u5316\u7684\u65B9\u6848\uFF08\u6307 DoubleCheckedLocking \u793A\u4F8B\u4EE3\u7801\uFF09\uFF0C\u53EA\u9700\u8981\u505A\u4E00\u70B9\u5C0F\u7684\u4FEE\u6539\uFF08\u628A instance \u58F0\u660E\u4E3A volatile \u578B\uFF09\uFF0C\u5C31\u53EF\u4EE5\u5B9E\u73B0\u7EBF\u7A0B\u5B89\u5168\u7684\u5EF6\u8FDF\u521D\u59CB\u5316\u3002\u8BF7\u770B\u4E0B\u9762\u7684\u793A\u4F8B\u4EE3\u7801\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SafeDoubleCheckedLocking</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token class-name">Instance</span> instance<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Instance</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">SafeDoubleCheckedLocking</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                    instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// instance \u4E3A volatile\uFF0C\u73B0\u5728\u6CA1\u95EE\u9898\u4E86</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u6CE8\u610F</strong>\uFF1A\u8FD9\u4E2A\u89E3\u51B3\u65B9\u6848\u9700\u8981 JDK 5 \u6216\u66F4\u9AD8\u7248\u672C\uFF08\u56E0\u4E3A\u4ECE JDK 5 \u5F00\u59CB\u4F7F\u7528\u65B0\u7684 JSR-133 \u5185\u5B58\u6A21\u578B\u89C4\u8303\uFF0C\u8FD9\u4E2A\u89C4\u8303\u589E\u5F3A\u4E86 volatile \u7684\u8BED\u4E49\uFF09\u3002</p><p>\u5F53\u58F0\u660E\u5BF9\u8C61\u7684\u5F15\u7528\u4E3A volatile \u540E\uFF0C3.8.2 \u8282\u4E2D\u7684 3 \u884C\u4F2A\u4EE3\u7801\u4E2D\u7684 2 \u548C 3 \u4E4B\u95F4\u7684\u91CD\u6392\u5E8F\uFF0C\u5728\u591A\u7EBF\u7A0B\u73AF\u5883\u4E2D\u5C06\u4F1A\u88AB\u7981\u6B62\u3002\u4E0A\u9762\u793A\u4F8B\u4EE3\u7801\u5C06\u6309\u5982\u4E0B\u7684\u65F6\u5E8F\u6267\u884C\uFF0C\u5982\u56FE3-39 \u6240\u793A\u3002</p><p><img src="`+W+`" alt="\u56FE3-39" loading="lazy"></p><p>\u56FE3-39 \u591A\u7EBF\u7A0B\u6267\u884C\u65F6\u5E8F\u56FE</p><p>\u8FD9\u4E2A\u65B9\u6848\u672C\u8D28\u4E0A\u662F\u901A\u8FC7\u7981\u6B62\u56FE3-39 \u4E2D\u7684 2 \u548C 3 \u4E4B\u95F4\u7684\u91CD\u6392\u5E8F\uFF0C\u6765\u4FDD\u8BC1\u7EBF\u7A0B\u5B89\u5168\u7684\u5EF6\u8FDF\u521D\u59CB\u5316\u3002</p><h3 id="_3-8-4-\u57FA\u4E8E\u7C7B\u521D\u59CB\u5316\u7684\u89E3\u51B3\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#_3-8-4-\u57FA\u4E8E\u7C7B\u521D\u59CB\u5316\u7684\u89E3\u51B3\u65B9\u6848" aria-hidden="true">#</a> 3.8.4 \u57FA\u4E8E\u7C7B\u521D\u59CB\u5316\u7684\u89E3\u51B3\u65B9\u6848</h3><p>JVM \u5728\u7C7B\u7684\u521D\u59CB\u5316\u9636\u6BB5\uFF08\u5373\u5728 Class \u88AB\u52A0\u8F7D\u540E\uFF0C\u4E14\u88AB\u7EBF\u7A0B\u4F7F\u7528\u4E4B\u524D\uFF09\uFF0C\u4F1A\u6267\u884C\u7C7B\u7684\u521D\u59CB\u5316\u3002\u5728\u6267\u884C\u7C7B\u7684\u521D\u59CB\u5316\u671F\u95F4\uFF0CJVM \u4F1A\u53BB\u83B7\u53D6\u4E00\u4E2A\u9501\u3002\u8FD9\u4E2A\u9501\u53EF\u4EE5\u540C\u6B65\u591A\u4E2A\u7EBF\u7A0B\u5BF9\u540C\u4E00\u4E2A\u7C7B\u7684\u521D\u59CB\u5316\u3002</p><p>\u57FA\u4E8E\u8FD9\u4E2A\u7279\u6027\uFF0C\u53EF\u4EE5\u5B9E\u73B0\u53E6\u4E00\u79CD\u7EBF\u7A0B\u5B89\u5168\u7684\u5EF6\u8FDF\u521D\u59CB\u5316\u65B9\u6848\uFF08\u8FD9\u4E2A\u65B9\u6848\u88AB\u79F0\u4E4B\u4E3A Initialization On Demand Holder idiom\uFF09\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InstanceFactory</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">InstanceHolder</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Instance</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Instance</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">InstanceHolder</span><span class="token punctuation">.</span>instance<span class="token punctuation">;</span>    <span class="token comment">// \u8FD9\u91CC\u5C06\u5BFC\u81F4 InstanceHolder \u7C7B\u88AB\u521D\u59CB\u5316</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5047\u8BBE\u4E24\u4E2A\u7EBF\u7A0B\u5E76\u53D1\u6267\u884C getInstance() \u65B9\u6CD5\uFF0C\u4E0B\u9762\u662F\u6267\u884C\u7684\u793A\u610F\u56FE\uFF0C\u5982\u56FE3-40 \u6240\u793A\u3002</p><p><img src="`+N+'" alt="\u56FE3-40" loading="lazy"></p><p>\u56FE3-40 \u4E24\u4E2A\u7EBF\u7A0B\u5E76\u53D1\u6267\u884C\u7684\u793A\u610F\u56FE</p><p>\u8FD9\u4E2A\u65B9\u6848\u7684\u5B9E\u8D28\u662F\uFF1A\u5141\u8BB8 3.8.2 \u8282\u4E2D\u7684 3 \u884C\u4F2A\u4EE3\u7801\u4E2D\u7684 2 \u548C 3 \u91CD\u6392\u5E8F\uFF0C\u4F46\u4E0D\u5141\u8BB8\u975E\u6784\u9020\u7EBF\u7A0B\uFF08\u8FD9\u91CC\u6307\u7EBF\u7A0B B\uFF09\u201C\u770B\u5230\u201D \u8FD9\u4E2A\u91CD\u6392\u5E8F\u3002</p><p>\u521D\u59CB\u5316\u4E00\u4E2A\u7C7B\uFF0C\u5305\u62EC\u6267\u884C\u8FD9\u4E2A\u7C7B\u7684\u9759\u6001\u521D\u59CB\u5316\u548C\u521D\u59CB\u5316\u5728\u8FD9\u4E2A\u7C7B\u4E2D\u58F0\u660E\u7684\u9759\u6001\u5B57\u6BB5\u3002\u6839\u636E Java \u8BED\u8A00\u89C4\u8303\uFF0C\u5728\u9996\u6B21\u53D1\u751F\u4E0B\u5217\u4EFB\u610F\u4E00\u79CD\u60C5\u51B5\u65F6\uFF0C\u4E00\u4E2A\u7C7B\u6216\u63A5\u53E3\u7C7B\u578B T \u5C06\u88AB\u7ACB\u5373\u521D\u59CB\u5316\u3002</p><ol><li><p>T \u662F\u4E00\u4E2A\u7C7B\uFF0C\u800C\u4E14\u4E00\u4E2A T \u7C7B\u578B\u7684\u5B9E\u4F8B\u88AB\u521B\u5EFA\u3002</p></li><li><p>T \u662F\u4E00\u4E2A\u7C7B\uFF0C\u4E14 T \u4E2D\u58F0\u660E\u7684\u4E00\u4E2A\u9759\u6001\u65B9\u6CD5\u88AB\u8C03\u7528\u3002</p></li><li><p>T \u4E2D\u58F0\u660E\u7684\u4E00\u4E2A\u9759\u6001\u5B57\u6BB5\u88AB\u8D4B\u503C\u3002</p></li><li><p>T \u4E2D\u58F0\u660E\u7684\u4E00\u4E2A\u9759\u6001\u5B57\u6BB5\u88AB\u4F7F\u7528\uFF0C\u800C\u4E14\u8FD9\u4E2A\u5B57\u6BB5\u4E0D\u662F\u4E00\u4E2A\u5E38\u91CF\u5B57\u6BB5\u3002</p></li><li><p>T \u662F\u4E00\u4E2A\u9876\u7EA7\u7C7B\uFF08Top Level Class\uFF0C\u89C1 Java \u8BED\u8A00\u89C4\u8303\u7684 \xA77.6\uFF09\uFF0C\u800C\u4E14\u4E00\u4E2A\u65AD\u8A00\u8BED\u53E5\u5D4C\u5957\u5728 T \u5185\u90E8\u88AB\u6267\u884C\u3002</p></li></ol><p>\u5728 InstanceFactory \u793A\u4F8B\u4EE3\u7801\u4E2D\uFF0C\u9996\u6B21\u6267\u884C getInstance() \u65B9\u6CD5\u7684\u7EBF\u7A0B\u5C06\u5BFC\u81F4 InstanceHolder \u7C7B\u88AB\u521D\u59CB\u5316\uFF08\u7B26\u5408\u60C5\u51B5 4\uFF09\u3002</p><p>\u7531\u4E8E Java \u8BED\u8A00\u662F\u591A\u7EBF\u7A0B\u7684\uFF0C\u591A\u4E2A\u7EBF\u7A0B\u53EF\u80FD\u5728\u540C\u4E00\u65F6\u95F4\u5C1D\u8BD5\u53BB\u521D\u59CB\u5316\u540C\u4E00\u4E2A\u7C7B\u6216\u63A5\u53E3\uFF08\u6BD4\u5982\u8FD9\u91CC\u591A\u4E2A\u7EBF\u7A0B\u53EF\u80FD\u5728\u540C\u4E00\u65F6\u523B\u8C03\u7528 getInstance() \u65B9\u6CD5\u6765\u521D\u59CB\u5316 InstanceHolder \u7C7B\uFF09\u3002\u56E0\u6B64\uFF0C\u5728 Java \u4E2D\u521D\u59CB\u5316\u4E00\u4E2A\u7C7B\u6216\u8005\u63A5\u53E3\u65F6\uFF0C\u9700\u8981\u505A\u7EC6\u81F4\u7684\u540C\u6B65\u5904\u7406\u3002</p><p>Java \u8BED\u8A00\u89C4\u8303\u89C4\u5B9A\uFF0C\u5BF9\u4E8E\u6BCF\u4E00\u4E2A\u7C7B\u6216\u63A5\u53E3 C\uFF0C\u90FD\u6709\u4E00\u4E2A\u552F\u4E00\u7684\u521D\u59CB\u5316\u9501 LC \u4E0E\u4E4B\u5BF9\u5E94\u3002\u4ECE C \u5230 LC \u7684\u6620\u5C04\uFF0C\u7531 JVM \u7684\u5177\u4F53\u5B9E\u73B0\u53BB\u81EA\u7531\u5B9E\u73B0\u3002JVM \u5728\u7C7B\u521D\u59CB\u5316\u671F\u95F4\u4F1A\u83B7\u53D6\u8FD9\u4E2A\u521D\u59CB\u5316\u9501\uFF0C\u5E76\u4E14\u6BCF\u4E2A\u7EBF\u7A0B\u81F3\u5C11\u83B7\u53D6\u4E00\u6B21\u9501\u6765\u786E\u4FDD\u8FD9\u4E2A\u7C7B\u5DF2\u7ECF\u88AB\u521D\u59CB\u5316\u8FC7\u4E86\uFF08\u4E8B\u5B9E\u4E0A\uFF0CJava \u8BED\u8A00\u89C4\u8303\u5141\u8BB8 JVM \u7684\u5177\u4F53\u5B9E\u73B0\u5728\u8FD9\u91CC\u505A\u4E00\u4E9B\u4F18\u5316\uFF0C\u89C1\u540E\u6587\u7684\u8BF4\u660E\uFF09\u3002</p><p>\u5BF9\u4E8E\u7C7B\u6216\u63A5\u53E3\u7684\u521D\u59CB\u5316\uFF0CJava \u8BED\u8A00\u89C4\u8303\u5236\u5B9A\u4E86\u7CBE\u5DE7\u800C\u590D\u6742\u7684\u7C7B\u521D\u59CB\u5316\u5904\u7406\u8FC7\u7A0B\u3002Java \u521D\u59CB\u5316\u4E00\u4E2A\u7C7B\u6216\u63A5\u53E3\u7684\u5904\u7406\u8FC7\u7A0B\u5982\u4E0B\uFF08\u8FD9\u91CC\u5BF9\u7C7B\u521D\u59CB\u5316\u5904\u7406\u8FC7\u7A0B\u7684\u8BF4\u660E\uFF0C\u7701\u7565\u4E86\u4E0E\u672C\u6587\u65E0\u5173\u7684\u90E8\u5206\uFF1B\u540C\u65F6\u4E3A\u4E86\u66F4\u597D\u7684\u8BF4\u660E\u7C7B\u521D\u59CB\u5316\u8FC7\u7A0B\u4E2D\u7684\u540C\u6B65\u5904\u7406\u673A\u5236\uFF0C\u7B14\u8005\u4EBA\u4E3A\u7684\u628A\u7C7B\u521D\u59CB\u5316\u7684\u5904\u7406\u8FC7\u7A0B\u5206\u4E3A\u4E86 5 \u4E2A\u9636\u6BB5\uFF09\u3002</p><p>\u7B2C 1 \u9636\u6BB5\uFF1A\u901A\u8FC7\u5728 Class \u5BF9\u8C61\u4E0A\u540C\u6B65\uFF08\u5373\u83B7\u53D6 Class \u5BF9\u8C61\u7684\u521D\u59CB\u5316\u9501\uFF09\uFF0C\u6765\u63A7\u5236\u7C7B\u6216\u63A5\u53E3\u7684\u521D\u59CB\u5316\u3002\u8FD9\u4E2A\u83B7\u53D6\u9501\u7684\u7EBF\u7A0B\u4F1A\u4E00\u76F4\u7B49\u5F85\uFF0C\u76F4\u5230\u5F53\u524D\u7EBF\u7A0B\u80FD\u591F\u83B7\u53D6\u5230\u8FD9\u4E2A\u521D\u59CB\u5316\u9501\u3002</p><p>\u5047\u8BBE Class \u5BF9\u8C61\u5F53\u524D\u8FD8\u6CA1\u6709\u88AB\u521D\u59CB\u5316\uFF08\u521D\u59CB\u5316\u72B6\u6001 state\uFF0C\u6B64\u65F6\u88AB\u6807\u8BB0\u4E3A state = noInitialization\uFF09\uFF0C\u4E14\u6709\u4E24\u4E2A\u7EBF\u7A0B A \u548C B \u8BD5\u56FE\u540C\u65F6\u521D\u59CB\u5316\u8FD9\u4E2A Class \u5BF9\u8C61\u3002\u56FE3-41 \u662F\u5BF9\u5E94\u7684\u793A\u610F\u56FE\u3002</p><p><img src="'+G+'" alt="\u56FE3-41" loading="lazy"></p><p>\u56FE3-41 \u7C7B\u521D\u59CB\u5316\u2014\u2014\u7B2C 1 \u9636\u6BB5</p><p>\u88683-7 \u662F\u8FD9\u4E2A\u793A\u610F\u56FE\u7684\u8BF4\u660E\u3002</p><p>\u88683-7 \u7C7B\u521D\u59CB\u5316\u2014\u2014\u7B2C 1 \u9636\u6BB5\u7684\u6267\u884C\u65F6\u5E8F\u8868</p><p><img src="'+Y+'" alt="\u88683-7" loading="lazy"></p><p>\u7B2C 2 \u9636\u6BB5\uFF1A\u7EBF\u7A0B A \u6267\u884C\u7C7B\u7684\u521D\u59CB\u5316\uFF0C\u540C\u65F6\u7EBF\u7A0B B \u5728\u521D\u59CB\u5316\u9501\u5BF9\u5E94\u7684 condition \u4E0A\u7B49\u5F85\u3002</p><p><img src="'+Z+'" alt="\u56FE3-42" loading="lazy"></p><p>\u56FE3-42 \u7C7B\u521D\u59CB\u5316\u2014\u2014\u7B2C 2 \u9636\u6BB5</p><p>\u88683-8 \u662F\u8FD9\u4E2A\u793A\u610F\u56FE\u7684\u8BF4\u660E\u3002</p><p>\u88683-8 \u7C7B\u521D\u59CB\u5316\u2014\u2014\u7B2C 2 \u9636\u6BB5\u7684\u6267\u884C\u65F6\u5E8F\u8868</p><p><img src="'+$+'" alt="\u88683-8" loading="lazy"></p><p>\u7B2C 3 \u9636\u6BB5\uFF1A\u7EBF\u7A0B A \u8BBE\u7F6E state = initialized\uFF0C\u7136\u540E\u5524\u9192\u5728 condition \u4E2D\u7B49\u5F85\u7684\u6240\u6709\u7EBF\u7A0B\u3002</p><p><img src="'+nn+'" alt="\u56FE3-43" loading="lazy"></p><p>\u56FE3-43 \u7C7B\u521D\u59CB\u5316\u2014\u2014\u7B2C 3 \u9636\u6BB5</p><p>\u88683-9 \u662F\u8FD9\u4E2A\u793A\u610F\u56FE\u7684\u8BF4\u660E\u3002</p><p>\u88683-9 \u7C7B\u521D\u59CB\u5316\u2014\u2014\u7B2C 3 \u9636\u6BB5\u7684\u6267\u884C\u65F6\u5E8F\u8868</p><p><img src="'+an+'" alt="\u88683-9" loading="lazy"></p><p>\u7B2C 4 \u9636\u6BB5\uFF1A\u7EBF\u7A0B B \u7ED3\u675F\u7C7B\u7684\u521D\u59CB\u5316\u5904\u7406\u3002</p><p><img src="'+sn+'" alt="\u56FE3-44" loading="lazy"></p><p>\u56FE3-44 \u7C7B\u521D\u59CB\u5316\u2014\u2014\u7B2C 4 \u9636\u6BB5</p><p>\u88683-10 \u662F\u8FD9\u4E2A\u793A\u610F\u56FE\u7684\u8BF4\u660E\u3002</p><p>\u88683-10 \u7C7B\u521D\u59CB\u5316\u2014\u2014\u7B2C 4 \u9636\u6BB5\u7684\u6267\u884C\u65F6\u5E8F\u8868</p><p><img src="'+pn+'" alt="\u88683-10" loading="lazy"></p><p><img src="'+en+'" alt="\u56FE3-45" loading="lazy"></p><p>\u56FE3-45 \u591A\u7EBF\u7A0B\u6267\u884C\u65F6\u5E8F\u56FE</p><p>\u7EBF\u7A0B A \u5728\u7B2C 2 \u9636\u6BB5\u7684 A1 \u6267\u884C\u7C7B\u7684\u521D\u59CB\u5316\uFF0C\u5E76\u5728\u7B2C 3 \u9636\u6BB5\u7684 A4 \u91CA\u653E\u521D\u59CB\u5316\u9501\uFF1B\u7EBF\u7A0B B \u5728\u7B2C 4 \u9636\u6BB5\u7684 B1 \u83B7\u53D6\u540C\u4E00\u4E2A\u521D\u59CB\u5316\u9501\uFF0C\u5E76\u5728\u7B2C 4 \u9636\u6BB5\u7684 B4 \u4E4B\u540E\u624D\u5F00\u59CB\u8BBF\u95EE\u8FD9\u4E2A\u7C7B\u3002\u6839\u636E Java \u5185\u5B58\u6A21\u578B\u89C4\u8303\u7684\u9501\u89C4\u5219\uFF0C\u8FD9\u91CC\u5C06\u5B58\u5728\u5982\u4E0B\u7684 happens-before \u5173\u7CFB\u3002</p><p>\u8FD9\u4E2A happens-before \u5173\u7CFB\u5C06\u4FDD\u8BC1\uFF1A\u7EBF\u7A0B A \u6267\u884C\u7C7B\u7684\u521D\u59CB\u5316\u65F6\u7684\u5199\u5165\u64CD\u4F5C\uFF08\u6267\u884C\u7C7B\u7684\u9759\u6001\u521D\u59CB\u5316\u548C\u521D\u59CB\u5316\u7C7B\u4E2D\u58F0\u660E\u7684\u9759\u6001\u5B57\u6BB5\uFF09\uFF0C\u7EBF\u7A0B B \u4E00\u5B9A\u80FD\u770B\u5230\u3002</p><p>\u7B2C 5 \u9636\u6BB5\uFF1A\u7EBF\u7A0B C \u6267\u884C\u7C7B\u7684\u521D\u59CB\u5316\u7684\u5904\u7406\u3002</p><p><img src="'+tn+'" alt="\u56FE3-46" loading="lazy"></p><p>\u56FE3-46 \u7C7B\u521D\u59CB\u5316\u2014\u2014\u7B2C 5 \u9636\u6BB5</p><p>\u88683-11 \u662F\u8FD9\u4E2A\u793A\u610F\u56FE\u7684\u8BF4\u660E\u3002</p><p>\u88683-11 \u7C7B\u521D\u59CB\u5316\u2014\u2014\u7B2C5\u9636\u6BB5\u7684\u6267\u884C\u65F6\u5E8F\u8868</p><p><img src="'+ln+'" alt="\u88683-11" loading="lazy"></p><p>\u5728\u7B2C 3 \u9636\u6BB5\u4E4B\u540E\uFF0C\u7C7B\u5DF2\u7ECF\u5B8C\u6210\u4E86\u521D\u59CB\u5316\u3002\u56E0\u6B64\u7EBF\u7A0B C \u5728\u7B2C 5 \u9636\u6BB5\u7684\u7C7B\u521D\u59CB\u5316\u5904\u7406\u8FC7\u7A0B\u76F8\u5BF9\u7B80\u5355\u4E00\u4E9B\uFF08\u524D\u9762\u7684\u7EBF\u7A0B A \u548C B \u7684\u7C7B\u521D\u59CB\u5316\u5904\u7406\u8FC7\u7A0B\u90FD\u7ECF\u5386\u4E86\u4E24\u6B21\u9501\u83B7\u53D6\u2014\u9501\u91CA\u653E\uFF0C\u800C\u7EBF\u7A0B C \u7684\u7C7B\u521D\u59CB\u5316\u5904\u7406\u53EA\u9700\u8981\u7ECF\u5386\u4E00\u6B21\u9501\u83B7\u53D6\u2014\u9501\u91CA\u653E\uFF09\u3002</p><p>\u7EBF\u7A0B A \u5728\u7B2C 2 \u9636\u6BB5\u7684 A1 \u6267\u884C\u7C7B\u7684\u521D\u59CB\u5316\uFF0C\u5E76\u5728\u7B2C 3 \u9636\u6BB5\u7684 A4 \u91CA\u653E\u9501\uFF1B\u7EBF\u7A0B C \u5728\u7B2C 5 \u9636\u6BB5\u7684 C1 \u83B7\u53D6\u540C\u4E00\u4E2A\u9501\uFF0C\u5E76\u5728\u5728\u7B2C 5 \u9636\u6BB5\u7684 C4 \u4E4B\u540E\u624D\u5F00\u59CB\u8BBF\u95EE\u8FD9\u4E2A\u7C7B\u3002\u6839\u636E Java \u5185\u5B58\u6A21\u578B\u89C4\u8303\u7684\u9501\u89C4\u5219\uFF0C\u5C06\u5B58\u5728\u5982\u4E0B\u7684 happens-before \u5173\u7CFB\u3002</p><p>\u8FD9\u4E2A happens-before \u5173\u7CFB\u5C06\u4FDD\u8BC1\uFF1A\u7EBF\u7A0B A \u6267\u884C\u7C7B\u7684\u521D\u59CB\u5316\u65F6\u7684\u5199\u5165\u64CD\u4F5C\uFF0C\u7EBF\u7A0B C \u4E00\u5B9A\u80FD\u770B\u5230\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1A\u8FD9\u91CC\u7684 condition \u548C state \u6807\u8BB0\u662F\u672C\u6587\u865A\u6784\u51FA\u6765\u7684\u3002Java \u8BED\u8A00\u89C4\u8303\u5E76\u6CA1\u6709\u786C\u6027\u89C4\u5B9A\u4E00\u5B9A\u8981\u4F7F\u7528 condition \u548C state \u6807\u8BB0\u3002JVM \u7684\u5177\u4F53\u5B9E\u73B0\u53EA\u8981\u5B9E\u73B0\u7C7B\u4F3C\u529F\u80FD\u5373\u53EF\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1AJava \u8BED\u8A00\u89C4\u8303\u5141\u8BB8 Java \u7684\u5177\u4F53\u5B9E\u73B0\uFF0C\u4F18\u5316\u7C7B\u7684\u521D\u59CB\u5316\u5904\u7406\u8FC7\u7A0B\uFF08\u5BF9\u8FD9\u91CC\u7684\u7B2C 5 \u9636\u6BB5\u505A\u4F18\u5316\uFF09\uFF0C\u5177\u4F53\u7EC6\u8282\u53C2\u89C1 Java \u8BED\u8A00\u89C4\u8303\u7684 12.4.2 \u8282\u3002</p><p><img src="'+on+'" alt="\u56FE3-47" loading="lazy"></p><p>\u56FE3-47 \u591A\u7EBF\u7A0B\u6267\u884C\u65F6\u5E8F\u56FE</p><p>\u901A\u8FC7\u5BF9\u6BD4\u57FA\u4E8E volatile \u7684\u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\u7684\u65B9\u6848\u548C\u57FA\u4E8E\u7C7B\u521D\u59CB\u5316\u7684\u65B9\u6848\uFF0C\u6211\u4EEC\u4F1A\u53D1\u73B0\u57FA\u4E8E\u7C7B\u521D\u59CB\u5316\u7684\u65B9\u6848\u7684\u5B9E\u73B0\u4EE3\u7801\u66F4\u7B80\u6D01\u3002\u4F46\u57FA\u4E8E volatile \u7684\u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\u7684\u65B9\u6848\u6709\u4E00\u4E2A\u989D\u5916\u7684\u4F18\u52BF\uFF1A\u9664\u4E86\u53EF\u4EE5\u5BF9\u9759\u6001\u5B57\u6BB5\u5B9E\u73B0\u5EF6\u8FDF\u521D\u59CB\u5316\u5916\uFF0C\u8FD8\u53EF\u4EE5\u5BF9\u5B9E\u4F8B\u5B57\u6BB5\u5B9E\u73B0\u5EF6\u8FDF\u521D\u59CB\u5316\u3002</p><p>\u5B57\u6BB5\u5EF6\u8FDF\u521D\u59CB\u5316\u964D\u4F4E\u4E86\u521D\u59CB\u5316\u7C7B\u6216\u521B\u5EFA\u5B9E\u4F8B\u7684\u5F00\u9500\uFF0C\u4F46\u589E\u52A0\u4E86\u8BBF\u95EE\u88AB\u5EF6\u8FDF\u521D\u59CB\u5316\u7684\u5B57\u6BB5\u7684\u5F00\u9500\u3002\u5728\u5927\u591A\u6570\u65F6\u5019\uFF0C\u6B63\u5E38\u7684\u521D\u59CB\u5316\u8981\u4F18\u4E8E\u5EF6\u8FDF\u521D\u59CB\u5316\u3002\u5982\u679C\u786E\u5B9E\u9700\u8981\u5BF9\u5B9E\u4F8B\u5B57\u6BB5\u4F7F\u7528\u7EBF\u7A0B\u5B89\u5168\u7684\u5EF6\u8FDF\u521D\u59CB\u5316\uFF0C\u8BF7\u4F7F\u7528\u4E0A\u9762\u4ECB\u7ECD\u7684\u57FA\u4E8E volatile \u7684\u5EF6\u8FDF\u521D\u59CB\u5316\u7684\u65B9\u6848\uFF1B\u5982\u679C\u786E\u5B9E\u9700\u8981\u5BF9\u9759\u6001\u5B57\u6BB5\u4F7F\u7528\u7EBF\u7A0B\u5B89\u5168\u7684\u5EF6\u8FDF\u521D\u59CB\u5316\uFF0C\u8BF7\u4F7F\u7528\u4E0A\u9762\u4ECB\u7ECD\u7684\u57FA\u4E8E\u7C7B\u521D\u59CB\u5316\u7684\u65B9\u6848\u3002</p><h2 id="_3-9-java-\u5185\u5B58\u6A21\u578B\u7EFC\u8FF0" tabindex="-1"><a class="header-anchor" href="#_3-9-java-\u5185\u5B58\u6A21\u578B\u7EFC\u8FF0" aria-hidden="true">#</a> 3.9 Java \u5185\u5B58\u6A21\u578B\u7EFC\u8FF0</h2><p>\u524D\u9762\u5BF9 Java \u5185\u5B58\u6A21\u578B\u7684\u57FA\u7840\u77E5\u8BC6\u548C\u5185\u5B58\u6A21\u578B\u7684\u5177\u4F53\u5B9E\u73B0\u8FDB\u884C\u4E86\u8BF4\u660E\u3002\u4E0B\u9762\u5BF9 Java \u5185\u5B58\u6A21\u578B\u7684\u76F8\u5173\u77E5\u8BC6\u505A\u4E00\u4E2A\u603B\u7ED3\u3002</p><h3 id="_3-9-1-\u5904\u7406\u5668\u7684\u5185\u5B58\u6A21\u578B" tabindex="-1"><a class="header-anchor" href="#_3-9-1-\u5904\u7406\u5668\u7684\u5185\u5B58\u6A21\u578B" aria-hidden="true">#</a> 3.9.1 \u5904\u7406\u5668\u7684\u5185\u5B58\u6A21\u578B</h3><p>\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B\u662F\u4E00\u4E2A\u7406\u8BBA\u53C2\u8003\u6A21\u578B\uFF0CJMM \u548C\u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\u5728\u8BBE\u8BA1\u65F6\u901A\u5E38\u4F1A\u4EE5\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B\u4E3A\u53C2\u7167\u3002\u5728\u8BBE\u8BA1\u65F6\uFF0CJMM \u548C\u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\u4F1A\u5BF9\u987A\u5E8F\u4E00\u81F4\u6027\u6A21\u578B\u505A\u4E00\u4E9B\u653E\u677E\uFF0C\u56E0\u4E3A\u5982\u679C\u5B8C\u5168\u6309\u7167\u987A\u5E8F\u4E00\u81F4\u6027\u6A21\u578B\u6765\u5B9E\u73B0\u5904\u7406\u5668\u548C JMM\uFF0C\u90A3\u4E48\u5F88\u591A\u7684\u5904\u7406\u5668\u548C\u7F16\u8BD1\u5668\u4F18\u5316\u90FD\u8981\u88AB\u7981\u6B62\uFF0C\u8FD9\u5BF9\u6267\u884C\u6027\u80FD\u5C06\u4F1A\u6709\u5F88\u5927\u7684\u5F71\u54CD\u3002</p><p>\u6839\u636E\u5BF9\u4E0D\u540C\u7C7B\u578B\u7684\u8BFB / \u5199\u64CD\u4F5C\u7EC4\u5408\u7684\u6267\u884C\u987A\u5E8F\u7684\u653E\u677E\uFF0C\u53EF\u4EE5\u628A\u5E38\u89C1\u5904\u7406\u5668\u7684\u5185\u5B58\u6A21\u578B\u5212\u5206\u4E3A\u5982\u4E0B\u51E0\u79CD\u7C7B\u578B\u3002</p><ul><li><p>\u653E\u677E\u7A0B\u5E8F\u4E2D\u5199\u2014\u8BFB\u64CD\u4F5C\u7684\u987A\u5E8F\uFF0C\u7531\u6B64\u4EA7\u751F\u4E86 Total Store Ordering \u5185\u5B58\u6A21\u578B\uFF08\u7B80\u79F0\u4E3A TSO\uFF09\u3002</p></li><li><p>\u5728\u4E0A\u9762\u7684\u57FA\u7840\u4E0A\uFF0C\u7EE7\u7EED\u653E\u677E\u7A0B\u5E8F\u4E2D\u5199\u2014\u5199\u64CD\u4F5C\u7684\u987A\u5E8F\uFF0C\u7531\u6B64\u4EA7\u751F\u4E86 Partial Store Order \u5185\u5B58\u6A21\u578B\uFF08\u7B80\u79F0\u4E3A PSO\uFF09\u3002</p></li><li><p>\u5728\u524D\u9762\u4E24\u6761\u7684\u57FA\u7840\u4E0A\uFF0C\u7EE7\u7EED\u653E\u677E\u7A0B\u5E8F\u4E2D\u8BFB\u2014\u5199\u548C\u8BFB\u2014\u8BFB\u64CD\u4F5C\u7684\u987A\u5E8F\uFF0C\u7531\u6B64\u4EA7\u751F\u4E86 Relaxed Memory Order \u5185\u5B58\u6A21\u578B\uFF08\u7B80\u79F0\u4E3A RMO\uFF09\u548C PowerPC \u5185\u5B58\u6A21\u578B\u3002</p></li></ul><p>\u6CE8\u610F\uFF0C\u8FD9\u91CC\u5904\u7406\u5668\u5BF9\u8BFB / \u5199\u64CD\u4F5C\u7684\u653E\u677E\uFF0C\u662F\u4EE5\u4E24\u4E2A\u64CD\u4F5C\u4E4B\u95F4\u4E0D\u5B58\u5728\u6570\u636E\u4F9D\u8D56\u6027\u4E3A\u524D\u63D0\u7684\uFF08\u56E0\u4E3A\u5904\u7406\u5668\u8981\u9075\u5B88 as-if-serial \u8BED\u4E49\uFF0C\u5904\u7406\u5668\u4E0D\u4F1A\u5BF9\u5B58\u5728\u6570\u636E\u4F9D\u8D56\u6027\u7684\u4E24\u4E2A\u5185\u5B58\u64CD\u4F5C\u505A\u91CD\u6392\u5E8F\uFF09\u3002</p><p>\u88683-12 \u5C55\u793A\u4E86\u5E38\u89C1\u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\u7684\u7EC6\u8282\u7279\u5F81\u5982\u4E0B\u3002</p><p>\u88683-12 \u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\u7684\u7279\u5F81\u8868</p><p><img src="'+cn+'" alt="\u88683-12" loading="lazy"></p><p>\u4ECE\u88683-12 \u4E2D\u53EF\u4EE5\u770B\u5230\uFF0C\u6240\u6709\u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\u90FD\u5141\u8BB8\u5199\u2014\u8BFB\u91CD\u6392\u5E8F\uFF0C\u539F\u56E0\u5728\u7B2C 1 \u7AE0\u5DF2\u7ECF\u8BF4\u660E\u8FC7\uFF1A\u5B83\u4EEC\u90FD\u4F7F\u7528\u4E86\u5199\u7F13\u5B58\u533A\u3002\u5199\u7F13\u5B58\u533A\u53EF\u80FD\u5BFC\u81F4\u5199\u2014\u8BFB\u64CD\u4F5C\u91CD\u6392\u5E8F\u3002\u540C\u65F6\uFF0C\u6211\u4EEC\u53EF\u4EE5\u770B\u5230\u8FD9\u4E9B\u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\u90FD\u5141\u8BB8\u66F4\u65E9\u8BFB\u5230\u5F53\u524D\u5904\u7406\u5668\u7684\u5199\uFF0C\u539F\u56E0\u540C\u6837\u662F\u56E0\u4E3A\u5199\u7F13\u5B58\u533A\u3002\u7531\u4E8E\u5199\u7F13\u5B58\u533A\u4EC5\u5BF9\u5F53\u524D\u5904\u7406\u5668\u53EF\u89C1\uFF0C\u8FD9\u4E2A\u7279\u6027\u5BFC\u81F4\u5F53\u524D\u5904\u7406\u5668\u53EF\u4EE5\u6BD4\u5176\u4ED6\u5904\u7406\u5668\u5148\u770B\u5230\u4E34\u65F6\u4FDD\u5B58\u5728\u81EA\u5DF1\u5199\u7F13\u5B58\u533A\u4E2D\u7684\u5199\u3002</p><p>\u88683-12 \u4E2D\u7684\u5404\u79CD\u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\uFF0C\u4ECE\u4E0A\u5230\u4E0B\uFF0C\u6A21\u578B\u7531\u5F3A\u53D8\u5F31\u3002\u8D8A\u662F\u8FFD\u6C42\u6027\u80FD\u7684\u5904\u7406\u5668\uFF0C\u5185\u5B58\u6A21\u578B\u8BBE\u8BA1\u5F97\u4F1A\u8D8A\u5F31\u3002\u56E0\u4E3A\u8FD9\u4E9B\u5904\u7406\u5668\u5E0C\u671B\u5185\u5B58\u6A21\u578B\u5BF9\u5B83\u4EEC\u7684\u675F\u7F1A\u8D8A\u5C11\u8D8A\u597D\uFF0C\u8FD9\u6837\u5B83\u4EEC\u5C31\u53EF\u4EE5\u505A\u5C3D\u53EF\u80FD\u591A\u7684\u4F18\u5316\u6765\u63D0\u9AD8\u6027\u80FD\u3002</p><p>\u7531\u4E8E\u5E38\u89C1\u7684\u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\u6BD4 JMM \u8981\u5F31\uFF0CJava \u7F16\u8BD1\u5668\u5728\u751F\u6210\u5B57\u8282\u7801\u65F6\uFF0C\u4F1A\u5728\u6267\u884C\u6307\u4EE4\u5E8F\u5217\u7684\u9002\u5F53\u4F4D\u7F6E\u63D2\u5165\u5185\u5B58\u5C4F\u969C\u6765\u9650\u5236\u5904\u7406\u5668\u7684\u91CD\u6392\u5E8F\u3002\u540C\u65F6\uFF0C\u7531\u4E8E\u5404\u79CD\u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\u7684\u5F3A\u5F31\u4E0D\u540C\uFF0C\u4E3A\u4E86\u5728\u4E0D\u540C\u7684\u5904\u7406\u5668\u5E73\u53F0\u5411\u7A0B\u5E8F\u5458\u5C55\u793A\u4E00\u4E2A\u4E00\u81F4\u7684\u5185\u5B58\u6A21\u578B\uFF0CJMM \u5728\u4E0D\u540C\u7684\u5904\u7406\u5668\u4E2D\u9700\u8981\u63D2\u5165\u7684\u5185\u5B58\u5C4F\u969C\u7684\u6570\u91CF\u548C\u79CD\u7C7B\u4E5F\u4E0D\u76F8\u540C\u3002\u56FE3-48 \u5C55\u793A\u4E86 JMM \u5728\u4E0D\u540C\u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\u4E2D\u9700\u8981\u63D2\u5165\u7684\u5185\u5B58\u5C4F\u969C\u7684\u793A\u610F\u56FE\u3002</p><p>JMM \u5C4F\u853D\u4E86\u4E0D\u540C\u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\u7684\u5DEE\u5F02\uFF0C\u5B83\u5728\u4E0D\u540C\u7684\u5904\u7406\u5668\u5E73\u53F0\u4E4B\u4E0A\u4E3A Java \u7A0B\u5E8F\u5458\u5448\u73B0\u4E86\u4E00\u4E2A\u4E00\u81F4\u7684\u5185\u5B58\u6A21\u578B\u3002</p><p><img src="'+rn+'" alt="\u56FE3-48" loading="lazy"></p><p>\u56FE3-48 JMM \u63D2\u5165\u5185\u5B58\u5C4F\u969C\u7684\u793A\u610F\u56FE</p><h3 id="_3-9-2-\u5404\u79CD\u5185\u5B58\u6A21\u578B\u4E4B\u95F4\u7684\u5173\u7CFB" tabindex="-1"><a class="header-anchor" href="#_3-9-2-\u5404\u79CD\u5185\u5B58\u6A21\u578B\u4E4B\u95F4\u7684\u5173\u7CFB" aria-hidden="true">#</a> 3.9.2 \u5404\u79CD\u5185\u5B58\u6A21\u578B\u4E4B\u95F4\u7684\u5173\u7CFB</h3><p>JMM \u662F\u4E00\u4E2A\u8BED\u8A00\u7EA7\u7684\u5185\u5B58\u6A21\u578B\uFF0C\u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\u662F\u786C\u4EF6\u7EA7\u7684\u5185\u5B58\u6A21\u578B\uFF0C\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B\u662F\u4E00\u4E2A\u7406\u8BBA\u53C2\u8003\u6A21\u578B\u3002\u4E0B\u9762\u662F\u8BED\u8A00\u5185\u5B58\u6A21\u578B\u3001\u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\u548C\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B\u7684\u5F3A\u5F31\u5BF9\u6BD4\u793A\u610F\u56FE\uFF0C\u5982\u56FE3-49 \u6240\u793A\u3002</p><p><img src="'+un+'" alt="\u56FE3-49" loading="lazy"></p><p>\u56FE3-49 \u5404\u79CD CPU \u5185\u5B58\u6A21\u578B\u7684\u5F3A\u5F31\u5BF9\u6BD4\u793A\u610F\u56FE</p><p>\u4ECE\u56FE\u4E2D\u53EF\u4EE5\u770B\u51FA\uFF1A\u5E38\u89C1\u7684 4 \u79CD\u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\u6BD4\u5E38\u7528\u7684 3 \u4E2D\u8BED\u8A00\u5185\u5B58\u6A21\u578B\u8981\u5F31\uFF0C\u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\u548C\u8BED\u8A00\u5185\u5B58\u6A21\u578B\u90FD\u6BD4\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B\u8981\u5F31\u3002\u540C\u5904\u7406\u5668\u5185\u5B58\u6A21\u578B\u4E00\u6837\uFF0C\u8D8A\u662F\u8FFD\u6C42\u6267\u884C\u6027\u80FD\u7684\u8BED\u8A00\uFF0C\u5185\u5B58\u6A21\u578B\u8BBE\u8BA1\u5F97\u4F1A\u8D8A\u5F31\u3002</p><h3 id="_3-9-3-jmm-\u7684\u5185\u5B58\u53EF\u89C1\u6027\u4FDD\u8BC1" tabindex="-1"><a class="header-anchor" href="#_3-9-3-jmm-\u7684\u5185\u5B58\u53EF\u89C1\u6027\u4FDD\u8BC1" aria-hidden="true">#</a> 3.9.3 JMM \u7684\u5185\u5B58\u53EF\u89C1\u6027\u4FDD\u8BC1</h3><p>\u6309\u7A0B\u5E8F\u7C7B\u578B\uFF0CJava \u7A0B\u5E8F\u7684\u5185\u5B58\u53EF\u89C1\u6027\u4FDD\u8BC1\u53EF\u4EE5\u5206\u4E3A\u4E0B\u5217 3 \u7C7B\u3002</p><ul><li><p>\u5355\u7EBF\u7A0B\u7A0B\u5E8F\u3002\u5355\u7EBF\u7A0B\u7A0B\u5E8F\u4E0D\u4F1A\u51FA\u73B0\u5185\u5B58\u53EF\u89C1\u6027\u95EE\u9898\u3002\u7F16\u8BD1\u5668\u3001runtime \u548C\u5904\u7406\u5668\u4F1A\u5171\u540C\u786E\u4FDD\u5355\u7EBF\u7A0B\u7A0B\u5E8F\u7684\u6267\u884C\u7ED3\u679C\u4E0E\u8BE5\u7A0B\u5E8F\u5728\u987A\u5E8F\u4E00\u81F4\u6027\u6A21\u578B\u4E2D\u7684\u6267\u884C\u7ED3\u679C\u76F8\u540C\u3002</p></li><li><p>\u6B63\u786E\u540C\u6B65\u7684\u591A\u7EBF\u7A0B\u7A0B\u5E8F\u3002\u6B63\u786E\u540C\u6B65\u7684\u591A\u7EBF\u7A0B\u7A0B\u5E8F\u7684\u6267\u884C\u5C06\u5177\u6709\u987A\u5E8F\u4E00\u81F4\u6027\uFF08\u7A0B\u5E8F\u7684\u6267\u884C\u7ED3\u679C\u4E0E\u8BE5\u7A0B\u5E8F\u5728\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B\u4E2D\u7684\u6267\u884C\u7ED3\u679C\u76F8\u540C\uFF09\u3002\u8FD9\u662F JMM \u5173\u6CE8\u7684\u91CD\u70B9\uFF0CJMM \u901A\u8FC7\u9650\u5236\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u7684\u91CD\u6392\u5E8F\u6765\u4E3A\u7A0B\u5E8F\u5458\u63D0\u4F9B\u5185\u5B58\u53EF\u89C1\u6027\u4FDD\u8BC1\u3002</p></li><li><p>\u672A\u540C\u6B65 / \u672A\u6B63\u786E\u540C\u6B65\u7684\u591A\u7EBF\u7A0B\u7A0B\u5E8F\u3002JMM \u4E3A\u5B83\u4EEC\u63D0\u4F9B\u4E86\u6700\u5C0F\u5B89\u5168\u6027\u4FDD\u969C\uFF1A\u7EBF\u7A0B\u6267\u884C\u65F6\u8BFB\u53D6\u5230\u7684\u503C\uFF0C\u8981\u4E48\u662F\u4E4B\u524D\u67D0\u4E2A\u7EBF\u7A0B\u5199\u5165\u7684\u503C\uFF0C\u8981\u4E48\u662F\u9ED8\u8BA4\u503C\uFF080\u3001null\u3001false\uFF09\u3002</p></li></ul><p>\u6CE8\u610F\uFF0C\u6700\u5C0F\u5B89\u5168\u6027\u4FDD\u969C\u4E0E 64 \u4F4D\u6570\u636E\u7684\u975E\u539F\u5B50\u6027\u5199\u5E76\u4E0D\u77DB\u76FE\u3002\u5B83\u4EEC\u662F\u4E24\u4E2A\u4E0D\u540C\u7684\u6982\u5FF5\uFF0C\u5B83\u4EEC \u201C\u53D1\u751F\u201D \u7684\u65F6\u95F4\u70B9\u4E5F\u4E0D\u540C\u3002\u6700\u5C0F\u5B89\u5168\u6027\u4FDD\u8BC1\u5BF9\u8C61\u9ED8\u8BA4\u521D\u59CB\u5316\u4E4B\u540E\uFF08\u8BBE\u7F6E\u6210\u5458\u57DF\u4E3A 0\u3001null \u6216 false\uFF09\uFF0C\u624D\u4F1A\u88AB\u4EFB\u610F\u7EBF\u7A0B\u4F7F\u7528\u3002\u6700\u5C0F\u5B89\u5168\u6027 \u201C\u53D1\u751F\u201D \u5728\u5BF9\u8C61\u88AB\u4EFB\u610F\u7EBF\u7A0B\u4F7F\u7528\u4E4B\u524D\u300264 \u4F4D\u6570\u636E\u7684\u975E\u539F\u5B50\u6027\u5199 \u201C\u53D1\u751F\u201D \u5728\u5BF9\u8C61\u88AB\u591A\u4E2A\u7EBF\u7A0B\u4F7F\u7528\u7684\u8FC7\u7A0B\u4E2D\uFF08\u5199\u5171\u4EAB\u53D8\u91CF\uFF09\u3002\u5F53\u53D1\u751F\u95EE\u9898\u65F6\uFF08\u5904\u7406\u5668 B \u770B\u5230\u4EC5\u4EC5\u88AB\u5904\u7406\u5668 A \u201C\u5199\u4E86\u4E00\u534A\u201D \u7684\u65E0\u6548\u503C\uFF09\uFF0C\u8FD9\u91CC\u867D\u7136\u5904\u7406\u5668 B \u8BFB\u53D6\u5230\u4E00\u4E2A\u88AB\u5199\u4E86\u4E00\u534A\u7684\u65E0\u6548\u503C\uFF0C\u4F46\u8FD9\u4E2A\u503C\u4ECD\u7136\u662F\u5904\u7406\u5668 A \u5199\u5165\u7684\uFF0C\u53EA\u4E0D\u8FC7\u662F\u5904\u7406\u5668 A \u8FD8\u6CA1\u6709\u5199\u5B8C\u800C\u5DF2\u3002\u6700\u5C0F\u5B89\u5168\u6027\u4FDD\u8BC1\u7EBF\u7A0B\u8BFB\u53D6\u5230\u7684\u503C\uFF0C\u8981\u4E48\u662F\u4E4B\u524D\u67D0\u4E2A\u7EBF\u7A0B\u5199\u5165\u7684\u503C\uFF0C\u8981\u4E48\u662F\u9ED8\u8BA4\u503C\uFF080\u3001null\u3001false\uFF09\u3002\u4F46\u6700\u5C0F\u5B89\u5168\u6027\u5E76\u4E0D\u4FDD\u8BC1\u7EBF\u7A0B\u8BFB\u53D6\u5230\u7684\u503C\uFF0C\u4E00\u5B9A\u662F\u67D0\u4E2A\u7EBF\u7A0B\u5199\u5B8C\u540E\u7684\u503C\u3002\u6700\u5C0F\u5B89\u5168\u6027\u4FDD\u8BC1\u7EBF\u7A0B\u8BFB\u53D6\u5230\u7684\u503C\u4E0D\u4F1A\u65E0\u4E2D\u751F\u6709\u7684\u5192\u51FA\u6765\uFF0C\u4F46\u5E76\u4E0D\u4FDD\u8BC1\u7EBF\u7A0B\u8BFB\u53D6\u5230\u7684\u503C\u4E00\u5B9A\u662F\u6B63\u786E\u7684\u3002</p><p>\u56FE3-50 \u5C55\u793A\u4E86\u8FD9 3 \u7C7B\u7A0B\u5E8F\u5728 JMM \u4E2D\u4E0E\u5728\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B\u4E2D\u7684\u6267\u884C\u7ED3\u679C\u7684\u5F02\u540C\u3002</p><p><img src="'+dn+'" alt="\u56FE3-50" loading="lazy"></p><p>\u56FE3-50 3 \u7C7B\u7A0B\u5E8F\u7684\u6267\u884C\u7ED3\u679C\u7684\u5BF9\u6BD4\u56FE</p><p>\u53EA\u8981\u591A\u7EBF\u7A0B\u7A0B\u5E8F\u662F\u6B63\u786E\u540C\u6B65\u7684\uFF0CJMM \u4FDD\u8BC1\u8BE5\u7A0B\u5E8F\u5728\u4EFB\u610F\u7684\u5904\u7406\u5668\u5E73\u53F0\u4E0A\u7684\u6267\u884C\u7ED3\u679C\uFF0C\u4E0E\u8BE5\u7A0B\u5E8F\u5728\u987A\u5E8F\u4E00\u81F4\u6027\u5185\u5B58\u6A21\u578B\u4E2D\u7684\u6267\u884C\u7ED3\u679C\u4E00\u81F4\u3002</p><h3 id="_3-9-4-jsr-133-\u5BF9\u65E7\u5185\u5B58\u6A21\u578B\u7684\u4FEE\u8865" tabindex="-1"><a class="header-anchor" href="#_3-9-4-jsr-133-\u5BF9\u65E7\u5185\u5B58\u6A21\u578B\u7684\u4FEE\u8865" aria-hidden="true">#</a> 3.9.4 JSR-133 \u5BF9\u65E7\u5185\u5B58\u6A21\u578B\u7684\u4FEE\u8865</h3><p>JSR-133 \u5BF9 JDK 5 \u4E4B\u524D\u7684\u65E7\u5185\u5B58\u6A21\u578B\u7684\u4FEE\u8865\u4E3B\u8981\u6709\u4E24\u4E2A\u3002</p><ul><li><p>\u589E\u5F3A volatile \u7684\u5185\u5B58\u8BED\u4E49\u3002\u65E7\u5185\u5B58\u6A21\u578B\u5141\u8BB8 volatile \u53D8\u91CF\u4E0E\u666E\u901A\u53D8\u91CF\u91CD\u6392\u5E8F\u3002JSR-133 \u4E25\u683C\u9650\u5236 volatile \u53D8\u91CF\u4E0E\u666E\u901A\u53D8\u91CF\u7684\u91CD\u6392\u5E8F\uFF0C\u4F7F volatile \u7684\u5199\u2014\u8BFB\u548C\u9501\u7684\u91CA\u653E\u2014\u83B7\u53D6\u5177\u6709\u76F8\u540C\u7684\u5185\u5B58\u8BED\u4E49\u3002</p></li><li><p>\u589E\u5F3A final \u7684\u5185\u5B58\u8BED\u4E49\u3002\u5728\u65E7\u5185\u5B58\u6A21\u578B\u4E2D\uFF0C\u591A\u6B21\u8BFB\u53D6\u540C\u4E00\u4E2A final \u53D8\u91CF\u7684\u503C\u53EF\u80FD\u4F1A\u4E0D\u76F8\u540C\u3002\u4E3A\u6B64\uFF0CJSR-133 \u4E3A final \u589E\u52A0\u4E86\u4E24\u4E2A\u91CD\u6392\u5E8F\u89C4\u5219\u3002\u5728\u4FDD\u8BC1 final \u5F15\u7528\u4E0D\u4F1A\u4ECE\u6784\u9020\u51FD\u6570\u5185\u9038\u51FA\u7684\u60C5\u51B5\u4E0B\uFF0Cfinal \u5177\u6709\u4E86\u521D\u59CB\u5316\u5B89\u5168\u6027\u3002</p></li></ul><h2 id="_3-10-\u672C\u7AE0\u5C0F\u7ED3" tabindex="-1"><a class="header-anchor" href="#_3-10-\u672C\u7AE0\u5C0F\u7ED3" aria-hidden="true">#</a> 3.10 \u672C\u7AE0\u5C0F\u7ED3</h2><p>\u672C\u7AE0\u5BF9 Java \u5185\u5B58\u6A21\u578B\u505A\u4E86\u6BD4\u8F83\u5168\u9762\u7684\u89E3\u8BFB\u3002\u5E0C\u671B\u8BFB\u8005\u9605\u8BFB\u672C\u7AE0\u4E4B\u540E\uFF0C\u5BF9 Java \u5185\u5B58\u6A21\u578B\u80FD\u591F\u6709\u4E00\u4E2A\u6BD4\u8F83\u6DF1\u5165\u7684\u4E86\u89E3\uFF1B\u540C\u65F6\uFF0C\u4E5F\u5E0C\u671B\u672C\u7AE0\u53EF\u5E2E\u52A9\u8BFB\u8005\u89E3\u51B3\u5728 Java \u5E76\u53D1\u7F16\u7A0B\u4E2D\u7ECF\u5E38\u9047\u5230\u7684\u5404\u79CD\u5185\u5B58\u53EF\u89C1\u6027\u95EE\u9898\u3002</p>',536),mn=[vn];function bn(hn,fn){return a(),s("div",null,mn)}var wn=n(kn,[["render",bn],["__file","\u7B2C3\u7AE0Java\u5185\u5B58\u6A21\u578B.html.vue"]]);export{wn as default};
