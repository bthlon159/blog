import{_ as i}from"./plugin-vue_export-helper.21dcd24c.js";import{r as l,o as t,c as p,a as s,b as r,e as n,d as e}from"./app.0d56c066.js";var c="/assets/\u56FE5-1.f5cd69d4.png",d="/assets/\u56FE5-2.6fb266fa.png",o="/assets/\u56FE5-3.2fabb51a.png",u="/assets/\u56FE5-4.24f68f69.png",v="/assets/\u56FE5-5.24221a93.png",m="/assets/\u56FE5-6.5adbfb71.png",g="/assets/\u56FE5-7.77e40e2c.png",b="/assets/\u56FE5-8.8935d385.png",k="/assets/\u56FE5-9.abae0951.png",x="/assets/\u56FE5-10.789634ce.png",C="/assets/\u56FE5-11.3428382d.png",h="/assets/\u56FE5-12.18b452bc.png",G="/assets/\u56FE5-13.6f36635d.png",M="/assets/\u56FE5-14.ef475f60.png",K="/assets/\u56FE5-15.f01acd9d.png",f="/assets/\u56FE5-16.dcf9cb18.png",X="/assets/\u56FE5-17.1f6ece41.png",T="/assets/\u56FE5-18.5ee05c06.png",y="/assets/\u56FE5-19.d14e55ab.png",S="/assets/\u56FE5-20.b12273ec.png",_="/assets/\u56FE5-21.c077830b.png",P="/assets/\u56FE5-22.32acd3bc.png",w="/assets/\u56FE5-23.c6e2f5d5.png",A="/assets/\u56FE5-24.2191c981.png",B="/assets/\u56FE5-25.c11e3b1e.png",z="/assets/\u56FE5-26.a3809fca.png",L="/assets/\u56FE5-27.e5e1078c.png",D="/assets/\u56FE5-28.8226e0e3.png",O="/assets/\u56FE5-29.1550917f.png",F="/assets/\u56FE5-30.2b4aeba0.png",J="/assets/\u56FE5-31.542f7893.png",U="/assets/\u56FE5-32.b19a9566.png",N="/assets/\u56FE5-33.058386bb.png",E="/assets/\u56FE5-34.6810b93b.png",j="/assets/\u56FE5-35.08374a48.png",R="/assets/\u56FE5-36.de276309.png",I="/assets/\u56FE5-37.ae0f9cdc.png",H="/assets/\u56FE5-38.c92cdcb7.png",q="/assets/\u56FE5-39.92440167.png";const W={},V=n('<h1 id="\u7B2C-5-\u7AE0-\u5783\u573E\u6536\u96C6\u5668\u548C\u5185\u5B58\u5206\u914D" tabindex="-1"><a class="header-anchor" href="#\u7B2C-5-\u7AE0-\u5783\u573E\u6536\u96C6\u5668\u548C\u5185\u5B58\u5206\u914D" aria-hidden="true">#</a> \u7B2C 5 \u7AE0 \u5783\u573E\u6536\u96C6\u5668\u548C\u5185\u5B58\u5206\u914D</h1><p>\u5728 Java \u865A\u62DF\u673A\u4E2D\uFF0C\u5783\u573E\u56DE\u6536\u5668\u53EF\u4E0D\u53EA\u6709\u4E00\u79CD\uFF0C\u4EC0\u4E48\u60C5\u51B5\u4E0B\u8981\u4F7F\u7528\u54EA\u4E00\u79CD\uFF0C\u5BF9\u6027\u80FD\u53C8\u6709\u4EC0\u4E48\u6837\u7684\u5F71\u54CD\uFF0C\u8FD9\u90FD\u662F\u6211\u4EEC\u5FC5\u987B\u8981\u4E86\u89E3\u7684\u3002\u672C\u7AE0\u5C06\u5177\u4F53\u4ECB\u7ECD\u865A\u62DF\u673A\u4E2D\u7684\u5783\u573E\u56DE\u6536\u5668\u7C7B\u578B\uFF0C\u4EE5\u53CA\u5B83\u4EEC\u7684\u7279\u70B9\u548C\u4F7F\u7528\u65B9\u6CD5\uFF0C\u5E76\u8FDB\u4E00\u6B65\u63A2\u8BA8\u5BF9\u8C61\u5728\u5185\u5B58\u4E2D\u7684\u5206\u914D\u548C\u56DE\u6536\u7684\u95EE\u9898\u3002</p><p>\u672C\u7AE0\u6D89\u53CA\u7684\u4E3B\u8981\u77E5\u8BC6\u70B9\u6709\uFF1A</p><ul><li>Java \u865A\u62DF\u673A\u652F\u6301\u7684\u5783\u573E\u56DE\u6536\u5668\u79CD\u7C7B\u3002</li><li>\u4E32\u884C\u5783\u573E\u56DE\u6536\u5668\u3002</li><li>\u5E76\u884C\u5783\u573E\u56DE\u6536\u5668\u3002</li><li>CMS \u56DE\u6536\u5668\u3002</li><li>G1 \u56DE\u6536\u5668\u3002</li><li>\u6709\u5173\u5BF9\u8C61\u5206\u914D\u7684\u4E00\u4E9B\u7EC6\u8282\u95EE\u9898\u3002</li></ul><h2 id="_5-1-\u4E00\u5FC3\u4E00\u610F\u4E00\u4EF6\u4E8B-\u4E32\u884C\u56DE\u6536\u5668" tabindex="-1"><a class="header-anchor" href="#_5-1-\u4E00\u5FC3\u4E00\u610F\u4E00\u4EF6\u4E8B-\u4E32\u884C\u56DE\u6536\u5668" aria-hidden="true">#</a> 5.1 \u4E00\u5FC3\u4E00\u610F\u4E00\u4EF6\u4E8B\uFF1A\u4E32\u884C\u56DE\u6536\u5668</h2><p>\u4E32\u884C\u56DE\u6536\u5668\u662F\u6307\u4F7F\u7528\u5355\u7EBF\u7A0B\u8FDB\u884C\u5783\u573E\u56DE\u6536\u7684\u56DE\u6536\u5668\u3002\u6BCF\u6B21\u56DE\u6536\u65F6\uFF0C\u4E32\u884C\u56DE\u6536\u5668\u53EA\u6709\u4E00\u4E2A\u5DE5\u4F5C\u7EBF\u7A0B\uFF0C\u5BF9\u4E8E\u5E76\u884C\u80FD\u529B\u8F83\u5F31\u7684\u8BA1\u7B97\u673A\u6765\u8BF4\uFF0C\u4E32\u884C\u56DE\u6536\u5668\u7684\u4E13\u6CE8\u6027\u548C\u72EC\u5360\u6027\u5F80\u5F80\u80FD\u8BA9\u5176\u6709\u66F4\u597D\u7684\u6027\u80FD\u8868\u73B0\u3002\u4E32\u884C\u56DE\u6536\u5668\u53EF\u4EE5\u5728\u65B0\u751F\u4EE3\u548C\u8001\u5E74\u4EE3\u4F7F\u7528\uFF0C\u6839\u636E\u4E0D\u540C\u7684\u5806\u7A7A\u95F4\u5206\u4E3A\u65B0\u751F\u4EE3\u4E32\u884C\u56DE\u6536\u5668\u548C\u8001\u5E74\u4EE3\u4E32\u884C\u56DE\u6536\u5668\u3002</p><h3 id="_5-1-1-\u65B0\u751F\u4EE3\u4E32\u884C\u56DE\u6536\u5668" tabindex="-1"><a class="header-anchor" href="#_5-1-1-\u65B0\u751F\u4EE3\u4E32\u884C\u56DE\u6536\u5668" aria-hidden="true">#</a> 5.1.1 \u65B0\u751F\u4EE3\u4E32\u884C\u56DE\u6536\u5668</h3><p>\u4E32\u884C\u56DE\u6536\u5668\u662F\u6240\u6709\u5783\u573E\u56DE\u6536\u5668\u4E2D\u6700\u53E4\u8001\u7684\u4E00\u79CD\uFF0C\u4E5F\u662F JDK \u4E2D\u6700\u57FA\u672C\u7684\u5783\u573E\u56DE\u6536\u5668\u4E4B\u4E00\u3002\u4E32\u884C\u56DE\u6536\u5668\u4E3B\u8981\u6709\u4E24\u4E2A\u7279\u70B9\uFF1A</p><p>\u7B2C\u4E00\uFF0C\u5B83\u4EC5\u4EC5\u4F7F\u7528\u5355\u7EBF\u7A0B\u8FDB\u884C\u5783\u573E\u56DE\u6536\u3002</p><p>\u7B2C\u4E8C\uFF0C\u5B83\u662F\u72EC\u5360\u5F0F\u7684\u5783\u573E\u56DE\u6536\u65B9\u5F0F\u3002</p><p>\u5728\u4E32\u884C\u56DE\u6536\u5668\u8FDB\u884C\u5783\u573E\u56DE\u6536\u65F6\uFF0CJava \u5E94\u7528\u7A0B\u5E8F\u4E2D\u7684\u7EBF\u7A0B\u90FD\u9700\u8981\u6682\u505C\u5DE5\u4F5C\uFF0C\u7B49\u5F85\u5783\u573E\u56DE\u6536\u5B8C\u6210\u3002\u5982\u56FE5.1 \u6240\u793A\uFF0C\u5728\u4E32\u884C\u56DE\u6536\u5668\u8FD0\u884C\u65F6\uFF0C\u5E94\u7528\u7A0B\u5E8F\u4E2D\u7684\u6240\u6709\u7EBF\u7A0B\u90FD\u505C\u6B62\u5DE5\u4F5C\uFF0C\u8FDB\u884C\u7B49\u5F85\uFF0C\u8FD9\u79CD\u73B0\u8C61\u79F0\u4E3A &quot;Stop-The-World\u201D\u3002\u5B83\u5C06\u9020\u6210\u975E\u5E38\u7CDF\u7CD5\u7684\u7528\u6237\u4F53\u9A8C\uFF0C\u5728\u5B9E\u65F6\u6027\u8981\u6C42\u8F83\u9AD8\u7684\u5E94\u7528\u573A\u666F\u4E2D\uFF0C\u8FD9\u5F80\u5F80\u662F\u4E0D\u80FD\u88AB\u63A5\u53D7\u7684\u3002</p><p><img src="'+c+`" alt="\u56FE5-1" loading="lazy"></p><p>\u56FE5.1 \u4E32\u884C\u56DE\u6536\u793A\u610F\u56FE</p><p>\u867D\u7136\u5982\u6B64\uFF0C\u4E32\u884C\u56DE\u6536\u5668\u5374\u662F\u4E00\u79CD\u6210\u719F\u4E14\u7ECF\u8FC7\u957F\u65F6\u95F4\u751F\u4EA7\u73AF\u5883\u8003\u9A8C\u7684\u6781\u4E3A\u9AD8\u6548\u7684\u6536\u96C6\u5668\u3002\u65B0\u751F\u4EE3\u4E32\u884C\u56DE\u6536\u5668\u4F7F\u7528\u590D\u5236\u7B97\u6CD5\uFF0C\u5B9E\u73B0\u76F8\u5BF9\u7B80\u5355\u3001\u903B\u8F91\u5904\u7406\u7279\u522B\u9AD8\u6548\u4E14\u6CA1\u6709\u7EBF\u7A0B\u5207\u6362\u7684\u5F00\u9500\u3002\u5728\u8BF8\u5982\u5355 CPU \u5904\u7406\u5668\u7B49\u786C\u4EF6\u5E73\u53F0\u4E0D\u662F\u7279\u522B\u4F18\u8D8A\u7684\u60C5\u51B5\u4E0B\uFF0C\u5B83\u7684\u6027\u80FD\u8868\u73B0\u53EF\u4EE5\u8D85\u8FC7\u5E76\u884C\u56DE\u6536\u5668\u548C\u5E76\u53D1\u56DE\u6536\u5668\u3002</p><p>\u4F7F\u7528 -XX:+UseSerialGC \u53C2\u6570\u53EF\u4EE5\u6307\u5B9A\u4F7F\u7528\u65B0\u751F\u4EE3\u4E32\u884C\u56DE\u6536\u5668\u6216\u8001\u5E74\u4EE3\u4E32\u884C\u56DE\u6536\u5668\u3002\u5F53\u865A\u62DF\u673A\u5728 Client \u6A21\u5F0F\u4E0B\u8FD0\u884C\u65F6\uFF0C\u5B83\u662F\u9ED8\u8BA4\u7684\u5783\u573E\u56DE\u6536\u5668\u3002</p><p>\u65B0\u751F\u4EE3\u4E32\u884C\u56DE\u6536\u5668\u7684\u8F93\u51FA\u65E5\u5FD7\u5982\u4E0B\uFF08\u4F7F\u7528 -XX:+PrintGCDetails \u5F00\u5173\uFF09\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	0.844: [GC 0.844: [DefNew: 17472K-&gt;2176K(19648K), 0.0188339 secs] 17472K-&gt; 2375K(63360K), 0.0189186 secs] [Times: user=0.01 sys=0.00, real=0.02 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5B83\u663E\u793A\u4E86\u4E00\u6B21\u5783\u573E\u56DE\u6536\u524D\u7684\u65B0\u751F\u4EE3\u5185\u5B58\u5360\u7528\u91CF\u548C\u5783\u573E\u56DE\u6536\u540E\u7684\u65B0\u751F\u4EE3\u5185\u5B58\u5360\u7528\u91CF\uFF0C\u4EE5\u53CA\u5783\u573E\u56DE\u6536\u6240\u6D88\u8017\u7684\u65F6\u95F4\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1A\u4E32\u884C\u5783\u573E\u56DE\u6536\u5668\u867D\u7136\u53E4\u8001\uFF0C\u4F46\u662F\u4E45\u7ECF\u8003\u9A8C\uFF0C\u5728\u5927\u591A\u6570\u60C5\u51B5\u4E0B\uFF0C\u5176\u6027\u80FD\u8868\u73B0\u662F\u76F8\u5F53\u4E0D\u9519\u7684\u3002</p><h3 id="_5-1-2-\u8001\u5E74\u4EE3\u4E32\u884C\u56DE\u6536\u5668" tabindex="-1"><a class="header-anchor" href="#_5-1-2-\u8001\u5E74\u4EE3\u4E32\u884C\u56DE\u6536\u5668" aria-hidden="true">#</a> 5.1.2 \u8001\u5E74\u4EE3\u4E32\u884C\u56DE\u6536\u5668</h3><p>\u8001\u5E74\u4EE3\u4E32\u884C\u56DE\u6536\u5668\u4F7F\u7528\u7684\u662F\u6807\u8BB0\u538B\u7F29\u6CD5\u3002\u548C\u65B0\u751F\u4EE3\u4E32\u884C\u56DE\u6536\u5668\u4E00\u6837\uFF0C\u5B83\u4E5F\u662F\u4E00\u4E2A\u4E32\u884C\u7684\u3001\u72EC\u5360\u5F0F\u7684\u5783\u573E\u56DE\u6536\u5668\u3002\u7531\u4E8E\u8001\u5E74\u4EE3\u5783\u573E\u56DE\u6536\u901A\u5E38\u4F1A\u9700\u8981\u6BD4\u65B0\u751F\u4EE3\u5783\u573E\u56DE\u6536\u66F4\u957F\u7684\u65F6\u95F4\uFF0C\u5728\u5806\u7A7A\u95F4\u8F83\u5927\u7684\u5E94\u7528\u7A0B\u5E8F\u4E2D\uFF0C\u4E00\u65E6\u8001\u5E74\u4EE3\u4E32\u884C\u56DE\u6536\u5668\u542F\u52A8\uFF0C\u5E94\u7528\u7A0B\u5E8F\u5F88\u53EF\u80FD\u4F1A\u56E0\u6B64\u505C\u987F\u8F83\u957F\u7684\u65F6\u95F4\u3002</p><p>\u867D\u7136\u5982\u6B64\uFF0C\u4F5C\u4E3A\u8001\u724C\u7684\u5783\u573E\u56DE\u6536\u5668\uFF0C\u8001\u5E74\u4EE3\u4E32\u884C\u56DE\u6536\u5668\u53EF\u4EE5\u548C\u591A\u79CD\u65B0\u751F\u4EE3\u56DE\u6536\u5668\u914D\u5408\u4F7F\u7528\uFF0C\u540C\u65F6\u5B83\u4E5F\u53EF\u4EE5\u4F5C\u4E3A CMS \u56DE\u6536\u5668\u7684\u5907\u7528\u56DE\u6536\u5668\u3002</p><p>\u82E5\u8981\u542F\u7528\u8001\u5E74\u4EE3\u4E32\u884C\u56DE\u6536\u5668\uFF0C\u53EF\u4EE5\u5C1D\u8BD5\u4F7F\u7528\u4EE5\u4E0B\u53C2\u6570\u3002</p><ul><li><p>-XX:+UseSerialGC\uFF1A\u65B0\u751F\u4EE3\u3001\u8001\u5E74\u4EE3\u90FD\u4F7F\u7528\u4E32\u884C\u56DE\u6536\u5668\u3002</p></li><li><p>-XX:+UseParNewGC\uFF08JDK 9\u3001JDK 10 \u5DF2\u7ECF\u5220\u9664\uFF0C\u56E0\u4E3A ParNew \u9700\u8981\u548C CMS \u642D\u914D\u5DE5\u4F5C\uFF0C\u800C CMS \u5DF1\u7ECF\u88AB G1 \u66FF\u4EE3\uFF0C\u4E0D\u518D\u652F\u6301\u6B64\u53C2\u6570\uFF09\uFF1A\u65B0\u751F\u4EE3\u4F7F\u7528 ParNew \u56DE\u6536\u5668\uFF0C\u8001\u5E74\u4EE3\u4F7F\u7528\u4E32\u884C\u56DE\u6536\u5668\u3002</p></li><li><p>-XX:+UseParallelGC\uFF1A\u65B0\u751F\u4EE3\u4F7F\u7528 ParallelGC \u56DE\u6536\u5668\uFF0C\u8001\u5E74\u4EE3\u4F7F\u7528\u4E32\u884C\u56DE\u6536\u5668\u3002</p></li></ul><p>\u8001\u5E74\u4EE3\u4E32\u884C\u56DE\u6536\u5668\u7684\u8F93\u51FA\u65E5\u5FD7\u7C7B\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	8.259: [Full GC 8.259: [Tenured: 43711K-&gt;40302K(43712K), 0.2960477 secs] 63350K-&gt;40302K(63360K), [Perm: 17836K-&gt;17836K(32768K)], 0.2961554 secs] [Times: user=0.28 sys=0.02, real=0.30 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5B83\u663E\u793A\u4E86\u5783\u573E\u56DE\u6536\u524D\u8001\u5E74\u4EE3\u548C\u6C38\u4E45\u533A\u7684\u5185\u5B58\u5360\u7528\u91CF\uFF0C\u4EE5\u53CA\u5783\u573E\u56DE\u6536\u540E\u8001\u5E74\u4EE3\u548C\u6C38\u4E45\u533A\u7684\u5185\u5B58\u5360\u7528\u91CF\u3002</p><h2 id="_5-2-\u4EBA\u591A\u529B\u91CF\u5927-\u5E76\u884C\u56DE\u6536\u5668" tabindex="-1"><a class="header-anchor" href="#_5-2-\u4EBA\u591A\u529B\u91CF\u5927-\u5E76\u884C\u56DE\u6536\u5668" aria-hidden="true">#</a> 5.2 \u4EBA\u591A\u529B\u91CF\u5927\uFF1A\u5E76\u884C\u56DE\u6536\u5668</h2><p>\u5E76\u884C\u56DE\u6536\u5668\u5728\u4E32\u884C\u56DE\u6536\u5668\u7684\u57FA\u7840\u4E0A\u505A\u4E86\u6539\u8FDB\uFF0C\u5B83\u4F7F\u7528\u591A\u4E2A\u7EBF\u7A0B\u540C\u65F6\u8FDB\u884C\u5783\u573E\u56DE\u6536\u3002\u5BF9\u4E8E\u5E76\u884C\u80FD\u529B\u5F3A\u7684\u8BA1\u7B97\u673A\uFF0C\u53EF\u4EE5\u6709\u6548\u51CF\u5C11\u5783\u573E\u56DE\u6536\u6240\u9700\u7684\u5B9E\u9645\u65F6\u95F4\u3002</p><h3 id="_5-2-1-\u65B0\u751F\u4EE3-parnew-\u56DE\u6536\u5668" tabindex="-1"><a class="header-anchor" href="#_5-2-1-\u65B0\u751F\u4EE3-parnew-\u56DE\u6536\u5668" aria-hidden="true">#</a> 5.2.1 \u65B0\u751F\u4EE3 ParNew \u56DE\u6536\u5668</h3><p>ParNew \u56DE\u6536\u5668\u662F\u4E00\u4E2A\u5DE5\u4F5C\u5728\u65B0\u751F\u4EE3\u7684\u5783\u573E\u56DE\u6536\u5668\u3002\u5B83\u53EA\u662F\u7B80\u5355\u5730\u5C06\u4E32\u884C\u56DE\u6536\u5668\u591A\u7EBF\u7A0B\u5316\uFF0C\u5B83\u7684\u56DE\u6536\u7B56\u7565\u3001\u7B97\u6CD5\u53CA\u53C2\u6570\u548C\u65B0\u751F\u4EE3\u4E32\u884C\u56DE\u6536\u5668\u4E00\u6837\u3002ParNew \u56DE\u6536\u5668\u7684\u5DE5\u4F5C\u793A\u610F\u56FE\u5982\u56FE5.2 \u6240\u793A\u3002ParNew \u56DE\u6536\u5668\u4E5F\u662F\u72EC\u5360\u5F0F\u7684\u56DE\u6536\u5668\uFF0C\u5728\u56DE\u6536\u8FC7\u7A0B\u4E2D\u5E94\u7528\u7A0B\u5E8F\u4F1A\u5168\u90E8\u6682\u505C\u3002\u4F46\u7531\u4E8E\u5E76\u884C\u56DE\u6536\u5668\u4F7F\u7528\u591A\u7EBF\u7A0B\u8FDB\u884C\u5783\u573E\u56DE\u6536\uFF0C\u5728\u5E76\u53D1\u80FD\u529B\u6BD4\u8F83\u5F3A\u7684 CPU \u4E0A\uFF0C\u5B83\u4EA7\u751F\u7684\u505C\u987F\u65F6\u95F4\u8981\u77ED\u4E8E\u4E32\u884C\u56DE\u6536\u5668\uFF0C\u800C\u5728\u5355 CPU \u6216\u8005\u5E76\u53D1\u80FD\u529B\u8F83\u5F31\u7684\u7CFB\u7EDF\u4E2D\uFF0C\u5E76\u884C\u56DE\u6536\u5668\u7684\u6548\u679C\u4E0D\u4F1A\u6BD4\u4E32\u884C\u56DE\u6536\u5668\u597D\uFF0C\u7531\u4E8E\u591A\u7EBF\u7A0B\u7684\u538B\u529B\uFF0C\u5B83\u7684\u5B9E\u9645\u8868\u73B0\u5F88\u53EF\u80FD\u6BD4\u4E32\u884C\u56DE\u6536\u5668\u5DEE\u3002</p><p><img src="`+d+`" alt="\u56FE5-2" loading="lazy"></p><p>\u56FE5.2 ParNew \u56DE\u6536\u5668\u7684\u5DE5\u4F5C\u793A\u610F\u56FE</p><p>\u5F00\u542F ParNew \u56DE\u6536\u5668\u53EF\u4EE5\u4F7F\u7528\u4EE5\u4E0B\u53C2\u6570\u3002</p><ul><li><p>-XX:+UseParNewGC\uFF08JDK 9\u3001JDK 10 \u5DF2\u7ECF\u5220\u9664\uFF0C\u56E0\u4E3A ParNew \u9700\u8981\u548C CMS \u642D\u914D\u5DE5\u4F5C\uFF0C\u800C CMS \u5DF2\u7ECF\u88AB G1 \u66FF\u4EE3\uFF0C\u4E0D\u518D\u652F\u6301\u6B64\u53C2\u6570\uFF09\uFF1A\u65B0\u751F\u4EE3\u4F7F\u7528 ParNew \u56DE\u6536\u5668\uFF0C\u8001\u5E74\u4EE3\u4F7F\u7528\u4E32\u884C\u56DE\u6536\u5668\u3002</p></li><li><p>-XX:+UseConcMarkSweepGC\uFF08JDK 9\u3001JDK 10 \u4E0D\u5EFA\u8BAE\u4F7F\u7528\uFF0C\u5EFA\u8BAE\u4F7F\u7528\u9ED8\u8BA4\u7684 G1 \u5783\u573E\u56DE\u6536\u5668\uFF09\uFF1A\u65B0\u751F\u4EE3\u4F7F\u7528 ParNew \u56DE\u6536\u5668\uFF0C\u8001\u5E74\u4EE3\u4F7F\u7528 CMS\u3002</p></li></ul><p>ParNew \u56DE\u6536\u5668\u5DE5\u4F5C\u65F6\u7684\u7EBF\u7A0B\u6570\u91CF\u53EF\u4EE5\u4F7F\u7528 -XX:ParallelGCThreads \u53C2\u6570\u6307\u5B9A\u3002\u4E00\u822C\uFF0C\u6700\u597D\u4E0E CPU \u6570\u91CF\u76F8\u5F53\uFF0C\u907F\u514D\u8FC7\u591A\u7684\u7EBF\u7A0B\u6570\u5F71\u54CD\u5783\u573E\u56DE\u6536\u6027\u80FD\u3002\u5728\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u5F53 CPU \u6570\u91CF\u5C0F\u4E8E 8 \u65F6\uFF0CParallelGCThreads \u7684\u503C\u7B49\u4E8E CPU \u6570\u91CF\uFF0C\u5F53 CPU \u6570\u91CF\u5927\u4E8E 8 \u65F6\uFF0CParallelGCThreads \u7684\u503C\u7B49\u4E8E 3 + ((5 * CPU_Count) / 8)\u3002</p><p>ParNew \u56DE\u6536\u5668\u7684\u8F93\u51FA\u65E5\u5FD7\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    0.834 : [GC 0.834: [ParNew: 13184K-&gt;1600K(14784K), 0.0092203 secs] 13184K-&gt; 1921K(63936K), 0.0093401 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u8FD9\u4E2A\u8F93\u51FA\u548C\u65B0\u751F\u4EE3\u4E32\u884C\u56DE\u6536\u5668\u7684\u8F93\u51FA\u51E0\u4E4E\u662F\u4E00\u6837\u7684\uFF0C\u53EA\u6709\u56DE\u6536\u5668\u6807\u8BC6\u7B26\u4E0D\u540C\u3002</p><h3 id="_5-2-2-\u65B0\u751F\u4EE3-parallelgc-\u56DE\u6536\u5668" tabindex="-1"><a class="header-anchor" href="#_5-2-2-\u65B0\u751F\u4EE3-parallelgc-\u56DE\u6536\u5668" aria-hidden="true">#</a> 5.2.2 \u65B0\u751F\u4EE3 ParallelGC \u56DE\u6536\u5668</h3><p>\u65B0\u751F\u4EE3 ParallelGC \u56DE\u6536\u5668\u4E5F\u662F\u4F7F\u7528\u590D\u5236\u7B97\u6CD5\u7684\u56DE\u6536\u5668\u3002\u4ECE\u8868\u9762\u4E0A\u770B\uFF0C\u5B83\u548C ParNew \u56DE\u6536\u5668\u4E00\u6837\uFF0C\u90FD\u662F\u591A\u7EBF\u7A0B\u3001\u72EC\u5360\u5F0F\u7684\u56DE\u6536\u5668\u3002\u4F46\u662F\uFF0CParallelGC \u56DE\u6536\u5668\u6709\u4E00\u4E2A\u91CD\u8981\u7684\u7279\u70B9\uFF1A\u5B83\u975E\u5E38\u5173\u6CE8\u7CFB\u7EDF\u7684\u541E\u5410\u91CF\u3002</p><p>\u65B0\u751F\u4EE3 ParallelGC \u56DE\u6536\u5668\u53EF\u4EE5\u4F7F\u7528\u4EE5\u4E0B\u53C2\u6570\u542F\u7528\u3002</p><ul><li><p>-XX:+UseParallelGC\uFF1A\u65B0\u751F\u4EE3\u4F7F\u7528 ParallelGC \u56DE\u6536\u5668\uFF0C\u8001\u5E74\u4EE3\u4F7F\u7528\u4E32\u884C\u56DE\u6536\u5668\u3002</p></li><li><p>-XX:+UseParallelOldGC\uFF1A\u65B0\u751F\u4EE3\u4F7F\u7528 ParallelGC \u56DE\u6536\u5668\uFF0C\u8001\u5E74\u4EE3\u4F7F\u7528 ParallelOldGC \u56DE\u6536\u5668\u3002</p></li></ul><p>ParallelGC \u56DE\u6536\u5668\u63D0\u4F9B\u4E86\u4E24\u4E2A\u91CD\u8981\u7684\u53C2\u6570\u7528\u4E8E\u63A7\u5236\u7CFB\u7EDF\u7684\u541E\u5410\u91CF\u3002</p><ul><li><p>-XX:MaxGCPauseMillis\uFF1A\u8BBE\u7F6E\u6700\u5927\u5783\u573E\u56DE\u6536\u505C\u987F\u65F6\u95F4\u3002\u5B83\u7684\u503C\u662F\u4E00\u4E2A\u5927\u4E8E 0 \u7684\u6574\u6570\u3002ParallelGC \u5728\u5DE5\u4F5C\u65F6\uFF0C\u4F1A\u8C03\u6574 Java \u5806\u5927\u5C0F\u6216\u8005\u5176\u4ED6\u53C2\u6570\uFF0C\u5C3D\u53EF\u80FD\u5730\u628A\u505C\u987F\u65F6\u95F4\u63A7\u5236\u5728 MaxGCPauseMillis \u4EE5\u5185\u3002\u5982\u679C\u8BFB\u8005\u5E0C\u671B\u51CF\u5C11\u505C\u987F\u65F6\u95F4\u800C\u628A\u8FD9\u4E2A\u503C\u8BBE\u5F97\u5F88\u5C0F\uFF0C\u4E3A\u4E86\u8FBE\u5230\u9884\u671F\u7684\u505C\u987F\u65F6\u95F4\uFF0C\u865A\u62DF\u673A\u53EF\u80FD\u4F1A\u4F7F\u7528\u4E00\u4E2A\u8F83\u5C0F\u7684\u5806\uFF08\u4E00\u4E2A\u5C0F\u5806\u6BD4\u4E00\u4E2A\u5927\u5806\u56DE\u6536\u5FEB\uFF09\uFF0C\u800C\u8FD9\u5C06\u5BFC\u81F4\u5783\u573E\u56DE\u6536\u53D8\u5F97\u5F88\u9891\u7E41\uFF0C\u4ECE\u800C\u589E\u52A0\u5783\u573E\u56DE\u6536\u603B\u65F6\u95F4\uFF0C\u964D\u4F4E\u541E\u5410\u91CF\u3002</p></li><li><p>-XX:GCTimeRatio\uFF1A\u8BBE\u7F6E\u541E\u5410\u91CF\u5927\u5C0F\u3002\u5B83\u7684\u503C\u662F\u4E00\u4E2A 0 \u5230 100 \u4E4B\u95F4\u7684\u6574\u6570\u3002\u5047\u8BBE GCTimeRatio \u7684\u503C\u4E3A n\uFF0C\u90A3\u4E48\u7CFB\u7EDF\u5C06\u82B1\u8D39\u4E0D\u8D85\u8FC7 1 / (1 + n) \u7684\u65F6\u95F4\u8FDB\u884C\u5783\u573E\u56DE\u6536\u3002\u6BD4\u5982 GCTimeRatio \u7B49\u4E8E 19\uFF08\u9ED8\u8BA4\u503C\uFF09\uFF0C\u5219\u7CFB\u7EDF\u7528\u4E8E\u5783\u573E\u56DE\u6536\u7684\u65F6\u95F4\u4E0D\u8D85\u8FC7 1 / (1 + 19) = 5%\u3002\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u5B83\u7684\u53D6\u503C\u662F 99\uFF0C\u5373\u6709\u4E0D\u8D85\u8FC71 / (1 + 99) = 1% \u7684\u65F6\u95F4\u7528\u4E8E\u5783\u573E\u56DE\u6536\u3002</p></li></ul><p>\u9664\u6B64\u4E4B\u5916\uFF0CParallelGC \u56DE\u6536\u5668\u4E0E ParNew \u56DE\u6536\u5668\u53E6\u4E00\u4E2A\u4E0D\u540C\u4E4B\u5904\u5728\u4E8E\uFF0C\u5B83\u8FD8\u652F\u6301\u4E00\u79CD\u81EA\u9002\u5E94\u7684 GC \u8C03\u8282\u7B56\u7565\u3002\u4F7F\u7528 -XX:+UseAdaptiveSizePolicy \u53EF\u4EE5\u6253\u5F00\u81EA\u9002\u5E94 GC \u7B56\u7565\u3002\u5728\u8FD9\u79CD\u6A21\u5F0F\u4E0B\uFF0C\u65B0\u751F\u4EE3\u7684\u5927\u5C0F\u3001eden \u533A\u548C survivor \u533A\u7684\u6BD4\u4F8B\u3001\u664B\u5347\u8001\u5E74\u4EE3\u7684\u5BF9\u8C61\u5E74\u9F84\u7B49\u53C2\u6570\u4F1A\u88AB\u81EA\u52A8\u8C03\u6574\uFF0C\u4EE5\u8FBE\u5230\u5728\u5806\u5927\u5C0F\u3001\u541E\u5410\u91CF\u548C\u505C\u987F\u65F6\u95F4\u4E4B\u95F4\u7684\u5E73\u8861\u70B9\u3002\u5728\u624B\u5DE5\u8C03\u4F18\u6BD4\u8F83\u56F0\u96BE\u7684\u573A\u5408\uFF0C\u53EF\u4EE5\u76F4\u63A5\u4F7F\u7528\u8FD9\u79CD\u81EA\u9002\u5E94\u7684\u65B9\u5F0F\uFF0C\u4EC5\u6307\u5B9A\u865A\u62DF\u673A\u7684\u6700\u5927\u5806\u3001\u76EE\u6807\u541E\u5410\u91CF\uFF08GCTimeRatio\uFF09\u548C\u505C\u987F\u65F6\u95F4\uFF08MaxGCPauseMillis\uFF09\uFF0C\u8BA9\u865A\u62DF\u673A\u81EA\u5DF1\u5B8C\u6210\u8C03\u4F18\u5DE5\u4F5C\u3002</p><p>ParallelGC \u56DE\u6536\u5668\u7684\u8F93\u51FA\u65E5\u5FD7\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	0.880: [GC [PSYoungGen: 16448K-&gt;2439K(19136K)] 16448K-&gt;2439K(62848K), 0.0064912 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5B83\u663E\u793A\u4E86 ParallelGC \u56DE\u6536\u5668\u7684\u5DE5\u4F5C\u6210\u679C\uFF0C\u4E5F\u5C31\u662F\u56DE\u6536\u524D\u7684\u5185\u5B58\u5927\u5C0F\u548C\u56DE\u6536\u540E\u7684\u5185\u5B58\u5927\u5C0F\uFF0C\u4EE5\u53CA\u82B1\u8D39\u7684\u65F6\u95F4\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1AParallelGC \u56DE\u6536\u5668\u5173\u6CE8\u7CFB\u7EDF\u541E\u5410\u91CF\u3002\u53EF\u4EE5\u901A\u8FC7 -XX:MaxGCPauseMillis \u548C -XX:GCTimeRatio \u8BBE\u7F6E\u671F\u671B\u7684\u505C\u987F\u65F6\u95F4\u548C\u541E\u5410\u91CF\u3002\u4F46\u662F\u9C7C\u548C\u718A\u638C\u4E0D\u53EF\u517C\u5F97\uFF0C\u8FD9\u4E24\u4E2A\u53C2\u6570\u662F\u76F8\u4E92\u77DB\u76FE\u7684\uFF0C\u901A\u5E38\u5982\u679C\u51CF\u5C11\u4E00\u6B21\u6536\u96C6\u7684\u6700\u5927\u505C\u987F\u65F6\u95F4\uFF0C\u5C31\u4F1A\u540C\u65F6\u51CF\u5C0F\u7CFB\u7EDF\u541E\u5410\u91CF\uFF0C\u589E\u52A0\u7CFB\u7EDF\u541E\u5410\u91CF\u53C8\u53EF\u80FD\u4F1A\u540C\u65F6\u589E\u52A0\u4E00\u6B21\u5783\u573E\u56DE\u6536\u7684\u6700\u5927\u505C\u987F\u65F6\u95F4\u3002</p><h3 id="_5-2-3-\u8001\u5E74\u4EE3-paralleloldgc-\u56DE\u6536\u5668" tabindex="-1"><a class="header-anchor" href="#_5-2-3-\u8001\u5E74\u4EE3-paralleloldgc-\u56DE\u6536\u5668" aria-hidden="true">#</a> 5.2.3 \u8001\u5E74\u4EE3 ParallelOldGC \u56DE\u6536\u5668</h3><p>\u8001\u5E74\u4EE3 ParallelOldGC \u56DE\u6536\u5668\u4E5F\u662F\u4E00\u79CD\u591A\u7EBF\u7A0B\u5E76\u53D1\u7684\u56DE\u6536\u5668\u3002\u548C\u65B0\u751F\u4EE3 ParallelGC \u56DE\u6536\u5668\u4E00\u6837\uFF0C\u5B83\u4E5F\u662F\u4E00\u79CD\u5173\u6CE8\u541E\u5410\u91CF\u7684\u56DE\u6536\u5668\u3002\u4ECE\u540D\u5B57\u4E0A\u770B\uFF0C\u5B83\u5728 ParallelGC \u4E2D\u95F4\u63D2\u5165\u4E86 Old\uFF0C\u8868\u793A\u8FD9\u662F\u4E00\u4E2A\u5E94\u7528\u4E8E\u8001\u5E74\u4EE3\u7684\u56DE\u6536\u5668\uFF0C\u5E76\u4E14\u548C ParallelGC \u65B0\u751F\u4EE3\u56DE\u6536\u5668\u642D\u914D\u4F7F\u7528\u3002</p><p>ParallelOldGC \u56DE\u6536\u5668\u4F7F\u7528\u6807\u8BB0\u538B\u7F29\u6CD5\uFF0C\u5B83\u5728 JDK 1.6 \u4E2D\u624D\u53EF\u4EE5\u4F7F\u7528\u3002\u56FE5.3 \u4E3A\u8001\u5E74\u4EE3 ParallelOldGC \u56DE\u6536\u5668\u5DE5\u4F5C\u793A\u610F\u56FE\u3002</p><p><img src="`+o+`" alt="\u56FE5-3" loading="lazy"></p><p>\u56FE5.3 \u8001\u5E74\u4EE3 ParallelOldGC \u56DE\u6536\u5668\u5DE5\u4F5C\u793A\u610F\u56FE</p><p>\u4F7F\u7528 -XX:+UseParallelOldGC \u53EF\u4EE5\u5728\u65B0\u751F\u4EE3\u4F7F\u7528 ParallelGC \u56DE\u6536\u5668\uFF0C\u8001\u5E74\u4EE3\u4F7F\u7528 ParallelOldGC \u56DE\u6536\u5668\u3002\u8FD9\u662F\u4E00\u5BF9\u975E\u5E38\u5173\u6CE8\u541E\u5410\u91CF\u7684\u5783\u573E\u56DE\u6536\u5668\u3002\u5728\u5BF9\u541E\u5410\u91CF\u654F\u611F\u7684\u7CFB\u7EDF\u4E2D\uFF0C\u53EF\u4EE5\u8003\u8651\u4F7F\u7528\u3002\u53C2\u6570 -XX:ParallelGCThreads \u4E5F\u53EF\u4EE5\u7528\u4E8E\u8BBE\u7F6E\u5783\u573E\u56DE\u6536\u65F6\u7684\u7EBF\u7A0B\u6570\u91CF\u3002</p><p>ParallelOldGC \u56DE\u6536\u5668\u7684\u8F93\u51FA\u65E5\u5FD7\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	1.500: [Full GC [PSYoungGen: 2682K-&gt;0K(19136K)] [ParOldGen: 28035K-&gt;30437K (43712K)] 30717K-&gt;30437K(62848K) [PSPermGen: 10943K-&gt;10928K(32768K)], 0.2902791 secs] [Times: user=l.44 sys=0.03, real=0.30 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5B83\u663E\u793A\u4E86\u65B0\u751F\u4EE3\u3001\u8001\u5E74\u4EE3\u53CA\u6C38\u4E45\u533A\u5728\u56DE\u6536\u524D\u3001\u540E\u7684\u60C5\u51B5\uFF0C\u4EE5\u53CA Full GC \u6240\u6D88\u8017\u7684\u65F6\u95F4\u3002</p><h2 id="_5-3-\u4E00\u5FC3\u591A\u7528\u90FD\u4E0D\u843D\u4E0B-cms-\u56DE\u6536\u5668-jdk-8-\u53CA\u4E4B\u524D\u7684\u7248\u672C" tabindex="-1"><a class="header-anchor" href="#_5-3-\u4E00\u5FC3\u591A\u7528\u90FD\u4E0D\u843D\u4E0B-cms-\u56DE\u6536\u5668-jdk-8-\u53CA\u4E4B\u524D\u7684\u7248\u672C" aria-hidden="true">#</a> 5.3 \u4E00\u5FC3\u591A\u7528\u90FD\u4E0D\u843D\u4E0B\uFF1ACMS \u56DE\u6536\u5668\uFF08JDK 8 \u53CA\u4E4B\u524D\u7684\u7248\u672C\uFF09</h2><p>\u4E0E ParallelGC \u548C ParallelOldGC \u4E0D\u540C\uFF0CCMS \u56DE\u6536\u5668\u4E3B\u8981\u5173\u6CE8\u7CFB\u7EDF\u505C\u987F\u65F6\u95F4\u3002CMS \u662F Concurrent Mark Sweep \u7684\u7F29\u5199\uFF0C\u610F\u4E3A\u5E76\u53D1\u6807\u8BB0\u6E05\u9664\uFF0C\u4ECE\u540D\u79F0\u4E0A\u5C31\u53EF\u4EE5\u5F97\u77E5\uFF0C\u5B83\u4F7F\u7528\u7684\u662F\u6807\u8BB0\u6E05\u9664\u6CD5\uFF0C\u540C\u65F6\u5B83\u53C8\u662F\u4E00\u4E2A\u4F7F\u7528\u591A\u7EBF\u7A0B\u5E76\u884C\u56DE\u6536\u7684\u5783\u573E\u56DE\u6536\u5668\u3002</p><h3 id="_5-3-1-cms-\u4E3B\u8981\u5DE5\u4F5C\u6B65\u9AA4" tabindex="-1"><a class="header-anchor" href="#_5-3-1-cms-\u4E3B\u8981\u5DE5\u4F5C\u6B65\u9AA4" aria-hidden="true">#</a> 5.3.1 CMS \u4E3B\u8981\u5DE5\u4F5C\u6B65\u9AA4</h3><p>CMS \u56DE\u6536\u5668\u7684\u5DE5\u4F5C\u8FC7\u7A0B\u4E0E\u5176\u4ED6\u5783\u573E\u56DE\u6536\u5668\u76F8\u6BD4\uFF0C\u7565\u663E\u590D\u6742\u3002CMS \u5DE5\u4F5C\u65F6\u7684\u4E3B\u8981\u6B65\u9AA4\u6709\uFF1A\u521D\u59CB\u6807\u8BB0\u3001\u5E76\u53D1\u6807\u8BB0\u3001\u9884\u6E05\u7406\u3001\u91CD\u65B0\u6807\u8BB0\u3001\u5E76\u53D1\u6E05\u9664\u548C\u5E76\u53D1\u91CD\u7F6E\u3002\u5176\u4E2D\u521D\u59CB\u6807\u8BB0\u548C\u91CD\u65B0\u6807\u8BB0\u662F\u72EC\u5360\u7CFB\u7EDF\u8D44\u6E90\u7684\uFF0C\u800C\u9884\u6E05\u7406\u3001\u5E76\u53D1\u6807\u8BB0\u3001\u5E76\u53D1\u6E05\u9664\u548C\u5E76\u53D1\u91CD\u7F6E\u662F\u53EF\u4EE5\u548C\u7528\u6237\u7EBF\u7A0B\u4E00\u8D77\u6267\u884C\u7684\u3002\u4ECE\u6574\u4F53\u4E0A\u8BF4\uFF0CCSM \u4E0D\u662F\u72EC\u5360\u5F0F\u7684\uFF0C\u5B83\u53EF\u4EE5\u5728\u5E94\u7528\u7A0B\u5E8F\u8FD0\u884C\u8FC7\u7A0B\u4E2D\u8FDB\u884C\u5783\u573E\u56DE\u6536\u3002CMS \u7684\u5DE5\u4F5C\u6D41\u7A0B\u5982\u56FE5.4 \u6240\u793A\u3002</p><p><img src="`+u+'" alt="\u56FE5-4" loading="lazy"></p><p>\u56FE5.4 CMS \u7684\u5DE5\u4F5C\u6D41\u7A0B</p><p>\u6839\u636E\u6807\u8BB0\u6E05\u9664\u6CD5\uFF0C\u521D\u59CB\u6807\u8BB0\u3001\u5E76\u53D1\u6807\u8BB0\u548C\u91CD\u65B0\u6807\u8BB0\u90FD\u662F\u4E3A\u4E86\u6807\u8BB0\u51FA\u9700\u8981\u56DE\u6536\u7684\u5BF9\u8C61\u3002\u5E76\u53D1\u6E05\u7406\u5219\u662F\u5728\u6807\u8BB0\u5B8C\u6210\u540E\uFF0C\u6B63\u5F0F\u56DE\u6536\u5783\u573E\u5BF9\u8C61\u3002\u5E76\u53D1\u91CD\u7F6E\u662F\u6307\u5728\u5783\u573E\u56DE\u6536\u5B8C\u6210\u540E\uFF0C\u91CD\u65B0\u521D\u59CB\u5316 CMS \u6570\u636E\u7ED3\u6784\u548C\u6570\u636E\uFF0C\u4E3A\u4E0B\u4E00\u6B21\u5783\u573E\u56DE\u6536\u505A\u597D\u51C6\u5907\u3002\u5E76\u53D1\u6807\u8BB0\u3001\u5E76\u53D1\u6E05\u7406\u548C\u5E76\u53D1\u91CD\u7F6E\u90FD\u662F\u53EF\u4EE5\u548C\u5E94\u7528\u7A0B\u5E8F\u7EBF\u7A0B\u4E00\u8D77\u6267\u884C\u7684\u3002</p><p>\u5728\u6574\u4E2A CMS \u7684\u56DE\u6536\u8FC7\u7A0B\u4E2D\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u5728\u5E76\u53D1\u6807\u8BB0\u4E4B\u540E\uFF0C\u4F1A\u6709\u4E00\u4E2A\u9884\u6E05\u7406\u7684\u64CD\u4F5C\uFF08\u4E5F\u53EF\u4EE5\u5173\u95ED\u5F00\u5173 -XX:-CMSPrecleaningEnabled\uFF0C\u4E0D\u8FDB\u884C\u9884\u6E05\u7406\uFF09\u3002\u9884\u6E05\u7406\u662F\u5E76\u53D1\u7684\uFF0C\u9664\u4E86\u4E3A\u6B63\u5F0F\u6E05\u7406\u505A\u51C6\u5907\u548C\u68C0\u67E5\uFF0C\u8FD8\u4F1A\u5C1D\u8BD5\u63A7\u5236\u4E00\u6B21\u505C\u987F\u7684\u65F6\u95F4\u3002\u7531\u4E8E\u91CD\u65B0\u6807\u8BB0\u662F\u72EC\u5360 CPU \u7684\uFF0C\u5982\u679C\u65B0\u751F\u4EE3 GC \u53D1\u751F\u540E\uFF0C\u7ACB\u5373\u89E6\u53D1\u4E00\u6B21\u91CD\u65B0\u6807\u8BB0\uFF0C\u90A3\u4E48\u4E00\u6B21\u505C\u987F\u7684\u65F6\u95F4\u53EF\u80FD\u5F88\u957F\u3002\u4E3A\u4E86\u907F\u514D\u8FD9\u79CD\u60C5\u51B5\uFF0C\u9884\u5904\u7406\u65F6\u4F1A\u523B\u610F\u7B49\u5F85\u4E00\u6B21\u65B0\u751F\u4EE3 GC \u7684\u53D1\u751F\uFF0C\u7136\u540E\u6839\u636E\u5386\u53F2\u6027\u80FD\u6570\u636E\u9884\u6D4B\u4E0B\u4E00\u6B21\u65B0\u751F\u4EE3 GC \u53EF\u80FD\u53D1\u751F\u7684\u65F6\u95F4\uFF0C\u5728\u5F53\u524D\u65F6\u95F4\u548C\u9884\u6D4B\u65F6\u95F4\u7684\u4E2D\u95F4\u65F6\u523B\u8FDB\u884C\u91CD\u65B0\u6807\u8BB0\u3002\u8FD9\u6837\u53EF\u5C3D\u91CF\u907F\u514D\u65B0\u751F\u4EE3 GC \u548C\u91CD\u65B0\u6807\u8BB0\u91CD\u5408\uFF0C\u5C3D\u53EF\u80FD\u51CF\u5C11\u4E00\u6B21\u505C\u987F\u7684\u65F6\u95F4\u3002</p><h3 id="_5-3-2-cms-\u4E3B\u8981\u7684\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#_5-3-2-cms-\u4E3B\u8981\u7684\u53C2\u6570" aria-hidden="true">#</a> 5.3.2 CMS \u4E3B\u8981\u7684\u53C2\u6570</h3><p>\u542F\u7528 CMS \u56DE\u6536\u5668\u7684\u53C2\u6570\u662F -XX:+UseConcMarkSweepGC\u3002CMS \u662F\u591A\u7EBF\u7A0B\u56DE\u6536\u5668\uFF0C\u8BBE\u7F6E\u5408\u7406\u7684\u5DE5\u4F5C\u7EBF\u7A0B\u6570\u91CF\u5BF9\u7CFB\u7EDF\u6027\u80FD\u6709\u91CD\u8981\u7684\u5F71\u54CD\u3002</p><p>CMS \u9ED8\u8BA4\u542F\u52A8\u7684\u5E76\u53D1\u7EBF\u7A0B\u6570\u662F (ParallelGCThreads + 3) / 4\u3002ParallelGCThreads \u8868\u793A GC \u5E76\u884C\u65F6\u4F7F\u7528\u7684\u7EBF\u7A0B\u6570\u91CF\uFF0C\u5982\u679C\u65B0\u751F\u4EE3\u4F7F\u7528 ParNew\uFF0C\u90A3\u4E48 ParallelGCThreads \u4E5F\u5C31\u662F\u65B0\u751F\u4EE3 GC \u7684\u7EBF\u7A0B\u6570\u91CF\u3002\u8FD9\u610F\u5473\u7740\u6709 4 \u4E2A ParallelGCThreads \u65F6\uFF0C\u53EA\u6709 1 \u4E2A\u5E76\u53D1\u7EBF\u7A0B\uFF0C\u800C\u6709\u4E24\u4E2A\u5E76\u53D1\u7EBF\u7A0B\u65F6\uFF0C\u6709 5 ~ 8 \u4E2A ParallelGCThreads \u7EBF\u7A0B\u3002</p><p>\u5E76\u53D1\u7EBF\u7A0B\u6570\u91CF\u4E5F\u53EF\u4EE5\u901A\u8FC7 -XX:ConcGCThreads \u6216\u8005 -XX:ParallelCMSThreads \u53C2\u6570\u624B\u5DE5\u8BBE\u5B9A\u3002\u5F53 CPU \u8D44\u6E90\u6BD4\u8F83\u7D27\u5F20\u65F6\uFF0C\u53D7\u5230 CMS \u56DE\u6536\u5668\u7EBF\u7A0B\u7684\u5F71\u54CD\uFF0C\u5E94\u7528\u7CFB\u7EDF\u7684\u6027\u80FD\u5728\u5783\u573E\u56DE\u6536\u9636\u6BB5\u53EF\u80FD\u4F1A\u975E\u5E38\u7CDF\u7CD5\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1A\u5E76\u53D1\u662F\u6307\u6536\u96C6\u5668\u548C\u5E94\u7528\u7EBF\u7A0B\u4EA4\u66FF\u6267\u884C\uFF0C\u5E76\u884C\u662F\u6307\u5E94\u7528\u7A0B\u5E8F\u505C\u6B62\uFF0C\u540C\u65F6\u7531\u591A\u4E2A\u7EBF\u7A0B\u4E00\u8D77\u6267\u884C GC\u3002\u56E0\u6B64\u5E76\u884C\u56DE\u6536\u5668\u4E0D\u662F\u5E76\u53D1\u7684\uFF0C\u56E0\u4E3A\u5E76\u884C\u56DE\u6536\u5668\u6267\u884C\u65F6\uFF0C\u5E94\u7528\u7A0B\u5E8F\u5B8C\u5168\u6302\u8D77\uFF0C\u4E0D\u5B58\u5728\u4EA4\u66FF\u6267\u884C\u3002</p><p>\u7531\u4E8E CMS \u56DE\u6536\u5668\u4E0D\u662F\u72EC\u5360\u5F0F\u7684\u56DE\u6536\u5668\uFF0C\u5728 CMS \u56DE\u6536\u8FC7\u7A0B\u4E2D\uFF0C\u5E94\u7528\u7A0B\u5E8F\u4ECD\u7136\u5728\u4E0D\u505C\u5730\u5DE5\u4F5C\u3002\u5728\u5E94\u7528\u7A0B\u5E8F\u5DE5\u4F5C\u8FC7\u7A0B\u4E2D\uFF0C\u53C8\u4F1A\u4E0D\u65AD\u5730\u4EA7\u751F\u5783\u573E\u3002\u8FD9\u4E9B\u65B0\u751F\u6210\u7684\u5783\u573E\u5728\u5F53\u524D CMS \u56DE\u6536\u8FC7\u7A0B\u4E2D\u662F\u65E0\u6CD5\u6E05\u9664\u7684\u3002\u540C\u65F6\uFF0C\u56E0\u4E3A\u5E94\u7528\u7A0B\u5E8F\u6CA1\u6709\u4E2D\u65AD\uFF0C\u6240\u4EE5\u5728 CMS \u56DE\u6536\u8FC7\u7A0B\u4E2D\uFF0C\u8FD8\u5E94\u8BE5\u786E\u4FDD\u5E94\u7528\u7A0B\u5E8F\u6709\u8DB3\u591F\u7684\u5185\u5B58\u53EF\u7528\u3002\u56E0\u6B64\uFF0CCMS \u56DE\u6536\u5668\u4E0D\u4F1A\u7B49\u5F85\u5806\u5185\u5B58\u9971\u548C\u65F6\u624D\u8FDB\u884C\u5783\u573E\u56DE\u6536\uFF0C\u800C\u662F\u5F53\u5806\u5185\u5B58\u4F7F\u7528\u7387\u8FBE\u5230\u67D0\u4E00\u9608\u503C\u65F6\u4FBF\u5F00\u59CB\u8FDB\u884C\u56DE\u6536\uFF0C\u4EE5\u786E\u4FDD\u5E94\u7528\u7A0B\u5E8F\u5728 CMS \u5DE5\u4F5C\u8FC7\u7A0B\u4E2D\uFF0C\u4F9D\u7136\u6709\u8DB3\u591F\u7684\u7A7A\u95F4\u652F\u6301\u5E94\u7528\u7A0B\u5E8F\u8FD0\u884C\u3002</p><p>\u8FD9\u4E2A\u56DE\u6536\u9608\u503C\u53EF\u4EE5\u4F7F\u7528\u53C2\u6570 -XX:CMSInitiatingOccupancyFraction \u6765\u6307\u5B9A\uFF0C\u9ED8\u8BA4\u662F 68\uFF0C\u5373\u5F53\u8001\u5E74\u4EE3\u7684\u7A7A\u95F4\u4F7F\u7528\u7387\u8FBE\u5230 68% \u65F6\uFF0C\u4F1A\u6267\u884C\u4E00\u6B21 CMS \u56DE\u6536\u3002\u5982\u679C\u5E94\u7528\u7A0B\u5E8F\u7684\u5185\u5B58\u4F7F\u7528\u7387\u589E\u957F\u5F88\u5FEB\uFF0C\u5728 CMS \u7684\u6267\u884C\u8FC7\u7A0B\u4E2D\uFF0C\u5DF1\u7ECF\u51FA\u73B0\u4E86\u5185\u5B58\u4E0D\u8DB3\u7684\u60C5\u51B5\uFF0CCMS \u56DE\u6536\u5C31\u4F1A\u5931\u8D25\uFF0C\u865A\u62DF\u673A\u5C06\u542F\u52A8\u8001\u5E74\u4EE3\u4E32\u884C\u56DE\u6536\u5668\u8FDB\u884C\u5783\u573E\u56DE\u6536\u3002\u6B64\u65F6\uFF0C\u5E94\u7528\u7A0B\u5E8F\u5C06\u5B8C\u5168\u4E2D\u65AD\uFF0C\u76F4\u5230\u5783\u573E\u56DE\u6536\u5B8C\u6210\uFF0C\u8FD9\u65F6\uFF0C\u5E94\u7528\u7A0B\u5E8F\u7684\u505C\u987F\u65F6\u95F4\u53EF\u80FD\u4F1A\u8F83\u957F\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1A\u901A\u8FC7 -XX:CMSInitiatingOccupancyFraction \u53EF\u4EE5\u6307\u5B9A\u5F53\u8001\u5E74\u4EE3\u7A7A\u95F4\u4F7F\u7528\u7387\u8FBE\u5230\u591A\u5C11\u65F6\u8FDB\u884C\u4E00\u6B21 CMS \u5783\u573E\u56DE\u6536\u3002</p><p>\u6839\u636E\u5E94\u7528\u7A0B\u5E8F\u7684\u7279\u70B9\uFF0C\u53EF\u4EE5\u5BF9\u53C2\u6570 -XX:CMSInitiatingOccupancyFraction \u8FDB\u884C\u8C03\u4F18\u3002\u5982\u679C\u5185\u5B58\u589E\u957F\u7F13\u6162\uFF0C\u5219\u53EF\u4EE5\u8BBE\u7F6E\u4E00\u4E2A\u7A0D\u5927\u7684\u503C\uFF0C\u5927\u7684\u9608\u503C\u53EF\u4EE5\u6709\u6548\u964D\u4F4E CMS \u7684\u89E6\u53D1\u9891\u7387\uFF0C\u51CF\u5C11\u8001\u5E74\u4EE3\u56DE\u6536\u7684\u6B21\u6570\uFF0C\u53EF\u4EE5\u8F83\u4E3A\u660E\u663E\u5730\u6539\u5584\u5E94\u7528\u7A0B\u5E8F\u6027\u80FD\u3002\u53CD\u4E4B\uFF0C\u5982\u679C\u5E94\u7528\u7A0B\u5E8F\u5185\u5B58\u4F7F\u7528\u7387\u589E\u957F\u5F88\u5FEB\uFF0C\u5219\u5E94\u8BE5\u964D\u4F4E\u8FD9\u4E2A\u9608\u503C\uFF0C\u4EE5\u907F\u514D\u9891\u7E41\u89E6\u53D1\u8001\u5E74\u4EE3\u4E32\u884C\u56DE\u6536\u5668\u3002</p><p>CMS \u662F\u4E00\u4E2A\u57FA\u4E8E\u6807\u8BB0\u6E05\u9664\u6CD5\u7684\u56DE\u6536\u5668\u3002\u5728\u672C\u7AE0\u4E4B\u524D\u7684\u7BC7\u5E45\u4E2D\u5DF2\u7ECF\u63D0\u5230\uFF0C\u6807\u8BB0\u6E05\u9664\u6CD5\u5C06\u4F1A\u4EA7\u751F\u5927\u91CF\u5185\u5B58\u788E\u7247\uFF0C\u79BB\u6563\u7684\u53EF\u7528\u7A7A\u95F4\u65E0\u6CD5\u5206\u914D\u7ED9\u8F83\u5927\u7684\u5BF9\u8C61\u3002\u56FE5.5 \u663E\u793A\u4E86 CMS \u56DE\u6536\u524D\u3001\u540E\u8001\u5E74\u4EE3\u7684\u60C5\u51B5\u3002</p><p><img src="'+v+`" alt="\u56FE5-5" loading="lazy"></p><p>\u56FE5.5 CMS \u56DE\u6536\u524D\u3001\u540E\u8001\u5E74\u4EE3\u5BF9\u6BD4\u793A\u610F\u56FE</p><p>\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0C\u5373\u4F7F\u5806\u5185\u5B58\u4ECD\u7136\u6709\u8F83\u5927\u7684\u5269\u4F59\u7A7A\u95F4\uFF0C\u4E5F\u53EF\u80FD\u4F1A\u88AB\u8FEB\u8FDB\u884C\u4E00\u6B21\u5783\u573E\u56DE\u6536\uFF0C\u4EE5\u6362\u53D6\u4E00\u5757\u53EF\u7528\u7684\u8FDE\u7EED\u5185\u5B58\u3002\u8FD9\u79CD\u73B0\u8C61\u5BF9\u7CFB\u7EDF\u6027\u80FD\u662F\u76F8\u5F53\u4E0D\u5229\u7684\uFF0C\u4E3A\u4E86\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\uFF0CCMS \u56DE\u6536\u5668\u8FD8\u63D0\u4F9B\u4E86\u51E0\u4E2A\u7528\u4E8E\u5185\u5B58\u538B\u7F29\u6574\u7406\u7684\u53C2\u6570\u3002</p><ul><li><p>-XX:+UseCMSCompactAtFullCollection \u53C2\u6570\u53EF\u4EE5\u4F7F CMS \u5728\u5783\u573E\u6536\u96C6\u5B8C\u6210\u540E\uFF0C\u8FDB\u884C\u4E00\u6B21\u5185\u5B58\u788E\u7247\u6574\u7406\uFF0C\u5185\u5B58\u788E\u7247\u7684\u6574\u7406\u4E0D\u662F\u5E76\u53D1\u8FDB\u884C\u7684\u3002</p></li><li><p>-XX:CMSFullGCsBeforeCompaction \u53C2\u6570\u53EF\u4EE5\u7528\u4E8E\u8BBE\u5B9A\u8FDB\u884C\u591A\u5C11\u6B21 CMS \u56DE\u6536\u540E\uFF0C\u8FDB\u884C\u4E00\u6B21\u5185\u5B58\u538B\u7F29\u3002</p></li></ul><h3 id="_5-3-3-cms-\u7684\u65E5\u5FD7\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_5-3-3-cms-\u7684\u65E5\u5FD7\u5206\u6790" aria-hidden="true">#</a> 5.3.3 CMS \u7684\u65E5\u5FD7\u5206\u6790</h3><p>CMS \u56DE\u6536\u5668\u5DE5\u4F5C\u65F6\u7684\u65E5\u5FD7\u8F93\u51FA\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	1.313: [GC [1 CMS-initial-mark: 69112K(136576K)] 77037K(198016K), 0.0120453 secs] [Times: user=0.00 sys=0.00, real=0.01 secs]
	1.325: [CMS-concurrent-mark-start]
	1.342: [GC1.342: [ParNew: 61440K-&gt;4557K(61440K), 0.0025283 secs] 130552K-&gt;74933K(198016K), 0.0026144 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
	1.365: [GC1.365: [ParNew: 59213K-&gt;5972K(61440K), 0.0036258 secs] 129589K-&gt;77612K(198016K), 0.0037053 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
	1.388: [GC1.388: [ParNew: 60628K-&gt;6468K(61440K), 0.0025254 secs] 132268K-&gt;79371K(198016K), 0.0026154 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
	1.406: [CMS-concurrent-mark: 0.072/0.082 secs] [Times: user=0.17 sys=0.00, secs]
	1.406: [CMS-concurrent-preclean-start]
	1.409: [CMS-concurrent-preclean: 0.002/0.002 secs] [Times: user=0.00 sys=0.00, secs]
	1.406: [CMS-concurrent-abortable-preclean-start]
	1.411: [GC1.411: [ParNew: 61124K-&gt;4691K(61440K), 0.0025330 secs] 134027K-&gt;78858K(198016K), 0.0026144 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
	1.422: [CMS-concurrent-abortable-preclean: 0.011/0.014 secs] [Times: user=0.03 sys=0.00, real=0.01 secs]
	1.423: [GC[YG occupancy: 35483K (61440K)] 1.423: [Rescan (parallel), 0.0102064 secs]1.433 : [weak refs processing, 0.0000142 secs] 1.433: [scrub string table,0.0000298 secs] [1 CMS-remark: 74166K (136576K) ] 109650K (198016K) , 0.0103386 secs] [Times: user=0.00 sys=0.00, real=0.01 secs]
	1.433: [CMS-concurrent-sweep-start]
	1.445: [GC1.445: [ParNew: 59347K-&gt;6001K(61440K), 0.0037510 secs] 132617K-&gt;80535K(198016K), 0.0038390 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
	1.450: [CMS-concurrent-sweep: 0.013/0.017 secs] [Times: user=0.06 sys=0.00, real=0.02 secs]
	1.450: [CMS-concurrent-reset-start]
	1.451: [CMS-concurrent-reset: 0.001/0.001 secs] [Times: user=0.00 sys=0.00, real=0.02 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE5\u4E0A\u4FE1\u606F\u662F\u4E00\u6B21 CMS \u56DE\u6536\u7684\u8F93\u51FA\u3002\u53EF\u4EE5\u770B\u5230\uFF0C\u5728 CMS \u56DE\u6536\u5668\u5DE5\u4F5C\u8FC7\u7A0B\u4E2D\uFF0C\u5305\u62EC\u521D\u59CB\u5316\u6807\u8BB0\u3001\u5E76\u53D1\u6807\u8BB0\u3001\u9884\u6E05\u7406\u3001\u91CD\u65B0\u6807\u8BB0\u3001\u5E76\u53D1\u6E05\u7406\u548C\u91CD\u53D1\u91CD\u7F6E\u7B49\u51E0\u4E2A\u91CD\u8981\u9636\u6BB5\u3002\u5728\u65E5\u5FD7\u4E2D\uFF0C\u8FD8\u53EF\u4EE5\u770B\u5230 CMS \u7684\u8017\u65F6\u53CA\u5806\u5185\u5B58\u4FE1\u606F\u3002</p><p>\u5728 1.409 \u79D2\u53D1\u751F abortable-preclean\uFF0C\u8868\u793A CMS \u5F00\u59CB\u7B49\u5F85\u4E00\u6B21\u65B0\u751F\u4EE3 GC\u3002\u5728 1.411 \u79D2 ParNew \u56DE\u6536\u5668\u5F00\u59CB\u5DE5\u4F5C\uFF0C\u5728 1.422 \u79D2 abortable-preclean \u7EC8\u6B62\u3002\u4E4B\u540E\uFF0CCMS \u6839\u636E\u4E4B\u524D\u65B0\u751F\u4EE3 GC \u7684\u60C5\u51B5\uFF0C\u5C06\u91CD\u65B0\u6807\u8BB0\u7684\u65F6\u95F4\u653E\u5728\u4E00\u4E2A\u6700\u4E0D\u53EF\u80FD\u548C\u4E0B\u4E00\u6B21\u65B0\u751F\u4EE3 GC \u91CD\u53E0\u7684\u65F6\u523B\uFF0C\u5373\u4E24\u6B21\u65B0\u751F\u4EE3 GC \u7684\u4E2D\u95F4\u70B9\uFF0C\u8FD9\u91CC\u4E3A 1.423 \u79D2\u5904\u3002</p><p>\u9664\u6B64\u4E4B\u5916\uFF0CCMS \u56DE\u6536\u5668\u5728\u8FD0\u884C\u65F6\u8FD8\u53EF\u80FD\u8F93\u51FA\u5982\u4E0B\u65E5\u5FD7\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	33.348: [Full GC 33.348: [CMS33.357: [CMS-concurrent-sweep: 0.035/0.036 secs] [Times: user=0.11 sys=0.03, real=0.03 secs]
	(concurrent mode failure): 47066K-&gt;39901K(49152K), 0.3896802 secs] 60771K-&gt; 39901K(63936K), [CMS Perm : 22529K-&gt;22529K(32768K)], 0.3897989 secs] [Times: user=0.39 sys=0.00, real=0.39 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u8BF4\u660E CMS \u56DE\u6536\u5668\u5E76\u53D1\u56DE\u6536\u5931\u8D25\u3002\u8FD9\u5F88\u53EF\u80FD\u662F\u5E94\u7528\u7A0B\u5E8F\u5728\u8FD0\u884C\u8FC7\u7A0B\u4E2D\u8001\u5E74\u4EE3\u7A7A\u95F4\u4E0D\u591F\u5BFC\u81F4\u7684\u3002\u5982\u679C\u5728 CMS \u5DE5\u4F5C\u8FC7\u7A0B\u4E2D\uFF0C\u51FA\u73B0\u975E\u5E38\u9891\u7E41\u7684\u5E76\u53D1\u6A21\u5F0F\u5931\u8D25\uFF0C\u5C31\u5E94\u8BE5\u8003\u8651\u8FDB\u884C\u8C03\u6574\uFF0C\u5C3D\u53EF\u80FD\u9884\u7559\u4E00\u4E2A\u8F83\u5927\u7684\u8001\u5E74\u4EE3\u7A7A\u95F4\u3002\u6216\u8005\u53EF\u4EE5\u8BBE\u7F6E\u4E00\u4E2A\u8F83\u5C0F\u7684 -XX:CMSInitiatingOccupancyFraction \u53C2\u6570\uFF0C\u964D\u4F4E CMS \u89E6\u53D1\u7684\u9608\u503C\uFF0C\u4F7F CMS \u5728\u6267\u884C\u8FC7\u7A0B\u4E2D\u4ECD\u7136\u6709\u8F83\u5927\u7684\u8001\u5E74\u4EE3\u7A7A\u95F2\u7A7A\u95F4\u4F9B\u5E94\u7528\u7A0B\u5E8F\u4F7F\u7528\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1ACMS \u56DE\u6536\u5668\u662F\u4E00\u4E2A\u5173\u6CE8\u505C\u987F\u7684\u5783\u573E\u56DE\u6536\u5668\u3002\u540C\u65F6 CMS \u56DE\u6536\u5668\u5728\u90E8\u5206\u5DE5\u4F5C\u6D41\u7A0B\u4E2D\uFF0C\u53EF\u4EE5\u4E0E\u7528\u6237\u7A0B\u5E8F\u540C\u65F6\u8FD0\u884C\uFF0C\u4ECE\u800C\u51CF\u5C11\u5E94\u7528\u7A0B\u5E8F\u7684\u505C\u987F\u65F6\u95F4\u3002</p><h3 id="_5-3-4-\u6709\u5173-class-\u7684\u56DE\u6536" tabindex="-1"><a class="header-anchor" href="#_5-3-4-\u6709\u5173-class-\u7684\u56DE\u6536" aria-hidden="true">#</a> 5.3.4 \u6709\u5173 Class \u7684\u56DE\u6536</h3><p>\u5728\u4F7F\u7528 CMS \u56DE\u6536\u5668\u65F6\uFF0C\u5982\u679C\u9700\u8981\u56DE\u6536 Perm \u533A\uFF0C\u90A3\u4E48\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u8FD8\u9700\u8981\u89E6\u53D1\u4E00\u6B21 Full GC\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	[Full GC[CMS: 4624K-&gt;2047K(10944K), 0.0156648 secs] 7191K-&gt;2047K(15936K), [CMS Perm : 4096K-&gt;2145K(4096K)], 0.0157072 secs] [Times: user=0.01 sys=0.00, real=0.02 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5982\u679C\u5E0C\u671B\u4F7F\u7528 CMS \u56DE\u6536\u5668\u56DE\u6536 Perm \u533A\uFF0C\u5219\u5FC5\u987B\u6253\u5F00 -XX:+CMSClassUnloadingEnabled \u5F00\u5173\u3002\u4F7F\u7528 -XX:+CMSClassUnloadingEnabled \u540E\uFF0C\u5982\u679C\u6761\u4EF6\u5141\u8BB8\uFF0C\u7CFB\u7EDF\u4F1A\u4F7F\u7528 CMS \u7684\u673A\u5236\u56DE\u6536 Perm \u533A\u7684 Class \u6570\u636E\uFF0C\u65E5\u5FD7\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	[GC [1 CMS-initial-mark: 6035K(10944K)] 6640K(15936K), 0.0007878 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
	[CMS-concurrent-mark: 0.008/0.009 secs] [Times: user=0.03 sys=0.00, real=0.01 secs] 
	[CMS-concurrent-preclean: 0.000/0.000 secs] [Times: user=0.00 sys=0.00r real=0.00 secs]
	[GC[YG occupancy: 1070 K (4992 K)][Rescan (parallel) , 0.0008064 secs][weak refs processing, 0.0001239 secs][class unloading, 0.0016846 secs][scrub symbol table, 0.0004835 secs][scrub string table, 0.0000285 secs][1 CMS-remark: 6035K(10944K)] 7105K(15936K), 0.0033860 secs] [Times: user=0.00 sys=0.00r real=0.00 secs]
	[CMS-concurrent-sweep: 0.009/0.009 secs] [Times: user=0.00 sys=0.00r real=0.01 secs]
	[CMS-concurrent-reset: 0.001/0.001 secs] [Times: user=0.00 sys=0.00r real=0.00 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-4-\u672A\u6765\u6211\u505A\u4E3B-g1-\u56DE\u6536\u5668-jdk-9-\u53CA\u4E4B\u540E\u7248\u672C\u7684\u9ED8\u8BA4\u56DE\u6536\u5668" tabindex="-1"><a class="header-anchor" href="#_5-4-\u672A\u6765\u6211\u505A\u4E3B-g1-\u56DE\u6536\u5668-jdk-9-\u53CA\u4E4B\u540E\u7248\u672C\u7684\u9ED8\u8BA4\u56DE\u6536\u5668" aria-hidden="true">#</a> 5.4 \u672A\u6765\u6211\u505A\u4E3B\uFF1AG1 \u56DE\u6536\u5668\uFF08JDK 9 \u53CA\u4E4B\u540E\u7248\u672C\u7684\u9ED8\u8BA4\u56DE\u6536\u5668\uFF09</h2><p>G1 \u56DE\u6536\u5668\uFF08Garbage-First\uFF09\u662F\u5728 JDK 1.7 \u4E2D\u6B63\u5F0F\u4F7F\u7528\u7684\u5168\u65B0\u7684\u5783\u573E\u56DE\u6536\u5668\uFF0C\u4ECE\u957F\u671F\u76EE\u6807\u6765\u770B\uFF0C\u5B83\u662F\u4E3A\u4E86\u53D6\u4EE3 CMS \u56DE\u6536\u5668\u3002G1 \u56DE\u6536\u5668\u62E5\u6709\u72EC\u7279\u7684\u5783\u573E\u56DE\u6536\u7B56\u7565\uFF0C\u548C\u4E4B\u524D\u63D0\u5230\u7684\u56DE\u6536\u5668\u622A\u7136\u4E0D\u540C\u3002\u4ECE\u5206\u4EE3\u4E0A\u770B\uFF0CG1 \u4F9D\u7136\u5C5E\u4E8E\u5206\u4EE3\u5783\u573E\u56DE\u6536\u5668\uFF0C\u5B83\u4F1A\u533A\u5206\u5E74\u8F7B\u4EE3\u548C\u8001\u5E74\u4EE3\uFF0C\u4F9D\u7136\u6709 eden \u533A\u548C survivor \u533A\uFF0C\u4F46\u4ECE\u5806\u7684\u7ED3\u6784\u4E0A\u770B\uFF0C\u5B83\u5E76\u4E0D\u8981\u6C42\u6574\u4E2A eden \u533A\u3001\u5E74\u8F7B\u4EE3\u6216\u8005\u8001\u5E74\u4EE3\u90FD\u8FDE\u7EED\u3002\u5B83\u4F7F\u7528\u4E86\u5206\u533A\u7B97\u6CD5\u3002\u4F5C\u4E3A CMS \u7684\u957F\u671F\u66FF\u4EE3\u65B9\u6848\uFF0CG1 \u4F7F\u7528\u4E86\u5168\u65B0\u7684\u5206\u533A\u7B97\u6CD5\uFF0C\u5176\u7279\u70B9\u5982\u4E0B\u3002</p><ul><li><p>\u5E76\u884C\u6027\uFF1AG1 \u5728\u56DE\u6536\u671F\u95F4\uFF0C\u53EF\u4EE5\u7531\u591A\u4E2A GC \u7EBF\u7A0B\u540C\u65F6\u5DE5\u4F5C\uFF0C\u6709\u6548\u5229\u7528\u591A\u6838\u8BA1\u7B97\u80FD\u529B\u3002</p></li><li><p>\u5E76\u53D1\u6027\uFF1AG1 \u62E5\u6709\u4E0E\u5E94\u7528\u7A0B\u5E8F\u4EA4\u66FF\u6267\u884C\u7684\u80FD\u529B\uFF0C\u90E8\u5206\u5DE5\u4F5C\u53EF\u4EE5\u548C\u5E94\u7528\u7A0B\u5E8F\u540C\u65F6\u6267\u884C\uFF0C\u4E00\u822C\u6765\u8BF4\uFF0C\u4E0D\u4F1A\u5728\u6574\u4E2A\u56DE\u6536\u671F\u95F4\u5B8C\u5168\u963B\u585E\u5E94\u7528\u7A0B\u5E8F\u3002</p></li><li><p>\u5206\u4EE3 GC\uFF1AG1 \u4F9D\u7136\u662F\u4E00\u4E2A\u5206\u4EE3\u56DE\u6536\u5668\uFF0C\u4F46\u662F\u548C\u4E4B\u524D\u7684\u56DE\u6536\u5668\u4E0D\u540C\uFF0C\u5B83\u540C\u65F6\u517C\u987E\u5E74\u8F7B\u4EE3\u548C\u8001\u5E74\u4EE3\uFF0C\u5176\u4ED6\u56DE\u6536\u5668\u6216\u8005\u5DE5\u4F5C\u5728\u5E74\u8F7B\u4EE3\uFF0C\u6216\u8005\u5DE5\u4F5C\u5728\u8001\u5E74\u4EE3\u3002</p></li><li><p>\u7A7A\u95F4\u6574\u7406\uFF1AG1 \u5728\u56DE\u6536\u8FC7\u7A0B\u4E2D\uFF0C\u4F1A\u8FDB\u884C\u9002\u5F53\u7684\u5BF9\u8C61\u79FB\u52A8\uFF0C\u4E0D\u50CF CMS\uFF0C\u53EA\u662F\u7B80\u5355\u5730\u6807\u8BB0\u6E05\u7406\u5BF9\u8C61\uFF0C\u5728\u82E5\u5E72\u6B21 GC \u540E\uFF0CCMS \u5FC5\u987B\u8FDB\u884C\u4E00\u6B21\u788E\u7247\u6574\u7406\u3002\u800C G1 \u4E0D\u540C\uFF0C\u5B83\u6BCF\u6B21\u56DE\u6536\u90FD\u4F1A\u6709\u6548\u5730\u590D\u5236\u5BF9\u8C61\uFF0C\u51CF\u5C11\u788E\u7247\u7A7A\u95F4\u3002</p></li><li><p>\u53EF\u9884\u89C1\u6027\uFF1A\u7531\u4E8E\u5206\u533A\u7684\u539F\u56E0\uFF0CG1 \u53EF\u4EE5\u53EA\u9009\u53D6\u90E8\u5206\u533A\u57DF\u8FDB\u884C\u5185\u5B58\u56DE\u6536\uFF0C\u8FD9\u6837\u7F29\u5C0F\u4E86\u56DE\u6536\u7684\u8303\u56F4\uFF0C\u5168\u5C40\u505C\u987F\u4E5F\u80FD\u5F97\u5230\u8F83\u597D\u7684\u63A7\u5236\u3002</p></li></ul><h3 id="_5-4-1-g1-\u7684\u5185\u5B58\u5212\u5206\u548C\u4E3B\u8981\u6536\u96C6\u8FC7\u7A0B" tabindex="-1"><a class="header-anchor" href="#_5-4-1-g1-\u7684\u5185\u5B58\u5212\u5206\u548C\u4E3B\u8981\u6536\u96C6\u8FC7\u7A0B" aria-hidden="true">#</a> 5.4.1 G1 \u7684\u5185\u5B58\u5212\u5206\u548C\u4E3B\u8981\u6536\u96C6\u8FC7\u7A0B</h3><p>G1 \u5C06\u5806\u8FDB\u884C\u5206\u533A\uFF0C\u5212\u5206\u4E3A\u4E00\u4E2A\u4E2A\u7684\u533A\u57DF\uFF0C\u6BCF\u6B21\u56DE\u6536\u7684\u65F6\u5019\uFF0C\u53EA\u56DE\u6536\u5176\u4E2D\u51E0\u4E2A\u533A\u57DF\uFF0C\u4EE5\u6B64\u6765\u63A7\u5236\u5783\u573E\u56DE\u6536\u4EA7\u751F\u7684\u4E00\u6B21\u505C\u987F\u7684\u65F6\u95F4\u3002</p><p>G1 \u7684\u56DE\u6536\u8FC7\u7A0B\u53EF\u80FD\u6709 4 \u4E2A\u9636\u6BB5\uFF1A</p><ul><li><p>\u65B0\u751F\u4EE3 GC\u3002</p></li><li><p>\u5E76\u53D1\u6807\u8BB0\u5468\u671F\u3002</p></li><li><p>\u6DF7\u5408\u56DE\u6536\u3002</p></li><li><p>\u5982\u679C\u9700\u8981\uFF0C\u53EF\u80FD\u4F1A\u8FDB\u884C Full GC\u3002</p></li></ul><h3 id="_5-4-2-g1-\u7684\u65B0\u751F\u4EE3-gc" tabindex="-1"><a class="header-anchor" href="#_5-4-2-g1-\u7684\u65B0\u751F\u4EE3-gc" aria-hidden="true">#</a> 5.4.2 G1 \u7684\u65B0\u751F\u4EE3 GC</h3><p>\u65B0\u751F\u4EE3 GC \u7684\u4E3B\u8981\u5DE5\u4F5C\u662F\u56DE\u6536 eden \u533A\u548C survivor \u533A\u3002\u4E00\u65E6 eden \u533A\u88AB\u5360\u6EE1\uFF0C\u65B0\u751F\u4EE3 GC \u5C31\u4F1A\u542F\u52A8\u3002\u65B0\u751F\u4EE3 GC \u524D\u3001\u540E\u7684\u5806\u6570\u636E\u793A\u4F8B\u5982\u56FE5.6 \u6240\u793A\uFF0C\u5176\u4E2D E \u8868\u793A eden \u533A\uFF0CS \u8868\u793A survivor \u533A\uFF0CO \u8868\u793A\u8001\u5E74\u4EE3\u3002\u53EF\u4EE5\u770B\u5230\uFF0C\u65B0\u751F\u4EE3 GC \u53EA\u5904\u7406 eden \u533A\u548C survivor \u533A\uFF0C\u56DE\u6536\u540E\u6240\u6709\u7684 eden \u533A\u90FD\u5E94\u8BE5\u88AB\u6E05\u7A7A\uFF0C\u800C survivor \u533A\u4F1A\u88AB\u56DE\u6536\u4E00\u90E8\u5206\u6570\u636E\uFF0C\u4F46\u662F\u5E94\u8BE5\u81F3\u5C11\u4ECD\u7136\u5B58\u5728\u4E00\u4E2A survivor \u533A\uFF0C\u7C7B\u6BD4\u5176\u4ED6\u7684\u65B0\u751F\u4EE3\u56DE\u6536\u5668\uFF0C\u8FD9\u4E00\u70B9\u4F3C\u4E4E\u5E76\u6CA1\u6709\u592A\u5927\u53D8\u5316\u3002\u53E6\u4E00\u4E2A\u91CD\u8981\u7684\u53D8\u5316\u662F\uFF0C\u8001\u5E74\u4EE3\u7684\u533A\u57DF\u589E\u591A\uFF0C\u56E0\u4E3A\u90E8\u5206 survivor \u533A\u6216\u8005 eden \u533A\u7684\u5BF9\u8C61\u53EF\u80FD\u4F1A\u664B\u5347\u5230\u8001\u5E74\u4EE3\u3002</p><p><img src="`+m+`" alt="\u56FE5-6" loading="lazy"></p><p>\u56FE5.6 \u65B0\u751F\u4EE3 GC \u524D\u3001\u540E\u7684\u5806\u6570\u636E\u793A\u4F8B</p><p>\u65B0\u751F\u4EE3 GC \u53D1\u751F\u540E\uFF0C\u5982\u679C\u6253\u5F00\u4E86 PrintGCDetails \u9009\u9879\uFF0C\u5C31\u53EF\u4EE5\u5F97\u5230\u7C7B\u4F3C\u5982\u4E0B\u7684 GC \u65E5\u5FD7\uFF08\u8FD9\u91CC\u53EA\u7ED9\u51FA\u4E86\u90E8\u5206\u65E5\u5FD7\uFF0C\u5B8C\u5168\u7684\u65E5\u5FD7\u53CA\u5176\u5206\u6790\u8BF7\u770B 5.4.6 \u8282)\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>0.336: [GC pause (young), 0.0063051 secs]
...
[Eden: 235.0M(235.0M)-&gt;0.0B(229.0M) Survivors: 5120.0K-&gt;11.0M Heap: 239.2M(400.0M)-&gt;10.5M(400.0M)] 
[Times: user=0.06 sys=0.00, real=0.01 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u548C\u5176\u4ED6\u56DE\u6536\u5668\u7684\u65E5\u5FD7\u76F8\u6BD4\uFF0CG1 \u7684\u65E5\u5FD7\u5185\u5BB9\u975E\u5E38\u4E30\u5BCC\u3002\u5F53\u7136\u6211\u4EEC\u6700\u5173\u5FC3\u7684\u4F9D\u7136\u662F GC \u7684\u505C\u987F\u65F6\u95F4\u53CA\u56DE\u6536\u60C5\u51B5\u3002\u4ECE\u65E5\u5FD7\u4E2D\u53EF\u4EE5\u770B\u5230\uFF0Cedcn \u533A\u539F\u672C\u5360\u7528 235MB \u7A7A\u95F4\uFF0C\u56DE\u6536\u540E\u88AB\u6E05\u7A7A\uFF0Csurvivor \u533A\u4ECE 5MB \u589E\u957F\u5230\u4E86 11MB\uFF0C\u8FD9\u662F\u56E0\u4E3A\u90E8\u5206\u5BF9\u8C61\u88AB\u4ECE eden \u533A\u590D\u5236\u5230 survivor \u533A\uFF0C\u6574\u4E2A\u5806\u5408\u8BA1\u4E3A 400MB\uFF0C\u5806\u5185\u5B58\u4ECE\u56DE\u6536\u524D\u7684 239MB \u4E0B\u964D\u5230 10.5MB\u3002</p><h3 id="_5-4-3-g1-\u7684\u5E76\u53D1\u6807\u8BB0\u5468\u671F" tabindex="-1"><a class="header-anchor" href="#_5-4-3-g1-\u7684\u5E76\u53D1\u6807\u8BB0\u5468\u671F" aria-hidden="true">#</a> 5.4.3 G1 \u7684\u5E76\u53D1\u6807\u8BB0\u5468\u671F</h3><p>G1 \u7684\u5E76\u53D1\u9636\u6BB5\u548C CMS \u6709\u70B9\u7C7B\u4F3C\uFF0C\u5B83\u4EEC\u90FD\u662F\u4E3A\u4E86\u964D\u4F4E\u4E00\u6B21\u505C\u987F\u65F6\u95F4\uFF0C\u800C\u5C06\u53EF\u4EE5\u548C\u5E94\u7528\u7A0B\u5E8F\u5E76\u53D1\u7684\u90E8\u5206\u5355\u72EC\u63D0\u53D6\u51FA\u6765\u6267\u884C\u3002</p><p>\u5E76\u53D1\u6807\u8BB0\u5468\u671F\u53EF\u4EE5\u5206\u4E3A\u4EE5\u4E0B\u51E0\u6B65\u3002</p><ul><li><p>\u521D\u59CB\u6807\u8BB0\uFF1A\u6807\u8BB0\u4ECE\u6839\u8282\u70B9\u76F4\u63A5\u53EF\u8FBE\u7684\u5BF9\u8C61\u3002\u8FD9\u4E2A\u9636\u6BB5\u4F1A\u4F34\u968F\u4E00\u6B21\u65B0\u751F\u4EE3 GC\uFF0C\u5B83\u662F\u4F1A\u4EA7\u751F\u5168\u5C40\u505C\u987F\u7684\uFF0C\u5E94\u7528\u7A0B\u5E8F\u7EBF\u7A0B\u5728\u8FD9\u4E2A\u9636\u6BB5\u5FC5\u987B\u505C\u6B62\u6267\u884C\u3002</p></li><li><p>\u6839\u533A\u57DF\u626B\u63CF\uFF1A\u7531\u4E8E\u521D\u59CB\u6807\u8BB0\u5FC5\u7136\u4F1A\u4F34\u968F\u4E00\u6B21\u65B0\u751F\u4EE3 GC\uFF0C\u6240\u4EE5\u5728\u521D\u59CB\u5316\u6807\u8BB0\u540E\uFF0Ceden \u533A\u88AB\u6E05\u7A7A\uFF0C\u5E76\u4E14\u5B58\u6D3B\u5BF9\u8C61\u88AB\u79FB\u5165 survivor \u533A\u3002\u5728\u8FD9\u4E2A\u9636\u6BB5\uFF0C\u5C06\u626B\u63CF\u7531 survivor \u533A\u76F4\u63A5\u53EF\u8FBE\u7684\u8001\u5E74\u4EE3\u533A\u57DF\uFF0C\u5E76\u6807\u8BB0\u8FD9\u4E9B\u76F4\u63A5\u53EF\u8FBE\u7684\u5BF9\u8C61\u3002\u8FD9\u4E2A\u8FC7\u7A0B\u662F\u53EF\u4EE5\u548C\u5E94\u7528\u7A0B\u5E8F\u5E76\u53D1\u6267\u884C\u7684\u3002\u4F46\u662F\u6839\u533A\u57DF\u626B\u63CF\u4E0D\u80FD\u548C\u65B0\u751F\u4EE3 GC \u540C\u65F6\u6267\u884C\uFF08\u56E0\u4E3A\u6839\u533A\u57DF\u626B\u63CF\u4F9D\u8D56 survivor \u533A\u7684\u5BF9\u8C61\uFF0C\u800C\u65B0\u751F\u4EE3 GC \u4F1A\u4FEE\u6539\u8FD9\u4E2A\u533A\u57DF\uFF09\uFF0C\u56E0\u6B64\u5982\u679C\u6070\u5DE7\u5728\u6B64\u65F6\u9700\u8981\u8FDB\u884C\u65B0\u751F\u4EE3 GC\uFF0C\u5C31\u9700\u8981\u7B49\u5F85\u6839\u533A\u57DF\u626B\u63CF\u7ED3\u675F\u540E\u624D\u80FD\u8FDB\u884C\u3002\u5982\u679C\u53D1\u751F\u8FD9\u79CD\u60C5\u51B5\uFF0C\u8FD9\u6B21\u65B0\u751F\u4EE3 GC \u7684\u65F6\u95F4\u5C31\u4F1A\u5EF6\u957F\u3002</p></li><li><p>\u5E76\u53D1\u6807\u8BB0\uFF1A\u548C CMS \u7C7B\u4F3C\uFF0C\u5E76\u53D1\u6807\u8BB0\u5C06\u4F1A\u626B\u63CF\u5E76\u67E5\u627E\u6574\u4E2A\u5806\u7684\u5B58\u6D3B\u5BF9\u8C61\uFF0C\u5E76\u505A\u597D\u6807\u8BB0\u3002\u8FD9\u662F\u4E00\u4E2A\u5E76\u53D1\u7684\u8FC7\u7A0B\uFF0C\u5E76\u4E14\u8FD9\u4E2A\u8FC7\u7A0B\u53EF\u4EE5\u88AB\u4E00\u6B21\u65B0\u751F\u4EE3 GC \u6253\u65AD\u3002</p></li><li><p>\u91CD\u65B0\u6807\u8BB0\uFF1A\u548C CMS \u4E00\u6837\uFF0C\u91CD\u65B0\u6807\u8BB0\u4E5F\u662F\u4F1A\u4EA7\u751F\u5E94\u7528\u7A0B\u5E8F\u505C\u987F\u7684\u3002\u7531\u4E8E\u5728\u5E76\u53D1\u6807\u8BB0\u8FC7\u7A0B\u4E2D\uFF0C\u5E94\u7528\u7A0B\u5E8F\u4F9D\u7136\u5728\u8FD0\u884C\uFF0C\u56E0\u6B64\u6807\u8BB0\u7ED3\u679C\u53EF\u80FD\u9700\u8981\u8FDB\u884C\u4FEE\u6B63\uFF0C\u6240\u4EE5\u5728\u6B64\u5BF9\u4E0A\u4E00\u6B21\u7684\u6807\u8BB0\u7ED3\u679C\u8FDB\u884C\u8865\u5145\u3002\u5728 G1 \u4E2D\uFF0C\u8FD9\u4E2A\u8FC7\u7A0B\u4F7F\u7528 SATB\uFF08Snapshot-At-The-Beginning\uFF09\u7B97\u6CD5\u5B8C\u6210\uFF0C\u5373 G1 \u4F1A\u5728\u6807\u8BB0\u4E4B\u521D\u4E3A\u5B58\u6D3B\u5BF9\u8C61\u521B\u5EFA\u4E00\u4E2A\u5FEB\u7167\uFF0C\u8FD9\u4E2A\u5FEB\u7167\u6709\u52A9\u4E8E\u52A0\u901F\u91CD\u65B0\u6807\u8BB0\u7684\u901F\u5EA6\u3002</p></li><li><p>\u72EC\u5360\u6E05\u7406\uFF1A\u8FD9\u4E2A\u9636\u6BB5\u662F\u4F1A\u5F15\u8D77\u505C\u987F\u7684\u3002\u5B83\u5C06\u8BA1\u7B97\u5404\u4E2A\u533A\u57DF\u7684\u5B58\u6D3B\u5BF9\u8C61\u548C GC \u56DE\u6536\u6BD4\u4F8B\uFF0C\u5E76\u8FDB\u884C\u6392\u5E8F\uFF0C\u8BC6\u522B\u53EF\u4F9B\u6DF7\u5408\u56DE\u6536\u7684\u533A\u57DF\u3002\u5728\u8FD9\u4E2A\u9636\u6BB5\uFF0C\u8FD8\u4F1A\u66F4\u65B0\u8BB0\u5FC6\u96C6\uFF08Remebered Set\uFF09\u3002\u8BE5\u9636\u6BB5\u7ED9\u51FA\u4E86\u9700\u8981\u88AB\u6DF7\u5408\u56DE\u6536\u7684\u533A\u57DF\u5E76\u8FDB\u884C\u4E86\u6807\u8BB0\uFF0C\u5728\u6DF7\u5408\u56DE\u6536\u9636\u6BB5\u9700\u8981\u8FD9\u4E9B\u4FE1\u606F\u3002</p></li><li><p>\u5E76\u53D1\u6E05\u7406\uFF1A\u8FD9\u91CC\u4F1A\u8BC6\u522B\u5E76\u6E05\u7406\u5B8C\u5168\u7A7A\u95F2\u7684\u533A\u57DF\u3002\u5B83\u662F\u5E76\u53D1\u7684\u6E05\u7406\uFF0C\u4E0D\u4F1A\u5F15\u8D77\u505C\u987F\u3002</p></li></ul><p>\u56FE5.7 \u663E\u793A\u4E86\u5E76\u53D1\u6807\u8BB0\u5468\u671F\u524D\u540E\u5806\u7684\u53EF\u80FD\u60C5\u51B5\u3002\u7531\u4E8E\u5E76\u53D1\u6807\u8BB0\u5468\u671F\u5305\u542B\u4E00\u6B21\u65B0\u751F\u4EE3 GC\uFF0C\u6545\u65B0\u751F\u4F1A\u88AB\u6574\u7406\uFF0C\u4F46\u7531\u4E8E\u5E76\u53D1\u6807\u8BB0\u5468\u671F\u6267\u884C\u65F6\uFF0C\u5E94\u7528\u7A0B\u5E8F\u4F9D\u7136\u5728\u8FD0\u884C\uFF0C\u6240\u4EE5\u5E76\u53D1\u6807\u8BB0\u5468\u671F\u7ED3\u675F\u540E\uFF0C\u53C8\u4F1A\u6709\u65B0\u7684 eden \u533A\u7684\u7A7A\u95F4\u88AB\u4F7F\u7528\u3002\u5E76\u53D1\u6807\u8BB0\u5468\u671F\u6267\u884C\u524D\u540E\u6700\u5927\u7684\u4E0D\u540C\u662F\u5728\u8BE5\u9636\u6BB5\u540E\uFF0C\u7CFB\u7EDF\u589E\u52A0\u4E86\u4E00\u4E9B\u6807\u8BB0\u4E3A G \u7684\u533A\u57DF\u3002\u8FD9\u4E9B\u533A\u57DF\u88AB\u6807\u8BB0\uFF0C\u662F\u56E0\u4E3A\u5B83\u4EEC\u5185\u90E8\u7684\u5783\u573E\u6BD4\u4F8B\u8F83\u9AD8\uFF0C\u5E0C\u671B\u5728\u540E\u7EED\u7684\u6DF7\u5408 GC \u4E2D\u8FDB\u884C\u6536\u96C6\uFF08\u6CE8\u610F\u5728\u5E76\u53D1\u6807\u8BB0\u5468\u671F\u4E2D\u5E76\u672A\u6B63\u5F0F\u6536\u96C6\u8FD9\u4E9B\u533A\u57DF\uFF09\u3002\u8FD9\u4E9B\u5C06\u8981\u88AB\u56DE\u6536\u7684\u533A\u57DF\u4F1A\u88AB G1 \u8BB0\u5F55\u5728\u4E00\u4E2A\u79F0\u4E3A Collection Sets\uFF08\u56DE\u6536\u96C6\uFF09\u7684\u96C6\u5408\u4E2D\u3002</p><p><img src="`+g+'" alt="\u56FE5-7" loading="lazy"></p><p>\u56FE5.7 \u5E76\u53D1\u6807\u8BB0\u5468\u671F\u524D\u3001\u540E\u5806\u7684\u53EF\u80FD\u60C5\u51B5</p><p>\u5E76\u53D1\u56DE\u6536\u9636\u6BB5\u7684\u6574\u4F53\u5DE5\u4F5C\u6D41\u7A0B\u5982\u56FE5.8 \u6240\u793A\uFF0C\u53EF\u4EE5\u770B\u5230\u9664\u4E86\u521D\u59CB\u6807\u8BB0\u3001\u91CD\u65B0\u6807\u8BB0\u548C\u72EC\u5360\u6E05\u7406\uFF0C\u5176\u4ED6\u51E0\u4E2A\u9636\u6BB5\u90FD\u53EF\u4EE5\u548C\u5E94\u7528\u7A0B\u5E8F\u5E76\u53D1\u6267\u884C\u3002</p><p><img src="'+b+`" alt="\u56FE5-8" loading="lazy"></p><p>\u56FE5.8 \u5E76\u53D1\u56DE\u6536\u9636\u6BB5\u7684\u6574\u4F53\u5DE5\u4F5C\u6D41\u7A0B</p><p>\u5728\u5E76\u53D1\u6807\u8BB0\u5468\u671F\u4E2D\uFF0CG1 \u4F1A\u4EA7\u751F\u5982\u4E0B\u65E5\u5FD7\u3002</p><ol><li><p>\u521D\u59CB\u6807\u8BB0\uFF0C\u5B83\u4F34\u968F\u4E00\u6B21\u65B0\u751F\u4EE3 GC\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1.765: [GC pause (young) (initial-mark), 0.0052941 secs]
...
[Eden: 61.0M(61.0M)-&gt;0.0B(57.0M) Survivors: 3072.0K-&gt;5120.OK Heap: 174.8M (200.0M)-&gt;116.3M(200.0M)]
[Times: user=0.00 sys=0.00, real=0.01 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u521D\u59CB\u5316\u6807\u8BB0\u65F6\uFF0Ceden \u533A\u88AB\u6E05\u7A7A\uFF0C\u5E76\u90E8\u5206\u590D\u5236\u5230 survivor \u533A\u3002</p></li><li><p>\u4E00\u6B21\u5E76\u53D1\u7684\u6839\u533A\u57DF\u626B\u63CF\uFF0C\u5E76\u53D1\u626B\u63CF\u8FC7\u7A0B\u4E0D\u80FD\u88AB\u65B0\u751F\u4EE3 GC \u4E2D\u65AD\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1.771: [GC concurrent-root-region-scan-start]
1.772: [GC concurrent-root-region-scan-end, 0.0011676 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6839\u533A\u57DF\u626B\u63CF\u4E0D\u4F1A\u4EA7\u751F\u505C\u987F\u3002</p></li><li><p>\u5E76\u53D1\u6807\u8BB0\uFF0C\u5E76\u53D1\u6807\u8BB0\u53EF\u4EE5\u88AB\u65B0\u751F\u4EE3 GC \u6253\u65AD\uFF0C\u4E0B\u9762\u7684\u65E5\u5FD7\u663E\u793A\u4E86\u4E00\u6B21\u5E76\u53D1\u6807\u8BB0\u88AB 3 \u6B21\u65B0\u751F\u4EE3 GC \u6253\u65AD\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1.772: [GC concurrent-mark-start]
1.793: [GC pause (young), 0.0057816 secs]
...
[Eden: 57.0M(57.0M)-&gt;0.0B(55.0M) Survivors: 5120.0K-&gt;6144.0K Heap: 173.3M(200.0M)-&gt;117.5M(200.0M)]
[Times: user=O.00 sys=0.00, real=0.01 secs]
1.818 : [GC pause (young), 0.0062386 secs]
...
[Eden: 55.0M(55.0M)-&gt;0.0B(55.0M) Survivors: 6144.0K-&gt;5120.0K Heap: 172.5M(200.0M)-&gt;118.2M(200.0M)]
[Times: user=0.00 sys=0.00, real=0.01 secs]
1.842: [GC pause (young), 0.0068966 secs]
...
[Eden: 55.0M(55.0M)-&gt;0.0B(53.0M) Survivors: 5120.0K-&gt;6144.0K Heap: 173.2M(200.0M)-&gt;119.2M(200.0M)]
[Times: user=0.00 sys=0.00, real=0.01 secs]
1.867: [GC pause (young), 0.0067426 secs]
...
[Eden: 53.0M(53.0M)-&gt;0.0B(52.0M) Survivors: 6144.0K-&gt;6144.0K Heap: 172.2M(200.0M)-&gt;120.7M(200.0M)]
[Times: user=0.06 sys=0.00, real=0.01 secs]
1.878: [GC concurrent-mark-end, 0.1055874 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u91CD\u65B0\u6807\u8BB0\uFF0C\u662F\u4F1A\u5F15\u8D77\u5168\u5C40\u505C\u987F\u7684\uFF0C\u5B83\u7684\u65E5\u5FD7\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1.878: [GC remark 1.878: [GC ref-proc, 0.0000447 secs], 0.0015223 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u91CD\u65B0\u6807\u8BB0\u540E\u4F1A\u8FDB\u884C\u72EC\u5360\u6E05\u7406\uFF0C\u72EC\u5360\u6E05\u7406\u4F1A\u91CD\u65B0\u8BA1\u7B97\u5404\u4E2A\u533A\u57DF\u7684\u5B58\u6D3B\u5BF9\u8C61\uFF0C\u5E76\u4EE5\u6B64\u53EF\u4EE5\u5F97\u5230\u6BCF\u4E2A\u533A\u57DF\u8FDB\u884C GC \u7684\u6548\u679C\uFF08\u5373\u56DE\u6536\u6BD4\uFF09\u3002\u5B83\u7684\u65E5\u5FD7\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1.879: [GC cleanup 127M-&gt;127M(200M), 0.0009723 secs]
[Times: user=0.00 sys=0.00r real=0.00 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u5E76\u53D1\u6E05\u7406\uFF0C\u662F\u5E76\u53D1\u6267\u884C\u7684\uFF0C\u5B83\u4F1A\u6839\u636E\u72EC\u5360\u6E05\u7406\u9636\u6BB5\u8BA1\u7B97\u5F97\u51FA\u7684\u6BCF\u4E2A\u533A\u57DF\u7684\u5B58\u6D3B\u5BF9\u8C61\u6570\u91CF\uFF0C\u76F4\u63A5\u56DE\u6536\u5DF2\u7ECF\u4E0D\u5305\u542B\u5B58\u6D3B\u5BF9\u8C61\u7684\u533A\u57DF\u3002\u5B83\u7684\u65E5\u5FD7\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1.498: [GC concurrent-cleanup-start]
1.498: [GC concurrent-cleanup-end, 0.0000073 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="_5-4-4-\u6DF7\u5408\u56DE\u6536" tabindex="-1"><a class="header-anchor" href="#_5-4-4-\u6DF7\u5408\u56DE\u6536" aria-hidden="true">#</a> 5.4.4 \u6DF7\u5408\u56DE\u6536</h3><p>\u5728\u5E76\u53D1\u6807\u8BB0\u5468\u671F\u4E2D\uFF0C\u867D\u7136\u6709\u90E8\u5206\u5BF9\u8C61\u88AB\u56DE\u6536\uFF0C\u4F46\u662F\u603B\u4F53\u4E0A\u8BF4\uFF0C\u56DE\u6536\u7684\u6BD4\u4F8B\u662F\u76F8\u5F53\u4F4E\u7684\u3002\u4F46\u662F\u5728\u5E76\u53D1\u6807\u8BB0\u5468\u671F\u540E\uFF0CG1 \u5DF2\u7ECF\u660E\u786E\u77E5\u9053\u54EA\u4E9B\u533A\u57DF\u542B\u6709\u6BD4\u8F83\u591A\u7684\u5783\u573E\u5BF9\u8C61\uFF0C\u5728\u6DF7\u5408\u56DE\u6536\u9636\u6BB5\u5C31\u53EF\u4EE5\u4E13\u95E8\u9488\u5BF9\u8FD9\u4E9B\u533A\u57DF\u8FDB\u884C\u56DE\u6536\u3002\u5F53\u7136\uFF0CG1 \u4F1A\u4F18\u5148\u56DE\u6536\u5783\u573E\u6BD4\u4F8B\u8F83\u9AD8\u7684\u533A\u57DF\uFF0C\u56E0\u4E3A\u56DE\u6536\u8FD9\u4E9B\u533A\u57DF\u7684\u6027\u4EF7\u6BD4\u4E5F\u6BD4\u8F83\u9AD8\u3002\u8FD9\u4E5F\u6B63\u662F G1 \u540D\u5B57\u7684\u7531\u6765\u3002G1 \u5783\u573E\u56DE\u6536\u5668\u7684\u5168\u79F0\u4E3A Garbage First Garbage Collector\uFF0C\u76F4\u8BD1\u4E3A\u5783\u573E\u4F18\u5148\u7684\u5783\u573E\u56DE\u6536\u5668\uFF0C\u8FD9\u91CC\u7684\u5783\u573E\u4F18\u5148\uFF08Garbage First\uFF09\u6307\u7684\u5C31\u662F\u56DE\u6536\u65F6\u4F18\u5148\u9009\u53D6\u5783\u573E\u6BD4\u4F8B\u6700\u9AD8\u7684\u533A\u57DF\u3002</p><p>\u8FD9\u4E2A\u9636\u6BB5\u53EB\u4F5C\u6DF7\u5408\u56DE\u6536\uFF0C\u662F\u56E0\u4E3A\u5728\u8FD9\u4E2A\u9636\u6BB5\u65E2\u4F1A\u6267\u884C\u6B63\u5E38\u7684\u5E74\u8F7B\u4EE3 GC\uFF0C\u53C8\u4F1A\u9009\u53D6\u4E00\u4E9B\u88AB\u6807\u8BB0\u7684\u8001\u5E74\u4EE3\u533A\u57DF\u8FDB\u884C\u56DE\u6536\uFF0C\u5B83\u540C\u65F6\u5904\u7406\u4E86\u65B0\u751F\u4EE3\u548C\u8001\u5E74\u4EE3\uFF0C\u5982\u56FE5.9 \u6240\u793A\uFF0C\u56E0\u4E3A\u65B0\u751F\u4EE3 GC \u7684\u539F\u56E0\uFF0Ceden \u533A\u5FC5\u7136\u88AB\u6E05\u7A7A\uFF0C\u6B64\u5916\uFF0C\u6709\u4E24\u5757\u88AB\u6807\u8BB0\u4E3A G \u7684\u5783\u573E\u6BD4\u4F8B\u6700\u9AD8\u7684\u533A\u57DF\u88AB\u6E05\u7406\u3002\u88AB\u6E05\u7406\u533A\u57DF\u4E2D\u7684\u5B58\u6D3B\u5BF9\u8C61\u4F1A\u88AB\u79FB\u5230\u5176\u4ED6\u533A\u57DF\uFF0C\u8FD9\u6837\u505A\u7684\u597D\u5904\u662F\u53EF\u4EE5\u51CF\u5C11\u7A7A\u95F4\u788E\u7247\u3002</p><p><img src="`+k+`" alt="\u56FE5-9" loading="lazy"></p><p>\u56FE5.9 G1 \u7684\u6DF7\u5408\u56DE\u6536</p><p>\u6DF7\u5408 GC \u4F1A\u4EA7\u751F\u5982\u4E0B\u65E5\u5FD7\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1.904: [GC pause (mixed), 0.0073135 secs]
...
[Eden: 4096.0K(4096.0K)-&gt;0.0B(53.0M) Survivors: 6144.0K-&gt;2048.0K Heap: 127.3M(200.0M)-&gt;123.6M(200.0M)]
[Times: user=0.00 sys=0.00, real=0.01 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6DF7\u5408 GC \u4F1A\u6267\u884C\u591A\u6B21\uFF0C\u76F4\u5230\u56DE\u6536\u4E86\u8DB3\u591F\u591A\u7684\u5185\u5B58\u7A7A\u95F4\uFF0C\u7136\u540E\u5B83\u4F1A\u89E6\u53D1\u4E00\u6B21\u65B0\u751F\u4EE3 GC\u3002\u65B0\u751F\u4EE3 GC \u540E\uFF0C\u53C8\u53EF\u80FD\u4F1A\u53D1\u751F\u4E00\u6B21\u5E76\u53D1\u6807\u8BB0\u5468\u671F\u7684\u5904\u7406\uFF0C\u6700\u540E\u53C8\u4F1A\u5F15\u8D77\u6DF7\u5408 GC \u7684\u6267\u884C\u3002\u6574\u4E2A\u8FC7\u7A0B\u53EF\u80FD\u5982\u56FE5.10 \u6240\u793A\u3002</p><p><img src="`+x+`" alt="\u56FE5-10" loading="lazy"></p><p>\u56FE5.10 \u6DF7\u5408 GC \u53CA G1 \u6574\u4F53\u793A\u610F\u56FE</p><h3 id="_5-4-5-\u5FC5\u8981\u65F6\u7684-full-gc" tabindex="-1"><a class="header-anchor" href="#_5-4-5-\u5FC5\u8981\u65F6\u7684-full-gc" aria-hidden="true">#</a> 5.4.5 \u5FC5\u8981\u65F6\u7684 Full GC</h3><p>\u548C CMS \u7C7B\u4F3C\uFF0C\u5E76\u53D1\u56DE\u6536\u7531\u4E8E\u8BA9\u5E94\u7528\u7A0B\u5E8F\u548C GC \u7EBF\u7A0B\u4EA4\u66FF\u5DE5\u4F5C\uFF0C\u603B\u662F\u4E0D\u80FD\u5B8C\u5168\u907F\u514D\u5728\u7279\u522B\u7E41\u5FD9\u7684\u573A\u5408\u51FA\u73B0\u5728\u56DE\u6536\u8FC7\u7A0B\u4E2D\u5185\u5B58\u4E0D\u5145\u8DB3\u7684\u60C5\u51B5\u3002\u5F53\u9047\u5230\u8FD9\u79CD\u60C5\u51B5\u65F6\uFF0CG1 \u4E5F\u4F1A\u8F6C\u5165\u4E00\u4E2A Full GC\u3002</p><p>\u3010\u793A\u4F8B 5-1\u3011\u5F53 G1 \u5728\u5E76\u53D1\u6807\u8BB0\u65F6\uFF0C\u7531\u4E8E\u8001\u5E74\u4EE3\u88AB\u5FEB\u901F\u586B\u5145\uFF0CG1 \u4F1A\u7EC8\u6B62\u5E76\u53D1\u6807\u8BB0\u800C\u8F6C\u5165\u4E00\u4E2A Full GC\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>24.909: [GC concurrent-mark-start]
24.909: [Full GC 898M-&gt;896M(900M), 0.7505595 secs]
[Eden: 0.0B(45.0M)-&gt;0.0B(45.0M) Survivors: 0.0B-&gt;0.0B Heap: 898.7M(900.0M)-&gt; 896.2M(900.0M)]
[Times: user=1.05 sys=0.00, real=0.75 secs] 
25.660: [GC concurrent-mark-abort]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6B64\u5916\uFF0C\u5982\u679C\u5728\u6DF7\u5408 GC \u65F6\u7A7A\u95F4\u4E0D\u8DB3\uFF0C\u6216\u8005\u5728\u65B0\u751F\u4EE3 GC \u65F6 survivor \u533A\u548C\u8001\u5E74\u4EE3\u65E0\u6CD5\u5BB9\u7EB3\u5E78\u5B58\u5BF9\u8C61\uFF0C\u90FD\u4F1A\u5BFC\u81F4\u4E00\u6B21 Full GC\u3002</p><h3 id="_5-4-6-g1-\u7684\u65E5\u5FD7" tabindex="-1"><a class="header-anchor" href="#_5-4-6-g1-\u7684\u65E5\u5FD7" aria-hidden="true">#</a> 5.4.6 G1 \u7684\u65E5\u5FD7</h3><p>G1 \u7684\u65E5\u5FD7\u4E0E\u5148\u524D\u7684\u56DE\u6536\u5668\u76F8\u6BD4\u5DF2\u7ECF\u4E30\u5BCC\u4E86\u5F88\u591A\u3002\u5728\u672C\u4E66\u524D\u6587\u4E2D\u5C1A\u672A\u7ED9\u51FA\u5B8C\u6574\u7684 G1 \u65E5\u5FD7\uFF0C\u672C\u8282\u5C06\u7ED9\u51FA\u4E00\u4E2A\u8F83\u4E3A\u5B8C\u6574\u7684\u65E5\u5FD7\uFF0C\u5E76\u505A\u51FA\u89E3\u91CA\u3002</p><p>\u3010\u793A\u4F8B 5-2\u3011\u4EE5\u4E0B\u662F\u4E00\u4E2A\u5B8C\u6574\u7684 G1 \u65B0\u751F\u4EE3\u65E5\u5FD7\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1.619: [GC pause (young) (initial-mark), 0.03848843 secs]
	[Parallel Time: 38.0 ms]
	 [GC Worker Start (ms): 1619.3 1619.3 1619.3 1619.3 Avg: 1619.3, Min: 1619.3, Max: 1619.3, Diff: 0.0]   
     [Ext Root Scanning (ms): 0.3 0.3 0.2 0.2 Avg: 0.3, Min: 0.2, Max: 0.3, Diff: 0.1]  
     [Update RS (ms): 5.7 5.4 28.0 5.3 Avg: 11.1, Min: 5.3, Max: 28.0, Diff: 22.8] 
     [Processed Buffers: 5 4 1 4, Sum: 14, Avg: 3, Min: 1, Max: 5, Diff: 4]    
     [Scan RS (ms): 4.6 5.0 0.0 5.2 Avg: 3.7, Min: 0.0, Max: 5.2, Diff: 5.2]  
     [Object Copy (ms): 27.4 27.3 9.6 27.2 Avg: 22.9, Min: 9.6, Max: 27.4, Diff: 17.7] 
     [Termination (ms): 0.1 0.0 0.0 0.1 Avg:	0.0, Min: 0.0, Max: 0.1, Diff: 0.1]  
     [Termination Attempts: 3 1 10 5 Sum: 19, Avg: 4, Min: 1, Max: 10, Diff: 9]   
     [GC Worker End (ms): 1657.3 1657.2 1657.2 1657.2 Avg: 1657.2, Min :1657.2, Max: 1657.3, Diff: 0.0]                       
     [GC Worker (ms): 38.0 38.0 38.0 38.0 Avg: 38.0, Min: 38.0, Max: 38.0, Diff: 0.1]  
     [GC Worker Other (ms): 0.0 0.1 0.1 0.1 Avg: 0.1, Min: 0.0, Max: 0.1, Diff: 0.1]  
	[Clear CT: 0.0 ms]                                                                                                      
	[Other: 0.4 ms]                                                                                                      
     [Choose CSet: 0.0 ms]                                                    
     [Ref Proc:	0.1 ms]                                                       
     [Ref Enq: 0.0 ms]                                                                                                       
     [Free CSet: 0.1 ms]                                                       
	[Eden: 32M(35M)-&gt;0B(35M) Survivors: 5120K-&gt;5120K Heap: 147M(200M)-&gt;147M(200M)]      
	[Times: user=0.16 sys=0.00, real=0.04 secs]    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><p>\u65E5\u5FD7\u7B2C\u4E00\u884C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1.619: [GC pause (young) (initial-mark), 0.03848843 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8868\u793A\u5728\u5E94\u7528\u7A0B\u5E8F\u5F00\u542F 1.619 \u79D2\u65F6\u53D1\u751F\u4E86\u4E00\u6B21\u65B0\u751F\u4EE3 GC\uFF0C\u8FD9\u662F\u5728\u521D\u59CB\u6807\u8BB0\u65F6\u53D1\u751F\u7684\uFF0C\u8017\u65F6 0.038 \u79D2\uFF0C\u610F\u5473\u7740\u5E94\u7528\u7A0B\u5E8F\u81F3\u5C11\u6682\u505C\u4E86 0.038 \u79D2\u3002</p></li><li><p>\u540E\u7EED\u5E76\u884C\u65F6\u95F4\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Parallel Time: 38.0 ms]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8868\u793A\u6240\u6709 GC \u7EBF\u7A0B\u603B\u7684\u82B1\u8D39\u65F6\u95F4\uFF0C\u8FD9\u91CC\u4E3A 38 \u6BEB\u79D2\u3002</p></li><li><p>\u7ED9\u51FA\u6BCF\u4E00\u4E2A GC \u7EBF\u7A0B\u7684\u6267\u884C\u60C5\u51B5\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[GC Worker Start (ms): 1619.3 1619.3 1619.3 1619.3 Avg: 1619.3, Min: 1619.3, Max: 1619.3, Diff:	0.0]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u8868\u793A\u4E00\u5171 4 \u4E2A GC \u7EBF\u7A0B\uFF08\u56E0\u4E3A\u7B2C\u4E00\u884C\u6709 4 \u4E2A\u6570\u636E\uFF09\uFF0C\u5B83\u4EEC\u90FD\u5728 1619.3 \u79D2\u65F6\u542F\u52A8\u3002\u540C\u65F6\uFF0C\u8FD8\u7ED9\u51FA\u4E86\u8FD9\u51E0\u4E2A\u542F\u52A8\u6570\u636E\u7684\u7EDF\u8BA1\u503C\uFF0C\u5982\u5E73\u5747\uFF08Avg\uFF09\u3001\u6700\u5C0F\uFF08Min\uFF09\u3001\u6700\u5927\uFF08Max\uFF09\u548C\u5DEE\u503C\uFF08Diff\uFF09\u3002Diff \u8868\u793A\u6700\u5927\u503C\u548C\u6700\u5C0F\u503C\u7684\u5DEE\u3002</p></li><li><p>\u7ED9\u51FA\u4E86\u6839\u626B\u63CF\u7684\u8017\u65F6\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Ext Root Scanning (ms): 0.3 0.3 0.2 0.2 Avg: 0.3, Min: 0.2, Max: 0.3, Diff: 0.1]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5728\u6839\u626B\u63CF\u65F6\uFF0C\u6BCF\u4E00\u4E2A GC \u7EBF\u7A0B\u7684\u8017\u65F6\uFF0C\u8FD9\u91CC\u5206\u522B\u6D88\u8017\u4E86 0.3\u30010.3\u30010.2\u30010.2 \u79D2\uFF0C\u540E\u4E00\u884C\u7ED9\u51FA\u4E86\u8FD9\u4E9B\u8017\u65F6\u7684\u7EDF\u8BA1\u6570\u636E\u3002</p></li><li><p>\u7ED9\u51FA\u4E86\u66F4\u65B0\u8BB0\u5FC6\u96C6\uFF08Remembered Set\uFF09\u7684\u8017\u65F6\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Update RS (ms): 5.7 5.4 28.0 5.3 Avg: 11.1, Min: 5.3, Max: 28.0, Diff: 22.8]
[Processed Buffers: 5 4 1 4 Sum: 14, Avg: 3, Min: 1, Max: 5, Diff: 4]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8BB0\u5FC6\u96C6\u662F G1 \u4E2D\u7EF4\u62A4\u7684\u4E00\u4E2A\u6570\u636E\u7ED3\u6784\uFF0C\u7B80\u79F0 RS\u3002\u6BCF\u4E00\u4E2A G1 \u533A\u57DF\u90FD\u6709\u4E00\u4E2A RS \u4E0E\u4E4B\u5173\u8054\u3002\u7531\u4E8E G1 \u56DE\u6536\u65F6\u662F\u6309\u7167\u533A\u57DF\u56DE\u6536\u7684\uFF0C\u6BD4\u5982\u5728\u56DE\u6536\u533A\u57DF A \u7684\u5BF9\u8C61\u65F6\uFF0C\u5F88\u53EF\u80FD\u5E76\u4E0D\u56DE\u6536\u533A\u57DF B \u7684\u5BF9\u8C61\uFF0C\u4E3A\u4E86\u56DE\u6536\u533A\u57DF A \u7684\u5BF9\u8C61\uFF0C\u8981\u626B\u63CF\u533A\u57DF B \u751A\u81F3\u6574\u4E2A\u5806\u6765\u5224\u5B9A\u533A\u57DF A \u4E2D\u54EA\u4E9B\u5BF9\u8C61\u4E0D\u53EF\u8FBE\uFF0C\u8FD9\u6837\u505A\u7684\u4EE3\u4EF7\u663E\u7136\u5F88\u5927\u3002\u56E0\u6B64\uFF0CG1 \u5728\u533A\u57DF A \u7684 RS \u4E2D\uFF0C\u8BB0\u5F55\u4E86\u5728\u533A\u57DF A \u4E2D\u88AB\u5176\u4ED6\u533A\u57DF\u5F15\u7528\u7684\u5BF9\u8C61\uFF0C\u8FD9\u6837\u5728\u56DE\u6536\u533A\u57DF A \u65F6\uFF0C\u53EA\u8981\u5C06 RS \u89C6\u4E3A\u533A\u57DF A \u6839\u96C6\u7684\u4E00\u90E8\u5206\u5373\u53EF\uFF0C\u4ECE\u800C\u907F\u514D\u505A\u6574\u4E2A\u5806\u7684\u626B\u63CF\u3002\u7531\u4E8E\u7CFB\u7EDF\u5728\u8FD0\u884C\u8FC7\u7A0B\u4E2D\uFF0C\u5BF9\u8C61\u4E4B\u95F4\u7684\u5F15\u7528\u5173\u7CFB\u662F\u53EF\u80FD\u65F6\u523B\u53D8\u5316\u7684\uFF0C\u4E3A\u4E86\u66F4\u9AD8\u6548\u5730\u8DDF\u8E2A\u8FD9\u4E9B\u5F15\u7528\u5173\u7CFB\uFF0C\u4F1A\u5C06\u8FD9\u4E9B\u53D8\u5316\u8BB0\u5F55\u5728 Update Buffers \u4E2D\u3002\u8FD9\u91CC\u7684 Processed Buffers \u6307\u7684\u5C31\u662F\u5904\u7406\u8FD9\u4E2A Update Buffers \u6570\u636E\u3002\u8FD9\u91CC\u7ED9\u51FA\u7684 4 \u4E2A\u65F6\u95F4\u4E5F\u662F 4 \u4E2A GC \u7EBF\u7A0B\u7684\u8017\u65F6\uFF0C\u4EE5\u53CA\u5B83\u4EEC\u7684\u7EDF\u8BA1\u6570\u636E\u3002\u4ECE\u8FD9\u4E2A\u65E5\u5FD7\u4E2D\u53EF\u4EE5\u770B\u5230\uFF0C\u66F4\u65B0 RS \u65F6\u5206\u522B\u8017\u65F6 5.7\u30015.4\u300128\u30015.3 \u6BEB\u79D2\uFF0C\u5E73\u5747\u8017\u65F6 11.1 \u6BEB\u79D2\u3002</p></li><li><p>\u626B\u63CF RS \u7684\u65F6\u95F4\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Scan RS (ms): 4.6 5.0 0.0 5.2 Avg: 3.7, Min: 0.0, Max: 5.2, Diff: 5.2]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u5728\u6B63\u5F0F\u56DE\u6536\u65F6\uFF0CG1 \u4F1A\u5BF9\u88AB\u56DE\u6536\u533A\u57DF\u7684\u5BF9\u8C61\u8FDB\u884C\u758F\u6563\uFF0C\u5373\u5C06\u5B58\u6D3B\u5BF9\u8C61\u653E\u7F6E\u5728\u5176\u4ED6\u533A\u57DF\u4E2D\uFF0C\u56E0\u6B64\u9700\u8981\u8FDB\u884C\u5BF9\u8C61\u7684\u590D\u5236\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Object Copy (ms): 27.4 27.3 9.6 27.2 Avg: 22.9, Min: 9.6, Max: 27.4, Diff: 17.7]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u7ED9\u51FA\u7684 Object Copy \u5C31\u662F\u8FDB\u884C\u5BF9\u8C61\u8D4B\u503C\u7684\u8017\u65F6\u3002</p></li><li><p>\u7ED9\u51FA GC \u5DE5\u4F5C\u7EBF\u7A0B\u7684\u7EC8\u6B62\u4FE1\u606F\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Termination (ms): 0.1 0.0 0.0 0.1 Avg: 0.0, Min: 0.0, Max: 0.1, Diff: 0.1]
[Termination Attempts: 3 1 10 5 Sum: 19, Avg: 4, Min: 1, Max: 10, Diff: 9]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u7684\u7EC8\u6B62\u65F6\u95F4\u662F\u7EBF\u7A0B\u82B1\u5728\u7EC8\u6B62\u9636\u6BB5\u7684\u8017\u65F6\u3002\u5728 GC \u7EBF\u7A0B\u7EC8\u6B62\u524D\uFF0C\u5B83\u4EEC\u4F1A\u68C0\u67E5\u5176\u4ED6 GC \u7EBF\u7A0B\u7684\u5DE5\u4F5C\u961F\u5217\uFF0C\u67E5\u770B\u662F\u5426\u4ECD\u7136\u8FD8\u6709\u5BF9\u8C61\u5F15\u7528\u6CA1\u6709\u5904\u7406\u5B8C\uFF0C\u5982\u679C\u5176\u4ED6\u7EBF\u7A0B\u4ECD\u7136\u6709\u6CA1\u6709\u5904\u7406\u5B8C\u7684\u6570\u636E\uFF0C\u8BF7\u6C42\u7EC8\u6B62\u7684 GC \u7EBF\u7A0B\u5C31\u4F1A\u5E2E\u52A9\u5B83\u5C3D\u5FEB\u5B8C\u6210\uFF0C\u968F\u540E\u518D\u5C1D\u8BD5\u7EC8\u6B62\u3002\u5176\u4E2D Termination Attempts \u5C55\u793A\u4E86\u6BCF\u4E00\u4E2A\u5DE5\u4F5C\u7EBF\u7A0B\u5C1D\u8BD5\u7EC8\u6B62\u7684\u6B21\u6570\u3002</p></li><li><p>\u663E\u793A GC \u5DE5\u4F5C\u7EBF\u7A0B\u7684\u5B8C\u6210\u65F6\u95F4\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[GC Worker End (ms): 1657.3 1657.2 1657.2 1657.2 Avg: 1657.2, Min: 1657.2, Max: 1657.3, Diff: 0.0]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u663E\u793A\u4E86\u5728\u7CFB\u7EDF\u8FD0\u884C\u540E 1657 \u6BEB\u79D2\uFF0C\u8FD9\u51E0\u4E2A\u7EBF\u7A0B\u90FD\u7EC8\u6B62\u4E86\u3002</p></li><li><p>\u663E\u793A\u51E0\u4E2A GC \u5DE5\u4F5C\u7EBF\u7A0B\u7684\u5B58\u6D3B\u65F6\u95F4\uFF0C\u5355\u4F4D\u662F\u6BEB\u79D2\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[GC Worker (ms) : 38.0 38.0 38.0 38.0 Avg: 38.0, Min: 38.0, Max: 38.0, Diff: 0.1]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u663E\u793A GC \u7EBF\u7A0B\u82B1\u8D39\u5728\u5176\u4ED6\u4EFB\u52A1\u4E2D\u7684\u8017\u65F6\uFF0C\u5355\u4F4D\u662F\u6BEB\u79D2\uFF0C\u53EF\u4EE5\u770B\u5230\u8FD9\u90E8\u5206\u65F6\u95F4\u975E\u5E38\u5C11\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[GC Worker Other (ms) : 0.0 0.1 0.1 0.1 Avg: 0.1, Min: 0.0, Max: 0.1, Diff:	0.1]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u663E\u793A\u6E05\u7A7A CardTable \u7684\u65F6\u95F4\uFF0CRS \u5C31\u662F\u4F9D\u9760 CardTable \u6765\u8BB0\u5F55\u54EA\u4E9B\u662F\u5B58\u6D3B\u5BF9\u8C61\u7684\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Clear CT:	0.0 ms]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u663E\u793A\u5176\u4ED6\u51E0\u4E2A\u4EFB\u52A1\u7684\u8017\u65F6\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Other:	0.4 ms]
[Choose CSet: 0.0 ms]
[Ref Proc: 0.1 ms]
[Ref Enq: 0.0 ms]
[Free CSet:	0.1 ms]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6BD4\u5982\u9009\u62E9 CSet\uFF08Collection Sets\uFF09\u7684\u65F6\u95F4\u3001Ref Proc\uFF08\u5904\u7406\u5F31\u5F15\u7528\u3001\u8F6F\u5F15\u7528\u7684\u65F6\u95F4\uFF09\u3001Ref Enq\uFF08\u5F31\u5F15\u7528\u3001\u8F6F\u5F15\u7528\u5165\u961F\u65F6\u95F4\uFF09\u548C Free CSet\uFF08\u91CA\u653E\u88AB\u56DE\u6536\u7684 CSet \u4E2D\u533A\u57DF\u7684\u65F6\u95F4\uFF0C\u5305\u62EC\u5B83\u4EEC\u7684 RS\uFF09\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1ACollection Sets \u8868\u793A\u88AB\u9009\u53D6\u7684\u3001\u5C06\u8981\u88AB\u56DE\u6536\u7684\u533A\u57DF\u7684\u96C6\u5408\u3002</p></li><li><p>\u663E\u793A\u6BD4\u8F83\u719F\u6089\u7684 GC \u56DE\u6536\u7684\u6574\u4F53\u60C5\u51B5\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Eden: 32M(35M)-&gt;0B(35M) Survivors: 5120K-&gt;5120K Heap: 147M(200M)-&gt;147M(200M)] 
[Times: user=0.16 sys=0.00, real=0.04 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u663E\u793A\u4E86 eden \u533A\u4E00\u5171 32MB \u88AB\u6E05\u7A7A\uFF0Csurvivor \u533A\u6CA1\u6709\u91CA\u653E\u5BF9\u8C61\uFF0C\u6574\u4E2A\u5806\u7A7A\u95F4\u6CA1\u6709\u91CA\u653E\u7A7A\u95F4\u3002\u7528\u6237 CPU \u8017\u65F6 0.16 \u79D2\uFF0C\u5B9E\u9645\u8017\u65F6 0.04 \u79D2\u3002</p></li></ol><h3 id="_5-4-7-g1-\u76F8\u5173\u7684\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#_5-4-7-g1-\u76F8\u5173\u7684\u53C2\u6570" aria-hidden="true">#</a> 5.4.7 G1 \u76F8\u5173\u7684\u53C2\u6570</h3><p>\u5BF9\u4E8E G1\uFF0C\u53EF\u4EE5\u4F7F\u7528 -XX:+UseG1GC \u6807\u8BB0\u6253\u5F00 G1 \u7684\u5F00\u5173\uFF0C\u5BF9 G1 \u8FDB\u884C\u8BBE\u7F6E\u65F6\uFF0C\u6700\u91CD\u8981\u7684\u4E00\u4E2A\u53C2\u6570\u5C31\u662F -XX:MaxGCPauseMillis\uFF0C\u5B83\u7528\u4E8E\u6307\u5B9A\u76EE\u6807\u6700\u5927\u505C\u987F\u65F6\u95F4\u3002\u5982\u679C\u4EFB\u4F55\u4E00\u6B21\u505C\u987F\u8D85\u8FC7\u8FD9\u4E2A\u8BBE\u7F6E\u503C\uFF0CG1 \u5C31\u4F1A\u5C1D\u8BD5\u8C03\u6574\u65B0\u751F\u4EE3\u548C\u8001\u5E74\u4EE3\u7684\u6BD4\u4F8B\u3001\u8C03\u6574\u5806\u5927\u5C0F\u3001\u8C03\u6574\u664B\u5347\u5E74\u9F84\u7B49\uFF0C\u8BD5\u56FE\u8FBE\u5230\u9884\u8BBE\u76EE\u6807\u3002\u5BF9\u4E8E\u6027\u80FD\u8C03\u4F18\u6765\u8BF4\uFF0C\u6709\u65F6\u5019\u603B\u662F\u9C7C\u548C\u718A\u638C\u4E0D\u53EF\u517C\u5F97\uFF0C\u5982\u679C\u505C\u987F\u65F6\u95F4\u7F29\u77ED\uFF0C\u5BF9\u4E8E\u65B0\u751F\u4EE3\u6765\u8BF4\uFF0C\u8FD9\u610F\u5473\u7740\u5F88\u53EF\u80FD\u8981\u589E\u52A0\u65B0\u751F\u4EE3 GC \u7684\u6B21\u6570\u3002\u5BF9\u4E8E\u8001\u5E74\u4EE3\u6765\u8BF4\uFF0C\u4E3A\u4E86\u83B7\u5F97\u66F4\u77ED\u7684\u505C\u987F\u65F6\u95F4\uFF0C\u5728\u6DF7\u5408 GC \u65F6\uFF0C\u4E00\u6B21\u6536\u96C6\u7684\u533A\u57DF\u6570\u91CF\u4E5F\u4F1A\u53D8\u5C11\uFF0C\u8FD9\u6837\u65E0\u7591\u589E\u52A0\u4E86\u8FDB\u884C Full GC \u7684\u53EF\u80FD\u6027\u3002</p><p>\u53E6\u5916\u4E00\u4E2A\u91CD\u8981\u7684\u53C2\u6570\u662F -XX:ParallelGCThreads\uFF0C\u5B83\u7528\u4E8E\u8BBE\u7F6E\u5E76\u884C\u56DE\u6536\u65F6 GC \u7684\u5DE5\u4F5C\u7EBF\u7A0B\u6570\u91CF\u3002</p><p>\u6B64\u5916\uFF0C-XX:InitiatingHeapOccupancyPercent \u53C2\u6570\u53EF\u4EE5\u6307\u5B9A\u5F53\u6574\u4E2A\u5806\u4F7F\u7528\u7387\u8FBE\u5230\u591A\u5C11\u65F6\uFF0C\u89E6\u53D1\u5E76\u53D1\u6807\u8BB0\u5468\u671F\u7684\u6267\u884C\u3002\u9ED8\u8BA4\u503C\u662F 45\uFF0C\u5373\u5F53\u6574\u4E2A\u5806\u7684\u5360\u7528\u7387\u8FBE\u5230 45% \u65F6\uFF0C\u6267\u884C\u5E76\u53D1\u6807\u8BB0\u5468\u671F\u3002InitiatingHeapOccupancyPercent \u4E00\u65E6\u8BBE\u7F6E\uFF0C\u59CB\u7EC8\u90FD\u4E0D\u4F1A\u88AB G1 \u4FEE\u6539\uFF0C\u8FD9\u610F\u5473\u7740 G1 \u4E0D\u4F1A\u8BD5\u56FE\u6539\u53D8\u8FD9\u4E2A\u503C\u6765\u6EE1\u8DB3 MaxGCPauseMillis \u7684\u76EE\u6807\u3002\u5982\u679C InitiatingHeapOccupancyPercent \u503C\u8BBE\u7F6E\u5F97\u504F\u5927\uFF0C\u4F1A\u5BFC\u81F4\u5E76\u53D1\u5468\u671F\u8FDF\u8FDF\u5F97\u4E0D\u5230\u542F\u52A8\uFF0C\u90A3\u4E48\u5F15\u8D77 Full GC \u7684\u53EF\u80FD\u6027\u4E5F\u5927\u5927\u589E\u52A0\uFF0C\u53CD\u4E4B\uFF0C\u4E00\u4E2A\u8FC7\u5C0F\u7684 InitiatingHeapOccupancyPercent \u503C\u4F1A\u4F7F\u5F97\u5E76\u53D1\u6807\u8BB0\u5468\u671F\u6267\u884C\u975E\u5E38\u9891\u7E41\uFF0C\u5927\u91CF GC \u7EBF\u7A0B\u62A2\u5360 CPU\uFF0C\u5BFC\u81F4\u5E94\u7528\u7A0B\u5E8F\u7684\u6027\u80FD\u6709\u6240\u4E0B\u964D\u3002</p><h2 id="_5-5-\u56DE\u7738-\u6709\u5173\u5BF9\u8C61\u5185\u5B58\u5206\u914D\u548C\u56DE\u6536\u7684\u4E00\u4E9B\u7EC6\u8282\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_5-5-\u56DE\u7738-\u6709\u5173\u5BF9\u8C61\u5185\u5B58\u5206\u914D\u548C\u56DE\u6536\u7684\u4E00\u4E9B\u7EC6\u8282\u95EE\u9898" aria-hidden="true">#</a> 5.5 \u56DE\u7738\uFF1A\u6709\u5173\u5BF9\u8C61\u5185\u5B58\u5206\u914D\u548C\u56DE\u6536\u7684\u4E00\u4E9B\u7EC6\u8282\u95EE\u9898</h2><p>\u901A\u8FC7\u524D\u9762\u7684\u5B66\u4E60\uFF0C\u8BFB\u8005\u5E94\u8BE5\u5DF2\u7ECF\u5BF9\u5DF2\u6709\u7684\u5783\u573E\u56DE\u6536\u7B97\u6CD5\u548C\u5177\u4F53\u7684\u5783\u573E\u56DE\u6536\u5668\u53CA\u5176\u4F7F\u7528\u6709\u4E86\u4E00\u5B9A\u7684\u4E86\u89E3\u3002\u672C\u8282\u6765\u8BA8\u8BBA\u4E00\u4E9B\u6709\u8DA3\u7684\u95EE\u9898\uFF0C\u66F4\u8FDB\u4E00\u6B65\u63A2\u8BA8\u5BF9\u8C61\u5728\u5185\u5B58\u4E2D\u7684\u5206\u914D\u53CA\u56DE\u6536\u65B9\u5F0F\u3002</p><h3 id="_5-5-1-\u7981\u7528-system-gc" tabindex="-1"><a class="header-anchor" href="#_5-5-1-\u7981\u7528-system-gc" aria-hidden="true">#</a> 5.5.1 \u7981\u7528 System.gc()</h3><p>\u5728\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0CSystem.gc() \u4F1A\u663E\u5F0F\u76F4\u63A5\u89E6\u53D1 Full GC\uFF0C\u540C\u65F6\u5BF9\u8001\u5E74\u4EE3\u548C\u65B0\u751F\u4EE3\u8FDB\u884C\u56DE\u6536\u3002\u800C\u4E00\u822C\u60C5\u51B5\u4E0B\uFF0C\u6211\u4EEC\u8BA4\u4E3A\u5783\u573E\u56DE\u6536\u5E94\u8BE5\u662F\u81EA\u52A8\u8FDB\u884C\u7684\uFF0C\u65E0\u987B\u624B\u5DE5\u89E6\u53D1\u3002\u5982\u679C\u8FC7\u4E8E\u9891\u7E41\u5730\u89E6\u53D1\u5783\u573E\u56DE\u6536\u5BF9\u7CFB\u7EDF\u6027\u80FD\u662F\u6CA1\u6709\u597D\u5904\u7684\u3002\u56E0\u6B64\u865A\u62DF\u673A\u63D0\u4F9B\u4E86\u4E00\u4E2A\u53C2\u6570 DisableExplicitGC \u6765\u63A7\u5236\u662F\u5426\u624B\u5DE5\u89E6\u53D1 GC\u3002</p><p>System.gc() \u7684\u5B9E\u73B0\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Runtime.gc() \u662F\u4E00\u4E2A native \u65B9\u6CD5\uFF0C\u6700\u7EC8\u5728 jvm.cpp \u4E2D\u5B9E\u73B0\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-c++ ext-c++ line-numbers-mode"><pre class="language-c++"><code>JVM_ENTRY_NO_ENV(void, JVM_GC(void))
    JVMWrapper(&quot;JVM_GC&quot;);
if (!DisableExplicitGC) {
    Universe::heap() -&gt; collect(GCCause::_java_lang_system_gc);
}
JVM_END
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u5982\u679C\u8BBE\u7F6E\u4E86 -XX:-+DisableExplicitGC\uFF0C\u6761\u4EF6\u5224\u65AD\u5C31\u65E0\u6CD5\u6210\u7ACB\uFF0C\u90A3\u4E48\u5C31\u4F1A\u7981\u7528\u663E\u5F0F GC\uFF0CSystem.gc() \u7B49\u4EF7\u4E8E\u4E00\u4E2A\u7A7A\u51FD\u6570\u8C03\u7528\u3002</p><h3 id="_5-5-2-system-gc-\u4F7F\u7528\u5E76\u53D1\u56DE\u6536" tabindex="-1"><a class="header-anchor" href="#_5-5-2-system-gc-\u4F7F\u7528\u5E76\u53D1\u56DE\u6536" aria-hidden="true">#</a> 5.5.2 System.gc() \u4F7F\u7528\u5E76\u53D1\u56DE\u6536</h3><p>\u5728\u9ED8\u8BA4\u7684\u60C5\u51B5\u4E0B\uFF0C\u5373\u4F7F System.gc() \u751F\u6548\uFF0C\u4F1A\u4F7F\u7528\u4F20\u7EDF\u7684 Full GC \u65B9\u5F0F\u56DE\u6536\u6574\u4E2A\u5806\uFF0C\u800C\u5FFD\u7565\u53C2\u6570\u4E2D\u7684 UseG1GC \u548C UseConcMarkSweepGC\u3002\u6BD4\u5982\u4F7F\u7528\u4EE5\u4E0B\u53C2\u6570\u8FD0\u884C\u7A0B\u5E8F\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-XX:+PrintGCDetails -XX:+UseConcMarkSweepGC
// \u6216\u8005
-XX:+PrintGCDetails -XX:+UseG1GC
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u9047\u5230 System.gc() \u7684\u65F6\u5019\uFF0C\u5219\u4F1A\u6709\u4EE5\u4E0B\u65E5\u5FD7\u8F93\u51FA\u3002</p><p>\u5BF9\u4E8E CMS\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Full GC[CMS: 454K-&gt;453K(10944K), 0.0046875 secs] 544K-&gt;453K(15936K), [CMS Perm: 1593K-&gt;1593K(12288K)], 0.0047210 secs] [Times: user=0.02 sys=0.00, real=0.01 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5BF9\u4E8E G1\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Full GC 616K-&gt;453K(5120K), 0.0049140 secs]
[Eden: 1024.0K(7168.0K)-&gt;0.0B(2048.0K) Survivors: 0.0B-&gt;0.0B Heap: 616.5K (16.0M)-&gt;453.4K(5120.0K)]
[Times: user=0.01 sys=0.00, real=0.00 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u663E\u7136\uFF0C\u6B64\u65F6 CMS \u548C G1\u662F\u6CA1\u6709\u5E76\u53D1\u6267\u884C\u7684\uFF0C\u56E0\u4E3A\u5728\u65E5\u5FD7\u4E2D\u6CA1\u6709\u4EFB\u4F55\u5E76\u53D1\u76F8\u5173\u7684\u4FE1\u606F\u3002\u6253\u5F00\u865A\u62DF\u673A\u53C2\u6570 -XX:+ExplicitGCInvokesConcurrent \u540E\uFF0C\u53EF\u4EE5\u6539\u53D8\u8FD9\u79CD\u9ED8\u8BA4\u7684\u884C\u4E3A\uFF0C\u6BD4\u5982\u4F7F\u7528\u4EE5\u4E0B\u53C2\u6570\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-XX:+PrintGCDetails -XX:+UseConcMarkSweepGC -XX:+ExplicitGCInvokesConcurrent
// \u6216\u8005
-XX:+PrintGCDetails -XX:+UseGlGC -XX:+ExplicitGCInvokesConcurrent
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5BF9\u4E8E CMS\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    [GC[ParNew: 620K-&gt;462K(4928K), 0.0012471 secs] 620K-&gt;462K(15872K), 0.0012948 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
    [GC [1 CMS-initial-mark: 0K(10944K)] 462K(15872K), 0.0004039 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
    [CMS-concurrent-mark: 0.006/0.006 secs] [Times: user=0.01 sys=0.00, real=0.01 secs] 
    [CMS-concurrent-preclean: 0.000/0.000 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
    [GC[YG occupancy: 550K(4928K)][Rescan (parallel), 0.0002013 secs][weak refs processing, 0.0000060 secs] [scrub string table, 0.0000209 secs] [1 CMS-remark: 0K(10944K)] 550K(15872K), 0.0002639 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
    [CMS-concurrent-sweep: 0.000/0.000 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5BF9\u4E8E G1\uFF08\u7701\u7565\u90E8\u5206\u8F93\u51FA\uFF09\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[GC pause (young) (initial-mark), 0.0013322 secs]
[Parallel Time: 1.1 ms, GC Workers: 2]
[Eden: 1024.0K(7168.0K)-&gt;0.0B(5120.0K) Survivors: 0.0B-&gt;1024.0K Heap: 616.5K(16.0M)-&gt;476.1K(16.0M)]
[Times: user=0.00 sys=0.00, real=0.00 secs]
[GC concurrent-root-region-scan-start]
[GC concurrent-root-region-scan-end, 0.0003496 secs]
[GC concurrent-mark-start]
[GC concurrent-mark-end, 0.0000331 secs]
[GC remark [GC ref-proc, 0.0000142 secs], 0.0003168 secs]
[Times: user=0.00 sys=0.00, real=0.00 secs]
[GC cleanup 517K-&gt;517K(16M), 0.0000742 secs]
[Times: user=0.00 sys=0.00, real=0.00 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u53EA\u6709\u5728\u6253\u5F00 ExplicitGCInvokesConcurrent \u5F00\u5173\u540E\uFF0CSystem.gc() \u8FD9\u79CD\u663E\u5F0F GC \u624D\u4F1A\u4F7F\u7528\u5E76\u53D1\u7684\u65B9\u5F0F\u8FDB\u884C\u56DE\u6536\uFF0C\u5426\u5219\uFF0C\u65E0\u8BBA\u662F\u5426\u542F\u7528\u4E86 CMS \u6216\u8005 G1\uFF0C\u90FD\u4E0D\u4F1A\u8FDB\u884C\u5E76\u53D1\u56DE\u6536\u3002</p><h3 id="_5-5-3-\u5E76\u884C-gc-\u524D\u989D\u5916\u89E6\u53D1\u7684\u65B0\u751F\u4EE3-gc" tabindex="-1"><a class="header-anchor" href="#_5-5-3-\u5E76\u884C-gc-\u524D\u989D\u5916\u89E6\u53D1\u7684\u65B0\u751F\u4EE3-gc" aria-hidden="true">#</a> 5.5.3 \u5E76\u884C GC \u524D\u989D\u5916\u89E6\u53D1\u7684\u65B0\u751F\u4EE3 GC</h3><p>\u5BF9\u4E8E\u5E76\u884C\u56DE\u6536\u5668\u7684 Full GC\uFF08\u4F7F\u7528 UseParallelOldGC \u6216\u8005 UseParallelGC\uFF09\uFF0C\u7EC6\u5FC3\u7684\u8BFB\u8005\u53EF\u80FD\u4F1A\u53D1\u73B0\uFF0C\u5728\u6BCF\u4E00\u6B21 FullGC \u4E4B\u524D\u90FD\u4F1A\u4F34\u968F\u4E00\u6B21\u65B0\u751F\u4EE3 GC\u3002\u8FD9\u548C\u4E32\u884C\u56DE\u6536\u5668\u76F8\u6BD4\uFF0C\u6709\u5F88\u5927\u7684\u4E0D\u540C\u3002</p><p>\u3010\u793A\u4F8B 5-3\u3011\u4E0B\u9762\u7ED9\u51FA\u4E00\u4E2A\u7B80\u5355\u7684\u6BD4\u8F83\u793A\u4F8B\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScavengeBeforeFullGC</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u53EA\u662F\u8FDB\u884C\u4E86\u4E00\u6B21\u7B80\u5355\u7684 Full GC\u3002\u4F7F\u7528\u4EE5\u4E0B\u53C2\u6570\uFF0C\u8BBE\u7F6E\u4E3A\u4E32\u884C\u56DE\u6536\u5668\u8FD0\u884C\u4EE3\u7801\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-XX:+PrintGCDetails -XX:+UseSerialGC
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u7CFB\u7EDF\u8FDB\u884C\u7684 GC \u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Full GC[Tenured: 0K-&gt;376K(10944K), 0.0033328 secs] 603K-&gt;376K(15872K), [Perm: 142K-&gt;142K(12288K)], 0.0033825 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4E00\u5207\u90FD\u5728\u610F\u6599\u4E4B\u4E2D\uFF0CSystem.gc() \u89E6\u53D1\u4E86\u4E00\u6B21 Full GC\u3002\u5207\u6362\u4E3A\u5E76\u884C\u56DE\u6536\u5668\uFF0C\u518D\u5C1D\u8BD5\u540C\u6837\u7684\u64CD\u4F5C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-XX:+PrintGCDetails -XX:+UseParallelOldGC
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8F93\u51FA\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    [GC [PSYoungGen: 670K-&gt;480K(5120K)] 670K-&gt;480K(15872K), 0.0153729 secs] [Times: user=0.02 sys=0.00, real=0.02 secs]
    [Full GC [PSYoungGen: 480K-&gt;0K(5120K)] [ParOldGen: 0K-&gt;453K(10752K)] 480K-&gt;453K(15872K) [PSPermGen: 1592K-&gt;1591K(12288K)], 0.0073608 secs] [Times: user=0.00 sys=0.00, real=0.01 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u5728\u4F7F\u7528\u5E76\u884C\u56DE\u6536\u5668\u65F6\uFF0C\u89E6\u53D1 FullGC \u4E4B\u524D\uFF0C\u8FDB\u884C\u4E86\u4E00\u6B21\u65B0\u751F\u4EE3 GC\u3002\u56E0\u6B64\uFF0C\u8FD9\u91CC\u7684 System.gc() \u5B9E\u9645\u4E0A\u89E6\u53D1\u4E86\u4E24\u6B21 GC\u3002\u8FD9\u6837\u505A\u7684\u76EE\u7684\u662F\u5148\u5C06\u65B0\u751F\u4EE3\u8FDB\u884C\u4E00\u6B21\u56DE\u6536\uFF0C\u907F\u514D\u5C06\u6240\u6709\u56DE\u6536\u5DE5\u4F5C\u540C\u65F6\u4EA4\u7ED9\u4E00\u6B21 Full GC \u8FDB\u884C\uFF0C\u4ECE\u800C\u5C3D\u53EF\u80FD\u5730\u7F29\u77ED\u4E00\u6B21\u505C\u987F\u65F6\u95F4\u3002</p><p>\u5982\u679C\u4E0D\u9700\u8981\u8FD9\u4E2A\u7279\u6027\uFF0C\u90A3\u4E48\u53EF\u4EE5\u4F7F\u7528\u53C2\u6570 -XX:-ScavengeBeforeFullGC \u53BB\u9664\u53D1\u751F\u5728 Full GC \u4E4B\u524D\u7684\u90A3\u6B21\u65B0\u751F\u4EE3 GC\u3002\u5728\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0CScavengeBeforeFullGC \u7684\u503C\u4E3A true\u3002</p><h3 id="_5-5-4-\u5BF9\u8C61\u4F55\u65F6\u8FDB\u5165\u8001\u5E74\u4EE3" tabindex="-1"><a class="header-anchor" href="#_5-5-4-\u5BF9\u8C61\u4F55\u65F6\u8FDB\u5165\u8001\u5E74\u4EE3" aria-hidden="true">#</a> 5.5.4 \u5BF9\u8C61\u4F55\u65F6\u8FDB\u5165\u8001\u5E74\u4EE3</h3><p>\u5BF9\u4E8E\u4E00\u822C\u60C5\u51B5\u800C\u8A00\uFF0C\u5F53\u5BF9\u8C61\u9996\u6B21\u521B\u5EFA\u65F6\uFF0C\u4F1A\u88AB\u653E\u7F6E\u5728\u65B0\u751F\u4EE3\u7684 eden \u533A\u3002\u4E3A\u4EC0\u4E48\u53D6\u540D\u53EB eden \u5462\uFF1Feden \u662F \u201C\u4F0A\u7538\u56ED\u201D \u7684\u610F\u601D\u3002\u6839\u636E\u5723\u7ECF\u7684\u8BB0\u8F7D\uFF0C\u4E9A\u5F53\u548C\u590F\u5A03\u5C31\u4F4F\u5728\u4F0A\u7538\u56ED\uFF0C\u90A3\u4E5F\u662F\u4EBA\u7C7B\u5F00\u59CB\u5C45\u4F4F\u7684\u5730\u65B9\u3002\u8FD9\u91CC\u6CBF\u7528\u4F0A\u7538\u56ED\u7684\u540D\u5B57\u4E5F\u5C31\u662F\u8FD9\u4E2A\u610F\u601D\u3002\u5728\u5806\u4E2D\u5206\u914D\u7684\u5BF9\u8C61\u9996\u5148\u4F1A\u88AB\u5B89\u7F6E\u5728 eden \u533A\u3002\u5982\u679C\u6CA1\u6709 GC \u7684\u4ECB\u5165\uFF0C\u90A3\u4E48\u8FD9\u4E9B\u5BF9\u8C61\u4E0D\u4F1A\u79BB\u5F00 eden \u533A\u3002</p><ol><li><p>\u521D\u521B\u7684\u5BF9\u8C61\u5728 eden \u533A</p><p>\u3010\u793A\u4F8B 5-4\u3011\u4E0B\u9762\u7684\u4EE3\u7801\u7533\u8BF7\u4E86\u5927\u7EA6 5MB \u5185\u5B58\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AllocEden</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _1K <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token operator">*</span> _1K<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>_1K<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u7528\u5982\u4E0B\u53C2\u6570\u8FD0\u884C\u4E0A\u9762\u7684\u4EE3\u7801\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-Xmx64M -Xms64M -XX:+PrintGCDetails
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5F97\u5230\u8F93\u51FA\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Heap
def new generation total 19648K, used 6321K [0x30460000, 0x319b0000, 0x319b0000)
eden space 17472K, 36% used [0x30460000, 0x30a8c500, 0x31570000)
from space 2176K, 0% used [0x31570000, 0x31570000, 0x31790000)
to space 2176K, 0% used [0x31790000, 0x31790000, 0x319b0000)
tenured generation total 43712K, used 0K [0x319b0000, 0x34460000, 0x34460000)
the space 43712K, 0% used [0x319b0000, 0x319b0000, 0x319b0200, 0x34460000)
compacting perm gen total 12288K, used 142K [0x34460000, 0x35060000, 0x38460000)
the space 12288K, 1% used [0x34460000, 0x34483a88, 0x34483c00, 0x35060000)
ro space 10240K, 44% used [0x38460000, 0x388d73f0, 0x388d7400, 0x38e60000)
rw space 12288K, 52% used [0x38e60000, 0x394add28, 0x394ade00, 0x39a60000)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u5728\u6574\u4E2A\u8FC7\u7A0B\u4E2D\u6CA1\u6709 GC \u53D1\u751F\uFF0C\u5206\u914D\u7684 5MB \u6570\u636E\u90FD\u5E94\u8BE5\u5728\u5806\u4E2D\uFF0C\u4ECE\u5806\u7684\u65E5\u5FD7\u4E2D\u53EF\u4EE5\u770B\u5230\uFF0Ceden \u533A\u5360\u636E\u4E86 6MB \u5DE6\u53F3\u7684\u7A7A\u95F4\uFF0Cfrom\u3001to \u548C\u8001\u5E74\u4EE3 tenured \u5747\u672A\u88AB\u4F7F\u7528\u3002</p></li><li><p>\u8001\u5E74\u5BF9\u8C61\u8FDB\u5165\u8001\u5E74\u4EE3</p><p>eden \u533A\u4E2D\u7684\u5BF9\u8C61\u4F55\u65F6\u80FD\u8FDB\u5165\u8001\u5E74\u4EE3\u5462\uFF1F\u4E00\u822C\u6765\u8BF4\uFF0C\u5F53\u5BF9\u8C61\u7684\u5E74\u9F84\u8FBE\u5230\u4E00\u5B9A\u7684\u5927\u5C0F\uFF0C\u5C31\u81EA\u7136\u53EF\u4EE5\u79BB\u5F00\u5E74\u8F7B\u4EE3\uFF0C\u8FDB\u5165\u8001\u5E74\u4EE3\u3002\u4E00\u822C\u628A\u5BF9\u8C61\u8FDB\u5165\u8001\u5E74\u4EE3\u7684\u4E8B\u4EF6\uFF0C\u79F0\u4E3A \u201C\u664B\u5347\u201D\u3002\u5BF9\u8C61\u7684\u5E74\u9F84\u662F\u7531\u5BF9\u8C61\u7ECF\u5386\u8FC7\u7684 GC \u6B21\u6570\u51B3\u5B9A\u7684\u3002\u5728\u65B0\u751F\u4EE3\u4E2D\u7684\u5BF9\u8C61\u6BCF\u7ECF\u5386\u4E00\u6B21 GC\uFF0C\u5982\u679C\u5B83\u6CA1\u6709\u88AB\u56DE\u6536\uFF0C\u5B83\u7684\u5E74\u9F84\u5C31\u52A0 1\u3002\u865A\u62DF\u673A\u63D0\u4F9B\u4E86\u4E00\u4E2A\u53C2\u6570\u6765\u63A7\u5236\u65B0\u751F\u4EE3\u5BF9\u8C61\u7684\u6700\u5927\u5E74\u9F84\uFF1AMaxTenuringThreshold\u3002\u5728\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u8FD9\u4E2A\u53C2\u6570\u7684\u503C\u4E3A 15\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C\u65B0\u751F\u4EE3\u7684\u5BF9\u8C61\u6700\u591A\u7ECF\u5386 15 \u6B21 GC\uFF0C\u5C31\u53EF\u4EE5\u664B\u5347\u5230\u8001\u5E74\u4EE3\u3002</p><p>\u3010\u793A\u4F8B 5-5\u3011\u4FEE\u6539\u4E0A\u4F8B\u4E2D\u7684\u4EE3\u7801\uFF0C\u4F7F\u4E4B\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MaxTenuringThreshold</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _1M <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _1K <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token operator">*</span> _1K<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>_1K<span class="token punctuation">]</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token number">17</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">270</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> g <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>_1M<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u4F9D\u7136\u7533\u8BF7\u4E86\u5927\u7EA6 5MB \u7A7A\u95F4\uFF0C\u4E0D\u540C\u7684\u662F\uFF0C\u5728\u4EE3\u7801\u7B2C 8 \u884C\u5C06\u65B0\u751F\u6210\u7684 byte \u6570\u7EC4\u8FDB\u884C\u4FDD\u5B58\uFF0C\u9632\u6B62\u5B83\u4EEC\u5728 GC \u65F6\u88AB\u56DE\u6536\u3002\u4EE3\u7801\u7B2C 11 ~ 15 \u884C\u4E0D\u505C\u5730\u5728\u65B0\u751F\u4EE3\u5206\u914D\u5185\u5B58\uFF0C\u4EE5\u89E6\u53D1\u65B0\u751F\u4EE3 GC\u3002\u4F7F\u7528\u5982\u4E0B\u53C2\u6570\u8FD0\u884C\u4EE3\u7801\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-Xmx1024M -Xms1024M -XX:+PrintGCDetails -XX:MaxTenuringThreshold=15 -XX:+PrintHeapAtGC
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u5206\u914D\u4E86 1GB \u7684\u5185\u5B58\uFF0C\u7528\u610F\u662F\u5C06\u5BF9\u8C61\u5C3D\u53EF\u80FD\u9884\u7559\u5728\u65B0\u751F\u4EE3\uFF08\u4E00\u4E2A\u5927\u7684\u5806\u81EA\u7136\u6709\u4E00\u4E2A\u5927\u7684\u65B0\u751F\u4EE3\uFF09\u3002\u663E\u5F0F\u6307\u5B9A\u4E86 MaxTenuringThreshold \u4E3A 15\uFF08\u548C\u9ED8\u8BA4\u503C\u4E00\u6837\uFF0C\u8FD9\u91CC\u65B9\u4FBF\u8BFB\u8005\u7406\u89E3\uFF09\uFF0C\u5E76\u6253\u5F00\u4E86 PrintHeapAtGC \u5F00\u5173\uFF0C\u5728\u6BCF\u6B21 GC \u65F6\u90FD\u6253\u5370\u5806\u7684\u8BE6\u7EC6\u4FE1\u606F\u3002</p><p>\u7A0B\u5E8F\u7684\u90E8\u5206\u8F93\u51FA\u5982\u4E0B\uFF08\u7531\u4E8E\u6253\u5F00\u4E86 PrintHeapAtGC\uFF0C\u4F1A\u4EA7\u751F\u5927\u91CF\u4FE1\u606F\uFF0C\u8FD9\u91CC\u4EC5\u663E\u793A\u76F8\u5173\u90E8\u5206\uFF09\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{Heap before GC invocations=0 (full 0):
def new generation total 314560K, used 279477K [0x04940000, 0x19e90000, 0x19e90000)
eden space 279616K, 99% used [0x04940000, 0x15a2d770, 0x15a50000)
from space 34944K, 0% used [0x15a50000, 0x15a50000, 0x17c70000)
to space 34944K, 0% used [0x17c70000, 0x17c70000, 0x19e90000)
tenured generation total 699072K, used 0K [0x19e90000, 0x44940000, 0x44940000)
the space 699072K, 0% used [0x19e90000, 0x19e90000, 0x19e90200, 0x44940000)
...
[GC[DefNew: 279477K-&gt;5888K(314560K), 0.0053669 secs] 279477K-&gt;5888K(1013632K), 0.0053970 secs] [Times: user=0.00 sys=0.02, real=0.01 secs]
Heap after GC invocations=1 (full 0):
def new generation total 314560K, used 5888K [0x04940000, 0x19e90000, 0x19e90000)
eden space 279616K, 0% used [0x04940000, 0x04940000, 0x15a50000)
from space 34944K, 16% used [0x17c70000, 0x18230358, 0x19e90000)
to space 34944K, 0% used [0x15a50000, 0x15a50000, 0x17c70000)
tenured generation total 699072K, used 0K [0x19e90000, 0x44940000, 0x44940000)
the space 699072K, 0% used [0x19e90000, 0x19e90000, 0x19e90200, 0x44940000)
...\uFF08\u8FD9\u91CC\u7701\u7565\u4E2D\u95F4\u5341\u51E0\u6B21 GC\uFF0C\u5B83\u4EEC\u7684\u60C5\u51B5\u548C\u7B2C\u4E00\u6B21 GC \u662F\u4E00\u6837\u7684\uFF09
{Heap before GC invocations=15 (full 0):
def new generation total 314560K, used 285452K [0x04940000, 0x19e90000, 0x19e90000)
eden space 279616K, 99% used [0x04940000, 0x15a43190, 0x15a50000)
from space 34944K, 16% used [0x17c70000, 0x18230250, 0x19e90000)
to space 34944K, 0% used [0x15a50000, 0x15a50000, 0x17c70000)
tenured generation total 699072K, used 0K [0x19e90000, 0x44940000, 0x44940000)
the space 699072K, 0% used [0x19e90000, 0x19e90000, 0x19e90200, 0x44940000)
...
[GC[DefNew: 285452K-&gt;0K(314560K) , 0.0045594 secs] 285452K-&gt;5888K(1013632K), 0.0045806 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
Heap after GC invocations=16 (full 0):
def new generation total 314560K, used 0K [0x04940000, 0x19e90000, 0x19e90000)
eden space 279616K, 0% used [0x04940000, 0x04940000, 0x15a50000)
from space 34944K, 0% used [0x15a50000, 0x15a50100, 0x17c70000)
to space 34944K, 0% used [0x17c70000, 0x17c70000, 0x19e90000)
tenured generation total 699072K, used 5888K [0x19e90000, 0x44940000, 0x44940000)
the space 699072K, 0% used [0x19e90000, 0x1a450150, 0x1a450200, 0x44940000)
...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u89C2\u5BDF\u4EE5\u4E0A\u65E5\u5FD7\uFF0C\u5728\u7B2C\u4E00\u6B21 GC \u5F00\u59CB\u524D\uFF0Ceden \u533A\u4F7F\u7528\u4E86 99%\uFF0C\u8FD9\u4E5F\u662F\u89E6\u53D1\u65B0\u751F\u4EE3 GC \u7684\u539F\u56E0\u3002\u65E2\u7136 eden \u533A\u4E0D\u80FD\u5BB9\u7EB3\u66F4\u591A\u5BF9\u8C61\uFF0C\u4E4B\u540E\u53C8\u9700\u8981\u6709\u65B0\u7684\u5BF9\u8C61\u4EA7\u751F\uFF0C\u81EA\u7136\u9700\u8981\u5BF9 eden \u533A\u8FDB\u884C\u6E05\u7406\uFF0C\u6E05\u7406\u7684\u7ED3\u679C\u662F\u5C06\u5B58\u6D3B\u5BF9\u8C61\u79FB\u5165\u4E86 from \u533A\u3002\u4ECE\u5806\u65E5\u5FD7\u4E2D\u53EF\u77E5\uFF0Cfrom \u533A\u5360\u7528\u4E86 16%\uFF0C349443 * 0.16 = 5591KB\uFF0C\u5927\u7EA6\u4E3A 5MB\uFF0C\u4E0E\u653E\u7F6E\u5728 map \u5BF9\u8C61\u4E2D\u7684 byte \u6570\u91CF\u5339\u914D\uFF0C\u7B2C\u4E00\u6B21 GC \u7684\u53E6\u4E00\u4E2A\u5F71\u54CD\u662F eden \u533A\u88AB\u6E05\u7A7A\u3002</p><p>\u4E4B\u540E\u7684 14 \u6B21 GC \u60C5\u51B5\u548C\u7B2C 1 \u6B21\u662F\u4E00\u6837\u7684\uFF0C\u5728\u65E5\u5FD7\u4E2D\u88AB\u7701\u7565\u3002\u6BCF\u4E00\u6B21 GC \u90FD\u4F1A\u4F7F\u5B58\u6D3B\u5BF9\u8C61\u7684\u5E74\u9F84\u52A0 1\uFF0C\u5728\u7B2C 16 \u6B21 GC \u65F6\uFF0C\u53EF\u4EE5\u770B\u5230\u5B83\u5DF1\u5C06\u65B0\u751F\u4EE3\u6E05\u7A7A\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[GC[DefNew: 285452K-&gt;0K(314560K), 0.0045594 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5BF9\u6BD4\u7B2C\u4E00\u6B21\u7684\u65E5\u5FD7\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[GC[DefNew: 279477K-&gt;5888K(314560K), 0.0053669 secs]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u6709\u660E\u663E\u7684\u5DEE\u5F02\u3002\u4ECE\u65B0\u751F\u4EE3\u88AB\u79FB\u9664\u7684\u5BF9\u8C61\uFF0C\u8FD9\u91CC\u664B\u5347\u5230\u4E86\u8001\u5E74\u4EE3\uFF08\u6307 map \u5BF9\u8C61\u4E2D\u7684 byte \u6570\u7EC4\uFF09\uFF0C\u8FD9\u4ECE\u6700\u540E\u4E00\u6B21 GC \u7684\u540E\u7EED\u5806\u65E5\u5FD7\u4E2D\u53EF\u4EE5\u770B\u5230\u3002\u8001\u5E74\u4EE3\u5DF2\u7ECF\u6709 5888KB \u88AB\u4F7F\u7528\uFF0C\u800C\u65B0\u751F\u4EE3\u6709 0KB \u88AB\u4F7F\u7528\u3002\u8FD9\u8BF4\u660E\u8FD9 5MB \u5BF9\u8C61\u6210\u529F\u664B\u5347\u5230\u8001\u5E74\u4EE3\u3002</p><p>\u8BFB\u8005\u53EF\u4EE5\u5C1D\u8BD5\u628A MaxTenuringThreshold \u6539\u4E3A 10\uFF0C\u90A3\u4E48\u5728\u8FD9\u4E2A\u793A\u4F8B\u4E2D\uFF0C\u5728\u7B2C 11 \u6B21 GC \u65F6\uFF0C5MB \u5BF9\u8C61\u5C31\u4F1A\u664B\u5347\u5230\u8001\u5E74\u4EE3\uFF0C\u6B64\u5904\u4ECE\u7565\u3002</p><p>\u867D\u7136\u6709\u4E0A\u8FF0\u793A\u4F8B\u505A\u94FA\u57AB\uFF0C\u4F46\u4ECD\u7136\u9700\u8981\u518D\u6B21\u5F3A\u8C03\uFF0CMaxTenuringThreshold \u6307\u7684\u662F\u6700\u5927\u664B\u5347\u5E74\u9F84\u3002\u5B83\u662F\u5BF9\u8C61\u664B\u5347\u5230\u8001\u5E74\u4EE3\u7684\u5145\u5206\u975E\u5FC5\u8981\u6761\u4EF6\u3002\u5373\u8FBE\u5230\u8BE5\u5E74\u9F84\uFF0C\u5BF9\u8C61\u5FC5\u7136\u664B\u5347\uFF0C\u800C\u672A\u8FBE\u5230\u8BE5\u5E74\u9F84\uFF0C\u5BF9\u8C61\u4E5F\u6709\u53EF\u80FD\u664B\u5347\u3002\u4E8B\u5B9E\u4E0A\uFF0C\u5BF9\u8C61\u7684\u5B9E\u9645\u664B\u5347\u5E74\u9F84\uFF0C\u662F\u7531\u865A\u62DF\u673A\u5728\u8FD0\u884C\u65F6\u81EA\u884C\u5224\u65AD\u7684\u3002</p><p>\u8BA1\u7B97\u664B\u5347\u5E74\u9F84\u7684\u57FA\u672C\u903B\u8F91\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>size_t desired_survivor_size = (size_t) ((((double) survivor_capacity) * TargetSurvivorRatio) / 100);
size_t total = 0;
int age = 1;
assert(sizes [0] == 0, &quot;no objects with age zero should be recorded&quot;);
while (age &lt; table_size) {
    total += sizes[age];
	// check if including objects of age &#39;age&#39; made us pass the desired
	// size, if so &#39;age&#39; is the new threshold
    if (total &gt; desired_survivor_size) break;
	age++;
}
int result = age &lt; MaxTenuringThreshold ? age : MaxTenuringThreshold;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u4E0A\u8FF0\u4EE3\u7801\u4E2D\uFF0C\u7B2C 1 \u884C\u7684 desired_survivor_size \u5B9A\u4E49\u4E86\u671F\u671B\u7684 survivor \u533A\u7684\u4F7F\u7528\u5927\u5C0F\u3002\u5728\u7B2C 5 ~ 10 \u884C\uFF0C\u6839\u636E desired_survivor_size \u8BA1\u7B97\u5BF9\u8C61\u664B\u5347\u5E74\u9F84\u3002\u5176\u4E2D sizes \u6570\u7EC4\u4FDD\u5B58\u6BCF\u4E00\u4E2A\u5E74\u9F84\u6BB5\u7684\u5BF9\u8C61\u5927\u5C0F\u4E4B\u548C\u3002\u6BD4\u5982 sizes[1] \u4FDD\u5B58\u5E74\u9F84\u4E3A 1 \u7684\u6240\u6709\u5BF9\u8C61\u7684\u5927\u5C0F\u4E4B\u548C\u3002\u7B2C 6 \u884C\u5BF9\u6BCF\u4E00\u4E2A\u5E74\u9F84\u6BB5\u7684\u5BF9\u8C61\u5927\u5C0F\u8FDB\u884C\u7D2F\u8BA1\u6C42\u548C\uFF0C\u5982\u679C\u5927\u4E8E desired_survivor_size \u5219\u9000\u51FA\u5FAA\u73AF\uFF0C\u5426\u5219 age\uFF08\u5BF9\u8C61\u664B\u5347\u5E74\u9F84\uFF09\u52A0 1\u3002\u5728\u5BF9\u6240\u6709\u5E74\u9F84\u6BB5\u7684\u5BF9\u8C61\u8FDB\u884C\u7EDF\u8BA1\u540E\uFF0C\u5982\u679C\u53D1\u73B0 survivor \u533A\u7684\u5E78\u5B58\u5BF9\u8C61\u8D85\u8FC7\u4E86\u671F\u671B\u503C desired_survivor_size\uFF0C\u90A3\u4E48 age \u5C31\u6210\u4E3A\u4E86\u664B\u5347\u5E74\u9F84\u3002\u4E4B\u540E\uFF0C\u5728 age \u548C MaxTenuringThreshold \u4E2D\u53D6\u8F83\u5C0F\u8005\u4F5C\u4E3A\u5BF9\u8C61\u7684\u5B9E\u9645\u664B\u5347\u5E74\u9F84\u3002\u786E\u5B9A\u5BF9\u8C61\u4F55\u65F6\u664B\u5347\u7684\u53E6\u5916\u4E00\u4E2A\u91CD\u8981\u53C2\u6570\u4E3A TargetSurvivorRatio\uFF0C\u5B83\u7528\u4E8E\u8BBE\u7F6E survivor \u533A\u7684\u76EE\u6807\u4F7F\u7528\u7387\uFF0C\u9ED8\u8BA4\u4E3A 50\uFF0C\u5373\u5982\u679C survivor \u533A\u5728 GC \u540E\u4F7F\u7528\u7387\u8D85\u8FC7 50%\uFF0C\u90A3\u4E48\u5C31\u5F88\u53EF\u80FD\u4F1A\u4F7F\u7528\u8F83\u5C0F\u7684 age \u4F5C\u4E3A\u664B\u5347\u5E74\u9F84\u3002</p><p>\u5728\u672C\u793A\u4F8B\u4E2D\uFF0C\u4F7F\u7528\u5982\u4E0B\u53C2\u6570\u8FD0\u884C\u4EE3\u7801\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-Xmx1024M -Xms1024M -XX:+PrintGCDetails -XX:MaxTenuringThreshold=15 -XX:+PrintHeapAtGC -XX:TargetSurvivorRatio=15
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5C06 TargetSurvivorRatio \u8BBE\u7F6E\u4E3A 15\u3002\u901A\u8FC7\u524D\u6587\u7684 GC \u65E5\u5FD7\u53EF\u77E5\uFF0Cfrom \u533A\u7684\u4F7F\u7528\u7387\u4F1A\u7EF4\u6301\u5728 16%\uFF0C\u800C\u73B0\u5728\u66F4\u6539\u76EE\u6807\u4F7F\u7528\u7387\u4E3A 15%\uFF0C\u5C0F\u4E8E 16%\uFF0C\u6545\u5E94\u8BE5\u4F1A\u4F7F\u5BF9\u8C61\u66F4\u5FEB\u5730\u664B\u5347\u5230\u8001\u5E74\u4EE3\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{Heap before GC invocations=1 (full 0):
def new generation total 314560K, used 285201K [0x04a10000, 0x19f60000, 0x19f60000) 
eden space 279616K, 99% used [0x04a10000, 0x15ad43e0, 0x15b20000)
from space 34944K, 16% used [0x17d40000, 0x18300368, 0x19f60000)
to space 34944K, 0% used [0x15b20000, 0x15b20000, 0x17d40000)
tenured generation total 699072K, used 0K [0x19f60000, 0x44a10000, 0x44a10000)
the space 699072K, 0% used [0x19f60000, 0x19f60000, 0x19f60200, 0x44a10000)
...
[GC[DefNew: 285201K-&gt;0K(314560K), 0.0040121 secs] 285201K-&gt;5888K(1013632K), 0.0040337 secs] [Times: user=0.00 sys=0.02, real=0.00 secs]
Heap after GC invocations=2 (full 0):
def new generation total 314560K, used 0K [0x04a10000, 0x19f60000, 0x19f60000) 
eden space 279616K, 0% used [0x04a10000, 0x04a10000, 0x15b20000)
from space 34944K, 0% used [0x15b20000, 0x15b20100, 0x17d40000)
to space 34944K, 0% used [0x17d40000, 0x17d40000, 0x19f60000)
tenured generation total 699072K, used 5888K [0x19f60000, 0x44a10000, 0x44a10000)
the space 699072K, 0% used [0x19f60000, 0x1a520158, 0x1a520200, 0x44a10000)
...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5982\u4E0A\u65E5\u5FD7\u663E\u793A\uFF0C\u5728\u7B2C 2 \u6B21 GC \u65F6\uFF0Cmap \u4E2D\u7684 byte \u6570\u7EC4\u5BF9\u8C61\u90FD\u5DF2\u7ECF\u664B\u5347\u5230\u8001\u5E74\u4EE3\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1A\u5BF9\u8C61\u7684\u5B9E\u9645\u664B\u5347\u5E74\u9F84\u662F\u6839\u636E survivor\u533A\u7684\u4F7F\u7528\u60C5\u51B5\u52A8\u6001\u8BA1\u7B97\u5F97\u6765\u7684\uFF0C\u800C MaxTenuringThreshold \u53EA\u662F\u8868\u793A\u8FD9\u4E2A\u5E74\u9F84\u7684\u6700\u5927\u503C\u3002</p></li><li><p>\u5927\u5BF9\u8C61\u8FDB\u5165\u8001\u5E74\u4EE3</p><p>\u9664\u4E86\u5E74\u9F84\uFF0C\u5BF9\u8C61\u7684\u4F53\u79EF\u4E5F\u4F1A\u5F71\u54CD\u5BF9\u8C61\u7684\u664B\u5347\u3002\u8BD5\u60F3\uFF0C\u5982\u679C\u5BF9\u8C61\u4F53\u79EF\u5F88\u5927\uFF0C\u65B0\u751F\u4EE3\u65E0\u8BBA eden \u533A\u8FD8\u662F survivor \u533A\u90FD\u65E0\u6CD5\u5BB9\u7EB3\u8FD9\u4E2A\u5BF9\u8C61\uFF0C\u81EA\u7136\u8FD9\u4E2A\u5BF9\u8C61\u65E0\u6CD5\u5B58\u653E\u5728\u65B0\u751F\u4EE3\uFF0C\u4E5F\u975E\u5E38\u6709\u53EF\u80FD\u88AB\u76F4\u63A5\u664B\u5347\u5230\u8001\u5E74\u4EE3\u3002\u5982\u56FE5.11 \u6240\u793A\uFF0C\u5982\u679C\u9700\u8981\u4E00\u4E2A\u8FDE\u7EED\u7684 6MB \u7A7A\u95F4\uFF0C\u800C\u65B0\u751F\u4EE3 survivor \u533A\uFF08\u53EA\u6709 5MB\uFF09\u65E0\u6CD5\u5BB9\u7EB3\u8FD9\u6837\u7684\u5927\u5C0F\uFF0C\u6B64\u65F6\u65E0\u8BBA\u8BE5\u5BF9\u8C61\u5E74\u9F84\u5982\u4F55\uFF0C\u5B83\u90FD\u4F1A\u88AB\u76F4\u63A5\u664B\u5347\u5230\u8001\u5E74\u4EE3\u3002</p><p><img src="`+C+`" alt="\u56FE5-11" loading="lazy"></p><p>\u56FE5.11 \u65B0\u751F\u4EE3\u65E0\u6CD5\u5BB9\u7EB3\u5927\u5BF9\u8C61</p><p>\u53E6\u5916\u4E00\u4E2A\u6709\u8DA3\u7684\u53C2\u6570\u662F PretenureSizeThreshold\uFF0C\u5B83\u7528\u6765\u8BBE\u7F6E\u5BF9\u8C61\u76F4\u63A5\u664B\u5347\u5230\u8001\u5E74\u4EE3\u7684\u9608\u503C\uFF0C\u5355\u4F4D\u662F\u5B57\u8282\u3002\u53EA\u8981\u5BF9\u8C61\u7684\u5927\u5C0F\u5927\u4E8E\u6307\u5B9A\u503C\uFF0C\u5C31\u4F1A\u7ED5\u8FC7\u65B0\u751F\u4EE3\uFF0C\u76F4\u63A5\u5728\u8001\u5E74\u4EE3\u5206\u914D\u3002\u8FD9\u4E2A\u53C2\u6570\u53EA\u5BF9\u4E32\u884C\u56DE\u6536\u5668\u548C ParNew \u6709\u6548\uFF0C\u5BF9\u4E8E ParallelGC \u65E0\u6548\u3002\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u8BE5\u503C\u4E3A 0\uFF0C\u4E5F\u5C31\u662F\u4E0D\u6307\u5B9A\u6700\u5927\u7684\u664B\u5347\u5927\u5C0F\uFF0C\u4E00\u5207\u7531\u8FD0\u884C\u60C5\u51B5\u51B3\u5B9A\u3002</p><p>\u3010\u793A\u4F8B 5-6\u3011\u4E0B\u9762\u7684\u793A\u4F8B\u6F14\u793A\u4E86 PretenureSizeThreshold \u7684\u4F7F\u7528\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PretenureSizeThreshold</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _1K <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token operator">*</span> _1K<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>_1K<span class="token punctuation">]</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u5206\u914D\u4E86\u7EA6 5MB \u7A7A\u95F4\uFF0C\u5927\u7EA6\u4E3A 6 \u5343\u4E2A byte \u6570\u7EC4\uFF0C\u6BCF\u4E2A\u6570\u7EC4\u5927\u5C0F\u4E3A 1024 \u5B57\u8282\u3002\u4F7F\u7528\u4E0B\u9762\u53C2\u6570\u8FD0\u884C\u8FD9\u6BB5\u4EE3\u7801\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-Xmx32m -Xms32m -XX:+UseSerialGC -XX:+PrintGCDetails
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5F97\u5230\u7684\u90E8\u5206\u8F93\u51FA\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Heap
def new generation total 9792K, used 6204K [0x32460000, 0x32f00000, 0x32f00000)
eden space 8704K, 71% used [0x32460000, 0x32a6f358, 0x32ce0000)
from space 1088K, 0% used [0x32ce0000, 0x32ce0000, 0x32df0000)
to space 1088K,	0% used [0x32df0000, 0x32df0000, 0x32f00000)
tenured generation total 21888K, used 0K [0x32f00000, 0x34460000, 0x34460000) 
the space 21888K, 0% used [0x32f00000, 0x32f00000, 0x32f00200, 0x34460000)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u6240\u6709\u7684\u5BF9\u8C61\u5747\u5206\u914D\u5728\u65B0\u751F\u4EE3\uFF0C\u8001\u5E74\u4EE3\u7684\u4F7F\u7528\u7387\u4E3A 0\u3002\u63A5\u7740\u9644\u52A0\u53C2\u6570 PretenureSizeThreshold\uFF0C\u4EE4 PretenureSizeThreshold = 1000\uFF0C\u5219\u5927\u5C0F\u4E3A 1024 \u5B57\u8282\u7684 byte \u6570\u7EC4\u7406\u5E94\u88AB\u5206\u914D\u5728\u8001\u5E74\u4EE3\uFF0C\u53C2\u6570\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Xmx32m -Xms32m -XX:+UseSerialGC -XX:+PrintGCDetails -XX:PretenureSizeThreshold=1000
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5F97\u5230\u7684\u90E8\u5206\u8F93\u51FA\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Heap
def new generation 9792K, used 6124K [0x32460000, 0x32f00000, 0x32f00000)
eden space 8704K, 70% used [0x32460000, 0x32a5b328, 0x32ce0000)
from space 1088K, 0% used [0x32ce0000, 0x32ce0000, 0x32df0000)
to space 1088K, 0% used [0x32df0000, 0x32df0000, 0x32f00000)
tenured generation total 21888K, used 80K [0x32f00000, 0x34460000, 0x34460000)
the space 21888K, 0% used [0x32f00000, 0x32f14030, 0x32f14200, 0x34460000)
...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8BFB\u8005\u4E5F\u8BB8\u4F1A\u89C9\u5F97\u975E\u5E38\u5947\u602A\uFF0C\u56E0\u4E3A\u671F\u671B\u7684\u7ED3\u679C\u662F\u81F3\u5C11\u6709 5MB \u6570\u636E\u88AB\u5206\u914D\u5728\u8001\u5E74\u4EE3\uFF0C\u4F46\u4E3A\u4EC0\u4E48\u4F5C\u4E3A\u5206\u914D\u4E3B\u4F53\u7684 5MB \u6570\u7EC4\u770B\u8D77\u6765\u4F9D\u7136\u5728\u65B0\u751F\u4EE3\u5462\uFF1F\u4F3C\u4E4E PretenureSizeThreshold \u4E0D\u8D77\u4F5C\u7528\uFF0C\u4F46\u662F\u8001\u5E74\u4EE3\u7684\u60C5\u51B5\u5374\u548C\u4E0D\u52A0 PretenureSizeThreshold \u65F6\u6709\u6240\u4E0D\u540C\uFF0C\u6709 80KB \u7684\u7A7A\u95F4\u88AB\u4F7F\u7528\u3002</p><p>\u51FA\u73B0\u8FD9\u79CD\u73B0\u8C61\u7684\u539F\u56E0\u662F\u865A\u62DF\u673A\u5728\u4E3A\u7EBF\u7A0B\u5206\u914D\u7A7A\u95F4\u65F6\uFF0C\u4F1A\u4F18\u5148\u4F7F\u7528\u4E00\u5757\u53EB\u4F5C TLAB \u7684\u533A\u57DF\uFF08TLAB \u7684\u76F8\u5173\u5185\u5BB9\u5728\u4E0B\u4E00\u8282\u8BE6\u7EC6\u4ECB\u7ECD\uFF09\uFF0C\u5BF9\u4E8E\u4F53\u79EF\u4E0D\u5927\u7684\u5BF9\u8C61\uFF0C\u5F88\u6709\u53EF\u80FD\u4F1A\u5728 TLAB \u4E0A\u5148\u884C\u5206\u914D\uFF0C\u56E0\u6B64\u5C31\u5931\u53BB\u4E86\u5728\u8001\u5E74\u4EE3\u5206\u914D\u7684\u673A\u4F1A\u3002\u8FD9\u91CC\u7B80\u5355\u5730\u7981\u7528 TLAB \u5373\u53EF\u3002\u4F7F\u7528\u4E0B\u8FF0\u53C2\u6570\uFF0C\u518D\u6B21\u8FD0\u884C\u7A0B\u5E8F\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-Xmx32m -Xms32m -XX:+UseSerialGC -XX:+PrintGCDetails -XX:-UseTLAB -XX:PretenureSizeThreshold=1000
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5F97\u5230\u7684\u90E8\u5206\u8F93\u51FA\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Heap
def new generation total 9792K, used 580K [0x32460000, 0x32f00000, 0x32f00000)
eden space 8704K, 6% used [0x32460000, 0x324fl3c0, 0x32ce0000)
from space 1088K, 0% used [0x32ce0000, 0x32ce0000, 0x32df0000)
to space 1088K,	0% used [0x32df0000, 0x32df0000, 0x32f00000)
tenured generation total 21888K, used 5413K [0x32f00000, 0x34460000, 0x34460000)
the space 21888K, 24% used [0x32f00000, 0x33449470, 0x33449600, 0x34460000)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u5728\u7981\u7528 TLAB \u540E\uFF0C\u5927\u4E8E 1000 \u5B57\u8282\u7684 byte \u6570\u7EC4\u5DF1\u7ECF\u5206\u914D\u5728\u8001\u5E74\u4EE3\u4E86\u3002\u90A3\u4E48\u4EC0\u4E48\u662F TLAB \u5462\uFF1F\u8BF7\u8BFB\u8005\u7EE7\u7EED\u9605\u8BFB\u4E0B\u4E00\u8282\u3002</p></li></ol><h3 id="_5-5-5-\u5728-tlab-\u4E0A\u5206\u914D\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_5-5-5-\u5728-tlab-\u4E0A\u5206\u914D\u5BF9\u8C61" aria-hidden="true">#</a> 5.5.5 \u5728 TLAB \u4E0A\u5206\u914D\u5BF9\u8C61</h3><p>TLAB \u7684\u5168\u79F0\u662F Thread Local Allocation Buffer\uFF0C\u5373\u7EBF\u7A0B\u672C\u5730\u5206\u914D\u7F13\u5B58\u3002\u4ECE\u540D\u5B57\u4E0A\u53EF\u4EE5\u770B\u5230\uFF0CTLAB \u662F\u4E00\u4E2A\u7EBF\u7A0B\u4E13\u7528\u7684\u5185\u5B58\u5206\u914D\u533A\u57DF\u3002</p><p>\u4E3A\u4EC0\u4E48\u9700\u8981 TLAB \u8FD9\u4E2A\u533A\u57DF\u5462\uFF1F\u8FD9\u662F\u4E3A\u4E86\u52A0\u901F\u5BF9\u8C61\u5206\u914D\u3002\u7531\u4E8E\u5BF9\u8C61\u4E00\u822C\u4F1A\u5206\u914D\u5728\u5806\u4E0A\uFF0C\u800C\u5806\u662F\u5168\u5C40\u5171\u4EAB\u7684\u3002\u5728\u540C\u4E00\u65F6\u95F4\uFF0C\u53EF\u80FD\u4F1A\u6709\u591A\u4E2A\u7EBF\u7A0B\u5728\u5806\u4E0A\u7533\u8BF7\u7A7A\u95F4\u3002\u56E0\u6B64\uFF0C\u6BCF\u4E00\u6B21\u5BF9\u8C61\u5206\u914D\u90FD\u5FC5\u987B\u8FDB\u884C\u540C\u6B65\uFF0C\u800C\u5728\u7ADE\u4E89\u6FC0\u70C8\u7684\u573A\u5408\u5206\u914D\u7684\u6548\u7387\u53C8\u4F1A\u8FDB\u4E00\u6B65\u4E0B\u964D\u3002\u8003\u8651\u5230\u5BF9\u8C61\u5206\u914D\u51E0\u4E4E\u662F Java \u6700\u5E38\u7528\u7684\u64CD\u4F5C\uFF0C\u56E0\u6B64 Java \u865A\u62DF\u673A\u5C31\u4F7F\u7528\u4E86 TLAB \u8FD9\u79CD\u7EBF\u7A0B\u4E13\u5C5E\u7684\u533A\u57DF\u6765\u907F\u514D\u591A\u7EBF\u7A0B\u51B2\u7A81\uFF0C\u63D0\u9AD8\u5BF9\u8C61\u5206\u914D\u7684\u6548\u7387\u3002TLAB \u672C\u8EAB\u5360\u7528\u4E86 eden \u533A\u7684\u7A7A\u95F4\u3002\u5728 TLAB \u542F\u7528\u7684\u60C5\u51B5\u4E0B\uFF0C\u865A\u62DF\u673A\u4F1A\u4E3A\u6BCF\u4E00\u4E2A Java \u7EBF\u7A0B\u5206\u914D\u4E00\u5757 TLAB \u533A\u57DF\u3002</p><p>\u3010\u793A\u4F8B 5-7\u3011\u4E0B\u9762\u6765\u770B\u4E00\u4E0B\u542F\u7528 TLAB \u4E0E\u5173\u95ED TLAB \u65F6\u7684\u6027\u80FD\u5DEE\u5F02\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UseTLAB</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> b <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> e <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e <span class="token operator">-</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u8FDB\u884C\u82E5\u5E72\u6B21\u6570\u7EC4\u5206\u914D\uFF0C\u5E76\u7EDF\u8BA1\u4E86\u6267\u884C\u65F6\u95F4\u3002\u4F7F\u7528\u5982\u4E0B\u53C2\u6570\u6267\u884C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-XX:+UseTLAB -Xcomp -XX:-Backgroundcompilation -XX:-DoEscapeAnalysis -server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8BE5\u53C2\u6570\u6253\u5F00\u4E86 TLAB\uFF08\u9ED8\u8BA4\u5373\u4E3A\u5F00\u542F\u72B6\u6001\uFF0C\u8FD9\u91CC\u4F7F\u7528\u53C2\u6570\u6253\u5F00\u662F\u4E3A\u4E86\u8BA9\u8868\u8FF0\u66F4\u6E05\u6670\uFF09\uFF0C\u5E76\u542F\u7528\u4E86\u5BF9\u6240\u6709\u51FD\u6570\u7684 JIT \u53CA\u7981\u6B62\u540E\u53F0\u7F16\u8BD1\uFF08\u8FD9\u91CC\u53EA\u662F\u5E0C\u671B\u5728\u76F8\u5BF9\u4E00\u81F4\u7684\u73AF\u5883\u4E2D\u6D4B\u8BD5\uFF09\uFF0C\u540C\u65F6\u7981\u7528\u4E86\u9003\u9038\u5206\u6790\uFF0C\u4EE5\u9632\u6B62\u6808\u4E0A\u5206\u914D\u7684\u884C\u4E3A\u5F71\u54CD\u672C\u6B21\u6D4B\u8BD5\u7ED3\u679C\u3002\u5F00\u542F Server \u6A21\u5F0F\u662F\u56E0\u4E3A\u5728 Client \u6A21\u5F0F\u4E0B\uFF0C\u4E0D\u652F\u6301\u9003\u9038\u5206\u6790\u53C2\u6570 DoEscapeAnalysis\u3002\u6700\u7EC8\u7A0B\u5E8F\u8F93\u51FA\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>54
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4FEE\u6539 Java \u865A\u62DF\u673A\u53C2\u6570\u4E3A\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-XX:-UseTLAB -Xcomp -XX:-BackgroundCompilation -XX:-DoEscapeAnalysis -server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u7981\u7528\u4E86 TLAB\uFF0C\u7A0B\u5E8F\u8F93\u51FA\u4E3A\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>141
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0CTLAB \u662F\u5426\u542F\u7528\u5BF9\u4E8E\u5BF9\u8C61\u5206\u914D\u7684\u5F71\u54CD\u662F\u5F88\u5927\u7684\u3002</p><p>\u7531\u4E8E TLAB \u533A\u57DF\u4E00\u822C\u4E0D\u4F1A\u592A\u5927\uFF0C\u56E0\u6B64\u5927\u5BF9\u8C61\u65E0\u6CD5\u5728 TLAB \u533A\u57DF\u8FDB\u884C\u5206\u914D\uFF0C\u603B\u662F\u4F1A\u76F4\u63A5\u5206\u914D\u5728\u5806\u4E0A\u3002\u7531\u4E8E TLAB \u7A7A\u95F4\u6BD4\u8F83\u5C0F\uFF0C\u5F88\u5BB9\u6613\u88C5\u6EE1\u3002\u6BD4\u5982\uFF0C\u4E00\u4E2A 100KB \u7684\u7A7A\u95F4\uFF0C\u5982\u679C\u5DF2\u7ECF\u4F7F\u7528\u4E86 80KB\uFF0C\u5F53\u9700\u8981\u518D\u5206\u914D\u4E00\u4E2A 30KB \u7684\u5BF9\u8C61\u65F6\uFF0C\u80AF\u5B9A\u5C31\u65E0\u80FD\u4E3A\u529B\u4E86\u3002\u8FD9\u65F6\uFF0C\u865A\u62DF\u673A\u6709\u4E24\u79CD\u9009\u62E9\uFF1A\u7B2C\u4E00\uFF0C\u5E9F\u5F03\u5F53\u524D\u7684 TLAB \u533A\u57DF\uFF0C\u8FD9\u6837\u5C31\u4F1A\u6D6A\u8D39 20KB \u7A7A\u95F4\uFF1B\u7B2C\u4E8C\uFF0C\u5C06\u8FD9 30KB \u7684\u5BF9\u8C61\u76F4\u63A5\u5206\u914D\u5728\u5806\u4E0A\uFF0C\u4FDD\u7559\u5F53\u524D\u7684 TLAB \u533A\u57DF\uFF0C\u8FD9\u6837\u5C06\u6765\u6709\u5C0F\u4E8E 20KB \u7684\u5BF9\u8C61\u5206\u914D\u8BF7\u6C42\u65F6\u53EF\u4EE5\u76F4\u63A5\u4F7F\u7528\u8FD9\u5757\u7A7A\u95F4\u3002\u5F53\u53D1\u751F\u8BF7\u6C42\u5206\u914D\u7684\u5BF9\u8C61\u5927\u4E8E TLAB \u5185\u53EF\u7528\u7A7A\u95F4\u65F6\uFF0C\u865A\u62DF\u673A\u5982\u4F55\u5728\u8FD9\u4E24\u79CD\u884C\u4E3A\u4E2D\u8FDB\u884C\u9009\u62E9\u5462\uFF1F\u865A\u62DF\u673A\u5185\u90E8\u4F1A\u7EF4\u62A4\u4E00\u4E2A\u53EB\u4F5C refill_waste \u7684\u503C\uFF0C\u5F53\u8BF7\u6C42\u5BF9\u8C61\u5927\u4E8E refill_waste \u65F6\uFF0C\u4F1A\u9009\u62E9\u5728\u5806\u4E2D\u5206\u914D\uFF0C\u82E5\u5C0F\u4E8E\u8BE5\u503C\uFF0C\u5219\u4F1A\u5E9F\u5F03\u5F53\u524D TLAB \u533A\u57DF\uFF0C\u65B0\u5EFA TLAB \u533A\u57DF\u6765\u5206\u914D\u65B0\u5BF9\u8C61\u3002\u8FD9\u4E2A\u9608\u503C\u53EF\u4EE5\u4F7F\u7528\u865A\u62DF\u673A\u53C2\u6570 TLABRefillWasteFraction \u6765\u8C03\u6574\uFF0C\u5B83\u8868\u793A TLAB \u4E2D\u5141\u8BB8\u4EA7\u751F\u8FD9\u79CD\u6D6A\u8D39\u7684\u6BD4\u4F8B\u3002\u5B83\u7684\u9ED8\u8BA4\u503C\u4E3A 64\uFF0C\u5373\u8868\u793A\u4F7F\u7528\u7EA6\u4E3A 1/64 \u7684TLAB \u533A\u57DF\u4F5C\u4E3A refill_waste\u3002</p><p>\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0CTLAB \u548C refill_waste \u7684\u5927\u5C0F\u90FD\u662F\u4F1A\u5728\u8FD0\u884C\u65F6\u4E0D\u65AD\u8C03\u6574\u7684\uFF0C\u4F7F\u7CFB\u7EDF\u7684\u8FD0\u884C\u72B6\u6001\u8FBE\u5230\u6700\u4F18\u3002\u5982\u679C\u60F3\u7981\u7528\u81EA\u52A8\u8C03\u6574 TLAB \u7684\u5927\u5C0F\uFF0C\u53EF\u4EE5\u4F7F\u7528 -XX:-ResizeTLAB \u7981\u7528 ResizeTLAB\uFF0C\u5E76\u4F7F\u7528 -XX:TLABSize \u624B\u5DE5\u6307\u5B9A TLAB \u7684\u5927\u5C0F\u3002</p><p>\u5982\u679C\u60F3\u89C2\u5BDF TLAB \u533A\u57DF\u7684\u4F7F\u7528\u60C5\u51B5\uFF0C\u53EF\u6253\u5F00\u8DDF\u8E2A\u53C2\u6570 -XX:+PrintTLAB\uFF08\u8003\u8651\u5230\u517C\u5BB9\u6027\u95EE\u9898\uFF0CJDK 9\u3001JDK 10 \u4E0D\u518D\u652F\u6301\u6B64\u53C2\u6570\uFF09\u3002\u73B0\u4F7F\u7528\u5982\u4E0B\u53C2\u6570\u518D\u6B21\u8FD0\u884C\u8FD9\u6BB5\u4EE3\u7801\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-XX:+UseTLAB -XX:+PrintTLAB -XX:+PrintGC -XX:TLABSize=102400 -XX:-ResizeTLAB -XX:TLABRefillWasteFraction=100 -XX:-DoEscapeAnalysis -server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5F97\u5230\u5982\u4E0B\u8F93\u51FA\uFF08\u7BC7\u5E45\u6709\u9650\uFF0C\u53EA\u622A\u53D6\u90E8\u5206\u8F93\u51FA\uFF09\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	TLAB: gc thread: 0x4c623400 [id: 1932] desired_size: 100KB slow allocs: 0 refill_waste: 1024B alloc: 0.29593	5000KB refills: 1 waste 100.0% gc: 102368B slow: 0B fast: 0B
	TLAB: gc thread: 0x4c621000 [id: 1740] desired_size: 100KB slow allocs: 0 refill_waste: 1024B alloc: 0.29593	5000KB refills : 1 waste 100.0% gc: 102400B slow: 0B fast: 0B
	TLAB: gc thread: 0x0045c400 [id: 5168] desired_size: 100KB slow allocs: 0 refill_waste: 1024B alloc: 0.64808	10950KB refills: 167 waste 0.0% gc: 0B slow: 2672B fast: 0B
	TLAB totals: thrds: 3 refills: 169 max: 167 slow allocs: 0 max 0 waste: 1.2% gc: 204768B max: 102400B slow: 2672B max: 2672B fast: 0B max: 0B
	[GC 17392K-&gt;472K(79872K), 0.0027370 secs]
	...
	90
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u65E5\u5FD7\u5C31\u662F TLAB \u7684\u4F7F\u7528\u65E5\u5FD7\uFF0C\u5206\u4E3A\u4E24\u90E8\u5206\uFF0C\u9996\u5148\u662F\u6BCF\u4E00\u4E2A\u7EBF\u7A0B\u7684 TLAB \u7684\u4F7F\u7528\u60C5\u51B5\uFF0C\u5176\u6B21\u662F\u4EE5 TLAB totals \u4E3A\u9996\u7684\u6574\u4F53 TLAB \u7684\u7EDF\u8BA1\u60C5\u51B5\u3002</p><p>\u5728\u8F93\u51FA\u65E5\u5FD7\u4E2D\uFF0Cdesired_size \u4E3A TLAB \u7684\u5927\u5C0F\uFF0C\u8FD9\u91CC\u901A\u8FC7 -XX:TLABSize = 102400 \u6307\u5B9A\u4E3A 100KB\uFF0Cslow allocs \u8868\u793A\u4ECE\u4E0A\u4E00\u6B21\u65B0\u751F\u4EE3 GC \u5230\u73B0\u5728\u4E3A\u6B62\u7684\u6162\u5206\u914D\u6B21\u6570\uFF0C\u8FD9\u91CC\u7684\u6162\u5206\u914D\u662F\u6307\u7531\u4E8E TLAB \u7A7A\u95F2\u7A7A\u95F4\u592A\u5C0F\u4E0D\u80FD\u6EE1\u8DB3\u8F83\u5927\u5BF9\u8C61\u7684\u5206\u914D\uFF0C\u800C\u5C06\u5BF9\u8C61\u76F4\u63A5\u5206\u914D\u5230\u5806\u4E0A\u3002\u540E\u9762\u7684 refill_waste \u8868\u793A\u524D\u6587\u6240\u8FF0\u7684 refill_waste \u503C\u3002\u540E\u7EED\u7684 alloc \u8868\u793A\u5F53\u524D\u7EBF\u7A0B\u7684 TLAB \u5206\u914D\u6BD4\u4F8B\u548C\u4F7F\u7528\u8BC4\u4F30\u91CF\uFF0C\u8FD9\u662F\u4E00\u4E2A\u7EDF\u8BA1\u6570\u636E\uFF0C\u524D\u8005\u8868\u793A\u81EA\u4E0A\u4E00\u6B21\u65B0\u751F\u4EE3 GC \u540E\u7684 number_of_refills * desired size / used_tlab \u7684\u52A0\u6743\u5E73\u5747\u503C\uFF0C\u540E\u8005\u4E3A\u8BE5\u5E73\u5747\u503C\u4E58\u4EE5 used_tlab\uFF08\u610F\u4E3A\u8FD9\u4E2A TLAB \u533A\u57DF\u5927\u7EA6\u5408\u8BA1\u88AB\u5206\u914D\u4E86\u591A\u5C11\u7A7A\u95F4\uFF09\u3002\u65E5\u5FD7\u4E2D\u540E\u7EED\u7684 refills \u8868\u793A\u8BE5\u7EBF\u7A0B\u7684 TLAB \u533A\u57DF\u88AB\u91CD\u65B0\u5206\u914D\u5E76\u586B\u5145\u7684\u6B21\u6570\uFF0Cwaste \u8868\u793A\u7A7A\u95F4\u7684\u6D6A\u8D39\u6BD4\u4F8B\u3002</p><p>\u6D6A\u8D39\u7684\u7A7A\u95F4\u7531\u4E09\u90E8\u5206\u7EC4\u6210\uFF0C\u5373\u540E\u7EED\u7684 gc\u3001slow \u548C fast\u3002\u5176\u4E2D\uFF0Cgc \u8868\u793A\u5728\u5F53\u524D\u65B0\u751F\u4EE3 GC \u53D1\u751F\u65F6\u5C1A\u7A7A\u95F2\u7684 TLAB \u7A7A\u95F4\uFF0Cslow \u548C fast \u90FD\u8868\u793A\u5F53 TLAB \u533A\u57DF\u88AB\u5E9F\u5F03\u65F6\u5C1A\u672A\u88AB\u4F7F\u7528\u7684 TLAB \u7A7A\u95F4\uFF0C\u4E24\u8005\u7684\u4E0D\u540C\u662F\uFF0Cfast \u8868\u793A\u8FD9\u4E2A refill \u64CD\u4F5C\u662F\u901A\u8FC7 JIT \u7F16\u8BD1\u4F18\u5316\u7684\uFF08\u7981\u7528 JIT\uFF0Cfast \u6C38\u8FDC\u4E3A 0\uFF09\u3002\u800C waste \u5219\u662F\u6D6A\u8D39\u7A7A\u95F4\u4E4B\u548C\uFF08gc + slow + fast\uFF09\u4E0E\u603B\u5206\u914D\u5927\u5C0F\uFF08_number_of_refills * _desired_size\uFF09\u7684\u6BD4\u503C\u3002</p><p>\u6700\u540E\u7684 TLAB totals \u5219\u663E\u793A\u4E86\u6240\u6709\u7EBF\u7A0B\u7684\u7EDF\u8BA1\u60C5\u51B5\u3002\u5982 thrds \u663E\u793A\u4E86\u76F8\u5173\u7EBF\u7A0B\u603B\u6570\uFF0Crefills \u8868\u793A\u6240\u6709\u7EBF\u7A0B refills \u7684\u603B\u6570\uFF0C\u7D27\u8DDF\u5728 refills \u540E\u7684 max \u8868\u793A refills \u6B21\u6570\u6700\u591A\u7684\u7EBF\u7A0B\u7684 refills \u6B21\u6570\u3002</p><p>\u56FE5.12 \u5C55\u793A\u4E86\u7B80\u8981\u7684\u5BF9\u8C61\u5206\u914D\u6D41\u7A0B\u3002\u5982\u679C\u5F00\u542F\u4E86\u6808\u4E0A\u5206\u914D\uFF0C\u7CFB\u7EDF\u4F1A\u5148\u8FDB\u884C\u6808\u4E0A\u5206\u914D\uFF0C\u6CA1\u6709\u5F00\u542F\u6808\u4E0A\u5206\u914D\u6216\u8005\u4E0D\u7B26\u5408\u6761\u4EF6\u5219\u4F1A\u8FDB\u884C TLAB \u5206\u914D\uFF0C\u5982\u679C TLAB \u5206\u914D\u4E0D\u6210\u529F\uFF0C\u518D\u5C1D\u8BD5\u5728\u5806\u4E0A\u5206\u914D\uFF0C\u5982\u679C\u6EE1\u8DB3\u4E86\u76F4\u63A5\u8FDB\u5165\u8001\u5E74\u4EE3\u7684\u6761\u4EF6\uFF08PretenureSizeThreshold \u7B49\u53C2\u6570\uFF09\uFF0C\u5C31\u5728\u8001\u5E74\u4EE3\u5206\u914D\uFF0C\u5426\u5219\u5C31\u5728 eden \u533A\u5206\u914D\uFF0C\u5F53\u7136\uFF0C\u5982\u679C\u6709\u5FC5\u8981\u53EF\u80FD\u4F1A\u8FDB\u884C\u4E00\u6B21\u65B0\u751F\u4EE3 GC\u3002</p><p><img src="`+h+`" alt="\u56FE5-12" loading="lazy"></p><p>\u56FE5.12 \u7B80\u8981\u7684\u5BF9\u8C61\u5206\u914D\u6D41\u7A0B</p><h3 id="_5-5-6-finalize-\u51FD\u6570\u5BF9\u5783\u573E\u56DE\u6536\u7684\u5F71\u54CD" tabindex="-1"><a class="header-anchor" href="#_5-5-6-finalize-\u51FD\u6570\u5BF9\u5783\u573E\u56DE\u6536\u7684\u5F71\u54CD" aria-hidden="true">#</a> 5.5.6 finalize() \u51FD\u6570\u5BF9\u5783\u573E\u56DE\u6536\u7684\u5F71\u54CD</h3><p>Java \u4E2D\u63D0\u4F9B\u4E86\u4E00\u4E2A\u7C7B\u4F3C\u4E8E C++ \u4E2D\u6790\u6784\u51FD\u6570\u7684\u673A\u5236 finalize() \u51FD\u6570\uFF0C\u5B83\u5728 java.lang.Object \u4E2D\u88AB\u58F0\u660E\uFF0C\u5F62\u5F0F\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8BE5\u51FD\u6570\u5141\u8BB8\u5728\u5B50\u7C7B\u4E2D\u88AB\u91CD\u8F7D\uFF0C\u7528\u4E8E\u5728\u5BF9\u8C61\u88AB\u56DE\u6536\u65F6\u8FDB\u884C\u8D44\u6E90\u91CA\u653E\u3002\u76EE\u524D\uFF0C\u666E\u904D\u7684\u8BA4\u8BC6\u662F\uFF0C\u5C3D\u91CF\u4E0D\u8981\u4F7F\u7528 finalize() \u51FD\u6570\u8FDB\u884C\u8D44\u6E90\u91CA\u653E\uFF0C\u539F\u56E0\u4E3B\u8981\u6709\u4EE5\u4E0B\u51E0\u70B9\uFF1A</p><ul><li><p>\u7B2C 4 \u7AE0\u66FE\u63D0\u5230\uFF0C\u5728\u4F7F\u7528 finalize() \u51FD\u6570\u65F6\u53EF\u80FD\u4F1A\u5BFC\u81F4\u5BF9\u8C61\u590D\u6D3B\u3002</p></li><li><p>finalize() \u51FD\u6570\u7684\u6267\u884C\u65F6\u95F4\u662F\u6CA1\u6709\u4FDD\u969C\u7684\uFF0C\u5B83\u5B8C\u5168\u7531 GC \u7EBF\u7A0B\u51B3\u5B9A\uFF0C\u5728\u6781\u7AEF\u60C5\u51B5\u4E0B\uFF0C\u82E5\u4E0D\u53D1\u751F GC\uFF0Cfinalize() \u51FD\u6570\u5C06\u6CA1\u6709\u673A\u4F1A\u6267\u884C\u3002</p></li><li><p>\u4E00\u4E2A\u7CDF\u7CD5\u7684 finalize() \u51FD\u6570\u4F1A\u4E25\u91CD\u5F71\u54CD GC \u7684\u6027\u80FD\u3002</p></li></ul><p>finalize() \u51FD\u6570\u662F\u7531 FinalizerThread \u7EBF\u7A0B\u5904\u7406\u7684\u3002\u6BCF\u4E00\u4E2A\u5373\u5C06\u88AB\u56DE\u6536\u5E76\u4E14\u5305\u542B finalize() \u51FD\u6570\u7684\u5BF9\u8C61\u90FD\u4F1A\u5728\u6B63\u5F0F\u56DE\u6536\u524D\u52A0\u5165 FinalizerThread \u7684\u6267\u884C\u961F\u5217\uFF0C\u8BE5\u961F\u5217\u4E3A java.lang.ref.ReferenceQueue \u5F15\u7528\u961F\u5217\uFF0C\u5185\u90E8\u5B9E\u73B0\u4E3A\u94FE\u8868\u7ED3\u6784\uFF0C\u961F\u5217\u4E2D\u6BCF\u4E00\u9879\u90FD\u4E3A java.lang.ref.Finalizer \u5F15\u7528\uFF0C\u5B83\u672C\u8D28\u4E3A\u4E00\u4E2A\u5F15\u7528\uFF0C\u5982\u56FE5.13 \u6240\u793A\uFF0C\u8FD9\u548C\u865A\u5F15\u7528\u3001\u5F31\u5F15\u7528\u7B49\u5982\u51FA\u4E00\u8F99\u3002</p><p><img src="`+G+'" alt="\u56FE5-13" loading="lazy"></p><p>\u56FE5.13 java.lang.ref.Finalizer \u5F15\u7528</p><p>Finalizer \u5185\u90E8\u5C01\u88C5\u4E86\u5B9E\u9645\u7684\u56DE\u6536\u5BF9\u8C61\uFF0C\u5982\u56FE5.14 \u6240\u793A\u3002\u53EF\u4EE5\u770B\u5230 next\u3001prev \u4E3A\u5B9E\u73B0\u94FE\u8868\u6240\u9700\uFF0C\u5B83\u4EEC\u5206\u522B\u6307\u5411\u961F\u5217\u4E2D\u7684\u4E0B\u4E00\u4E2A\u5143\u7D20\u548C\u4E0A\u4E00\u4E2A\u5143\u7D20\uFF0C\u800C referent \u5B57\u6BB5\u5219\u6307\u5411\u5B9E\u9645\u7684\u5BF9\u8C61\u5F15\u7528\u3002\u6BD4\u5982\uFF0C\u5728\u540E\u7EED\u7684\u793A\u4F8B\u4E2D\u5C31\u4E3A LongFinalize$LF\u3002</p><p><img src="'+M+'" alt="\u56FE5-14" loading="lazy"></p><p>\u56FE5.14 Finalizer \u4E3B\u8981\u7ED3\u6784</p><p>\u7531\u4E8E\u5BF9\u8C61\u5728\u56DE\u6536\u524D\u88AB Finalizer \u7684 referent \u5B57\u6BB5\u8FDB\u884C \u201C\u5F3A\u5F15\u7528\u201D\uFF0C\u5E76\u52A0\u5165\u4E86 FinalizerThread \u7684\u6267\u884C\u961F\u5217\uFF0C\u8FD9\u610F\u5473\u7740\u5BF9\u8C61\u53C8\u53D8\u4E3A\u53EF\u8FBE\u5BF9\u8C61\uFF0C\u56E0\u6B64\u963B\u6B62\u4E86\u5BF9\u8C61\u7684\u6B63\u5E38\u56DE\u6536\u3002\u7531\u4E8E\u5728\u5F15\u7528\u961F\u5217\u4E2D\u7684\u5143\u7D20\u6392\u961F\u6267\u884C finalize() \u51FD\u6570\uFF0C\u4E00\u65E6\u51FA\u73B0\u6027\u80FD\u95EE\u9898\uFF0C\u5C06\u5BFC\u81F4\u8FD9\u4E9B\u5783\u573E\u5BF9\u8C61\u957F\u65F6\u95F4\u5806\u79EF\u5728\u5185\u5B58\u4E2D\uFF0C\u53EF\u80FD\u4F1A\u5BFC\u81F4 OOM\u3002</p><p>\u56FE5.15 \u663E\u793A\u4E86 FinalizerThread \u7684\u5DE5\u4F5C\u8FC7\u7A0B\u548C FinalizerThread \u6267\u884C\u961F\u5217\u4E2D Finalizer \u7684\u5F15\u7528\u5173\u7CFB\u3002</p><p><img src="'+K+`" alt="\u56FE5-15" loading="lazy"></p><p>\u56FE5.15 FinalizerThread \u6267\u884C\u961F\u5217</p><p>\u3010\u793A\u4F8B 5-8\u3011\u4EE5\u4E0B\u4EE3\u7801\u6F14\u793A\u4E86\u4E00\u4E2A\u62E5\u6709\u7CDF\u7CD5\u7684 finalize() \u5B9E\u73B0\u5BF9\u8C61\u7684\u56DE\u6536\u8FC7\u7A0B\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LongFinalize</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">LF</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> content <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> b <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">LF</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> e <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e <span class="token operator">-</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u4E2D\u6709\u4E00\u4E2A\u62E5\u6709\u7CDF\u7CD5 finalize() \u5B9E\u73B0\u7684\u7C7B LongFinalize$LF\uFF08\u8FD9\u662F\u4E00\u4E2A\u5185\u90E8\u7C7B\uFF0C\u56E0\u6B64\u5E26\u6709 $ \u7B26\u53F7\uFF09\u3002\u53EF\u4EE5\u770B\u5230\uFF0C\u5728\u7B2C 8 \u884C\u4E00\u4E2A sleep() \u65B9\u6CD5\u6A21\u62DF\u4E86\u4E00\u4E2A\u8017\u65F6\u64CD\u4F5C\uFF0C\u4E3B\u51FD\u6570\u5219\u4E0D\u65AD\u4EA7\u751F\u65B0\u7684 LF \u5BF9\u8C61\u3002\u4F7F\u7528\u5982\u4E0B\u53C2\u6570\u6267\u884C\u4E0A\u8FF0\u4EE3\u7801\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-Xmx10m -Xms10m -XX:+PrintGCDetails -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=&quot;D:/f.dump&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u7ED3\u679C\u53D1\u751F\u4E86 OOM\uFF0C\u5E76\u5728 D \u76D8\u4E0B\u5F97\u5230\u4E86\u5806\u7684 Dump \u6587\u4EF6\u3002\u4ED4\u7EC6\u9605\u8BFB\u4EE3\u7801\u7B2C 16 ~ 21 \u884C\uFF0C\u4E0D\u96BE\u53D1\u73B0\uFF0C\u6BCF\u6B21\u5FAA\u73AF\u4E2D\u4EA7\u751F\u7684 LF \u5BF9\u8C61\uFF08\u5360\u7528\u5927\u7EA6 512 \u5B57\u8282\uFF09\u90FD\u4F1A\u5728\u4E0B\u4E00\u6B21\u5FAA\u73AF\u4E2D\u5931\u6548\uFF08\u56E0\u4E3A\u5C40\u90E8\u53D8\u91CF\u4F5C\u7528\u57DF\u8FC7\u671F\uFF0C\u5BF9\u8C61\u4E5F\u65E0\u5176\u4ED6\u5F15\u7528\uFF09\uFF0C\u56E0\u6B64\u6240\u6709\u4EA7\u751F\u7684 LF \u5BF9\u8C61\u90FD\u5E94\u8BE5\u53EF\u4EE5\u88AB\u56DE\u6536\u300210MB \u5806\u7A7A\u95F4\u7406\u8BBA\u4E0A\u5E94\u8BE5\u5B8C\u5168\u53EF\u4EE5\u6EE1\u8DB3\u9700\u8981\uFF0C\u53EA\u662F\u9700\u8981\u591A\u8FDB\u884C\u51E0\u6B21 GC\uFF0C\u800C\u8FD9\u91CC\u4E3A\u4EC0\u4E48\u4F9D\u7136\u4F1A\u51FA\u73B0 OOM \u5462\uFF1F\u4F7F\u7528 MAT\uFF08MAT \u7684\u5177\u4F53\u4ECB\u7ECD\u8BF7\u53C2\u8003\u7B2C 7 \u7AE0\uFF09\u6253\u5F00\u5F97\u5230\u7684\u5806\u6587\u4EF6\uFF0C\u5982\u56FE5.16 \u6240\u793A\u3002</p><p><img src="`+f+'" alt="\u56FE5-16" loading="lazy"></p><p>\u56FE5.16 OOM \u65F6\u663E\u793A\u5927\u91CF Finalizer</p><p>\u4ECE\u6700\u5927\u5BF9\u8C61\u4E2D\u53EF\u4EE5\u770B\u5230\uFF0C\u76EE\u524D\u7CFB\u7EDF\u4E2D\u6709\u5927\u91CF\u7684 Finalizer \u7C7B\uFF0C\u8FD9\u610F\u5473\u7740 FinalizerThread \u6267\u884C\u961F\u5217\u53EF\u80FD\u4E00\u76F4\u6301\u6709\u5BF9\u8C61\u800C\u6765\u4E0D\u53CA\u6267\u884C\uFF0C\u56E0\u6B64\u5927\u91CF\u7684\u5BF9\u8C61\u5806\u79EF\u800C\u65E0\u6CD5\u88AB\u91CA\u653E\uFF0C\u6700\u7EC8\u5BFC\u81F4\u4E86\u8FD9\u4E2A OOM\u3002\u4F7F\u7528 MAT \u81EA\u5E26\u7684 \u201DFinalizer Overview\u201C \u529F\u80FD\u53EF\u4EE5\u66F4\u597D\u5730\u89C2\u5BDF\u7CFB\u7EDF\u4E2D\u7684 Finalizer\uFF0C\u5982\u56FE5.17 \u6240\u793A\u3002</p><p><img src="'+X+'" alt="\u56FE5-17" loading="lazy"></p><p>\u56FE5.17 MAT \u7684 Finalizer \u6982\u89C8\u529F\u80FD</p><p>\u4F7F\u7528\u8BE5\u529F\u80FD\u89C2\u5BDF\u672C\u4F8B\u7684 Finalizer\uFF0C\u5982\u56FE5.18 \u6240\u793A\u3002\u8BE5\u89C6\u56FE\u4E2D\u663E\u5F0F\u4E86\u6B63\u5728\u88AB\u6267\u884C finalize() \u51FD\u6570\u7684\u5BF9\u8C61\uFF0C\u4EE5\u53CA\u51C6\u5907\u6267\u884C\u7684\u5BF9\u8C61\u5217\u8868\u3002\u8BFB\u8005\u53EF\u4EE5\u6839\u636E\u8FD9\u4E2A\u529F\u80FD\uFF0C\u6765\u5206\u6790\u7CFB\u7EDF\u4E2D\u5BF9\u8C61\u7684 finalize() \u51FD\u6570\u6267\u884C\u60C5\u51B5\u3002</p><p><img src="'+T+`" alt="\u56FE5-18" loading="lazy"></p><p>\u56FE5.18 FinalizerThread \u6267\u884C\u961F\u5217\u7684\u5C55\u793A</p><p>\u53BB\u6389 LF \u7C7B\u7684 finalize() \u51FD\u6570\uFF0C\u5373\u6CE8\u91CA\u6389\u672C\u4F8B\u4EE3\u7801\u4E2D\u7684\u7B2C 5 ~ 12 \u884C\uFF0C\u518D\u6B21\u4EE5\u76F8\u540C\u7684\u53C2\u6570\u8FD0\u884C\u8FD9\u6BB5\u7A0B\u5E8F\u3002\u53EF\u4EE5\u89C2\u5BDF\u5230\uFF0C\u7A0B\u5E8F\u5F88\u5FEB\u6B63\u5E38\u7ED3\u675F\u3002\u7531\u6B64\u53EF\u4EE5\u8FDB\u4E00\u6B65\u8BF4\u660E finalize() \u51FD\u6570\u5BF9 GC \u4EA7\u751F\u7684\u5F71\u54CD\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1A\u4E00\u4E2A\u7CDF\u7CD5\u7684 finalize() \u51FD\u6570\u53EF\u80FD\u4F1A\u4F7F\u5BF9\u8C61\u957F\u65F6\u95F4\u88AB Finalizer \u5F15\u7528\uFF0C\u800C\u5F97\u4E0D\u5230\u91CA\u653E\uFF0C\u8FD9\u4F1A\u8FDB\u4E00\u6B65\u589E\u52A0 GC \u7684\u538B\u529B\u3002\u56E0\u6B64\uFF0C\u5E94\u8BE5\u662F\u5C3D\u91CF\u5C11\u5730\u4F7F\u7528 finalize() \u51FD\u6570\u3002</p><p>\u867D\u7136\u4E0D\u63A8\u8350\u4F7F\u7528 finalize() \u51FD\u6570\uFF0C\u4F46\u662F\u5728\u6709\u4E9B\u573A\u5408\uFF0C\u4F7F\u7528 finalize() \u51FD\u6570\u53EF\u4EE5\u8D77\u5230\u53CC\u4FDD\u9669\u7684\u4F5C\u7528\u3002\u6BD4\u5982\u5728 MySQL \u7684 JDBC \u9A71\u52A8\u4E2D\uFF0Ccom.mysql.jdbc.ConnectionImpl \u5C31\u5B9E\u73B0\u4E86 finalize() \u51FD\u6570\uFF0C\u5B9E\u73B0\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
    <span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E5F\u5C31\u662F\uFF0C\u5F53\u4E00\u4E2A JDBC Connection \u88AB\u56DE\u6536\u65F6\uFF0C\u9700\u8981\u8FDB\u884C\u8FDE\u63A5\u7684\u5173\u95ED\uFF0C\u5373\u8FD9\u91CC\u7684 cleanup() \u65B9\u6CD5\u3002\u4E8B\u5B9E\u4E0A\uFF0C\u5728\u56DE\u6536\u524D\uFF0C\u5F00\u53D1\u4EBA\u5458\u5982\u679C\u6B63\u5E38\u8C03\u7528\u4E86 Connection.close() \u65B9\u6CD5\uFF0C\u8FDE\u63A5\u5C31\u4F1A\u88AB\u663E\u5F0F\u5173\u95ED\uFF0C\u90A3\u6837\u7684\u8BDD\uFF0C\u5728 cleanup() \u65B9\u6CD5\u4E2D\u5C06\u4EC0\u4E48\u90FD\u4E0D\u4F1A\u505A\u3002\u800C\u5982\u679C\u5F00\u53D1\u4EBA\u5458\u5FD8\u8BB0\u663E\u5F0F\u5173\u95ED\u8FDE\u63A5\uFF0C\u800C Connection \u5BF9\u8C61\u53C8\u88AB\u56DE\u6536\u4E86\uFF0C\u5219\u4F1A\u9690\u5F0F\u5730\u8FDB\u884C\u8FDE\u63A5\u7684\u5173\u95ED\uFF0C\u786E\u4FDD\u6CA1\u6709\u6570\u636E\u5E93\u8FDE\u63A5\u6CC4\u6F0F\u3002\u800C\u4E00\u822C\u6765\u8BF4\uFF0C\u5B98\u65B9\u9F13\u52B1\u5F00\u53D1\u4EBA\u5458\u5728\u5F00\u53D1\u8FC7\u7A0B\u4E2D\u663E\u5F0F\u5173\u95ED\u6570\u636E\u5E93\u8FDE\u63A5\u3002\u56E0\u6B64\uFF0Cfinalize() \u51FD\u6570\u53EF\u80FD\u4F1A\u88AB\u4F5C\u4E3A\u4E00\u79CD\u8865\u507F\u63AA\u65BD\uFF0C\u5728\u6B63\u5E38\u65B9\u6CD5\u51FA\u73B0\u610F\u5916\u65F6\uFF08\u5F00\u53D1\u4EBA\u5458\u758F\u5FFD\uFF09\u8FDB\u884C\u8865\u507F\uFF0C\u5C3D\u53EF\u80FD\u786E\u4FDD\u7CFB\u7EDF\u7A33\u5B9A\u3002\u5F53\u7136\uFF0C\u7531\u4E8E\u5176\u8C03\u7528\u65F6\u95F4\u7684\u4E0D\u786E\u5B9A\u6027\uFF0C\u8FD9\u4E0D\u80FD\u5355\u72EC\u4F5C\u4E3A\u53EF\u9760\u7684\u8D44\u6E90\u56DE\u6536\u624B\u6BB5\u3002</p><h2 id="_5-6-\u6E29\u6545\u53C8\u77E5\u65B0-\u5E38\u7528\u7684-gc-\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#_5-6-\u6E29\u6545\u53C8\u77E5\u65B0-\u5E38\u7528\u7684-gc-\u53C2\u6570" aria-hidden="true">#</a> 5.6 \u6E29\u6545\u53C8\u77E5\u65B0\uFF1A\u5E38\u7528\u7684 GC \u53C2\u6570</h2><ol><li><p>\u4E0E\u4E32\u884C\u56DE\u6536\u5668\u76F8\u5173\u7684\u53C2\u6570</p><ul><li>-XX:+UseSerialGC\uFF1A\u5728\u65B0\u751F\u4EE3\u548C\u8001\u5E74\u4EE3\u4F7F\u7528\u4E32\u884C\u56DE\u6536\u5668\u3002</li><li>-XX:SurvivorRatio\uFF1A\u8BBE\u7F6E eden \u533A\u5927\u5C0F\u548C survivior \u533A\u5927\u5C0F\u7684\u6BD4\u4F8B\u3002</li><li>-XX:PretenureSizeThreshold\uFF1A\u8BBE\u7F6E\u5927\u5BF9\u8C61\u76F4\u63A5\u8FDB\u5165\u8001\u5E74\u4EE3\u7684\u9608\u503C\u3002\u5F53\u5BF9\u8C61\u7684\u5927\u5C0F\u8D85\u8FC7\u8FD9\u4E2A\u503C\u65F6\uFF0C\u5C06\u76F4\u63A5\u88AB\u5206\u914D\u5728\u8001\u5E74\u4EE3\u3002</li><li>-XX:MaxTenuringThreshold\uFF1A\u8BBE\u7F6E\u5BF9\u8C61\u8FDB\u5165\u8001\u5E74\u4EE3\u7684\u5E74\u9F84\u7684\u6700\u5927\u503C\u3002\u6BCF\u4E00\u6B21 Minor GC \u540E\uFF0C\u5BF9\u8C61\u5E74\u9F84\u5C31\u52A0 1\u3002\u4EFB\u4F55\u5927\u4E8E\u8FD9\u4E2A\u5E74\u9F84\u7684\u5BF9\u8C61\uFF0C\u4E00\u5B9A\u4F1A\u8FDB\u5165\u8001\u5E74\u4EE3\u3002</li></ul></li><li><p>\u4E0E\u5E76\u884C GC \u76F8\u5173\u7684\u53C2\u6570</p><ul><li>-XX:+UseParNewGC\uFF08\u8003\u8651\u5230\u517C\u5BB9\u6027\u95EE\u9898\uFF0CJDK 9\u3001JDK 10 \u5DF2\u7ECF\u5220\u9664\uFF09\uFF1A\u5728\u65B0\u751F\u4EE3\u4F7F\u7528\u5E76\u884C\u56DE\u6536\u5668\u3002</li><li>-XX:+UseParallelOldGC\uFF1A\u8001\u5E74\u4EE3\u4F7F\u7528\u5E76\u884C\u56DE\u6536\u5668\u3002</li><li>-XX:ParallelGCThreads\uFF1A\u8BBE\u7F6E\u7528\u4E8E\u5783\u573E\u56DE\u6536\u7684\u7EBF\u7A0B\u6570\u3002\u901A\u5E38\u60C5\u51B5\u4E0B\u53EF\u4EE5\u548C CPU \u6570\u91CF\u76F8\u7B49\uFF0C\u4F46\u5728 CPU \u6570\u91CF\u6BD4\u8F83\u591A\u7684\u60C5\u51B5\u4E0B\uFF0C\u8BBE\u7F6E\u76F8\u5BF9\u8F83\u5C0F\u7684\u6570\u503C\u4E5F\u662F\u5408\u7406\u7684\u3002</li><li>-XX:MaxGCPauseMillis\uFF1A\u8BBE\u7F6E\u6700\u5927\u5783\u573E\u56DE\u6536\u505C\u987F\u65F6\u95F4\u3002\u5B83\u7684\u503C\u662F\u4E00\u4E2A\u5927\u4E8E 0 \u7684\u6574\u6570\u3002\u56DE\u6536\u5668\u5728\u5DE5\u4F5C\u65F6\uFF0C\u4F1A\u8C03\u6574 Java \u5806\u5927\u5C0F\u6216\u8005\u5176\u4ED6\u4E00\u4E9B\u53C2\u6570\uFF0C\u5C3D\u53EF\u80FD\u5730\u628A\u505C\u987F\u65F6\u95F4\u63A7\u5236\u5728 MaxGCPauseMillis \u4EE5\u5185\u3002</li><li>-XX:GCTimeRatio\uFF1A\u8BBE\u7F6E\u541E\u5410\u91CF\u5927\u5C0F\u3002\u5B83\u7684\u503C\u662F\u4E00\u4E2A 0 \u5230 100 \u4E4B\u95F4\u7684\u6574\u6570\u3002\u5047\u8BBE GCTimeRatio \u7684\u503C\u4E3A n\uFF0C\u90A3\u4E48\u7CFB\u7EDF\u5C06\u82B1\u8D39\u4E0D\u8D85\u8FC7 1 / (1 + n) \u7684\u65F6\u95F4\u7528\u4E8E\u5783\u573E\u56DE\u6536\u3002</li><li>-XX:+UseAdaptiveSizePolicy\uFF1A\u6253\u5F00\u81EA\u9002\u5E94 GC \u7B56\u7565\u3002\u5728\u8FD9\u79CD\u6A21\u5F0F\u4E0B\uFF0C\u65B0\u751F\u4EE3\u7684\u5927\u5C0F\u3001edcn \u533A\u548C survivior \u533A\u7684\u6BD4\u4F8B\u3001\u664B\u5347\u8001\u5E74\u4EE3\u7684\u5BF9\u8C61\u5E74\u9F84\u7B49\u53C2\u6570\u4F1A\u88AB\u81EA\u52A8\u8C03\u6574\uFF0C\u4EE5\u8FBE\u5230\u5728\u5806\u5927\u5C0F\u3001\u541E\u5410\u91CF\u548C\u505C\u987F\u65F6\u95F4\u4E4B\u95F4\u7684\u5E73\u8861\u3002</li></ul></li><li><p>\u4E0E CMS \u56DE\u6536\u5668\u76F8\u5173\u7684\u53C2\u6570\uFF08JDK 9\u3001JDK 10 \u5DF2\u7ECF\u5F00\u59CB\u5E9F\u5F03 CMS \u56DE\u6536\u5668\uFF0C\u5EFA\u8BAE\u4F7F\u7528 G1\u56DE\u6536\u5668\uFF09</p><ul><li>-XX:+UseConcMarkSweepGC\uFF1A\u65B0\u751F\u4EE3\u4F7F\u7528\u5E76\u884C\u56DE\u6536\u5668\uFF0C\u8001\u5E74\u4EE3\u4F7F\u7528 CMS + \u4E32\u884C\u56DE\u6536\u5668\u3002</li><li>-XX:ParallelCMSThreads\uFF1A\u8BBE\u5B9A CMS \u7684\u7EBF\u7A0B\u6570\u91CF\u3002</li><li>-XX:CMSInitiatingOccupancyFraction\uFF1A\u8BBE\u7F6E CMS \u56DE\u6536\u5668\u5728\u8001\u5E74\u4EE3\u7A7A\u95F4\u88AB\u4F7F\u7528\u591A\u5C11\u540E\u89E6\u53D1\uFF0C\u9ED8\u8BA4\u4E3A 68%\u3002</li><li>-XX:+UseCMSCompactAtFullCollection\uFF1A\u8BBE\u7F6E CMS \u56DE\u6536\u5668\u5728\u5B8C\u6210\u5783\u573E\u56DE\u6536\u540E\u662F\u5426\u8981\u8FDB\u884C\u4E00\u6B21\u5185\u5B58\u788E\u7247\u7684\u6574\u7406\u3002</li><li>-XX:CMSFullGCsBefbreCompaction\uFF1A\u8BBE\u5B9A\u8FDB\u884C\u591A\u5C11\u6B21 CMS \u5783\u573E\u56DE\u6536\u540E\uFF0C\u8FDB\u884C\u4E00\u6B21\u5185\u5B58\u538B\u7F29\u3002</li><li>-XX:+CMSClassUnloadingEnabled\uFF1A\u5141\u8BB8\u5BF9\u7C7B\u5143\u6570\u636E\u533A\u8FDB\u884C\u56DE\u6536\u3002</li><li>-XX:CMSInitiatingPermOccupancyFraction\uFF1A\u5F53\u6C38\u4E45\u533A\u5360\u7528\u7387\u8FBE\u5230\u8FD9\u4E00\u767E\u5206\u6BD4\u65F6\uFF0C\u542F\u52A8 CMS \u56DE\u6536\uFF08\u524D\u63D0\u662F\u6FC0\u6D3B\u4E86 -XX:+CMSClassUnloadingEnabled\uFF09\u3002</li><li>-XX:UseCMSInitiatingOccupancyOnly\uFF1A\u8868\u793A\u53EA\u5728\u5230\u8FBE\u9608\u503C\u7684\u65F6\u5019\u624D\u8FDB\u884C CMS \u56DE\u6536\u3002</li><li>-XX:+CMSIncrementalMode\uFF1A\u4F7F\u7528\u589E\u91CF\u6A21\u5F0F\uFF0C\u6BD4\u8F83\u9002\u5408\u5355 CPU\u3002\u589E\u91CF\u6A21\u5F0F\u5728 JDK 8 \u4E2D\u6807\u8BB0\u4E3A\u5E9F\u5F03\uFF0C\u5E76\u4E14\u5C06\u5728 JDK 9 \u4E2D\u5F7B\u5E95\u79FB\u9664\u3002</li></ul></li><li><p>\u4E0E G1 \u56DE\u6536\u5668\u76F8\u5173\u7684\u53C2\u6570</p><ul><li>-XX:+UseG1GC\uFF1A\u4F7F\u7528 G1 \u56DE\u6536\u5668\u3002</li><li>-XX:MaxGCPauseMillis\uFF1A\u8BBE\u7F6E\u6700\u5927\u5783\u573E\u56DE\u6536\u505C\u987F\u65F6\u95F4\u3002</li><li>-XX:GCPauseIntervalMillis\uFF1A\u8BBE\u7F6E\u505C\u987F\u95F4\u9694\u65F6\u95F4\u3002</li></ul></li><li><p>TLAB \u76F8\u5173</p><ul><li>-XX:+UseTLAB\uFF1A\u5F00\u542F TLAB \u5206\u914D\u3002</li><li>-XX:+PrintTLAB\uFF08\u8003\u8651\u5230\u517C\u5BB9\u6027\u95EE\u9898\uFF0CJDK 9\u3001JDK 10 \u4E0D\u518D\u652F\u6301\u6B64\u53C2\u6570\uFF09\uFF1A\u6253\u5370 TLAB \u76F8\u5173\u5206\u914D\u4FE1\u606F\u3002</li><li>-XX:TLABSize\uFF1A\u8BBE\u7F6E TLAB \u533A\u57DF\u5927\u5C0F\u3002</li><li>-XX:+ResizeTLAB\uFF1A\u81EA\u52A8\u8C03\u6574 TLAB \u533A\u57DF\u5927\u5C0F\u3002</li></ul></li><li><p>\u5176\u4ED6\u53C2\u6570</p><ul><li>-XX:+DisableExplicitGC\uFF1A\u7981\u7528\u663E\u5F0F GC\u3002</li><li>-XX:+ExplicitGClnvokesConcurrent\uFF1A\u4F7F\u7528\u5E76\u53D1\u65B9\u5F0F\u5904\u7406\u663E\u5F0F GC\u3002</li></ul></li></ol><h2 id="_5-7-\u52A8\u624B\u624D\u662F\u771F\u82F1\u96C4-\u5783\u573E\u56DE\u6536\u5668\u5BF9-tomcat-\u6027\u80FD\u5F71\u54CD\u7684\u5B9E\u9A8C" tabindex="-1"><a class="header-anchor" href="#_5-7-\u52A8\u624B\u624D\u662F\u771F\u82F1\u96C4-\u5783\u573E\u56DE\u6536\u5668\u5BF9-tomcat-\u6027\u80FD\u5F71\u54CD\u7684\u5B9E\u9A8C" aria-hidden="true">#</a> 5.7 \u52A8\u624B\u624D\u662F\u771F\u82F1\u96C4\uFF1A\u5783\u573E\u56DE\u6536\u5668\u5BF9 Tomcat \u6027\u80FD\u5F71\u54CD\u7684\u5B9E\u9A8C</h2><p>\u4E0D\u540C\u7684\u5783\u573E\u56DE\u6536\u5668\u548C\u5806\u5927\u5C0F\u5BF9 Java \u5E94\u7528\u7A0B\u5E8F\u7684\u6027\u80FD\u6709\u4E00\u5B9A\u7684\u5F71\u54CD\u3002\u4E3A\u4E86\u63D0\u9AD8\u7CFB\u7EDF\u7684\u6027\u80FD\uFF0C\u5E94\u8BE5\u914D\u7F6E\u4E00\u4E9B\u5408\u7406\u7684\u865A\u62DF\u673A\u53C2\u6570\uFF0C\u6BD4\u5982\u5806\u5927\u5C0F\u3001\u5783\u573E\u56DE\u6536\u5668\u7C7B\u578B\u7B49\u3002\u7CFB\u7EDF\u7684\u6027\u80FD\u7531\u5F88\u591A\u65B9\u9762\u51B3\u5B9A\uFF0C\u6BD4\u5982\u7A0B\u5E8F\u4EE3\u7801\u7684\u8D28\u91CF\u3001\u786C\u4EF6\u7684\u6027\u80FD\u53CA\u7F51\u7EDC\u5E26\u5BBD\u7684\u5EF6\u8FDF\u7B49\uFF0C\u5F53\u7136\u865A\u62DF\u673A\u53C2\u6570\u4E5F\u662F\u91CD\u8981\u7684\u4E00\u73AF\uFF0C\u662F\u4FDD\u969C\u7CFB\u7EDF\u6027\u80FD\u7684\u5FC5\u8981\u975E\u5145\u5206\u6761\u4EF6\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C\u5982\u679C\u7CFB\u7EDF\u6027\u80FD\u4E0D\u4EE4\u4EBA\u6EE1\u610F\uFF0C\u4EC5\u8C03\u6574\u865A\u62DF\u673A\u53C2\u6570\u4E5F\u8BB8\u6839\u672C\u65E0\u6CD5\u89E3\u51B3\u95EE\u9898\uFF0C\u4E00\u4E2A\u7CDF\u7CD5\u7684\u7CFB\u7EDF\u5B9E\u73B0\u662F\u6CA1\u6709\u529E\u6CD5\u7528\u865A\u62DF\u673A\u53C2\u6570\u6765\u5F25\u8865\u7684\uFF0C\u4F46\u4E00\u4E2A\u826F\u597D\u7684\u7CFB\u7EDF\u5B9E\u73B0\u52A0\u4E0A\u4E00\u4E2A\u7CDF\u7CD5\u7684\u53C2\u6570\u914D\u7F6E\uFF0C\u7CFB\u7EDF\u6027\u80FD\u4E5F\u4E0D\u4F1A\u6709\u4EE4\u4EBA\u6EE1\u610F\u7684\u8868\u73B0\u3002</p><h3 id="_5-7-1-\u914D\u7F6E\u5B9E\u9A8C\u73AF\u5883" tabindex="-1"><a class="header-anchor" href="#_5-7-1-\u914D\u7F6E\u5B9E\u9A8C\u73AF\u5883" aria-hidden="true">#</a> 5.7.1 \u914D\u7F6E\u5B9E\u9A8C\u73AF\u5883</h3><p>\u672C\u5B9E\u9A8C\u5C06\u4F7F\u7528\u4E0D\u540C\u7684\u865A\u62DF\u673A\u53C2\u6570\u542F\u52A8 Tomcat \u670D\u52A1\u5668\uFF0C\u901A\u8FC7\u538B\u529B\u6D4B\u8BD5\uFF0C\u83B7\u5F97\u865A\u62DF\u673A\u7684\u4E3B\u8981\u6027\u80FD\u6307\u6807\uFF0C\u4F53\u9A8C\u4E0D\u540C\u53C2\u6570\u5BF9\u7CFB\u7EDF\u6027\u80FD\u7684\u5F71\u54CD\u3002\u5B9E\u9A8C\u80CC\u666F\u5982\u4E0B\uFF1A</p><ul><li><p>\u73AF\u5883</p><ul><li>Tomcat 7</li><li>\u4E00\u4E2A JSP \u7F51\u7AD9</li><li>\u6D4B\u8BD5\u7F51\u7AD9\u7684\u541E\u5410\u91CF</li></ul></li><li><p>\u5DE5\u5177</p><ul><li>Apache JMeter</li></ul></li><li><p>\u5B9E\u9A8C\u539F\u7406</p><ul><li>\u901A\u8FC7 JMeter \u5BF9 Tomcat \u589E\u52A0\u538B\u529B\uFF0C\u4E0D\u540C\u7684\u865A\u62DF\u673A\u53C2\u6570\u5E94\u8BE5\u4F1A\u6709\u4E0D\u540C\u7684\u6027\u80FD\u8868\u73B0</li></ul></li><li><p>\u76EE\u7684</p><ul><li>\u89C2\u5BDF\u4E0D\u540C\u53C2\u6570\u914D\u7F6E\u5BF9\u541E\u5410\u91CF\u7684\u5F71\u54CD</li></ul></li></ul><p>\u5B9E\u9A8C\u7CFB\u7EDF\u7ED3\u6784\u5982\u56FE5.19 \u6240\u793A\uFF0C\u4E3A\u9632\u6B62 JMeter \u5BF9 Tomcat \u4EA7\u751F\u5F71\u54CD\uFF0C\u6D4B\u8BD5\u65F6\u4F7F\u7528\u4E24\u53F0\u72EC\u7ACB\u7684\u8BA1\u7B97\u673A\uFF0C\u901A\u8FC7\u5C40\u57DF\u7F51\u8FDE\u63A5\u3002</p><p><img src="`+y+'" alt="\u56FE5-19" loading="lazy"></p><p>\u56FE5.19 \u5B9E\u9A8C\u7CFB\u7EDF\u7ED3\u6784</p><h3 id="_5-7-2-\u914D\u7F6E\u6027\u80FD\u6D4B\u8BD5\u5DE5\u5177-jmeter" tabindex="-1"><a class="header-anchor" href="#_5-7-2-\u914D\u7F6E\u6027\u80FD\u6D4B\u8BD5\u5DE5\u5177-jmeter" aria-hidden="true">#</a> 5.7.2 \u914D\u7F6E\u6027\u80FD\u6D4B\u8BD5\u5DE5\u5177 JMeter</h3><p>JMeter \u662F Apache \u4E0B\u57FA\u4E8E Java \u7684\u4E00\u6B3E\u6027\u80FD\u6D4B\u8BD5\u548C\u538B\u529B\u6D4B\u8BD5\u5DE5\u5177\u3002\u5B83\u57FA\u4E8E Java \u5F00\u53D1\uFF0C\u53EF\u5BF9 HTTP \u670D\u52A1\u5668\u548C FTP \u670D\u52A1\u5668\uFF0C\u751A\u81F3\u6570\u636E\u5E93\u8FDB\u884C\u538B\u529B\u6D4B\u8BD5\u3002\u4F5C\u4E3A\u4E00\u6B3E\u4E13\u4E1A\u7684\u538B\u529B\u6D4B\u8BD5\u5DE5\u5177\uFF0CJMeter \u529F\u80FD\u5F3A\u5927\uFF0C\u672C\u8282\u4EC5\u7B80\u8981\u4ECB\u7ECD\u4E0E\u672C\u6B21\u5B9E\u9A8C\u76F8\u5173\u7684\u529F\u80FD\u3002</p><p>JMeter \u7684\u8FD0\u884C\u4E3B\u754C\u9762\u5982\u56FE5.20 \u6240\u793A\uFF0C\u4E0B\u9762\u5F00\u59CB\u8BE6\u7EC6\u8BB2\u8FF0\u8BBE\u7F6E\u6B65\u9AA4\u3002</p><p><img src="'+S+'" alt="\u56FE5-20" loading="lazy"></p><p>\u56FE5.20 JMeter \u7684\u8FD0\u884C\u4E3B\u754C\u9762</p><ol><li><p>\u4E3A\u4E86\u80FD\u591F\u4F7F\u7528 JMeter \u5BF9 Tomcat \u670D\u52A1\u5668\u8FDB\u884C\u6027\u80FD\u6D4B\u8BD5\uFF0C\u9996\u5148\u9700\u8981\u6DFB\u52A0\u7EBF\u7A0B\u7EC4\uFF0C\u7EBF\u7A0B\u7EC4\u5C06\u6A21\u62DF\u7528\u6237\u7EBF\u7A0B\u8BBF\u95EE Tomcat \u670D\u52A1\u5668\u3002\u56FE5.21 \u663E\u793A\u4E86\u5982\u4F55\u5728 JMeter \u4E2D\u6DFB\u52A0\u7EBF\u7A0B\u7EC4\u3002</p><p><img src="'+_+'" alt="\u56FE5-21" loading="lazy"></p><p>\u56FE5.21 \u5728 JMeter \u4E2D\u6DFB\u52A0\u7EBF\u7A0B\u7EC4</p></li><li><p>\u4F7F\u7528\u7EBF\u7A0B\u7EC4\u53EF\u4EE5\u8BBE\u7F6E\u8BF7\u6C42\u7684\u5F3A\u5EA6\uFF0C\u5982\u56FE5.22 \u6240\u793A\uFF0C\u8BBE\u7F6E\u4E86 10 \u4E2A\u7EBF\u7A0B\uFF0C\u5E76\u4E14\u89C4\u5B9A\u6BCF\u4E2A\u7EBF\u7A0B\u8FDB\u884C 1000 \u6B21\u8BF7\u6C42\u3002\u8FD9\u6837\uFF0CTomcat \u5C31\u4F1A\u5728\u8FD9\u6B21\u7EBF\u7A0B\u7EC4\u7684\u8FD0\u884C\u4E2D\uFF0C\u6536\u5230 10000 \u6B21\u8BF7\u6C42\u3002</p><p><img src="'+P+'" alt="\u56FE5-22" loading="lazy"></p><p>\u56FE5.22 \u5728 JMeter \u4E2D\u914D\u7F6E\u7EBF\u7A0B\u7EC4</p></li><li><p>\u9664\u4E86\u7EBF\u7A0B\u7EC4\uFF0C\u8981\u8BA9 JMeter \u6B63\u5E38\u5DE5\u4F5C\u8FD8\u9700\u8981\u4E00\u4E2A\u91C6\u6837\u5668\u3002\u91C6\u6837\u5668\u7528\u4E8E\u5BF9\u5177\u4F53\u7684\u8BF7\u6C42\u8FDB\u884C\u6027\u80FD\u6570\u636E\u7684\u91C7\u6837\uFF0C\u5982\u56FE5.23 \u6240\u793A\u3002\u672C\u4F8B\u4E2D\uFF0C\u9700\u8981\u6DFB\u52A0\u7684\u662F HTTP \u8BF7\u6C42\u7684\u91C7\u6837\u3002</p><p><img src="'+w+'" alt="\u56FE5-23" loading="lazy"></p><p>\u56FE5.23 \u6DFB\u52A0\u91C7\u6837\u5668</p></li><li><p>\u5BF9\u4E8E\u6DFB\u52A0\u7684 HTTP \u8BF7\u6C42\uFF0C\u8FD8\u9700\u8981\u5BF9\u8BF7\u6C42\u7684\u5177\u4F53\u76EE\u6807\u8FDB\u884C\u8BBE\u7F6E\uFF0C\u6BD4\u5982\u76EE\u6807\u670D\u52A1\u5668\u7684\u5730\u5740\u3001\u7AEF\u53E3\u53F7\u3001\u8BBF\u95EE\u8DEF\u5F84\u7B49\u4FE1\u606F\uFF0C\u5982\u56FE5.24 \u6240\u793A\u3002JMeter \u4F1A\u6309\u7167\u8BBE\u7F6E\u7684\u8981\u6C42\u8FDB\u884C\u6279\u91CF\u7684\u8BF7\u6C42\u8BBF\u95EE\u3002</p><p><img src="'+A+'" alt="\u56FE5-24" loading="lazy"></p><p>\u56FE5.24 \u8BBE\u7F6EHTTP\u8BF7\u6C42</p></li><li><p>\u5BF9\u4E8E\u6279\u91CF\u8BF7\u6C42\u7684\u8BBF\u95EE\u7ED3\u679C\uFF0CJMeter \u53EF\u4EE5\u4EE5\u62A5\u544A\u7684\u5F62\u5F0F\u5448\u73B0\u51FA\u6765\u3002\u5728\u76D1\u542C\u5668\u4E2D\uFF0C\u6DFB\u52A0\u805A\u5408\u62A5\u544A\uFF0C\u5982\u56FE5.25 \u6240\u793A\u3002\u805A\u5408\u62A5\u544A\u53EF\u4EE5\u7EDF\u8BA1\u6574\u4E2A\u6D4B\u8BD5\u7684\u6027\u80FD\u53C2\u6570\u3002</p><p><img src="'+B+'" alt="\u56FE5-25" loading="lazy"></p><p>\u56FE5.25 \u6DFB\u52A0\u805A\u5408\u62A5\u544A</p></li><li><p>\u6DFB\u52A0\u540E\uFF0C\u805A\u5408\u62A5\u544A\u7684\u5185\u5BB9\u5982\u56FE5.26 \u6240\u793A\u3002\u62A5\u544A\u4E2D\u4E3B\u8981\u5185\u5BB9\u4E3A\u6BCF\u6B21\u8BF7\u6C42\u7684\u5EF6\u65F6\u60C5\u51B5\u548C\u541E\u5410\u91CF\u3002\u8FD9\u91CC\u4E3B\u8981\u5173\u6CE8\u541E\u5410\u91CF\uFF0C\u5373\u56FE\u4E2D\u7528\u9ED1\u8272\u77E9\u5F62\u6807\u6CE8\u90E8\u5206\u3002</p><p><img src="'+z+'" alt="\u56FE5-26" loading="lazy"></p><p>\u56FE5.26 \u805A\u5408\u62A5\u544A\u7684\u5185\u5BB9</p></li></ol><p>\u81F3\u6B64\uFF0C\u5DF2\u7ECF\u5B8C\u6574\u4ECB\u7ECD\u4E86\u901A\u8FC7 JMeter \u5EFA\u7ACB\u7EBF\u7A0B\u7EC4\u3001\u91C6\u6837\u5668\u548C\u805A\u5408\u62A5\u544A\u6765\u8FDB\u884C\u538B\u529B\u6D4B\u8BD5\u5E76\u83B7\u5F97\u6D4B\u8BD5\u7ED3\u679C\u7684\u65B9\u6CD5\uFF0C\u672C\u5B9E\u9A8C\u5C06\u4F7F\u7528\u8FD9\u4E2A\u65B9\u6CD5\u83B7\u5F97 Tomcat \u7684\u6D4B\u8BD5\u7ED3\u679C\u3002</p><h3 id="_5-7-3-\u914D\u7F6E-web-\u5E94\u7528\u670D\u52A1\u5668-tomcat" tabindex="-1"><a class="header-anchor" href="#_5-7-3-\u914D\u7F6E-web-\u5E94\u7528\u670D\u52A1\u5668-tomcat" aria-hidden="true">#</a> 5.7.3 \u914D\u7F6E Web \u5E94\u7528\u670D\u52A1\u5668 Tomcat</h3><p>Tomcat \u670D\u52A1\u5668\u662F\u4E00\u4E2A\u514D\u8D39\u7684\u5F00\u653E\u6E90\u4EE3\u7801 Web \u5E94\u7528\u670D\u52A1\u5668\u3002Tomcat \u662F Apache \u8F6F\u4EF6\u57FA\u91D1\u4F1A\uFF08Apache Software Foundation\uFF09\u7684 Jakarta \u9879\u76EE\u4E2D\u7684\u4E00\u4E2A\u6838\u5FC3\u9879\u76EE\uFF0C\u7531 Apache\u3001Sun \u548C\u5176\u4ED6\u4E00\u4E9B\u516C\u53F8\u53CA\u4E2A\u4EBA\u5171\u540C\u5F00\u53D1\u800C\u6210\u3002\u5B83\u5B8C\u5168\u57FA\u4E8E Java \u5E73\u53F0\uFF0C\u4E5F\u662F\u76EE\u524D\u4F7F\u7528\u6700\u5E7F\u6CDB\u7684 Servlet \u5BB9\u5668\u4E4B\u4E00\u3002Tomcat \u5B89\u88C5\u5B8C\u6210\u540E\uFF0C\u76EE\u5F55\u7ED3\u6784\u5982\u56FE5.27 \u6240\u793A\u3002</p><p><img src="'+L+'" alt="\u56FE5-27" loading="lazy"></p><p>\u56FE5.27 Tomcat \u76EE\u5F55\u7ED3\u6784</p><p>\u4E3B\u8981\u76EE\u5F55\u8BF4\u660E\u5982\u4E0B\uFF1A</p><ul><li><p>bin \u76EE\u5F55\u4E0B\u662F Tomcat \u7684\u542F\u52A8\u3001\u5173\u95ED\u7684\u7A0B\u5E8F\u3002</p></li><li><p>conf \u76EE\u5F55\u4E0B\u662F Tomcat \u670D\u52A1\u5668\u7684\u914D\u7F6E\u6587\u4EF6\uFF0C\u5305\u62EC Tomcat \u7684\u6743\u9650\u7BA1\u7406\u3001\u7EBF\u7A0B\u6C60\u3001\u7AEF\u53E3\u53F7\u7B49\u914D\u7F6E\u4FE1\u606F\u3002</p></li><li><p>webapps \u76EE\u5F55\u4E0B\u5B58\u653E\u90E8\u7F72\u5728 Tomcat \u4E0B\u7684 Web \u5E94\u7528\uFF0C\u6BCF\u4E2A\u5E94\u7528\u5BF9\u5E94\u4E00\u4E2A\u6587\u4EF6\u5939\u6216\u8005 war \u5305\u3002</p></li></ul>',269),Y=e("Tomcat \u662F\u4E00\u4E2A\u6807\u51C6\u7684 Java \u7A0B\u5E8F\uFF0C\u56E0\u6B64 Tomcat \u5728\u542F\u52A8\u7684\u65F6\u5019\uFF0C\u81EA\u7136\u53EF\u4EE5\u914D\u7F6E Java \u865A\u62DF\u673A\u7684\u53C2\u6570\u3002\u914D\u7F6E Tomcat \u542F\u52A8\u865A\u62DF\u673A\u53C2\u6570\u65F6\uFF0C\u53EF\u4EE5\u8FDB\u5165 bin \u76EE\u5F55\uFF0C\u67E5\u627E catalina.bat \u6587\u4EF6\uFF08Linux \u5E73\u53F0\u662F "),$={href:"http://catalina.sh",target:"_blank",rel:"noopener noreferrer"},Q=e("catalina.sh"),Z=e("\uFF09\uFF0C\u53EF\u4EE5\u901A\u8FC7\u4FEE\u6539 catalina.bat \u6587\u4EF6\u6765\u914D\u7F6E Java \u865A\u62DF\u673A\u53C2\u6570\u3002"),ee=n(`<p>\u5728 catalina.bat \u4E2D\uFF0C\u8BFB\u8005\u53EF\u4EE5\u7279\u522B\u5173\u6CE8\u4E00\u4E0B JAVA_OPTS \u548C CATALINA_OPTS \u4E24\u4E2A\u73AF\u5883\u53D8\u91CF\u3002\u5B83\u4EEC\u5728\u6587\u4EF6\u4E2D\u7684\u8BF4\u660E\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rem  CATALINA_OPTS   (Optional) Java runtime options used when the &quot;start&quot;, 
rem	                &quot;run&quot; or &quot;debug&quot; command is executed.
rem	                Include here and not in JAVA_OPTS all options, that should
rem	                only be used by Tomcat itself, not by the stop process,
rem	                the version command etc.
rem	                Examples are heap size, GC logging, JMX ports etc.
rem  JAVA_OPTS       (Optional) Java runtime options used when any command rem	is executed.
rem	                Include here and not in CATALINA_OPTS all options, that
rem	                should be used by Tomcat and also by the stop process,
rem	                the version command etc.
rem	                Most options should	go into	CATALINA_OPTS.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u4E24\u4E2A\u73AF\u5883\u53D8\u91CF\u90FD\u53EF\u4EE5\u7528\u6765\u63A7\u5236 Tomcat \u542F\u52A8\u65F6\u7684\u865A\u62DF\u673A\u53C2\u6570\u3002CATALINA_OPTS \u7528\u4E8E\u63A7\u5236 Tomcat \u672C\u8EAB\u7684\u865A\u62DF\u673A\u53C2\u6570\uFF0C\u6BD4\u5982\u5806\u5927\u5C0F\u3001GC \u65E5\u5FD7\u7B49\uFF0C\u8FD9\u4E2A\u914D\u7F6E\u4E0D\u4F1A\u88AB Tomcat \u7684\u5176\u4ED6\u8FDB\u7A0B\uFF08\u6BD4\u5982 shutdown.bat\uFF09\u4F7F\u7528\u3002JAVA_OPTS \u53D8\u91CF\u7684\u4F7F\u7528\u8303\u56F4\u66F4\u5E7F\uFF0C\u9664\u4E86 Tomcat\uFF0C\u5176\u4ED6\u76F8\u5173\u8FDB\u7A0B\u4E5F\u4F1A\u4F7F\u7528 JAVA_OPTS \u7684\u914D\u7F6E\u3002\u6211\u4EEC\u5728\u5927\u90E8\u5206\u60C5\u51B5\u4E0B\u4F7F\u7528 CATALINA_OPTS \u5373\u53EF\u3002</p><p>\u5728\u672C\u6B21\u5B9E\u9A8C\u4E2D\uFF0C\u5747\u901A\u8FC7\u8BBE\u7F6E CATALINA_OPTS \u6765\u63A7\u5236\u865A\u62DF\u673A\u7684\u884C\u4E3A\u3002</p><h3 id="_5-7-4-\u5B9E\u6218\u6848\u4F8B-1\u2014\u2014\u521D\u8BD5\u4E32\u884C\u56DE\u6536\u5668" tabindex="-1"><a class="header-anchor" href="#_5-7-4-\u5B9E\u6218\u6848\u4F8B-1\u2014\u2014\u521D\u8BD5\u4E32\u884C\u56DE\u6536\u5668" aria-hidden="true">#</a> 5.7.4 \u5B9E\u6218\u6848\u4F8B 1\u2014\u2014\u521D\u8BD5\u4E32\u884C\u56DE\u6536\u5668</h3><p>\u4F7F\u7528 JDK 1.8 \u5F00\u542F Tomcat\uFF0C\u8BBE\u7F6E\u53C2\u6570\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>set CATALINA_OPTS= -Xloggc:gc.log
-XX:+PrintGCDetails -Xmx32M -Xms32M
-XX:+HeapDumpOnOutOfMemoryError -XX:+UseSerialGC -XX:PermSize=32M
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6B64\u53C2\u6570\u4E2D\u8BBE\u7F6E\u4E86\u6700\u5927\u5806\u4E3A 32MB\u3002\u5728\u8FDB\u884C\u4E00\u6BB5\u65F6\u95F4\u7684\u8BF7\u6C42\u540E\uFF0C\u90E8\u5206 GC \u65E5\u5FD7\u5982\u56FE5.28 \u6240\u793A\u3002</p><p><img src="`+D+'" alt="\u56FE5-28" loading="lazy"></p><p>\u56FE5.28 \u5B9E\u6218\u6848\u4F8B 1 \u90E8\u5206 GC \u65E5\u5FD7</p><p>\u53EF\u4EE5\u770B\u5230\uFF0CTomcat \u8FDB\u884C\u4E86\u5927\u91CF\u9891\u7E41\u7684 Full GC\u3002\u8001\u5E74\u4EE3\u5927\u5C0F\u4E3A 21888KB\uFF0C\u5E76\u57FA\u672C\u7528\u5B8C\uFF0C\u6574\u4E2A\u5806\u53EF\u7528\u5927\u5C0F\u4E3A 31680KB\uFF0C\u4E5F\u57FA\u672C\u4F7F\u7528\u6B86\u5C3D\u3002\u4F7F\u7528 JMeter \u89C2\u5BDF\u5230\u7684\u805A\u5408\u62A5\u544A\u5982\u56FE5.29 \u6240\u793A\u3002</p><p><img src="'+O+`" alt="\u56FE5-29" loading="lazy"></p><p>\u56FE5.29 \u5B9E\u6218\u6848\u4F8B 1 \u805A\u5408\u62A5\u544A</p><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u5728\u8FD9 10000 \u6B21\u8BF7\u6C42\u4E2D\u6700\u7EC8\u7684\u541E\u5410\u91CF\u5B9A\u4F4D\u5728 540 \u6B21/\u79D2\u3002</p><h3 id="_5-7-5-\u5B9E\u6218\u6848\u4F8B-2\u2014\u2014\u6269\u5927\u5806\u4EE5\u63D0\u5347\u7CFB\u7EDF\u6027\u80FD" tabindex="-1"><a class="header-anchor" href="#_5-7-5-\u5B9E\u6218\u6848\u4F8B-2\u2014\u2014\u6269\u5927\u5806\u4EE5\u63D0\u5347\u7CFB\u7EDF\u6027\u80FD" aria-hidden="true">#</a> 5.7.5 \u5B9E\u6218\u6848\u4F8B 2\u2014\u2014\u6269\u5927\u5806\u4EE5\u63D0\u5347\u7CFB\u7EDF\u6027\u80FD</h3><p>\u4FEE\u6539\u5B9E\u6218\u6848\u4F8B 1 \u4E2D\u7684\u6700\u5927\u5806\u5927\u5C0F\uFF0C\u5C06\u5176\u8C03\u6574\u4E3A 512MB\uFF0C\u6574\u7406\u53C2\u6570\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>set CATALINA_OPTS=-Xmx512m
-XX:MaxPermSize=32M
-Xloggc:gc.log -XX:+PrintGCDetails
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u7528\u76F8\u540C\u7684\u65B9\u5F0F\u6D4B\u8BD5\u65B0\u7684\u53C2\u6570\uFF0C\u5F97\u5230\u7684 GC \u65E5\u5FD7\u5982\u56FE5.30 \u6240\u793A\u3002</p><p><img src="`+F+'" alt="\u56FE5-30" loading="lazy"></p><p>\u56FE5.30 \u5B9E\u6210\u6848\u4F8B 2 \u90E8\u5206 GC \u65E5\u5FD7</p><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u5F53\u8BBE\u7F6E\u6700\u5927\u5806\u4E3A 512MB \u540E\uFF08\u672A\u8BBE\u7F6E\u521D\u59CB\u5806\uFF09\uFF0C\u542F\u52A8\u521D\u671F\uFF0C\u53EF\u7528\u5806\u7EA6\u4E3A 16MB\uFF0C\u968F\u7740\u8BF7\u6C42\u7684\u589E\u52A0\uFF0C\u6700\u7EC8\u5806\u5927\u5C0F\u6269\u5C55\u5230 60MB \u5DE6\u53F3\u3002\u5728\u65E5\u5FD7\u6700\u540E\u4E5F\u672A\u51FA\u73B0 FullGC\uFF0C\u8BF4\u660E\u6240\u6709\u7684\u56DE\u6536\u90FD\u5728\u65B0\u751F\u4EE3\u5B8C\u6210\uFF0C\u8FD9\u662F\u548C\u5B9E\u6218\u6848\u4F8B 1 \u6700\u5927\u7684\u4E0D\u540C\u3002\u540C\u65F6\uFF0C\u7531\u4E8E\u65B0\u751F\u4EE3 GC \u901F\u5EA6\u666E\u904D\u6BD4 Full GC \u66F4\u5FEB\uFF0C\u56E0\u6B64\uFF0C\u5355\u6B21 GC \u8017\u65F6\u4E5F\u76F8\u5DEE\u7EA6 1 \u4E2A\u6570\u91CF\u7EA7\u3002</p><p>\u6700\u7EC8\uFF0CJMeter \u7684\u805A\u5408\u62A5\u544A\u5982\u56FE5.31 \u6240\u793A\u3002\u53EF\u4EE5\u770B\u5230\uFF0C\u541E\u5410\u91CF\u4E0A\u5347\u5230\u4E86 651 \u6B21/\u79D2\u3002</p><p><img src="'+J+`" alt="\u56FE5-31" loading="lazy"></p><p>\u56FE5.31 \u5B9E\u6210\u6848\u4F8B 2 \u805A\u5408\u544A</p><h3 id="_5-7-6-\u5B9E\u6218\u6848\u4F8B-3\u2014\u2014\u8C03\u6574\u521D\u59CB\u5806\u5927\u5C0F" tabindex="-1"><a class="header-anchor" href="#_5-7-6-\u5B9E\u6218\u6848\u4F8B-3\u2014\u2014\u8C03\u6574\u521D\u59CB\u5806\u5927\u5C0F" aria-hidden="true">#</a> 5.7.6 \u5B9E\u6218\u6848\u4F8B 3\u2014\u2014\u8C03\u6574\u521D\u59CB\u5806\u5927\u5C0F</h3><p>\u6839\u636E\u5B9E\u6218\u6848\u4F8B 2 \u7684\u7ED3\u679C\u53EF\u77E5\uFF0C\u7CFB\u7EDF\u7684\u5806\u6700\u7EC8\u4F1A\u7A33\u5B9A\u5728 60MB \u9644\u8FD1\uFF0C\u56E0\u6B64\u5C0F\u4E8E 60MB \u7684\u5806\u5F88\u6709\u53EF\u80FD\u4F1A\u5F15\u8D77\u5927\u91CF GC\u3002\u5728\u5B9E\u6218\u6848\u4F8B 3 \u4E2D\u6269\u5927\u521D\u59CB\u5806\u4E3A 60MB\uFF0C\u8BBE\u7F6E\u53C2\u6570\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>set CATALINA_OPTS=-Xmx512m -Xms64m
-XX:MaxPermSize=32M
-Xloggc:gc.log -XX:+PrintGCDetails
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u542F\u52A8 Tomcat\uFF0C\u5E76\u8FD0\u884C JMeter\uFF0C\u5F97\u5230 Tomcat \u7684\u90E8\u5206 GC \u65E5\u5FD7\u5982\u56FE5.32 \u6240\u793A\u3002</p><p><img src="`+U+'" alt="\u56FE5-32" loading="lazy"></p><p>\u56FE5.32 \u5B9E\u6218\u6848\u4F8B 3 \u90E8\u5206 GC \u65E5\u5FD7</p><p>\u901A\u8FC7 GC \u65E5\u5FD7\u53EF\u4EE5\u770B\u5230\uFF0C\u5728\u672C\u6B21\u5B9E\u9A8C\u4E2D\uFF0CGC \u6570\u91CF\u5927\u5E45\u51CF\u5C11\uFF0C\u5E76\u4E14\u5B58\u5728\u7684\u57FA\u672C\u90FD\u662F\u65B0\u751F\u4EE3 GC\u3002\u4ECE\u805A\u5408\u62A5\u544A\u4E2D\u4E5F\u53EF\u4EE5\u770B\u5230\uFF0C\u541E\u5410\u91CF\u4E3A 674 \u6B21/\u79D2\uFF0C\u5982\u56FE5.33 \u6240\u793A\u3002</p><p><img src="'+N+`" alt="\u56FE5-33" loading="lazy"></p><p>\u56FE5.33 \u5B9E\u6218\u6848\u4F8B 3 \u805A\u5408\u62A5\u544A</p><h3 id="_5-7-7-\u5B9E\u6218\u6848\u4F8B-4\u2014\u2014\u4F7F\u7528-parrelloldgc-\u56DE\u6536\u5668" tabindex="-1"><a class="header-anchor" href="#_5-7-7-\u5B9E\u6218\u6848\u4F8B-4\u2014\u2014\u4F7F\u7528-parrelloldgc-\u56DE\u6536\u5668" aria-hidden="true">#</a> 5.7.7 \u5B9E\u6218\u6848\u4F8B 4\u2014\u2014\u4F7F\u7528 ParrellOldGC \u56DE\u6536\u5668</h3><p>\u4F7F\u7528 ParrellOldGC \u56DE\u6536\u5668\u4EE3\u66FF\u4E32\u884C\u56DE\u6536\u5668\u3002\u5728\u7B14\u8005\u7684\u8BA1\u7B97\u673A\u4E0A\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u4F7F\u7528\u7684\u662F\u4E32\u884C\u56DE\u6536\u5668\u3002\u8BBE\u7F6E\u865A\u62DF\u673A\u53C2\u6570\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>set CATALINA_OPTS=-Xmx512m -Xms64m
-XX:MaxPermSize=32M
-Xloggc:gc.log -XX:+PrintGCDetails
-XX:+UseParallelGC -XX:+UseParallelOldGC -XX:ParallelGCThreads=4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5806\u5927\u5C0F\u548C\u5B9E\u6218\u6848\u4F8B 3 \u4FDD\u6301\u4E0D\u53D8\uFF0C\u4F46\u662F\u66F4\u6362\u4E86\u5783\u573E\u56DE\u6536\u5668\u3002\u6D4B\u8BD5\u5F97\u5230\u7684\u805A\u5408\u62A5\u544A\u5982\u56FE5.34 \u6240\u793A\u3002</p><p><img src="`+E+`" alt="\u56FE5-34" loading="lazy"></p><p>\u56FE5.34 \u5B9E\u6218\u6848\u4F8B 4 \u805A\u5408\u62A5\u544A</p><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u7531\u4E8E GC \u538B\u529B\u5728\u672C\u6B21\u5B9E\u9A8C\u4E2D\u5E76\u4E0D\u5927\uFF08\u7531\u5B9E\u6218\u6848\u4F8B 3 \u7684 GC \u65E5\u5FD7\u53EF\u4EE5\u5F97\u51FA\u8FD9\u4E2A\u7ED3\u8BBA\uFF09\uFF0C\u66F4\u6362\u5783\u573E\u56DE\u6536\u5668\u540E\uFF0C\u541E\u5410\u91CF\u5E76\u65E0\u6539\u5584\u3002</p><h3 id="_5-7-8-\u5B9E\u6218\u6848\u4F8B-5\u2014\u2014\u4F7F\u7528\u8F83\u5C0F\u5806\u63D0\u9AD8-gc-\u538B\u529B" tabindex="-1"><a class="header-anchor" href="#_5-7-8-\u5B9E\u6218\u6848\u4F8B-5\u2014\u2014\u4F7F\u7528\u8F83\u5C0F\u5806\u63D0\u9AD8-gc-\u538B\u529B" aria-hidden="true">#</a> 5.7.8 \u5B9E\u6218\u6848\u4F8B 5\u2014\u2014\u4F7F\u7528\u8F83\u5C0F\u5806\u63D0\u9AD8 GC \u538B\u529B</h3><p>\u901A\u8FC7\u8BBE\u7F6E\u4E00\u4E2A\u8F83\u5C0F\u7684\u5806\uFF0C\u589E\u52A0 GC \u538B\u529B\uFF0C\u4EE5\u6B64\u6765\u8003\u5BDF\u4E0D\u540C\u5783\u573E\u56DE\u6536\u5668\u7684\u8868\u73B0\uFF0C\u4F9D\u7136\u4F7F\u7528\u4E32\u884C\u56DE\u6536\u5668\u3002\u8BBE\u7F6E\u865A\u62DF\u673A\u53C2\u6570\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>set CATALINA_OPTS=-Xmx40m -Xms40m
-XX:MaxPermSize=32M
-Xloggc:gc.log -XX:+PrintGCDetails
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5C06\u521D\u59CB\u5806\u548C\u6700\u5927\u5806\u7EDF\u4E00\u8BBE\u7F6E\u4E3A 40MB\uFF0C\u5E76\u4F7F\u7528\u4E32\u884C\u56DE\u6536\u5668\u3002\u5F97\u5230\u7684\u805A\u5408\u62A5\u544A\u5982\u56FE5.35 \u6240\u793A\u3002</p><p><img src="`+j+`" alt="\u56FE5-35" loading="lazy"></p><p>\u56FE5.35 \u5B9E\u6218\u6848\u4F8B 5 \u805A\u5408\u62A5\u544A</p><p>\u51CF\u5C0F\u5806\u5927\u5C0F\u540E\uFF0C\u541E\u5410\u91CF\u6709\u8F83\u4E3A\u660E\u663E\u7684\u4E0B\u964D\uFF08\u4ECE\u5B9E\u6218\u6848\u4F8B 3 \u53EF\u4EE5\u77E5\u9053\uFF0C\u672C\u6B21\u5B9E\u9A8C\u5806\u5927\u5C0F\u5728 60MB \u5DE6\u53F3\u662F\u6CA1\u6709 GC \u538B\u529B\u7684\uFF0C\u800C\u5C0F\u4E8E 60MB \u7684\u5806\u4F1A\u6709\u4E00\u5B9A\u7684 GC \u538B\u529B\uFF09\u3002</p><h3 id="_5-7-9-\u5B9E\u6218\u6848\u4F8B-6\u2014\u2014\u6D4B\u8BD5-paralleloldgc-\u7684\u8868\u73B0" tabindex="-1"><a class="header-anchor" href="#_5-7-9-\u5B9E\u6218\u6848\u4F8B-6\u2014\u2014\u6D4B\u8BD5-paralleloldgc-\u7684\u8868\u73B0" aria-hidden="true">#</a> 5.7.9 \u5B9E\u6218\u6848\u4F8B 6\u2014\u2014\u6D4B\u8BD5 ParallelOldGC \u7684\u8868\u73B0</h3><p>\u5728\u5B9E\u6218\u6848\u4F8B 5 \u7684\u57FA\u7840\u4E0A\uFF0C\u66F4\u6362 ParallelOldGC \u56DE\u6536\u5668\u8FDB\u884C\u6D4B\u8BD5\u3002\u4F7F\u7528\u53C2\u6570\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>set CATALINA_OPTS=-Xmx40m -Xms40m
-XX:MaxPermSize=32M
-Xloggc:gc.log -XX:+PrintGCDetails
-XX:+UseParallelOldGC -XX:ParallelGCThreads=4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5F97\u5230\u7684\u805A\u5408\u62A5\u544A\u5982\u56FE5.36 \u6240\u793A\u3002</p><p><img src="`+R+`" alt="\u56FE5-36" loading="lazy"></p><p>\u56FE5.36 \u5B9E\u6218\u6848\u4F8B 6 \u805A\u5408\u62A5\u544A</p><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u5728\u6709\u4E00\u5B9A GC \u538B\u529B\u7684\u60C5\u51B5\u4E0B\uFF0C\u4F7F\u7528 ParallelOldGC \u56DE\u6536\u5668\u5BF9\u7CFB\u7EDF\u6027\u80FD\u6709\u8F83\u4E3A\u660E\u663E\u7684\u6539\u5584\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1AParallelOldGC \u56DE\u6536\u5668\u5728\u591A\u6838 CPU \u4E0A\u624D\u6709\u53EF\u80FD\u6539\u5584\u6027\u80FD\uFF0C\u5BF9\u4E8E\u5355\u6838 CPU \u6216\u8005\u5E76\u884C\u80FD\u529B\u8F83\u5F31\u7684\u8BA1\u7B97\u673A\uFF0C\u8FD8\u662F\u5E94\u8BE5\u9009\u62E9\u4E32\u884C\u56DE\u6536\u5668\u3002</p><h3 id="_5-7-10-\u5B9E\u6218\u6848\u4F8B-7\u2014\u2014\u6D4B\u8BD5-parnew-\u56DE\u6536\u5668\u7684\u8868\u73B0" tabindex="-1"><a class="header-anchor" href="#_5-7-10-\u5B9E\u6218\u6848\u4F8B-7\u2014\u2014\u6D4B\u8BD5-parnew-\u56DE\u6536\u5668\u7684\u8868\u73B0" aria-hidden="true">#</a> 5.7.10 \u5B9E\u6218\u6848\u4F8B 7\u2014\u2014\u6D4B\u8BD5 ParNew \u56DE\u6536\u5668\u7684\u8868\u73B0</h3><p>\u4F7F\u7528 ParNew \u56DE\u6536\u5668\u4EE3\u66FF ParallelOldGC\uFF0C\u8FD9\u6837\u5728\u8001\u5E74\u4EE3\u4F9D\u7136\u4F7F\u7528\u4E32\u884C\u56DE\u6536\u5668\uFF0C\u4EC5\u5728\u65B0\u751F\u4EE3\u4F7F\u7528\u5E76\u884C\u56DE\u6536\u5668\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>set CATALINA_OPTS=-Xmx40m -Xms40m
-XX:MaxPermSize=32M
-Xloggc:gc.log -XX:+PrintGCDetails
-XX:+UseParNewGC
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5F97\u5230\u7684\u805A\u5408\u62A5\u544A\u5982\u56FE5.37 \u6240\u793A\u3002</p><p><img src="`+I+`" alt="\u56FE5-37" loading="lazy"></p><p>\u56FE5.37 \u5B9E\u6218\u6848\u4F8B 7 \u805A\u5408\u62A5\u544A</p><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u6027\u80FD\u6BD4\u5B9E\u6218\u6848\u4F8B 6 \u5DEE\u4E9B\uFF0C\u4F46\u4ECD\u7136\u597D\u4E8E\u5B9E\u6218\u6848\u4F8B 5 \u7684\u5168\u4E32\u884C\u7ED3\u679C\u3002</p><h3 id="_5-7-11-\u5B9E\u6218\u6848\u4F8B-8\u2014\u2014\u6D4B\u8BD5-jdk-1-8-\u7684\u8868\u73B0" tabindex="-1"><a class="header-anchor" href="#_5-7-11-\u5B9E\u6218\u6848\u4F8B-8\u2014\u2014\u6D4B\u8BD5-jdk-1-8-\u7684\u8868\u73B0" aria-hidden="true">#</a> 5.7.11 \u5B9E\u6218\u6848\u4F8B 8\u2014\u2014\u6D4B\u8BD5 JDK 1.8 \u7684\u8868\u73B0</h3><p>\u5728\u672C\u6B21\u5B9E\u6218\u6848\u4F8B\u4E2D\uFF0C\u4F7F\u7528 JDK 1.8\uFF0C\u5E76\u4F7F\u7528\u5982\u4E0B\u53C2\u6570\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-Xmx40m -Xms40m -XX:MaxPermSize=32M -Xloggc:gc.log -XX:+PrintGCDetails -XX:+UseSerialGC
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5F97\u5230\u7684\u805A\u5408\u62A5\u544A\u5982\u56FE5.38 \u6240\u793A\u3002</p><p><img src="`+H+'" alt="\u56FE5-38" loading="lazy"></p><p>\u56FE5.38 \u5B9E\u6218\u6848\u4F8B 8 \u805A\u5408\u62A5\u544A</p><h3 id="_5-7-12-\u5B9E\u6218\u6848\u4F8B-9\u2014\u2014\u4F7F\u7528\u9AD8\u7248\u672C\u865A\u62DF\u673A\u63D0\u5347\u6027\u80FD" tabindex="-1"><a class="header-anchor" href="#_5-7-12-\u5B9E\u6218\u6848\u4F8B-9\u2014\u2014\u4F7F\u7528\u9AD8\u7248\u672C\u865A\u62DF\u673A\u63D0\u5347\u6027\u80FD" aria-hidden="true">#</a> 5.7.12 \u5B9E\u6218\u6848\u4F8B 9\u2014\u2014\u4F7F\u7528\u9AD8\u7248\u672C\u865A\u62DF\u673A\u63D0\u5347\u6027\u80FD</h3><p>\u5728\u672C\u6B21\u5B9E\u6218\u6848\u4F8B\u4E2D\uFF0C\u4F7F\u7528\u548C\u5B9E\u6218\u6848\u4F8B 8 \u76F8\u540C\u7684 Java \u865A\u62DF\u673A\u53C2\u6570\uFF0C\u4F46\u662F\u4F7F\u7528 JDK 10 \u8FD0\u884C Tomcat \u670D\u52A1\u5668\uFF0C\u5F97\u5230\u5982\u56FE5.39 \u6240\u793A\u7684\u7ED3\u679C\u3002</p><p><img src="'+q+'" alt="\u56FE5-39" loading="lazy"></p><p>\u56FE5.39 \u5B9E\u6218\u6848\u4F8B 9 \u805A\u5408\u62A5\u544A</p><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u53EA\u662F\u7B80\u5355\u7684\u5347\u7EA7\u865A\u62DF\u673A\u7248\u672C\uFF0C\u4E5F\u53EF\u4EE5\u5F97\u5230\u610F\u5916\u7684\u6027\u80FD\u63D0\u5347\u3002\u8FD9\u79CD\u514D\u8D39\u7684\u5348\u9910\u662F\u503C\u5F97\u5927\u5BB6\u5C1D\u8BD5\u7684\uFF0C\u4F46\u662F JDK \u7248\u672C\u5347\u7EA7\u4F9D\u7136\u4F34\u968F\u4E00\u5B9A\u98CE\u9669\uFF0C\u4E5F\u8BB8\u5728\u65B0\u7248\u672C\u7684 JDK \u4E2D\u5F15\u5165\u4E86\u67D0\u4E9B\u672A\u77E5\u7684 Bug\u3002\u56E0\u6B64\uFF0C\u5FC5\u987B\u8981\u505A\u597D\u5145\u5206\u7684\u56DE\u5F52\u6D4B\u8BD5\u5DE5\u4F5C\u3002</p><h2 id="_5-8-\u5C0F\u7ED3" tabindex="-1"><a class="header-anchor" href="#_5-8-\u5C0F\u7ED3" aria-hidden="true">#</a> 5.8 \u5C0F\u7ED3</h2><p>\u672C\u7AE0\u4E3B\u8981\u4ECB\u7ECD\u4E86\u865A\u62DF\u673A\u652F\u6301\u7684\u5404\u79CD\u5783\u573E\u56DE\u6536\u7684\u79CD\u7C7B\u3001\u4F7F\u7528\u65B9\u6CD5\u548C\u76F8\u5173\u53C2\u6570\uFF0C\u7740\u91CD\u4ECB\u7ECD\u4E86\u4E32\u884C\u56DE\u6536\u5668\u3001\u5E76\u884C\u56DE\u6536\u5668\u3001CMS \u548C G1 \u56DE\u6536\u5668\u3002\u6B64\u5916\uFF0C\u672C\u7AE0\u8FD8\u4ECB\u7ECD\u4E86\u6709\u5173\u5BF9\u8C61\u5206\u914D\u548C\u56DE\u6536\u7684\u4E00\u4E9B\u7EC6\u8282\u95EE\u9898\u3002\u6700\u540E\uFF0C\u7B14\u8005\u5C1D\u8BD5\u4F7F\u7528\u5404\u79CD\u5783\u573E\u56DE\u6536\u5668\u53CA\u5404\u9879\u53C2\u6570\uFF0C\u6D4B\u8BD5\u4E86\u5B83\u4EEC\u5BF9 Tomcat \u670D\u52A1\u5668\u7684\u6027\u80FD\u5F71\u54CD\u3002</p>',75);function se(ne,ae){const a=l("ExternalLinkIcon");return t(),p("div",null,[V,s("p",null,[Y,s("a",$,[Q,r(a)]),Z]),ee])}var te=i(W,[["render",se],["__file","\u7B2C5\u7AE0\u5783\u573E\u6536\u96C6\u5668\u548C\u5185\u5B58\u5206\u914D.html.vue"]]);export{te as default};
