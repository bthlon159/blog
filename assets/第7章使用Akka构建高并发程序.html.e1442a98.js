import{_ as t}from"./plugin-vue_export-helper.21dcd24c.js";import{o as p,c as e,e as a,a as n,d as s}from"./app.0d56c066.js";var o="/assets/\u56FE7-1.c07e321a.jpeg",c="/assets/\u56FE7-2.5977505c.jpeg",l="/assets/\u56FE7-3.14f2d4f1.jpeg";const u={},i=a(`<h1 id="\u7B2C-7-\u7AE0-\u4F7F\u7528-akka-\u6784\u5EFA\u9AD8\u5E76\u53D1\u7A0B\u5E8F" tabindex="-1"><a class="header-anchor" href="#\u7B2C-7-\u7AE0-\u4F7F\u7528-akka-\u6784\u5EFA\u9AD8\u5E76\u53D1\u7A0B\u5E8F" aria-hidden="true">#</a> \u7B2C 7 \u7AE0 \u4F7F\u7528 Akka \u6784\u5EFA\u9AD8\u5E76\u53D1\u7A0B\u5E8F</h1><p>\u6211\u4EEC\u77E5\u9053\uFF0C\u5199\u51FA\u4E00\u4E2A\u6B63\u786E\u7684\u3001\u9AD8\u6027\u80FD\u5E76\u4E14\u53EF\u6269\u5C55\u7684\u5E76\u53D1\u7A0B\u5E8F\u662F\u76F8\u5F53\u56F0\u96BE\u7684\uFF0C\u90A3\u4E48\u662F\u5426\u6709\u4E00\u4E2A\u597D\u7684\u6846\u67B6\u53EF\u4EE5\u5E2E\u52A9\u6211\u4EEC\u8F7B\u677E\u6784\u5EFA\u8FD9\u4E48\u4E00\u4E2A\u5E94\u7528\u5462\uFF1F\u7B54\u6848\u662F\u80AF\u5B9A\u7684\uFF0C\u90A3\u5C31\u662F Akka\u3002Akka \u662F\u4E00\u6B3E\u9075\u5FAA Aapche 2 \u8BB8\u53EF\u7684\u5F00\u6E90\u9879\u76EE\uFF0C\u8FD9\u610F\u5473\u7740\u4F60\u53EF\u4EE5\u65E0\u507F\u5E76\u4E14\u51E0\u4E4E\u6CA1\u6709\u9650\u5236\u5730\u4F7F\u7528\u5B83\uFF0C\u5305\u62EC\u5C06\u5B83\u5E94\u7528\u4E8E\u5546\u4E1A\u73AF\u5883\u4E2D\u3002</p><p>Akka \u662F\u7528 Scala \u521B\u5EFA\u7684\uFF0C\u4F46\u7531\u4E8E Scala \u548C Java \u4E00\u6837\uFF0C\u90FD\u662F Java \u865A\u62DF\u673A\u4E0A\u7684\u8BED\u8A00\uFF0C\u672C\u8D28\u4E0A\u8BF4\uFF0C\u4E24\u8005\u5E76\u6CA1\u6709\u4EC0\u4E48\u4E0D\u540C\uFF0C\u56E0\u6B64\uFF0C\u6211\u4EEC\u4E5F\u53EF\u4EE5\u5728 Java \u4E2D\u4F7F\u7528 Akka\u3002\u8003\u8651\u5230 Java \u5F00\u53D1\u4EBA\u5458\u7684\u6570\u91CF\u8FDC\u8FDC\u9AD8\u4E8E Scala\uFF0C\u4E3A\u4E86\u65B9\u4FBF\u5927\u4F17\uFF0C\u5728\u8FD9\u91CC\uFF0C\u6211\u5C06\u5168\u7A0B\u4F7F\u7528 Java \u6765\u4F5C\u4E3A Akka \u7684\u5BBF\u4E3B\u8BED\u8A00\uFF08\u672C\u4E66\u4F7F\u7528 Akka 2.11-2.3.7 \u4F5C\u4E3A\u6F14\u793A\uFF09\u3002\u4F46\u6211\u5E76\u4E0D\u6253\u7B97\u5728\u8FD9\u91CC\u628A\u5BF9 Akka \u7684\u4ECB\u7ECD\u5199\u6210\u4E00\u4E2A Akka \u4F7F\u7528\u624B\u518C\uFF0C\u56E0\u6B64\uFF0C\u672C\u7AE0\u4E0D\u4F1A\u5BF9 Akka \u8FDB\u884C\u5168\u65B9\u4F4D\u5B8C\u6574\u7684 API \u4ECB\u7ECD\u3002\u672C\u7AE0\u53EA\u662F\u5BF9 Akka \u7684\u4E3B\u8981\u529F\u80FD\u8FDB\u884C\u7B80\u5355\u7684\u63CF\u8FF0\uFF0C\u5E2E\u52A9\u5927\u5BB6\u5C3D\u5FEB\u7406\u89E3 Akka \u7684\u57FA\u672C\u601D\u60F3\u3002</p><p>\u4F7F\u7528 Akka \u80FD\u591F\u7ED9\u6211\u4EEC\u5E26\u6765\u4EC0\u4E48\u597D\u5904\u5462\uFF1F</p><p>\u9996\u5148\uFF0CAkka \u63D0\u4F9B\u4E86\u4E00\u79CD\u540D\u4E3A Actor \u7684\u5E76\u53D1\u6A21\u578B\uFF0C\u5176\u7C92\u5EA6\u6BD4\u7EBF\u7A0B\u5C0F\uFF0C\u8FD9\u610F\u5473\u7740\u4F60\u53EF\u4EE5\u5728\u7CFB\u7EDF\u4E2D\u542F\u7528\u5927\u91CF\u7684 Actor\u3002</p><p>\u5176\u6B21\uFF0CAkka \u4E2D\u63D0\u4F9B\u4E86\u4E00\u5957\u5BB9\u9519\u673A\u5236\uFF0C\u5141\u8BB8\u5728 Actor \u51FA\u73B0\u5F02\u5E38\u65F6\uFF0C\u8FDB\u884C\u4E00\u4E9B\u6062\u590D\u6216\u8005\u91CD\u7F6E\u64CD\u4F5C\u3002</p><p>\u518D\u6B21\uFF0C\u901A\u8FC7 Akka \u4E0D\u4EC5\u53EF\u4EE5\u5728\u5355\u673A\u4E0A\u6784\u5EFA\u9AD8\u5E76\u53D1\u7A0B\u5E8F\uFF0C\u4E5F\u53EF\u4EE5\u5728\u7F51\u7EDC\u4E2D\u6784\u5EFA\u5206\u5E03\u5F0F\u7A0B\u5E8F\uFF0C\u5E76\u63D0\u4F9B\u4F4D\u7F6E\u900F\u660E\u7684 Actor \u5B9A\u4F4D\u670D\u52A1\u3002</p><p>\u4E0B\u9762\u5C31\u8BA9\u6211\u4EEC\u6B63\u5F0F\u5F00\u542F Akka \u4E4B\u65C5\u5427\uFF01</p><h2 id="_7-1-\u65B0\u5E76\u53D1\u6A21\u578B-actor" tabindex="-1"><a class="header-anchor" href="#_7-1-\u65B0\u5E76\u53D1\u6A21\u578B-actor" aria-hidden="true">#</a> 7.1 \u65B0\u5E76\u53D1\u6A21\u578B\uFF1AActor</h2><p>\u5BF9\u4E8E\u5E76\u53D1\u7A0B\u5E8F\u6765\u8BF4\uFF0C\u7EBF\u7A0B\u59CB\u7EC8\u662F\u5E76\u53D1\u7A0B\u5E8F\u7684\u57FA\u672C\u6267\u884C\u5355\u5143\u3002\u4F46\u5728 Akka \u4E2D\uFF0C\u4F60\u53EF\u4EE5\u5B8C\u5168\u5FD8\u8BB0\u7EBF\u7A0B\u4E86\u3002\u5F53\u4F60\u4F7F\u7528 Akka \u65F6\uFF0C\u4F60\u5C31\u6709\u4E00\u4E2A\u5168\u65B0\u7684\u6267\u884C\u5355\u5143\u2014Actor\u3002Actor \u662F\u4EC0\u4E48\u5462\uFF1F</p><p>\u7B80\u5355\u5730\u8BF4\uFF0C\u4F60\u53EF\u4EE5\u628A Actor \u6BD4\u55BB\u6210\u4E00\u4E2A\u4EBA\u3002\u4EBA\u4E0E\u4EBA\u4E4B\u95F4\u53EF\u4EE5\u4F7F\u7528\u8BED\u8A00\u8FDB\u884C\u4EA4\u6D41\u3002\u6BD4\u5982\uFF0C\u8001\u5E08\u95EE\u540C\u5B66 5 \u4E58\u4EE5 5 \u662F\u591A\u5C11\u5440\uFF1F\u540C\u5B66\u542C\u5230\u95EE\u9898\u540E\uFF0C\u60F3\u4E86\u60F3\uFF0C\u56DE\u7B54\u8BF4\u662F 25\u3002Actor \u4E4B\u95F4\u7684\u901A\u4FE1\u65B9\u5F0F\u548C\u4E0A\u8FF0\u5BF9\u8BDD\u5F62\u5F0F\u51E0\u4E4E\u662F\u4E00\u6A21\u4E00\u6837\u7684\u3002</p><p>\u4F20\u7EDF Java \u5E76\u884C\u7A0B\u5E8F\u662F\u5B8C\u5168\u57FA\u4E8E\u9762\u5411\u5BF9\u8C61\u7684\u65B9\u6CD5\u3002\u6211\u4EEC\u8FD8\u662F\u901A\u8FC7\u5BF9\u8C61\u7684\u65B9\u6CD5\u8C03\u7528\u8FDB\u884C\u4FE1\u606F\u7684\u4F20\u9012\u3002\u8FD9\u65F6\uFF0C\u5982\u679C\u5BF9\u8C61\u7684\u65B9\u6CD5\u4F1A\u4FEE\u6539\u5BF9\u8C61\u672C\u8EAB\u7684\u72B6\u6001\uFF0C\u90A3\u4E48\u5728\u591A\u7EBF\u7A0B\u60C5\u51B5\u4E0B\uFF0C\u5C31\u6709\u53EF\u80FD\u51FA\u73B0\u5BF9\u8C61\u72B6\u6001\u7684\u4E0D\u4E00\u81F4\uFF0C\u6240\u4EE5\u6211\u4EEC\u5FC5\u987B\u5BF9\u8FD9\u7C7B\u65B9\u6CD5\u8C03\u7528\u8FDB\u884C\u540C\u6B65\u3002\u5F53\u7136\uFF0C\u540C\u6B65\u5F80\u5F80\u662F\u4EE5\u727A\u7272\u6027\u80FD\u4E3A\u4EE3\u4EF7\u7684\u3002</p><p>\u5728 Actor \u6A21\u578B\u4E2D\uFF0C\u6211\u4EEC\u5931\u53BB\u4E86\u5BF9\u8C61\u7684\u65B9\u6CD5\u8C03\u7528\uFF0C\u6211\u4EEC\u5E76\u4E0D\u662F\u901A\u8FC7\u8C03\u7528 Actor \u5BF9\u8C61\u7684\u67D0\u4E00\u4E2A\u65B9\u6CD5\u6765\u544A\u8BC9 Actor \u4F60\u9700\u8981\u505A\u4EC0\u4E48\uFF0C\u800C\u662F\u7ED9 Actor \u53D1\u9001\u4E00\u6761\u6D88\u606F\u3002\u5F53\u4E00\u4E2A Actor \u6536\u5230\u6D88\u606F\u540E\uFF0C\u5B83\u6709\u53EF\u80FD\u4F1A\u6839\u636E\u6D88\u606F\u7684\u5185\u5BB9\u505A\u51FA\u67D0\u4E9B\u884C\u4E3A\uFF0C\u5305\u62EC\u66F4\u6539\u81EA\u8EAB\u72B6\u6001\u3002\u4F46\u662F\uFF0C\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0C\u8FD9\u4E2A\u72B6\u6001\u7684\u66F4\u6539\u662F Actor \u81EA\u5DF1\u8FDB\u884C\u7684\uFF0C\u5E76\u4E0D\u662F\u7531\u5916\u754C\u88AB\u8FEB\u8FDB\u884C\u7684\u3002</p><h2 id="_7-2-akka-\u4E4B-hello-world" tabindex="-1"><a class="header-anchor" href="#_7-2-akka-\u4E4B-hello-world" aria-hidden="true">#</a> 7.2 Akka \u4E4B Hello World</h2><p>\u5728\u4E86\u89E3\u4E86 Actor \u7684\u57FA\u672C\u884C\u4E3A\u6A21\u5F0F\u540E\uFF0C\u6211\u4EEC\u901A\u8FC7\u7B80\u5355\u7684 Hello World \u7A0B\u5E8F\u6765\u8FDB\u4E00\u6B65\u4E86\u89E3 Akka \u7684\u5F00\u53D1\u3002</p><p>\u9996\u5148\u8BA9\u6211\u4EEC\u770B\u4E00\u4E0B\u7B2C\u4E00\u4E2A Actor \u7684\u5B9E\u73B0\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Greeter</span> <span class="token keyword">extends</span> <span class="token class-name">UntypedActor</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">enum</span> <span class="token class-name">Msg</span> <span class="token punctuation">{</span>
        GREET<span class="token punctuation">,</span> DONE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token class-name">Msg</span><span class="token punctuation">.</span>GREET<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">getSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">Msg</span><span class="token punctuation">.</span>DONE<span class="token punctuation">,</span> <span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> 
            <span class="token function">unhandled</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u5B9A\u4E49\u4E86\u4E00\u4E2A\u6B22\u8FCE\u8005\uFF08Greeter\uFF09Actor\uFF0C\u5B83\u7EE7\u627F\u81EA UntypedActor\uFF08\u5B83\u81EA\u7136\u5C31\u662F Akka \u4E2D\u7684\u6838\u5FC3\u6210\u5458\u4E86\uFF09\u3002UntypedActor \u5C31\u662F\u6211\u4EEC\u6240\u8BF4\u7684 Actor\uFF0C\u4E4B\u6240\u4EE5\u8FD9\u91CC\u5F3A\u8C03\u662F\u65E0\u7C7B\u578B\u7684\uFF0C\u662F\u56E0\u4E3A\u5728 Akka \u4E2D\uFF0C\u8FD8\u652F\u6301\u4E00\u79CD\u6709\u7C7B\u578B\u7684 Actor\u3002\u6709\u7C7B\u578B\u7684 Actor \u53EF\u4EE5\u4F7F\u7528\u7CFB\u7EDF\u4E2D\u7684\u5176\u4ED6\u7C7B\u578B\u6784\u9020\uFF0C\u4ECE\u800C\u7F13\u89E3 Java \u5355\u7EE7\u627F\u7684\u95EE\u9898\u3002\u56E0\u4E3A\u7EE7\u627F\u4E86 UntypedActor \u540E\uFF0C\u5C31\u4E0D\u80FD\u518D\u7EE7\u627F\u7CFB\u7EDF\u4E2D\u7684\u5176\u4ED6\u7C7B\u4E86\u3002\u5982\u679C\u4F60\u4E00\u5B9A\u8981\u8FD9\u4E48\u505A\uFF0C\u90A3\u4E48\u5C31\u53EA\u80FD\u9009\u62E9\u6709\u7C7B\u578B\u7684 Actor\u3002\u5426\u5219\uFF0CUntypedActor \u5E94\u8BE5\u5C31\u662F\u4F60\u7684\u9996\u9009\u3002</p><p>\u4EE3\u7801\u7B2C 2 ~ 4 \u884C\u5B9A\u4E49\u4E86\u6D88\u606F\u7C7B\u578B\u3002\u8FD9\u91CC\u53EA\u6709\u6B22\u8FCE\uFF08GREET\uFF09\u548C\u5B8C\u6210\uFF08DONE\uFF09\u4E24\u79CD\u7C7B\u578B\u3002\u5F53 Greeter \u6536\u5230 GREET \u6D88\u606F\u65F6\uFF0C\u5C31\u4F1A\u5728\u63A7\u5236\u53F0\u6253\u5370 &quot;Hello World\u201D\uFF0C\u5E76\u4E14\u5411\u6D88\u606F\u53D1\u9001\u65B9\u53D1\u9001 DONE \u4FE1\u606F\uFF08\u7B2C 10 \u884C\uFF09\u3002</p><p>\u4E0E Greeter \u4EA4\u6D41\u7684\u53E6\u5916\u4E00\u4E2A Actor \u662F HelloWorld\uFF0C\u5B83\u7684\u5B9E\u73B0\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorld</span> <span class="token keyword">extends</span> <span class="token class-name">UntypedActor</span> <span class="token punctuation">{</span>
    <span class="token class-name">ActorRef</span> greeter<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">preStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        greeter <span class="token operator">=</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Greeter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;greeter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Greeter Actor Path:&quot;</span> <span class="token operator">+</span> greeter<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        greeter<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">Greeter<span class="token punctuation">.</span>Msg</span><span class="token punctuation">.</span>GREET<span class="token punctuation">,</span> <span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token class-name">Greeter<span class="token punctuation">.</span>Msg</span><span class="token punctuation">.</span>DONE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            greeter<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">Greeter<span class="token punctuation">.</span>Msg</span><span class="token punctuation">.</span>GREET<span class="token punctuation">,</span> <span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> 
            <span class="token function">unhandled</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u5B9E\u73B0\u4E86\u4E00\u4E2A\u540D\u4E3A HelloWorld \u7684 Actor\u3002\u7B2C 5 \u884C\u7684 preStart() \u65B9\u6CD5\u4E3A Akka \u7684\u56DE\u8C03\u65B9\u6CD5\uFF0C\u5728 Actor \u542F\u52A8\u524D\uFF0C\u4F1A\u88AB Akka \u6846\u67B6\u8C03\u7528\uFF0C\u5B8C\u6210\u4E00\u4E9B\u521D\u59CB\u5316\u7684\u5DE5\u4F5C\u3002\u5728\u8FD9\u91CC\uFF0C\u6211\u4EEC\u5728 HelloWorld \u4E2D\u521B\u5EFA\u4E86 Greeter \u7684\u5B9E\u4F8B\uFF08\u7B2C 6 \u884C\uFF09\uFF0C\u5E76\u4E14\u5411\u5B83\u53D1\u9001 GREET \u6D88\u606F\uFF08\u7B2C 8 \u884C\uFF09\u3002\u6B64\u65F6\uFF0C\u7531\u4E8E\u521B\u5EFA Greeter \u65F6\u4F7F\u7528\u7684\u662F HelloWorld \u7684\u4E0A\u4E0B\u6587\uFF0C\u56E0\u6B64\u5B83\u5C5E\u4E8E HelloWorld \u7684\u5B50 Actor\u3002</p><p>\u7B2C 12 \u884C\u5B9A\u4E49\u7684 onReceive() \u51FD\u6570\u4E3A HelloWorld \u7684\u6D88\u606F\u5904\u7406\u51FD\u6570\u3002\u5728\u8FD9\u91CC\uFF0C\u53EA\u5904\u7406 DONE \u7684\u6D88\u606F\u3002\u5728\u6536\u5230 DONE \u6D88\u606F\u540E\uFF0C\u5B83\u4F1A\u518D\u5411 Greeter \u53D1\u9001 GREET \u6D88\u606F\uFF0C\u63A5\u7740\u5C06\u81EA\u5DF1\u505C\u6B62\u3002</p><p>\u56E0\u6B64\uFF0CGreeter \u4F1A\u6536\u5230\u524D\u540E\u4E24\u6761 GREET \u6D88\u606F\uFF0C\u6253\u5370\u4E24\u6B21 &quot;Hello World\u201D\u3002</p><p>\u6700\u540E\uFF0C\u8BA9\u6211\u4EEC\u770B\u4E00\u4E0B\u4E3B\u51FD\u6570 main()\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloMainSimple</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ActorSystem</span> system <span class="token operator">=</span> <span class="token class-name">ActorSystem</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ConfigFactory</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;samplehello.conf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ActorRef</span> a <span class="token operator">=</span> system<span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">HelloWorld</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;helloWorld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;HelloWorld Actor Path:&quot;</span> <span class="token operator">+</span> a<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7A0B\u5E8F\u7B2C 3 \u884C\u521B\u5EFA\u4E86 ActorSystem\uFF0C\u8868\u793A\u7BA1\u7406\u548C\u7EF4\u62A4 Actor \u7684\u7CFB\u7EDF\u3002\u4E00\u822C\u6765\u8BF4\uFF0C\u4E00\u4E2A\u5E94\u7528\u7A0B\u5E8F\u53EA\u9700\u8981\u4E00\u4E2A ActorSystem \u5C31\u591F\u7528\u4E86\u3002ActorSystem.create() \u51FD\u6570\u7684\u7B2C\u4E00\u4E2A\u53C2\u6570 &quot;Hello\u201D \u4E3A\u7CFB\u7EDF\u540D\u79F0\uFF0C\u7B2C\u4E8C\u4E2A\u53C2\u6570\u4E3A\u914D\u7F6E\u6587\u4EF6\u3002</p><p>\u7B2C 4 \u884C\u901A\u8FC7 ActorSystem \u521B\u5EFA\u4E00\u4E2A\u9876\u7EA7\u7684 Actor\uFF08HelloWorld\uFF09\u3002</p><p>\u914D\u7F6E\u6587\u4EF6 samplehello.conf \u7684\u5185\u5BB9\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>akka <span class="token punctuation">{</span>
    loglevel <span class="token operator">=</span> INFO
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u8FD9\u91CC\uFF0C\u53EA\u662F\u7B80\u5355\u5730\u914D\u7F6E\u65E5\u5FD7\u7EA7\u522B\u4E3A INFO\u3002</p><p>\u6267\u884C\u4E0A\u8FF0\u4EE3\u7801\uFF0C\u53EF\u4EE5\u770B\u5230\u4EE5\u4E0B\u8F93\u51FA\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">HelloWorld</span> <span class="token class-name">Actor</span> <span class="token class-name">Path</span><span class="token operator">:</span>akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token class-name">Hello</span><span class="token operator">/</span>user<span class="token operator">/</span>helloWorld
<span class="token class-name">Greeter</span> <span class="token class-name">Actor</span> <span class="token class-name">Path</span><span class="token operator">:</span>akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token class-name">Hello</span><span class="token operator">/</span>user<span class="token operator">/</span>helloWorld<span class="token operator">/</span>greeter
<span class="token class-name">Hello</span> <span class="token class-name">World</span><span class="token operator">!</span>
<span class="token class-name">Hello</span> <span class="token class-name">World</span><span class="token operator">!</span>
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">/</span><span class="token number">13</span><span class="token operator">/</span><span class="token number">2015</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">01.299</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Hello</span><span class="token operator">-</span>akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token operator">-</span>dispatcher<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token class-name">Hello</span><span class="token operator">/</span>user<span class="token operator">/</span>helloWorld<span class="token punctuation">]</span> <span class="token class-name">Message</span> <span class="token punctuation">[</span><span class="token class-name">Greeter</span>$<span class="token class-name">Msg</span><span class="token punctuation">]</span> from <span class="token class-name">Actor</span><span class="token punctuation">[</span>akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token class-name">Hello</span><span class="token operator">/</span>user<span class="token operator">/</span>helloWorld<span class="token operator">/</span>greeter#<span class="token operator">-</span><span class="token number">1698722495</span><span class="token punctuation">]</span> <span class="token keyword">to</span> <span class="token class-name">Actor</span><span class="token punctuation">[</span>akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token class-name">Hello</span><span class="token operator">/</span>user<span class="token operator">/</span>helloWorld#<span class="token operator">-</span><span class="token number">1915075849</span><span class="token punctuation">]</span> was not delivered<span class="token punctuation">.</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> dead letters <span class="token class-name"><span class="token namespace">encountered<span class="token punctuation">.</span></span> This</span> logging can be turned off or adjusted <span class="token keyword">with</span> <span class="token namespace">configuration</span> settings &#39;akka<span class="token punctuation">.</span>log<span class="token operator">-</span>dead<span class="token operator">-</span>letters<span class="token char">&#39; and &#39;</span>akka<span class="token punctuation">.</span>log<span class="token operator">-</span>dead<span class="token operator">-</span>letters<span class="token operator">-</span>during<span class="token operator">-</span>shutdown&#39;<span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7B2C\u4E00\u884C\u6253\u5370\u4E86 HelloWorld Actor \u7684\u8DEF\u5F84\u3002\u5B83\u662F\u7CFB\u7EDF\u5185\u7B2C\u4E00\u4E2A\u88AB\u521B\u5EFA\u7684 Actor\u3002\u5B83\u7684\u8DEF\u5F84\u4E3A akka://Hello/user/helloWorld\uFF0C\u5176\u4E2D Hello \u8868\u793A ActorSystem \u7684\u7CFB\u7EDF\u540D\uFF0C\u6211\u4EEC\u6784\u9020 ActorSystem \u65F6\uFF0C\u4F20\u5165\u7684\u7B2C\u4E00\u4E2A\u53C2\u6570\u5C31\u662F Hello\uFF1Buser \u8868\u793A\u7528\u6237 Actor\u3002\u6240\u6709\u7684\u7528\u6237 Actor \u90FD\u4F1A\u6302\u8F7D\u5728 user \u8DEF\u5F84\u4E0B\uFF1BhelloWorld \u5C31\u662F\u8FD9\u4E2A Actor \u7684\u540D\u5B57\u3002</p><p>\u540C\u7406\uFF0C\u7B2C\u4E8C\u4E2A Greeter Actor \u7684\u8DEF\u5F84\u7ED3\u6784\u548C HelloWorld \u7684\u8DEF\u5F84\u7ED3\u6784\u662F\u5B8C\u5168\u4E00\u81F4\u7684\u3002\u8F93\u51FA\u7684\u7B2C 3\u30014 \u884C\u663E\u793A\u4E86 Greeter \u6253\u5370\u7684\u4E24\u6761\u4FE1\u606F\u3002\u7B2C 5 \u884C\u8868\u793A\u7CFB\u7EDF\u9047\u5230\u4E86\u4E00\u6761\u6D88\u606F\u6295\u9012\u5931\u8D25\uFF0C\u5931\u8D25\u7684\u539F\u56E0\u662F HelloWorld \u5C06\u81EA\u5DF1\u7EC8\u6B62\u4E86\uFF0C\u5BFC\u81F4 Greeter \u53D1\u9001\u7684\u4FE1\u606F\u65E0\u6CD5\u6295\u9012\u3002</p><p>\u5F53\u4F7F\u7528 Actor \u8FDB\u884C\u5E76\u884C\u7A0B\u5E8F\u5F00\u53D1\u65F6\uFF0C\u6211\u4EEC\u7684\u5173\u6CE8\u70B9\u5DF2\u7ECF\u4E0D\u5728\u7EBF\u7A0B\u4E0A\u4E86\u3002\u5B9E\u9645\u4E0A\uFF0C\u7EBF\u7A0B\u8C03\u5EA6\u5DF2\u7ECF\u88AB Akka \u6846\u67B6\u5C01\u88C5\u4E86\uFF0C\u6211\u4EEC\u53EA\u9700\u8981\u5173\u6CE8 Actor \u5BF9\u8C61\u5373\u53EF\u3002\u800C Actor \u5BF9\u8C61\u4E4B\u95F4\u7684\u4EA4\u6D41\u548C\u666E\u901A\u7684\u5BF9\u8C61\u7684\u51FD\u6570\u8C03\u7528\u6709\u660E\u663E\u533A\u522B\uFF0C\u5B83\u4EEC\u662F\u901A\u8FC7\u663E\u793A\u7684\u6D88\u606F\u53D1\u9001\u6765\u4F20\u9012\u4FE1\u606F\u7684\u3002</p><p>\u5F53\u7CFB\u7EDF\u5185\u6709\u591A\u4E2A Actor \u5B58\u5728\u65F6\uFF0CAkka \u4F1A\u81EA\u52A8\u5728\u7EBF\u7A0B\u6C60\u4E2D\u9009\u62E9\u7EBF\u7A0B\u6765\u6267\u884C\u6211\u4EEC\u7684 Actor\u3002\u56E0\u6B64\uFF0C\u591A\u4E2A\u4E0D\u540C\u7684 Actor \u6709\u53EF\u80FD\u4F1A\u88AB\u540C\u4E00\u4E2A\u7EBF\u7A0B\u6267\u884C\uFF0C\u540C\u65F6\uFF0C\u4E00\u4E2A Actor \u4E5F\u6709\u53EF\u80FD\u88AB\u4E0D\u540C\u7684\u7EBF\u7A0B\u6267\u884C\u3002\u56E0\u6B64\uFF0C\u4E00\u4E2A\u503C\u5F97\u6CE8\u610F\u7684\u5730\u65B9\u662F\uFF1A\u4E0D\u8981\u5728\u4E00\u4E2A Actor \u4E2D\u6267\u884C\u8017\u65F6\u7684\u4EE3\u7801\uFF0C\u8FD9\u6837\u53EF\u80FD\u4F1A\u5BFC\u81F4\u5176\u4ED6 Actor \u7684\u8C03\u5EA6\u51FA\u73B0\u95EE\u9898\u3002</p><h2 id="_7-3-\u6709\u5173\u6D88\u606F\u6295\u9012\u7684\u4E00\u4E9B\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_7-3-\u6709\u5173\u6D88\u606F\u6295\u9012\u7684\u4E00\u4E9B\u8BF4\u660E" aria-hidden="true">#</a> 7.3 \u6709\u5173\u6D88\u606F\u6295\u9012\u7684\u4E00\u4E9B\u8BF4\u660E</h2><p>\u6574\u4E2A Akka \u5E94\u7528\u662F\u7531\u6D88\u606F\u9A71\u52A8\u7684\uFF0C\u6D88\u606F\u662F\u9664 Actor \u4E4B\u5916\u6700\u91CD\u8981\u7684\u6838\u5FC3\u7EC4\u4EF6\u3002\u4F5C\u4E3A\u5E76\u53D1\u7A0B\u5E8F\u4E2D\u7684\u6838\u5FC3\u7EC4\u4EF6\uFF0C\u5728 Actor \u4E4B\u95F4\u4F20\u9012\u7684\u6D88\u606F\u5E94\u8BE5\u6EE1\u8DB3\u4E0D\u53EF\u53D8\u6027\uFF0C\u4E5F\u5C31\u662F\u4E0D\u53D8\u6A21\u5F0F\u3002\u56E0\u4E3A\u53EF\u53D8\u7684\u6D88\u606F\u65E0\u6CD5\u9AD8\u6548\u7684\u5728\u5E76\u53D1\u73AF\u5883\u4E2D\u4F7F\u7528\u3002\u7406\u8BBA\u4E0A Akka \u4E2D\u7684\u6D88\u606F\u53EF\u4EE5\u4F7F\u7528\u4EFB\u4F55\u5BF9\u8C61\u5B9E\u4F8B\uFF0C\u4F46\u5728\u5B9E\u9645\u4F7F\u7528\u4E2D\uFF0C\u5F3A\u70C8\u63A8\u8350\u4F7F\u7528\u4E0D\u53EF\u53D8\u7684\u5BF9\u8C61\u3002\u4E00\u4E2A\u5178\u578B\u7684\u4E0D\u53EF\u53D8\u5BF9\u8C61\u7684\u5B9E\u73B0\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ImmutableMessage</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> sequenceNumber<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ImmutableMessage</span><span class="token punctuation">(</span><span class="token keyword">int</span> sequenceNumber<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sequenceNumber <span class="token operator">=</span> sequenceNumber<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>values <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getSequenceNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sequenceNumber<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> values<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u5B9E\u73B0\u4E86\u4E00\u4E2A\u4E0D\u53EF\u53D8\u7684\u6D88\u606F\u3002\u6CE8\u610F\u4EE3\u7801\u4E2D\u5BF9 final \u7684\u4F7F\u7528\uFF0C\u5B83\u58F0\u660E\u4E86\u5F53\u524D\u6D88\u606F\u4E2D\u7684\u51E0\u4E2A\u5B57\u6BB5\u90FD\u662F\u5E38\u91CF\uFF0C\u5728\u6D88\u606F\u6784\u9020\u5B8C\u6210\u540E\uFF0C\u5C31\u4E0D\u80FD\u518D\u6539\u53D8\u4E86\u3002\u66F4\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u5BF9\u4E8E values \u5B57\u6BB5\uFF0Cfinal \u5173\u952E\u5B57\u53EA\u80FD\u4FDD\u8BC1 values \u5F15\u7528\u7684\u4E0D\u53EF\u53D8\u6027\uFF0C\u65E0\u6CD5\u4FDD\u8BC1 values \u5BF9\u8C61\u7684\u4E0D\u53EF\u53D8\u6027\u3002\u4E3A\u4E86\u5B9E\u73B0\u5F7B\u5E95\u7684\u4E0D\u53EF\u53D8\u6027\uFF0C\u4EE3\u7801\u7B2C 8 \u884C\u6784\u9020\u4E86\u4E00\u4E2A\u4E0D\u53EF\u53D8\u7684 List \u5BF9\u8C61\u3002</p><p>\u5BF9\u4E8E\u6D88\u606F\u6295\u9012\uFF0C\u5927\u5BB6\u53EF\u80FD\u8FD8\u6709\u53E6\u5916\u4E00\u4E2A\u7591\u95EE\uFF0C\u90A3\u5C31\u662F\u6D88\u606F\u6295\u9012\u7A76\u7ADF\u662F\u4EE5\u4F55\u79CD\u7B56\u7565\u8FDB\u884C\u7684\u5462\uFF1F\u4E5F\u5C31\u662F\u53D1\u51FA\u7684\u6D88\u606F\u4E00\u5B9A\u4F1A\u88AB\u5BF9\u65B9\u63A5\u6536\u5230\u5417\uFF1F\u5982\u679C\u63A5\u6536\u4E0D\u5230\u4F1A\u91CD\u53D1\u5417\uFF1F\u6709\u6CA1\u6709\u53EF\u80FD\u91CD\u590D\u63A5\u6536\u6D88\u606F\u5462\uFF1F</p><p>\u5B9E\u9645\u4E0A\uFF0C\u5BF9\u4E8E\u6D88\u606F\u6295\u9012\uFF0C\u6211\u4EEC\u53EF\u4EE5\u6709\u4E09\u79CD\u4E0D\u540C\u7684\u7B56\u7565\u3002</p><p>\u7B2C\u4E00\u79CD\uFF0C\u79F0\u4E3A\u81F3\u591A\u4E00\u6B21\u6295\u9012\u3002\u5728\u8FD9\u79CD\u7B56\u7565\u4E2D\uFF0C\u6BCF\u4E00\u6761\u6D88\u606F\u6700\u591A\u4F1A\u88AB\u6295\u9012\u4E00\u6B21\u3002\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0C\u53EF\u80FD\u5076\u5C14\u4F1A\u51FA\u73B0\u6D88\u606F\u6295\u9012\u5931\u8D25\uFF0C\u800C\u5BFC\u81F4\u6D88\u606F\u4E22\u5931\u3002</p><p>\u7B2C\u4E8C\u79CD\uFF0C\u79F0\u4E3A\u81F3\u5C11\u4E00\u6B21\u6295\u9012\u3002\u5728\u8FD9\u79CD\u7B56\u7565\u4E2D\uFF0C\u6BCF\u4E00\u6761\u6D88\u606F\u81F3\u5C11\u4F1A\u88AB\u6295\u9012\u4E00\u6B21\uFF0C\u76F4\u5230\u6210\u529F\u4E3A\u6B62\u3002\u56E0\u6B64\u5728\u4E00\u4E9B\u5076\u7136\u7684\u573A\u5408\uFF0C\u63A5\u53D7\u8005\u53EF\u80FD\u4F1A\u6536\u5230\u91CD\u590D\u7684\u6D88\u606F\uFF0C\u4F46\u4E0D\u4F1A\u53D1\u751F\u6D88\u606F\u4E22\u5931\u3002</p><p>\u7B2C\u4E09\u79CD\uFF0C\u79F0\u4E3A\u7CBE\u786E\u7684\u6D88\u606F\u6295\u9012\u3002\u4E5F\u5C31\u662F\u6240\u6709\u7684\u6D88\u606F\u4FDD\u8BC1\u88AB\u7CBE\u786E\u5730\u6295\u9012\u5E76\u6210\u529F\u63A5\u6536\u4E00\u6B21\u3002\u65E2\u4E0D\u4F1A\u6709\u4E22\u5931\uFF0C\u4E5F\u4E0D\u4F1A\u6709\u91CD\u590D\u63A5\u6536\u3002</p><p>\u5F88\u660E\u663E\uFF0C\u7B2C\u4E00\u79CD\u7B56\u7565\u662F\u6700\u9AD8\u6027\u80FD\u3001\u6700\u4F4E\u6210\u672C\u7684\u3002\u56E0\u4E3A\u7CFB\u7EDF\u53EA\u8981\u8D1F\u8D23\u628A\u6D88\u606F\u9001\u51FA\u53BB\u5C31\u53EF\u4EE5\u4E86\uFF0C\u4E0D\u9700\u8981\u5173\u6CE8\u662F\u5426\u6210\u529F\u3002\u7B2C\u4E8C\u79CD\u7B56\u7565\u5219\u9700\u8981\u4FDD\u5B58\u6D88\u606F\u6295\u9012\u7684\u72B6\u6001\u5E76\u4E0D\u65AD\u5145\u5B9E\u3002\u7B2C\u4E09\u79CD\u7B56\u7565\u5219\u662F\u6210\u672C\u6700\u9AD8\u4E14\u6700\u4E0D\u5BB9\u6613\u5B9E\u73B0\u7684\u3002</p><p>\u90A3\u6211\u4EEC\u662F\u5426\u771F\u7684\u9700\u8981\u4FDD\u8BC1\u6D88\u606F\u6295\u9012\u7684\u53EF\u9760\u6027\u5462\uFF1F</p><p>\u7B54\u6848\u662F\u5426\u5B9A\u7684\u3002\u5B9E\u9645\u4E0A\uFF0C\u6211\u4EEC\u6CA1\u6709\u5FC5\u8981\u5728 Akka \u5C42\u4FDD\u8BC1\u6D88\u606F\u7684\u53EF\u9760\u6027\u3002\u8FD9\u6837\u505A\u6210\u672C\u592A\u9AD8\u4E86\uFF0C\u4E5F\u662F\u6CA1\u6709\u5FC5\u8981\u7684\u3002\u6D88\u606F\u7684\u53EF\u9760\u6027\u66F4\u5E94\u8BE5\u4ECE\u5E94\u7528\u7684\u4E1A\u52A1\u5C42\u53BB\u7EF4\u62A4\uFF0C\u56E0\u4E3A\u4E5F\u8BB8\u5728\u6709\u4E9B\u65F6\u5019\uFF0C\u4E22\u5931\u4E00\u4E9B\u6D88\u606F\u5B8C\u5168\u662F\u7B26\u5408\u5E94\u7528\u8981\u6C42\u7684\u3002\u56E0\u6B64\uFF0C\u5728\u4F7F\u7528 Akka \u65F6\uFF0C\u9700\u8981\u5728\u4E1A\u52A1\u5C42\u5BF9\u6B64\u8FDB\u884C\u4FDD\u8BC1\u3002</p><p>\u6B64\u5916\uFF0C\u5BF9\u4E8E\u6D88\u606F\u6295\u9012 Akka \u53EF\u4EE5\u5728\u4E00\u5B9A\u7A0B\u5EA6\u4E0A\u4FDD\u8BC1\u987A\u5E8F\u6027\u3002\u6BD4\u5982\uFF0CActor A1 \u5411 Actor A2 \u987A\u5E8F\u53D1\u9001\u4E86 M1\u3001M2 \u548C M3 \u4E09\u6761\u6D88\u606F\uFF0CActor A3 \u5411 Actor A2 \u987A\u5E8F\u53D1\u9001\u4E86 M4\u3001M5 \u548C M6 \u4E09\u6761\u6D88\u606F\uFF0C\u90A3\u4E48\u7CFB\u7EDF\u53EF\u4EE5\u4FDD\u8BC1\uFF1A</p><ol><li>\u5982\u679C M1 \u6CA1\u6709\u4E22\u5931\uFF0C\u90A3\u5B83\u4E00\u5B9A\u5148\u4E8E M2 \u548C M3 \u88AB Actor A2 \u6536\u5230\u3002</li><li>\u5982\u679C M2 \u6CA1\u6709\u4E22\u5931\uFF0C\u90A3\u5B83\u4E00\u5B9A\u5148\u4E8E M3 \u88AB Actor A2 \u6536\u5230\u3002</li><li>\u5982\u679C M4 \u6CA1\u6709\u4E22\u5931\uFF0C\u90A3\u5B83\u4E00\u5B9A\u5148\u4E8E M5 \u548C M6 \u88AB Actor A2 \u6536\u5230\u3002</li><li>\u5982\u679C M5 \u6CA1\u6709\u4E22\u5931\uFF0C\u90A3\u5B83\u4E00\u5B9A\u5148\u4E8E M6 \u88AB Actor A2 \u6536\u5230\u3002</li><li>\u5BF9 Actor A2 \u6765\u8BF4\uFF0C\u6765\u81EA Actor A1 \u548C Actor A3 \u7684\u6D88\u606F\u53EF\u80FD\u4EA4\u7EC7\u5728\u4E00\u8D77\uFF0C\u6CA1\u6709\u987A\u5E8F\u4FDD\u8BC1\u3002</li></ol><p>\u503C\u5F97\u6CE8\u610F\u7684\u4E00\u70B9\u662F\uFF0C\u8FD9\u79CD\u6D88\u606F\u6295\u9012\u89C4\u5219\u4E0D\u5177\u5907\u53EF\u4F20\u9012\u6027\uFF0C\u6BD4\u5982\uFF1AActor A \u5411 Actor C \u53D1\u9001\u4E86 M1\uFF0C\u63A5\u7740\uFF0CActor A \u5411 Actor B \u53D1\u9001\u4E86 M2\uFF0CActor B \u5C06 M2 \u8F6C\u53D1\u7ED9 Actor C\uFF0C\u90A3\u4E48\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0CActor C \u6536\u5230 M1 \u548C M2 \u7684\u5148\u540E\u987A\u5E8F\u662F\u6CA1\u6709\u4FDD\u8BC1\u7684\u3002</p><h2 id="_7-4-actor-\u7684\u751F\u547D\u5468\u671F" tabindex="-1"><a class="header-anchor" href="#_7-4-actor-\u7684\u751F\u547D\u5468\u671F" aria-hidden="true">#</a> 7.4 Actor \u7684\u751F\u547D\u5468\u671F</h2><p>Actor \u5728\u7CFB\u7EDF\u4E2D\u4EA7\u751F\u540E\uFF0C\u4E5F\u5B58\u5728\u7740 \u201C\u751F\u8001\u75C5\u6B7B\u201D \u7684\u6D3B\u52A8\u5468\u671F\u3002Akka \u6846\u67B6\u63D0\u4F9B\u4E86\u82E5\u5E72\u56DE\u8C03\u51FD\u6570\uFF0C\u8BA9\u6211\u4EEC\u5F97\u4EE5\u5728 Actor \u7684\u6D3B\u52A8\u5468\u671F\u5185\u8FDB\u884C\u4E00\u4E9B\u4E1A\u52A1\u76F8\u5173\u7684\u884C\u4E3A\u3002Actor \u7684\u751F\u547D\u5468\u671F\u5982\u56FE7.1 \u6240\u793A\u3002</p><img src="`+o+`" alt="\u56FE7-1" style="zoom:100%;"><p>\u56FE7.1 Actor \u7684\u751F\u547D\u5468\u671F</p><p>\u4E00\u4E2A Actor \u5728 actorOf() \u51FD\u6570\u88AB\u8C03\u7528\u540E\u5F00\u59CB\u5EFA\u7ACB\uFF0CActor \u5B9E\u4F8B\u521B\u5EFA\u540E\u4F1A\u56DE\u8C03 preStart() \u65B9\u6CD5\u3002\u5728\u8FD9\u4E2A\u65B9\u6CD5\u91CC\uFF0C\u6211\u4EEC\u53EF\u4EE5\u8FDB\u884C\u4E00\u4E9B\u8D44\u6E90\u7684\u521D\u59CB\u5316\u5DE5\u4F5C\u3002\u5728 Actor \u7684\u5DE5\u4F5C\u8FC7\u7A0B\u4E2D\uFF0C\u53EF\u80FD\u4F1A\u51FA\u73B0\u4E00\u4E9B\u5F02\u5E38\uFF0C\u8FD9\u79CD\u60C5\u51B5\u4E0B Actor \u9700\u8981\u91CD\u542F\u3002\u5F53 Actor \u88AB\u91CD\u542F\u65F6\uFF0C\u4F1A\u56DE\u8C03 preRestart() \u65B9\u6CD5\uFF08\u5728\u8001\u7684\u5B9E\u4F8B\u4E0A\uFF09\uFF0C\u63A5\u7740\u7CFB\u7EDF\u4F1A\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684 Actor \u5BF9\u8C61\u5B9E\u4F8B\uFF08\u867D\u7136\u662F\u65B0\u7684\u5B9E\u4F8B\uFF0C\u4F46\u5B83\u4EEC\u90FD\u8868\u793A\u540C\u4E00\u4E2A Actor\uFF09\u3002\u5F53\u65B0\u7684 Actor \u5B9E\u4F8B\u521B\u5EFA\u540E\uFF0C\u4F1A\u56DE\u8C03 postRestart() \u65B9\u6CD5\uFF0C\u8868\u793A\u542F\u52A8\u5B8C\u6210\uFF0C\u540C\u65F6\u65B0\u7684\u5B9E\u4F8B\u5C06\u4F1A\u4EE3\u66FF\u65E7\u7684\u5B9E\u4F8B\u3002\u505C\u6B62\u4E00\u4E2A Actor \u4E5F\u6709\u5F88\u591A\u65B9\u5F0F\uFF0C\u4F60\u53EF\u4EE5\u8C03\u7528 stop() \u65B9\u6CD5\u6216\u8005\u7ED9 Actor \u53D1\u9001\u4E00\u4E2A PosionPill\uFF08\u6BD2\u836F\u4E38\uFF09\u3002\u5F53 Actor \u505C\u6B62\u65F6\uFF0CpostStop() \u65B9\u6CD5\u4F1A\u88AB\u8C03\u7528\uFF0C\u540C\u65F6\u8FD9\u4E2A Actor \u7684\u76D1\u89C6\u8005\u4F1A\u6536\u5230\u4E00\u4E2A Terminated \u6D88\u606F\u3002</p><p>\u4E0B\u9762\u8BA9\u6211\u4EEC\u5EFA\u7ACB\u4E00\u4E2A\u5E26\u6709\u751F\u547D\u5468\u671F\u56DE\u8C03\u51FD\u6570\u7684 Actor\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyWorker</span> <span class="token keyword">extends</span> <span class="token class-name">UntypedActor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">LoggingAdapter</span> log <span class="token operator">=</span> <span class="token class-name">Logging</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">enum</span> <span class="token class-name">Msg</span> <span class="token punctuation">{</span>
        WORKING<span class="token punctuation">,</span> DONE<span class="token punctuation">,</span> CLOSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">preStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MyWorker is starting&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MyWorker is stopping&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token class-name">Msg</span><span class="token punctuation">.</span>WORKING<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;I am working&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token class-name">Msg</span><span class="token punctuation">.</span>DONE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Stop working&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token class-name">Msg</span><span class="token punctuation">.</span>CLOSE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;I will shutdown&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">getSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">Msg</span><span class="token punctuation">.</span>CLOSE<span class="token punctuation">,</span> <span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">unhandled</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u5B9A\u4E49\u4E86\u4E00\u4E2A\u540D\u4E3A MyWorker \u7684 Actor\u3002\u5B83\u91CD\u8F7D\u4E86 preStart() \u548C postStop() \u4E24\u4E2A\u65B9\u6CD5\u3002\u4E00\u822C\u6765\u8BF4\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528 preStart() \u65B9\u6CD5\u6765\u521D\u59CB\u5316\u4E00\u4E9B\u8D44\u6E90\uFF0C\u4F7F\u7528 postStop() \u65B9\u6CD5\u6765\u8FDB\u884C\u8D44\u6E90\u7684\u91CA\u653E\u3002\u8FD9\u4E2A Actor \u5F88\u7B80\u5355\uFF0C\u5F53\u5B83\u6536\u5230 WORKING \u6D88\u606F\u65F6\uFF0C\u5C31\u6253\u5370 &quot;I am working\u201D\uFF0C\u6536\u5230 DONE \u6D88\u606F\u65F6\uFF0C\u6253\u5370 &quot;Stop working\u201D\u3002</p><p>\u63A5\u7740\uFF0C\u6211\u4EEC\u4E3A MyWorker \u6307\u5B9A\u4E00\u4E2A\u76D1\u89C6\u8005\uFF0C\u76D1\u89C6\u8005\u5C31\u5982\u540C\u4E00\u4E2A\u52B3\u52A8\u76D1\u5DE5\uFF0C\u4E00\u65E6 MyWorker \u56E0\u4E3A\u610F\u5916\u505C\u6B62\u5DE5\u4F5C\uFF0C\u76D1\u89C6\u8005\u5C31\u4F1A\u6536\u5230\u4E00\u4E2A\u901A\u77E5\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WatchActor</span> <span class="token keyword">extends</span> <span class="token class-name">UntypedActor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">LoggingAdapter</span> log <span class="token operator">=</span> <span class="token class-name">Logging</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">WatchActor</span><span class="token punctuation">(</span><span class="token class-name">ActorRef</span> ref<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">Terminated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s has terminated, shutting down system&quot;</span><span class="token punctuation">,</span> 
                    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Terminated</span><span class="token punctuation">)</span> msg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getActor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">unhandled</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u5B9A\u4E49\u4E86\u4E00\u4E2A\u76D1\u89C6\u8005 WatchActor\uFF0C\u5B83\u672C\u8D28\u4E0A\u4E5F\u662F\u4E00\u4E2A Actor\uFF0C\u4F46\u4E0D\u540C\u7684\u662F\uFF0C\u5B83\u4F1A\u5728\u5B83\u7684\u4E0A\u4E0B\u6587\u4E2D watch \u4E00\u4E2A Actor\uFF08\u7B2C 5 \u884C\uFF09\u3002\u5982\u679C\u5C06\u6765\u8FD9\u4E2A\u88AB\u76D1\u89C6\u7684 Actor \u7684\u9000\u51FA\u7EC8\u6B62\uFF0CWatchActor \u5C31\u80FD\u6536\u5230\u4E00\u6761 Terminated \u6D88\u606F\uFF08\u4EE3\u7801\u7B2C 10 \u884C\uFF09\u3002\u5728\u8FD9\u91CC\uFF0C\u6211\u4EEC\u5C06\u7B80\u5355\u5730\u6253\u5370\u7EC8\u6B62\u6D88\u606F Terminated \u4E2D\u7684\u76F8\u5173 Actor \u8DEF\u5F84\uFF0C\u5E76\u4E14\u5173\u95ED\u6574\u4E2A ActorSystem\uFF08\u7B2C 13 \u884C\uFF09\u3002</p><p>\u4E3B\u51FD\u6570\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeadMain</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ActorSystem</span> system <span class="token operator">=</span> <span class="token class-name">ActorSystem</span>
                <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;deadwatch&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ConfigFactory</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;samplehello.conf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ActorRef</span> worker <span class="token operator">=</span> system<span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">MyWorker</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;worker&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        system<span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">WatchActor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> worker<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;watcher&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        worker<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">MyWorker<span class="token punctuation">.</span>Msg</span><span class="token punctuation">.</span>WORKING<span class="token punctuation">,</span> <span class="token class-name">ActorRef</span><span class="token punctuation">.</span><span class="token function">noSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        worker<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">MyWorker<span class="token punctuation">.</span>Msg</span><span class="token punctuation">.</span>DONE<span class="token punctuation">,</span> <span class="token class-name">ActorRef</span><span class="token punctuation">.</span><span class="token function">noSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        worker<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">PoisonPill</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ActorRef</span><span class="token punctuation">.</span><span class="token function">noSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u9996\u5148\u521B\u5EFA ActorSystem \u5168\u5C40\u5B9E\u4F8B\uFF08\u7B2C 3 ~ 4 \u884C\uFF09\uFF0C\u63A5\u7740\u521B\u5EFA MyWorker Actor \u548C WatchActor\u3002\u6CE8\u610F\u7B2C 6 \u884C\u7684 Props.create() \u65B9\u6CD5\uFF0C\u5B83\u7684\u7B2C 1 \u4E2A\u53C2\u6570\u4E3A\u8981\u521B\u5EFA\u7684 Actor \u7C7B\u578B\uFF0C\u7B2C 2 \u4E2A\u53C2\u6570\u4E3A\u8FD9\u4E2A Actor \u7684\u6784\u9020\u51FD\u6570\u7684\u53C2\u6570\uFF08\u5728\u8FD9\u91CC\uFF0C\u5C31\u662F\u8981\u8C03\u7528 WatchActor \u7684\u6784\u9020\u51FD\u6570\uFF09\u3002\u63A5\u7740\uFF0C\u5411 MyWorker \u5148\u540E\u53D1\u9001 WORKING \u548C DONE \u4E24\u6761\u6D88\u606F\u3002\u6700\u540E\u5728\u7B2C 9 \u884C\uFF0C\u53D1\u9001\u4E00\u6761\u7279\u6B8A\u7684\u6D88\u606F PoisonPill\u3002PoisonPill \u610F\u4E3A\u6BD2\u836F\u4E38\uFF0C\u5B83\u4F1A\u76F4\u63A5 \u201C\u6BD2\u6B7B\u201D \u63A5\u6536\u65B9\uFF0C\u8BA9\u5176\u7EC8\u6B62\u3002</p><p>\u6267\u884C\u4E0A\u8FF0\u4EE3\u7801\uFF0C\u7CFB\u7EDF\u8F93\u51FA\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">MyWorker</span> is starting
<span class="token class-name">I</span> am working
<span class="token class-name">Stop</span> working
<span class="token class-name">MyWorker</span> is stopping
akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>deadwatch<span class="token operator">/</span>user<span class="token operator">/</span>worker has terminated<span class="token punctuation">,</span> shutting down system
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECE\u8FD9\u4E2A\u8F93\u51FA\u4E2D\u53EF\u4EE5\u770B\u5230\uFF0CMyWorker \u751F\u547D\u5468\u671F\u4E2D\u7684\u4E24\u4E2A\u56DE\u8C03\u51FD\u6570\u53CA\u6D88\u606F\u5904\u7406\u51FD\u6570\u90FD\u88AB\u6B63\u5E38\u8C03\u7528\u3002\u6700\u540E\u4E00\u884C\u8F93\u51FA\u4E5F\u663E\u793A WatchActor \u6B63\u5E38\u76D1\u89C6\u5230 MyWorker \u7684\u7EC8\u6B62\u3002</p><h2 id="_7-5-\u76D1\u7763\u7B56\u7565" tabindex="-1"><a class="header-anchor" href="#_7-5-\u76D1\u7763\u7B56\u7565" aria-hidden="true">#</a> 7.5 \u76D1\u7763\u7B56\u7565</h2><p>\u5982\u679C\u4E00\u4E2A Actor \u5728\u6267\u884C\u8FC7\u7A0B\u4E2D\u53D1\u751F\u610F\u5916\uFF0C\u6BD4\u5982\u56E0\u6CA1\u6709\u5904\u7406\u67D0\u4E9B\u5F02\u5E38\u5BFC\u81F4\u51FA\u9519\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u65F6\u5019\u5E94\u8BE5\u600E\u4E48\u529E\u5462\uFF1F\u7CFB\u7EDF\u662F\u5E94\u8BE5\u5F53\u505A\u4EC0\u4E48\u90FD\u6CA1\u53D1\u751F\u8FC7\uFF0C\u7EE7\u7EED\u6267\u884C\uFF0C\u8FD8\u662F\u8BA4\u4E3A\u9047\u5230\u4E86\u4E00\u4E2A\u7CFB\u7EDF\u6027\u7684\u9519\u8BEF\u800C\u91CD\u542F Actor\uFF0C\u751A\u81F3\u662F\u5B83\u6240\u6709\u7684\u5144\u5F1F Actor \u5462\uFF1F</p><p>\u5BF9\u4E8E\u8FD9\u79CD\u60C5\u51B5\uFF0CAkka \u6846\u67B6\u7ED9\u4E88\u4E86\u6211\u4EEC\u8DB3\u591F\u7684\u63A7\u5236\u6743\u3002\u5728 Akka \u6846\u67B6\u5185\uFF0C\u7236 Actor \u53EF\u4EE5\u5BF9\u5B50 Actor \u8FDB\u884C\u76D1\u7763\uFF0C\u76D1\u63A7 Actor \u7684\u884C\u4E3A\u662F\u5426\u6709\u5F02\u5E38\u3002\u76D1\u7763\u7B56\u7565\u53EF\u4EE5\u5206\u4E3A\u4E24\u79CD\uFF1A\u4E00\u79CD\u662F OneForOneStrategy \u7B56\u7565\u7684\u76D1\u7763\uFF0C\u53E6\u5916\u4E00\u79CD\u662F AllForOneStrategy \u7B56\u7565\u7684\u76D1\u7763\u3002</p><p>\u5BF9\u4E8E OneForOneStrategy \u7B56\u7565\uFF0C\u7236 Actor \u53EA\u4F1A\u5BF9\u51FA\u95EE\u9898\u7684\u5B50 Actor \u8FDB\u884C\u5904\u7406\uFF0C\u6BD4\u5982\u91CD\u542F\u6216\u8005\u505C\u6B62\uFF0C\u800C\u5BF9\u4E8E AllForOneStrategy \u7B56\u7565\uFF0C\u7236 Actor \u4F1A\u5BF9\u51FA\u95EE\u9898\u7684\u5B50 Actor \u53CA\u5B83\u6240\u6709\u7684\u5144\u5F1F\u90FD\u8FDB\u884C\u5904\u7406\u3002\u5F88\u663E\u7136\uFF0C\u5BF9\u4E8E AllForOneStrategy \u7B56\u7565\uFF0C\u5B83\u66F4\u52A0\u9002\u5408\u5404\u4E2A Actor \u8054\u7CFB\u975E\u5E38\u7D27\u5BC6\u7684\u573A\u666F\uFF0C\u591A\u4E2A Actor \u95F4\u53EA\u8981\u6709\u4E00\u4E2A Actor \u51FA\u73B0\u6545\u969C\uFF0C\u5C31\u5BA3\u544A\u6574\u4E2A\u4EFB\u52A1\u5931\u8D25\u3002\u5426\u5219\uFF0C\u5728\u66F4\u591A\u7684\u573A\u666F\u4E2D\uFF0C\u5E94\u8BE5\u4F7F\u7528 OneForOneStrategy \u7B56\u7565\u3002\u5F53\u7136\u4E86\uFF0COneForOneStrategy \u7B56\u7565\u4E5F\u662F Akka \u7684\u9ED8\u8BA4\u7B56\u7565\u3002</p><p>\u5728\u4E00\u4E2A\u6307\u5B9A\u7684\u7B56\u7565\u4E2D\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5BF9 Actor \u7684\u5931\u8D25\u60C5\u51B5\u8FDB\u884C\u76F8\u5E94\u7684\u5904\u7406\uFF0C\u6BD4\u5982\u5F53\u5931\u8D25\u65F6\uFF0C\u6211\u4EEC\u53EF\u4EE5\u65E0\u89C6\u8FD9\u4E2A\u9519\u8BEF\uFF0C\u7EE7\u7EED\u6267\u884C Actor\uFF0C\u5C31\u50CF\u4EC0\u4E48\u4E8B\u90FD\u6CA1\u53D1\u751F\u8FC7\u4E00\u6837\u3002\u6216\u8005\u53EF\u4EE5\u91CD\u542F Actor\uFF0C\u751A\u81F3\u53EF\u4EE5\u8BA9 Actor \u5F7B\u5E95\u505C\u6B62\u5DE5\u4F5C\u3002\u8981\u6307\u5B9A\u8FD9\u4E9B\u76D1\u7763\u884C\u4E3A\uFF0C\u53EA\u8981\u6784\u9020\u4E00\u4E2A\u81EA\u5B9A\u4E49\u7684\u76D1\u7763\u7B56\u7565\u5373\u53EF\u3002</p><p>\u4E0B\u9762\u8BA9\u6211\u4EEC\u7B80\u5355\u770B\u4E00\u4E0B SupervisorStrategy \u7684\u4F7F\u7528\u548C\u8BBE\u7F6E\u3002\u9996\u5148\uFF0C\u9700\u8981\u5B9A\u4E49\u4E00\u4E2A\u7236 Actor\uFF0C\u628A\u5B83\u4F5C\u4E3A\u6240\u6709\u5B50 Actor \u7684\u76D1\u7763\u8005\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Supervisor</span> <span class="token keyword">extends</span> <span class="token class-name">UntypedActor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">SupervisorStrategy</span> strategy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OneForOneStrategy</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Throwable</span><span class="token punctuation">,</span> <span class="token class-name">SupervisorStrategy<span class="token punctuation">.</span>Directive</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token class-name">SupervisorStrategy<span class="token punctuation">.</span>Directive</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token keyword">instanceof</span> <span class="token class-name">ArithmeticException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;meet ArithmeticException,just resume&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> <span class="token class-name">SupervisorStrategy</span><span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token keyword">instanceof</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;meet NullPointerException,restart&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> <span class="token class-name">SupervisorStrategy</span><span class="token punctuation">.</span><span class="token function">restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token keyword">instanceof</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span> <span class="token class-name">SupervisorStrategy</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span> <span class="token class-name">SupervisorStrategy</span><span class="token punctuation">.</span><span class="token function">escalate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">SupervisorStrategy</span> <span class="token function">supervisorStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> strategy<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token keyword">instanceof</span> <span class="token class-name">Props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">)</span> o<span class="token punctuation">,</span> <span class="token string">&quot;restartActor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">unhandled</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u7B2C 2 ~ 18 \u884C\u5B9A\u4E49\u4E86\u4E00\u4E2A OneForOneStrategy \u7B56\u7565\u7684\u76D1\u7763\u3002\u5728\u8FD9\u4E2A\u76D1\u7763\u7B56\u7565\u4E2D\uFF0C\u8FD0\u884C Actor \u9047\u5230\u9519\u8BEF\u540E\uFF0C\u5728 1 \u5206\u949F\u5185\u8FDB\u884C 3 \u6B21\u91CD\u8BD5\u3002\u5982\u679C\u8D85\u8FC7\u8FD9\u4E2A\u9891\u7387\uFF0C\u5C31\u76F4\u63A5\u6740\u6B7B Actor\u3002\u5177\u4F53\u7684\u7B56\u7565\u7531\u7B2C 5 ~ 16 \u884C\u5B9A\u4E49\u3002\u8FD9\u91CC\u7684\u542B\u4E49\u662F\uFF0C\u5F53\u9047\u5230 ArithmeticException \u5F02\u5E38\u65F6\uFF08\u6BD4\u5982\u9664\u4EE5 0 \u7684\u9519\u8BEF\uFF09\uFF0C\u7EE7\u7EED\u6307\u5B9A\u8FD9\u4E2A Actor\uFF0C\u4E0D\u505A\u4EFB\u4F55\u5904\u7406\uFF08\u7B2C 8 \u884C\uFF09\uFF1B\u5F53\u9047\u5230\u7A7A\u6307\u9488\u65F6\uFF0C\u8FDB\u884C Actor \u91CD\u542F\uFF08\u7B2C 11 \u884C\uFF09\u3002\u5982\u679C\u9047\u5230 IllegalArgumentException \u5F02\u5E38\uFF0C\u5219\u76F4\u63A5\u505C\u6B62 Actor\uFF08\u7B2C 13 \u884C\uFF09\u3002\u5BF9\u4E8E\u5728\u8FD9\u4E2A\u51FD\u6570\u4E2D\u6CA1\u6709\u6D89\u53CA\u7684\u5F02\u5E38\uFF0C\u5219\u5411\u4E0A\u629B\u51FA\uFF0C\u7531\u9876\u5C42\u7684 Actor \u5904\u7406\uFF08\u7B2C 15 \u884C\uFF09\u3002</p><p>\u7B2C 20 ~ 23 \u884C\u8986\u76D6\u7236\u7C7B\u7684 supervisorStrategy() \u65B9\u6CD5\uFF0C\u8BBE\u7F6E\u4F7F\u7528\u81EA\u5B9A\u4E49\u7684\u76D1\u7763\u7B56\u7565\u3002</p><p>\u7B2C 27 \u884C\u7528\u6765\u65B0\u5EFA\u4E00\u4E2A\u540D\u4E3A restartActor \u7684\u5B50 Actor\uFF0C\u8FD9\u4E2A\u5B50 Actor \u5C31\u7531\u5F53\u524D\u7684 Supervisor \u8FDB\u884C\u76D1\u7763\u4E86\u3002\u5F53 Supervisor \u63A5\u6536\u4E00\u4E2A Props \u5BF9\u8C61\u65F6\uFF0C\u5C31\u4F1A\u6839\u636E\u8FD9\u4E2A Props \u5BF9\u8C61\u914D\u7F6E\u751F\u6210\u4E00\u4E2A restartActor\u3002</p><p>RestartActor \u7684\u5B9E\u73B0\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RestartActor</span> <span class="token keyword">extends</span> <span class="token class-name">UntypedActor</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Msg</span> <span class="token punctuation">{</span>
        DONE<span class="token punctuation">,</span> RESTART
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">preStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;preStart hashcode:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;postStop hashcode:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postRestart</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> reason<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">postRestart</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;postRestart hashcode:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">preRestart</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> reason<span class="token punctuation">,</span> <span class="token class-name">Option</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;preRestart hashcode:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token class-name">Msg</span><span class="token punctuation">.</span>DONE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token class-name">Msg</span><span class="token punctuation">.</span>RESTART<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">)</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u629B\u51FA\u5F02\u5E38\uFF0C\u9ED8\u8BA4\u4F1A\u88AB restart\uFF0C\u4F46\u8FD9\u91CC\u4F1A resume</span>
            <span class="token keyword">double</span> a <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">unhandled</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7B2C 6 ~ 25 \u884C\u5B9A\u4E49\u4E86\u4E00\u4E9B Actor \u751F\u547D\u5468\u671F\u7684\u56DE\u8C03\u63A5\u53E3\uFF0C\u76EE\u7684\u662F\u66F4\u597D\u5730\u89C2\u5BDF Actor \u7684\u6D3B\u52A8\u60C5\u51B5\u3002\u5728\u7B2C 32 ~ 34 \u884C\u6A21\u62DF\u4E86\u4E00\u4E9B\u5F02\u5E38\u60C5\u51B5\uFF0C\u7B2C 32 \u884C\u4F1A\u629B\u51FA NullPointerException\uFF0C\u800C\u7B2C 34 \u884C\u56E0\u4E3A\u9664\u4EE5\u96F6\uFF0C\u6240\u4EE5\u4F1A\u629B\u51FA ArithmeticException\u3002</p><p>\u4E3B\u51FD\u6570\u5B9A\u4E49\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">customStrategy</span><span class="token punctuation">(</span><span class="token class-name">ActorSystem</span> system<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ActorRef</span> a <span class="token operator">=</span> system<span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Supervisor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Supervisor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    a<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">RestartActor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ActorRef</span><span class="token punctuation">.</span><span class="token function">noSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ActorSelection</span> sel <span class="token operator">=</span> system<span class="token punctuation">.</span><span class="token function">actorSelection</span><span class="token punctuation">(</span><span class="token string">&quot;akka://lifecycle/user/Supervisor/restartActor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sel<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">RestartActor<span class="token punctuation">.</span>Msg</span><span class="token punctuation">.</span>RESTART<span class="token punctuation">,</span> <span class="token class-name">ActorRef</span><span class="token punctuation">.</span><span class="token function">noSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ActorSystem</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;lifecycle&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ConfigFactory</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;lifecycle.conf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">customStrategy</span><span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u4E0A\u8FF0\u4EE3\u7801\u4E2D\uFF0C\u521B\u5EFA\u4E86\u5168\u5C40 ActorSystem\uFF0C\u63A5\u7740\u5728 customStrategy() \u51FD\u6570\u4E2D\u521B\u5EFA\u4E86 Supervisor Actor\uFF0C\u5E76\u4E14\u5BF9 Supervisor \u53D1\u9001\u4E00\u4E2A RestartActor \u7684 Props \u5BF9\u8C61\uFF08\u7B2C 3 \u884C\uFF0C\u8FD9\u4E2A\u6D88\u606F\u4F1A\u4F7F\u5F97 Supervisor \u521B\u5EFA RestartActor\uFF09\u3002</p><p>\u63A5\u7740\uFF0C\u9009\u4E2D RestartActor \u5B9E\u4F8B\uFF08\u7B2C 5 \u884C\uFF09\uFF0C\u5411\u5B83\u53D1\u9001 100 \u6761 RESTART \u6D88\u606F\uFF08\u7B2C 7 ~ 9 \u884C\uFF09\uFF0C\u8FD9\u4F1A\u4F7F\u5F97 RestartActor \u629B\u51FA NullPointerException\u3002</p><p>\u6267\u884C\u4E0A\u8FF0\u4EE3\u7801\uFF0C\u90E8\u5206\u8F93\u51FA\u5982\u4E0B\uFF08\u7531\u4E8E\u8F93\u51FA\u592A\u591A\uFF0C\u8FD9\u91CC\u53EA\u622A\u53D6\u91CD\u8981\u7684\u90E8\u5206\uFF09\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>preStart hashcode<span class="token operator">:</span><span class="token number">7302437</span>
meet <span class="token class-name">NullPointerException</span><span class="token punctuation">,</span>restart
postRestart hashcode<span class="token operator">:</span><span class="token number">7302437</span>
<span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>lifecycle<span class="token operator">-</span>akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token operator">-</span>dispatcher<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>lifecycle<span class="token operator">/</span>user<span class="token operator">/</span><span class="token class-name">Supervisor</span><span class="token operator">/</span>restartActor<span class="token punctuation">]</span> <span class="token keyword">null</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NullPointerException</span>
	at <span class="token class-name">RestartActor</span><span class="token punctuation">.</span><span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">RestartActor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">46</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span></span>UntypedActor</span>$$anonfun$receive$<span class="token number">1.</span><span class="token function">applyOrElse</span><span class="token punctuation">(</span><span class="token class-name">UntypedActor</span><span class="token punctuation">.</span>scala<span class="token operator">:</span><span class="token number">167</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span></span>Actor</span>$<span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">aroundReceive</span><span class="token punctuation">(</span><span class="token class-name">Actor</span><span class="token punctuation">.</span>scala<span class="token operator">:</span><span class="token number">465</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span></span>UntypedActor</span><span class="token punctuation">.</span><span class="token function">aroundReceive</span><span class="token punctuation">(</span><span class="token class-name">UntypedActor</span><span class="token punctuation">.</span>scala<span class="token operator">:</span><span class="token number">97</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span></span>ActorCell</span><span class="token punctuation">.</span><span class="token function">receiveMessage</span><span class="token punctuation">(</span><span class="token class-name">ActorCell</span><span class="token punctuation">.</span>scala<span class="token operator">:</span><span class="token number">516</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span></span>ActorCell</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">ActorCell</span><span class="token punctuation">.</span>scala<span class="token operator">:</span><span class="token number">487</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">akka<span class="token punctuation">.</span>dispatch<span class="token punctuation">.</span></span>Mailbox</span><span class="token punctuation">.</span><span class="token function">processMailbox</span><span class="token punctuation">(</span><span class="token class-name">Mailbox</span><span class="token punctuation">.</span>scala<span class="token operator">:</span><span class="token number">254</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">akka<span class="token punctuation">.</span>dispatch<span class="token punctuation">.</span></span>Mailbox</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Mailbox</span><span class="token punctuation">.</span>scala<span class="token operator">:</span><span class="token number">221</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">akka<span class="token punctuation">.</span>dispatch<span class="token punctuation">.</span></span>Mailbox</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token class-name">Mailbox</span><span class="token punctuation">.</span>scala<span class="token operator">:</span><span class="token number">231</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>forkjoin<span class="token punctuation">.</span></span>ForkJoinTask</span><span class="token punctuation">.</span><span class="token function">doExec</span><span class="token punctuation">(</span><span class="token class-name">ForkJoinTask</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">260</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>forkjoin<span class="token punctuation">.</span></span>ForkJoinPool</span>$<span class="token class-name">WorkQueue</span><span class="token punctuation">.</span><span class="token function">runTask</span><span class="token punctuation">(</span><span class="token class-name">ForkJoinPool</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1339</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>forkjoin<span class="token punctuation">.</span></span>ForkJoinPool</span><span class="token punctuation">.</span><span class="token function">runWorker</span><span class="token punctuation">(</span><span class="token class-name">ForkJoinPool</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1979</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>forkjoin<span class="token punctuation">.</span></span>ForkJoinWorkerThread</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ForkJoinWorkerThread</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">107</span><span class="token punctuation">)</span>

preStart hashcode<span class="token operator">:</span><span class="token number">23269863</span>
postRestart hashcode<span class="token operator">:</span><span class="token number">23269863</span>
meet <span class="token class-name">NullPointerException</span><span class="token punctuation">,</span>restart
preRestart hashcode<span class="token operator">:</span><span class="token number">23269863</span>
preStart hashcode<span class="token operator">:</span><span class="token number">24918371</span>
postRestart hashcode<span class="token operator">:</span><span class="token number">24918371</span>
meet <span class="token class-name">NullPointerException</span><span class="token punctuation">,</span>restart
preRestart hashcode<span class="token operator">:</span><span class="token number">24918371</span>
preStart hashcode<span class="token operator">:</span><span class="token number">12844205</span>
postRestart hashcode<span class="token operator">:</span><span class="token number">12844205</span>
<span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>lifecycle<span class="token operator">-</span>akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token operator">-</span>dispatcher<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>lifecycle<span class="token operator">/</span>user<span class="token operator">/</span><span class="token class-name">Supervisor</span><span class="token operator">/</span>restartActor<span class="token punctuation">]</span> <span class="token keyword">null</span>
meet <span class="token class-name">NullPointerException</span><span class="token punctuation">,</span>restart
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
postStop hashcode<span class="token operator">:</span><span class="token number">12844205</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7B2C 1 \u884C\u7684 preStart \u8868\u793A RestartActor \u6B63\u5728\u521D\u59CB\u5316\uFF0C\u6CE8\u610F\u5B83\u7684 HashCode \u4E3A 7302437\u3002\u63A5\u7740\uFF0C\u8FD9\u4E2A Actor \u9047\u5230\u4E86 NullPointerException\u3002\u6839\u636E\u81EA\u5B9A\u4E49\u7684\u7B56\u7565\uFF0C\u8FD9\u5C06\u5BFC\u81F4\u5B83\u91CD\u542F\uFF0C\u56E0\u6B64\uFF0C\u8FD9\u5C31\u6709\u4E86\u7B2C 3 \u884C\u7684 preRestart\uFF0C\u56E0\u4E3A preRestart \u5728\u6B63\u5F0F\u91CD\u542F\u4E4B\u524D\u8C03\u7528\uFF0C\u56E0\u6B64 HashCode \u8FD8\u662F 7302437\uFF0C\u8868\u793A\u5F53\u524D Actor \u548C\u4E0A\u4E00\u4E2A Actor \u8FD8\u662F\u540C\u4E00\u4E2A\u5B9E\u4F8B\u3002\u63A5\u7740\uFF0C\u7B2C 4 ~ 19 \u884C\u6253\u5370\u4E86\u5F02\u5E38\u4FE1\u606F\u3002</p><p>\u7B2C 20 \u884C\u8FDB\u5165\u4E86 preStart() \u65B9\u6CD5\uFF0C\u5B83\u7684 HashCode \u4E3A 23269863\u3002\u8FD9\u8BF4\u660E\u7CFB\u7EDF\u5DF2\u7ECF\u4E3A RestartActor \u751F\u6210\u4E86\u4E00\u4E2A\u65B0\u7684\u5B9E\u4F8B\uFF0C\u539F\u6709\u7684\u5B9E\u4F8B\u56E0\u4E3A\u91CD\u542F\u800C\u88AB\u56DE\u6536\u3002\u65B0\u7684\u5B9E\u4F8B\u5C06\u4EE3\u66FF\u539F\u6709\u5B9E\u4F8B\u7EE7\u7EED\u5DE5\u4F5C\u3002\u8FD9\u8BF4\u660E\u540C\u4E00\u4E2A RestartActor \u5728\u7CFB\u7EDF\u7684\u5DE5\u4F5C\u59CB\u7EC8\uFF0C\u672A\u5FC5\u80FD\u4FDD\u6301\u540C\u4E00\u4E2A\u5B9E\u4F8B\u3002\u91CD\u542F\u5B8C\u6210\u540E\uFF0C\u8C03\u7528 postRestart() \u65B9\u6CD5\uFF08\u7B2C 21 \u884C\uFF09\u3002\u5B9E\u9645\u4E0A\uFF0CActor \u91CD\u542F\u540E\u7684 preStart() \u65B9\u6CD5\uFF0C\u5C31\u662F\u5728 postRestart() \u65B9\u6CD5\u4E2D\u8C03\u7528\u7684\uFF08Actor \u7236\u7C7B\u7684 postRestart() \u65B9\u6CD5\u4F1A\u8C03\u7528 preStart() \u65B9\u6CD5\uFF09\u3002</p><p>\u7ECF\u8FC7 3 \u6B21\u91CD\u542F\u540E\uFF0C\u8D85\u8FC7\u4E86\u76D1\u7763\u7B56\u7565\u4E2D\u7684\u5355\u4F4D\u65F6\u95F4\u5185\u7684\u91CD\u8BD5\u4E0A\u9650\uFF0C\u56E0\u6B64\u7CFB\u7EDF\u4E0D\u4F1A\u518D\u8FDB\u884C\u5C1D\u8BD5\uFF0C\u800C\u662F\u76F4\u63A5\u5173\u95ED RestartActor\u3002\u4E0A\u8FF0\u8F93\u51FA\u4E2D\u7B2C 33 \u884C\u5C31\u663E\u793A\u4E86\u8FD9\u4E2A\u8FC7\u7A0B\uFF0C\u5728\u6700\u540E\u4E00\u4E2A RestartActor \u5B9E\u4F8B\u4E0A\uFF0C\u6267\u884C\u4E86\u505C\u6B62\u65B9\u6CD5\u3002</p><h2 id="_7-6-\u9009\u62E9-actor" tabindex="-1"><a class="header-anchor" href="#_7-6-\u9009\u62E9-actor" aria-hidden="true">#</a> 7.6 \u9009\u62E9 Actor</h2><p>\u5728\u4E00\u4E2A ActorSystem \u4E2D\uFF0C\u53EF\u80FD\u5B58\u5728\u5927\u91CF\u7684 Actor\u3002\u5982\u4F55\u624D\u80FD\u6709\u6548\u5730\u5BF9\u5927\u91CF Actor \u8FDB\u884C\u6279\u91CF\u7684\u7BA1\u7406\u548C\u901A\u4FE1\u5462\uFF1FAkka \u4E3A\u6211\u4EEC\u63D0\u4F9B\u4E86\u4E00\u4E2A ActorSelection \u7C7B\uFF0C\u7528\u6765\u8FDB\u884C\u6279\u91CF\u6D88\u606F\u53D1\u9001\u3002\u7531\u4E8E\u7BC7\u5E45\u6709\u9650\uFF0C\u8FD9\u91CC\u4E0D\u518D\u7ED9\u51FA\u5B8C\u6574\u7684\u4EE3\u7801\uFF0C\u793A\u610F\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> WORDER_COUNT<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    workers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>system<span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">MyWork</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;work_&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">ActorSelection</span> selection <span class="token operator">=</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">actorSelection</span><span class="token punctuation">(</span><span class="token string">&quot;/user/worker_*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
selection<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u7B2C 1 ~ 3 \u884C\u6279\u91CF\u751F\u6210\u4E86\u5927\u91CF Actor\u3002\u63A5\u7740\uFF0C\u6211\u4EEC\u8981\u7ED9\u8FD9\u4E9B worker \u53D1\u9001\u6D88\u606F\uFF0C\u901A\u8FC7 actorSelection() \u65B9\u6CD5\u63D0\u4F9B\u7684\u9009\u62E9\u901A\u914D\u7B26\uFF08\u7B2C 5 \u884C\uFF09\uFF0C\u53EF\u4EE5\u5F97\u5230\u4EE3\u8868\u6240\u6709\u6EE1\u8DB3\u6761\u4EF6\u7684 ActorSelection\u3002\u7B2C 6 \u884C\uFF0C\u901A\u8FC7 ActorSelection \u5B9E\u4F8B\uFF0C\u4FBF\u53EF\u4EE5\u5411\u6240\u6709 woker Actor \u53D1\u9001\u6D88\u606F\u4E86\u3002</p><h2 id="_7-7-\u6D88\u606F\u6536\u4EF6\u7BB1-inbox" tabindex="-1"><a class="header-anchor" href="#_7-7-\u6D88\u606F\u6536\u4EF6\u7BB1-inbox" aria-hidden="true">#</a> 7.7 \u6D88\u606F\u6536\u4EF6\u7BB1\uFF08Inbox\uFF09</h2><p>\u6211\u4EEC\u5DF2\u7ECF\u77E5\u9053\uFF0C\u6240\u6709 Actor \u4E4B\u95F4\u7684\u901A\u4FE1\u90FD\u662F\u901A\u8FC7\u6D88\u606F\u6765\u8FDB\u884C\u7684\u3002\u8FD9\u662F\u5426\u610F\u5473\u7740\u6211\u4EEC\u5FC5\u987B\u6784\u5EFA\u4E00\u4E2A Actor \u6765\u63A7\u5236\u6574\u4E2A\u7CFB\u7EDF\u5462\uFF1F\u7B54\u6848\u662F\u5426\u5B9A\u7684\uFF0C\u6211\u4EEC\u5E76\u4E0D\u4E00\u5B9A\u8981\u8FD9\u4E48\u505A\uFF0CAkka \u6846\u67B6\u5DF2\u7ECF\u4E3A\u6211\u4EEC\u51C6\u5907\u4E86\u4E00\u4E2A\u540D\u53EB \u201C\u6536\u4EF6\u7BB1\u201D \u7684\u7EC4\u4EF6\uFF0C\u4F7F\u7528\u5B83\u53EF\u4EE5\u5F88\u65B9\u4FBF\u5730\u5BF9 Actor \u8FDB\u884C\u6D88\u606F\u53D1\u9001\u548C\u63A5\u6536\uFF0C\u5927\u5927\u65B9\u4FBF\u4E86\u5E94\u7528\u7A0B\u5E8F\u4E0E Actor \u4E4B\u95F4\u7684\u4EA4\u4E92\u3002</p><p>\u4E0B\u9762\u5B9A\u4E49\u4E86\u5F53\u524D\u793A\u4F8B\u4E2D\u552F\u4E00\u4E00\u4E2A Actor\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyWorker</span> <span class="token keyword">extends</span> <span class="token class-name">UntypedActor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">LoggingAdapter</span> log <span class="token operator">=</span> <span class="token class-name">Logging</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">enum</span> <span class="token class-name">Msg</span> <span class="token punctuation">{</span>
        WORKING<span class="token punctuation">,</span> DONE<span class="token punctuation">,</span> CLOSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token class-name">Msg</span><span class="token punctuation">.</span>WORKING<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;I am working&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token class-name">Msg</span><span class="token punctuation">.</span>DONE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Stop working&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token class-name">Msg</span><span class="token punctuation">.</span>CLOSE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;I will shutdown&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">getSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">Msg</span><span class="token punctuation">.</span>CLOSE<span class="token punctuation">,</span> <span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> 
            <span class="token function">unhandled</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u4E2D\uFF0CMyWorker \u4F1A\u6839\u636E\u6536\u5230\u7684\u6D88\u606F\u6253\u5370\u81EA\u5DF1\u7684\u5DE5\u4F5C\u72B6\u6001\u3002\u5F53\u63A5\u6536\u5230 CLOSE \u6D88\u606F\u65F6\uFF08\u7B2C 14 \u884C\uFF09\uFF0C\u4F1A\u5173\u95ED\u81EA\u5DF1\uFF0C\u7ED3\u675F\u8FD0\u884C\u3002</p><p>\u800C\u5728\u672C\u4F8B\u4E2D\uFF0C\u4E0E\u8FD9\u4E2A MyWorker Actor \u4EA4\u4E92\u7684\uFF0C\u5E76\u4E0D\u662F\u4E00\u4E2A Actor\uFF0C\u800C\u662F\u4E00\u4E2A\u90AE\u7BB1\uFF0C\u90AE\u7BB1\u7684\u4F7F\u7528\u5F88\u7B80\u5355\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ActorSystem</span> system <span class="token operator">=</span> <span class="token class-name">ActorSystem</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;inboxdemo&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ConfigFactory</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;samplehello.conf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ActorRef</span> worker <span class="token operator">=</span> system<span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">MyWorker</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;worker&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">final</span> <span class="token class-name">Inbox</span> inbox <span class="token operator">=</span> <span class="token class-name">Inbox</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token punctuation">;</span>
    inbox<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>worker<span class="token punctuation">)</span><span class="token punctuation">;</span>
    inbox<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>worker<span class="token punctuation">,</span> <span class="token class-name">MyWorker<span class="token punctuation">.</span>Msg</span><span class="token punctuation">.</span>WORKING<span class="token punctuation">)</span><span class="token punctuation">;</span>
    inbox<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>worker<span class="token punctuation">,</span> <span class="token class-name">MyWorker<span class="token punctuation">.</span>Msg</span><span class="token punctuation">.</span>DONE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    inbox<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>worker<span class="token punctuation">,</span> <span class="token class-name">MyWorker<span class="token punctuation">.</span>Msg</span><span class="token punctuation">.</span>CLOSE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> msg <span class="token operator">=</span> inbox<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token class-name">MyWorker<span class="token punctuation">.</span>Msg</span><span class="token punctuation">.</span>CLOSE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;My worker is Closing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span>  <span class="token class-name">Terminated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;My worker is dead&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            system<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u7B2C 5 \u884C\u6839\u636E ActorSystem \u6784\u9020\u4E00\u4E2A\u4E0E\u4E4B\u7ED1\u5B9A\u7684\u90AE\u7BB1 Inbox\u3002\u63A5\u7740\u4F7F\u7528\u90AE\u7BB1\u76D1\u89C6 MyWorker\uFF08\u7B2C 6 \u884C\uFF09\uFF0C\u8FD9\u6837\u5C31\u80FD\u5728 MyWorker \u505C\u6B62\u540E\u5F97\u5230\u4E00\u4E2A\u6D88\u606F\u901A\u77E5\u3002\u7B2C 7 ~ 9 \u884C\u901A\u8FC7\u90AE\u7BB1\u5411 MyWorker \u53D1\u9001\u6D88\u606F\u3002</p><p>\u5728\u7B2C 11 ~ 21 \u884C\u8FDB\u884C\u6D88\u606F\u63A5\u6536\uFF0C\u5982\u679C\u53D1\u73B0 MyWorker \u5DF2\u7ECF\u505C\u6B62\u5DE5\u4F5C\uFF0C\u5219\u5173\u95ED\u6574\u4E2A ActorSystem\uFF08\u7B2C 17 \u884C\uFF09\u3002</p><p>\u6267\u884C\u4E0A\u8FF0\u4EE3\u7801\uFF0C\u8F93\u51FA\u5982\u4E0B\uFF08\u4E3A\u8282\u7701\u7248\u9762\uFF0C\u6211\u5BF9\u8F93\u51FA\u8FDB\u884C\u4E86\u4E00\u4E9B\u7B80\u5355\u7684\u5220\u51CF\uFF09\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>inboxdemo<span class="token operator">-</span>akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token operator">-</span>dispatcher<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>inboxdemo<span class="token operator">/</span>user<span class="token operator">/</span>worker<span class="token punctuation">]</span> <span class="token class-name">I</span> am working
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>inboxdemo<span class="token operator">-</span>akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token operator">-</span>dispatcher<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>inboxdemo<span class="token operator">/</span>user<span class="token operator">/</span>worker<span class="token punctuation">]</span> <span class="token class-name">Stop</span> working
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>inboxdemo<span class="token operator">-</span>akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token operator">-</span>dispatcher<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>inboxdemo<span class="token operator">/</span>user<span class="token operator">/</span>worker<span class="token punctuation">]</span> <span class="token class-name">I</span> will shutdown
<span class="token class-name">My</span> worker is <span class="token class-name">Closing</span>
<span class="token class-name">My</span> worker is dead
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u8F93\u51FA\u7684\u524D 3 \u884C\u4E3A MyWorker \u7684\u8F93\u51FA\u65E5\u5FD7\uFF0C\u8868\u793A MyWorker Actor \u7684\u5DE5\u4F5C\u72B6\u6001\u3002\u540E\u4E24\u884C\u4E3A\u4E3B\u51FD\u6570 main() \u4E2D\u5BF9 MyWorker \u6D88\u606F\u7684\u5904\u7406\u3002</p><h2 id="_7-8-\u6D88\u606F\u8DEF\u7531" tabindex="-1"><a class="header-anchor" href="#_7-8-\u6D88\u606F\u8DEF\u7531" aria-hidden="true">#</a> 7.8 \u6D88\u606F\u8DEF\u7531</h2><p>Akka \u63D0\u4F9B\u4E86\u975E\u5E38\u7075\u6D3B\u7684\u6D88\u606F\u53D1\u9001\u673A\u5236\u3002\u6709\u65F6\u5019\uFF0C\u6211\u4EEC\u4E5F\u8BB8\u4F1A\u4F7F\u7528\u4E00\u7EC4 Actor \u800C\u4E0D\u662F\u4E00\u4E2A Actor \u6765\u63D0\u4F9B\u4E00\u9879\u670D\u52A1\u3002\u8FD9\u4E00\u7EC4 Actor \u4E2D\u6240\u6709\u7684 Actor \u90FD\u662F\u5BF9\u7B49\u7684\uFF0C\u4E5F\u5C31\u662F\u8BF4\u4F60\u53EF\u4EE5\u627E\u4EFB\u4F55\u4E00\u4E2A Actor \u6765\u4E3A\u4F60\u670D\u52A1\u3002\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0C\u5982\u4F55\u624D\u80FD\u5FEB\u901F\u6709\u6548\u5730\u627E\u5230\u5408\u9002\u7684 Actor \u5462\uFF1F\u6216\u8005\u8BF4\u5982\u4F55\u8C03\u5EA6\u8FD9\u4E9B\u6D88\u606F\uFF0C\u624D\u53EF\u4EE5\u4F7F\u8D1F\u8F7D\u66F4\u4E3A\u5747\u8861\u5730\u5206\u914D\u5728\u8FD9\u4E00\u7EC4 Actor \u4E2D\u3002</p><p>\u4E3A\u4E86\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\uFF0CAkka \u4F7F\u7528\u4E00\u4E2A\u8DEF\u7531\u5668\u7EC4\u4EF6\uFF08Router\uFF09\u6765\u5C01\u88C5\u6D88\u606F\u7684\u8C03\u5EA6\u3002\u7CFB\u7EDF\u63D0\u4F9B\u4E86\u51E0\u79CD\u5B9E\u7528\u7684\u6D88\u606F\u8DEF\u7531\u7B56\u7565\uFF0C\u6BD4\u5982\uFF0C\u8F6E\u8BE2\u9009\u62E9 Actor \u8FDB\u884C\u6D88\u606F\u53D1\u9001\uFF0C\u968F\u673A\u6D88\u606F\u53D1\u9001\uFF0C\u5C06\u6D88\u606F\u53D1\u9001\u7ED9\u6700\u4E3A\u7A7A\u95F2\u7684 Actor\uFF0C\u751A\u81F3\u662F\u5728\u7EC4\u5185\u5E7F\u64AD\u6D88\u606F\u3002</p><p>\u4E0B\u9762\u5C31\u6765\u6F14\u793A\u4E00\u4E0B\u6D88\u606F\u8DEF\u7531\u7684\u4F7F\u7528\u65B9\u5F0F\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WatchActor</span> <span class="token keyword">extends</span> <span class="token class-name">UntypedActor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">LoggingAdapter</span> log <span class="token operator">=</span> <span class="token class-name">Logging</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Router</span> router<span class="token punctuation">;</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Routee</span><span class="token punctuation">&gt;</span></span> routees <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Routee</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ActorRef</span> worker <span class="token operator">=</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">MyWorker</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;worker_&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>worker<span class="token punctuation">)</span><span class="token punctuation">;</span>
            routees<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ActorRefRoutee</span><span class="token punctuation">(</span>worker<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RandomRoutingLogic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> routees<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">MyWorker<span class="token punctuation">.</span>Msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token function">getSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">Terminated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            router <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">removeRoutee</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Terminated</span><span class="token punctuation">)</span> msg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">actor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Terminated</span><span class="token punctuation">)</span> msg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">actor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; is closed,routees=&quot;</span> <span class="token operator">+</span> router<span class="token punctuation">.</span><span class="token function">routees</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routees</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Close system&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">RouteMain</span><span class="token punctuation">.</span>flag<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">unhandled</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u4E2D\u5B9A\u4E49\u4E86 WatchActor\u3002\u7B2C 3 \u884C\u662F\u8DEF\u7531\u5668\u7EC4\u4EF6 Router\uFF0C\u5728\u6784\u9020 Router \u65F6\uFF0C\u9700\u8981\u6307\u5B9A\u8DEF\u7531\u7B56\u7565\u548C\u4E00\u7EC4\u88AB\u8DEF\u7531\u7684 Actor\uFF08Routee\uFF09\uFF0C\u5982\u7B2C 11 \u884C\u6240\u793A\u3002\u8FD9\u91CC\u4F7F\u7528\u4E86 RoundRobinRoutingLogic \u8DEF\u7531\u7B56\u7565\uFF0C\u4E5F\u5C31\u662F\u5BF9\u6240\u6709\u7684 Routee \u8FDB\u884C\u8F6E\u8BE2\u6D88\u606F\u53D1\u9001\u3002\u5728\u672C\u4F8B\u4E2D\uFF0CRoutee \u7531 5 \u4E2A MyWorker Actor \u6784\u6210\uFF08\u7B2C 6 ~ 10 \u884C\uFF0CMyWorker \u4E0E\u4E0A\u4E00\u8282\u4E2D\u7684\u76F8\u540C\uFF0C\u6545\u6B64\u5904\u4E0D\u518D\u7ED9\u51FA\u4EE3\u7801\uFF09\u3002</p><p>\u5F53\u6709\u6D88\u606F\u9700\u8981\u4F20\u9012\u7ED9\u8FD9 5 \u4E2A MyWorker \u65F6\uFF0C\u53EA\u9700\u8981\u5C06\u6D88\u606F\u6295\u9012\u7ED9\u8FD9\u4E2A Router \u5373\u53EF\uFF08\u4E0A\u8FF0\u4EE3\u7801\u7B2C 17 \u884C\uFF09\u3002Router \u5C31\u4F1A\u6839\u636E\u7ED9\u5B9A\u7684\u6D88\u606F\u8DEF\u7531\u7B56\u7565\u8FDB\u884C\u6D88\u606F\u6295\u9012\u3002\u5F53\u4E00\u4E2A MyWorker \u505C\u6B62\u5DE5\u4F5C\u65F6\uFF0C\u8FD8\u53EF\u4EE5\u7B80\u5355\u5730\u5C06\u5176\u4ECE\u5DE5\u4F5C\u7EC4\u4E2D\u79FB\u9664\uFF08\u7B2C 19 \u884C\uFF09\u3002\u5728\u8FD9\u91CC\uFF0C\u5982\u679C\u53D1\u73B0\u7CFB\u7EDF\u4E2D\u6CA1\u6709\u53EF\u7528\u7684 Actor\uFF0C\u5C31\u4F1A\u76F4\u63A5\u5173\u95ED\u7CFB\u7EDF\u3002</p><p>\u4E3B\u51FD\u6570\u6BD4\u8F83\u7B80\u5355\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RouteMain</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Agent</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> flag <span class="token operator">=</span> <span class="token class-name">Agent</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionContexts</span><span class="token punctuation">.</span><span class="token function">global</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ActorSystem</span> system <span class="token operator">=</span> <span class="token class-name">ActorSystem</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;route&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ConfigFactory</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;samplehello.conf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ActorRef</span> w <span class="token operator">=</span> system<span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">WatchActor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;watcher&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>flag<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">MyWorker<span class="token punctuation">.</span>Msg</span><span class="token punctuation">.</span>WORKING<span class="token punctuation">,</span> <span class="token class-name">ActorRef</span><span class="token punctuation">.</span><span class="token function">noSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> w<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">MyWorker<span class="token punctuation">.</span>Msg</span><span class="token punctuation">.</span>CLOSE<span class="token punctuation">,</span> <span class="token class-name">ActorRef</span><span class="token punctuation">.</span><span class="token function">noSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            i<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u5411 WatchActor \u53D1\u9001\u5927\u91CF\u6D88\u606F\uFF0C\u5176\u4E2D\u5939\u6742\u7740\u51E0\u6761\u5173\u95ED Actor \u7684\u6D88\u606F\u3002\u8FD9\u4F1A\u4F7F\u5F97 MyWorker Actor \u9010\u4E00\u88AB\u5173\u95ED\uFF0C\u6700\u7EC8\u7A0B\u5E8F\u5C06\u9000\u51FA\u3002</p><p>\u8FD9\u6BB5\u7A0B\u5E8F\u7684\u90E8\u5206\u8F93\u51FA\u5982\u4E0B\uFF08\u505A\u8FC7\u9002\u91CF\u88C1\u526A\uFF09\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>route<span class="token operator">-</span>akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token operator">-</span>dispatcher<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>route<span class="token operator">/</span>user<span class="token operator">/</span>watcher<span class="token operator">/</span>worker_0<span class="token punctuation">]</span> <span class="token class-name">I</span> am working
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>route<span class="token operator">-</span>akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token operator">-</span>dispatcher<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>route<span class="token operator">/</span>user<span class="token operator">/</span>watcher<span class="token operator">/</span>worker_1<span class="token punctuation">]</span> <span class="token class-name">I</span> am working
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>route<span class="token operator">-</span>akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token operator">-</span>dispatcher<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>route<span class="token operator">/</span>user<span class="token operator">/</span>watcher<span class="token operator">/</span>worker_2<span class="token punctuation">]</span> <span class="token class-name">I</span> am working
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>route<span class="token operator">-</span>akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token operator">-</span>dispatcher<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>route<span class="token operator">/</span>user<span class="token operator">/</span>watcher<span class="token operator">/</span>worker_3<span class="token punctuation">]</span> <span class="token class-name">I</span> am working
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>route<span class="token operator">-</span>akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token operator">-</span>dispatcher<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>route<span class="token operator">/</span>user<span class="token operator">/</span>watcher<span class="token operator">/</span>worker_4<span class="token punctuation">]</span> <span class="token class-name">I</span> am working
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>route<span class="token operator">-</span>akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token operator">-</span>dispatcher<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>route<span class="token operator">/</span>user<span class="token operator">/</span>watcher<span class="token operator">/</span>worker_0<span class="token punctuation">]</span> <span class="token class-name">I</span> am working
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>route<span class="token operator">-</span>akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token operator">-</span>dispatcher<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>route<span class="token operator">/</span>user<span class="token operator">/</span>watcher<span class="token operator">/</span>worker_0<span class="token punctuation">]</span> <span class="token class-name">I</span> will shutdown
akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>route<span class="token operator">/</span>user<span class="token operator">/</span>watcher<span class="token operator">/</span>worker_1 is closed<span class="token punctuation">,</span>routees<span class="token operator">=</span><span class="token number">0</span>
<span class="token class-name">Close</span> system
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0CWORKING \u6D88\u606F\u88AB\u8F6E\u6D41\u53D1\u9001\u7ED9\u8FD9 5 \u4E2A worker\u3002\u5927\u5BB6\u53EF\u4EE5\u4FEE\u6539\u8DEF\u7531\u7B56\u7565\uFF0C\u89C2\u5BDF\u4E0D\u540C\u8DEF\u7531\u7B56\u7565\u4E0B\u7684\u6D88\u606F\u6295\u9012\u65B9\u5F0F\uFF08\u9664\u4E86 RoundRobinRoutingLogic\uFF0C\u8FD8\u53EF\u4EE5\u5C1D\u8BD5 BroadcastRoutingLogic \u5E7F\u64AD\u7B56\u7565\u3001RandomRoutingLogic \u968F\u673A\u6295\u9012\u7B56\u7565\u3001SmallestMailboxRoutingLogic \u7A7A\u95F2 Actor \u4F18\u5148\u6295\u9012\u7B56\u7565\uFF09\u3002</p><h2 id="_7-9-actor-\u7684\u5185\u7F6E\u72B6\u6001\u8F6C\u6362" tabindex="-1"><a class="header-anchor" href="#_7-9-actor-\u7684\u5185\u7F6E\u72B6\u6001\u8F6C\u6362" aria-hidden="true">#</a> 7.9 Actor \u7684\u5185\u7F6E\u72B6\u6001\u8F6C\u6362</h2><p>\u5728\u5F88\u591A\u573A\u666F\u4E0B\uFF0CActor \u7684\u4E1A\u52A1\u903B\u8F91\u53EF\u80FD\u6BD4\u8F83\u590D\u6742\uFF0CActor \u53EF\u80FD\u9700\u8981\u6839\u636E\u4E0D\u540C\u7684\u72B6\u6001\u5BF9\u540C\u4E00\u6761\u6D88\u606F\u505A\u51FA\u4E0D\u540C\u7684\u5904\u7406\u3002Akka \u5DF2\u7ECF\u4E3A\u6211\u4EEC\u8003\u8651\u5230\u4E86\u8FD9\u4E00\u70B9\uFF0C\u4E00\u4E2A Actor \u5185\u90E8\u6D88\u606F\u5904\u7406\u51FD\u6570\u53EF\u4EE5\u62E5\u6709\u591A\u4E2A\u4E0D\u540C\u7684\u72B6\u6001\uFF0C\u5728\u7279\u5B9A\u7684\u72B6\u6001\u4E0B\uFF0C\u53EF\u4EE5\u5BF9\u540C\u4E00\u6D88\u606F\u8FDB\u884C\u4E0D\u540C\u7684\u5904\u7406\uFF0C\u72B6\u6001\u4E4B\u95F4\u4E5F\u53EF\u4EE5\u4EFB\u610F\u5207\u6362\u3002</p><p>\u73B0\u5728\u8BA9\u6211\u4EEC\u6A21\u62DF\u4E00\u4E2A\u5A74\u513F Actor\uFF0C\u5047\u8BBE\u5A74\u513F\u62E5\u6709\u5F00\u5FC3\u6216\u8005\u751F\u6C14\u4E24\u79CD\u4E0D\u540C\u7684\u72B6\u6001\u3002\u5F53\u4F60\u5E26\u4ED6\u73A9\u7684\u65F6\u5019\uFF0C\u4ED6\u603B\u662F\u4F1A\u8868\u73B0\u51FA\u5F00\u5FC3\u72B6\u6001\uFF1B\u5F53\u4F60\u8BA9\u4ED6\u7761\u89C9\u65F6\uFF0C\u4ED6\u5C31\u4F1A\u975E\u5E38\u751F\u6C14\uFF0C\u5C0F\u5B69\u5B50\u603B\u662F\u62E5\u6709\u7528\u4E0D\u5B8C\u7684\u7CBE\u529B\uFF0C\u5165\u7761\u56F0\u96BE\u53EF\u80FD\u662F\u4E00\u79CD\u901A\u75C5\u5427\uFF01</p><p>\u5728\u8FD9\u4E2A\u7B80\u5355\u7684\u573A\u666F\u6A21\u62DF\u4E2D\uFF0C\u6211\u4EEC\u4F1A\u7ED9\u5A74\u513F Actor \u53D1\u9001\u7761\u89C9\u548C\u73A9\u4E24\u79CD\u6307\u4EE4\u3002\u5982\u679C\u5A74\u513F\u6B63\u5728\u751F\u6C14\uFF0C\u4F60\u8FD8\u8BA9\u4ED6\u7761\u89C9\uFF0C\u4ED6\u5C31\u4F1A\u8BF4\uFF1A\u201C\u6211\u5DF2\u7ECF\u751F\u6C14\u4E86\u201D\uFF0C\u5982\u679C\u4F60\u8BA9\u4ED6\u53BB\u73A9\uFF0C\u4ED6\u5C31\u4F1A\u53D8\u5F97\u5F00\u5FC3\u3002\u540C\u6837\uFF0C\u5982\u679C\u4ED6\u6B63\u73A9\u5F97\u9AD8\u5174\uFF0C\u4F60\u8BA9\u4ED6\u7EE7\u7EED\u73A9\uFF0C\u4ED6\u5C31\u4F1A\u8BF4\uFF1A\u201C\u6211\u5F88\u6109\u5FEB\u201D\uFF0C\u5982\u679C\u8BA9\u4ED6\u7761\u89C9\uFF0C\u4ED6\u5C31\u4F1A\u53D8\u5F97\u5F88\u751F\u6C14\u3002</p><p>\u4E0B\u9762\u7684\u8FD9\u4E2A BabyActor \u5C31\u6A21\u62DF\u4E86\u4E0A\u8FF0\u573A\u666F\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BabyActor</span> <span class="token keyword">extends</span> <span class="token class-name">UntypedActor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">LoggingAdapter</span> log <span class="token operator">=</span> <span class="token class-name">Logging</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">enum</span> <span class="token class-name">Msg</span> <span class="token punctuation">{</span>
        SLEEP<span class="token punctuation">,</span> PLAY<span class="token punctuation">,</span> CLOSE
    <span class="token punctuation">}</span>

    <span class="token class-name">Procedure</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> angry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Procedure</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">Object</span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;angryApply:&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">==</span> <span class="token class-name">Msg</span><span class="token punctuation">.</span>SLEEP<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">getSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token string">&quot;I am already angry&quot;</span><span class="token punctuation">,</span> <span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;I am already angry&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">==</span> <span class="token class-name">Msg</span><span class="token punctuation">.</span>PLAY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;I like playing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">become</span><span class="token punctuation">(</span>happy<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token class-name">Procedure</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> happy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Procedure</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">Object</span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;happyApply:&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">==</span> <span class="token class-name">Msg</span><span class="token punctuation">.</span>PLAY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">getSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token string">&quot;I am already happy :-)&quot;</span><span class="token punctuation">,</span> <span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;I am already happy :-)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">==</span> <span class="token class-name">Msg</span><span class="token punctuation">.</span>SLEEP<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;I don&#39;t want to sleep&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">become</span><span class="token punctuation">(</span>angry<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;onReceive:&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token class-name">Msg</span><span class="token punctuation">.</span>SLEEP<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">become</span><span class="token punctuation">(</span>angry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token class-name">Msg</span><span class="token punctuation">.</span>PLAY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">become</span><span class="token punctuation">(</span>happy<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">unhandled</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u4F7F\u7528 become() \u65B9\u6CD5\u5207\u6362 Actor \u7684\u72B6\u6001\uFF08\u7B2C 39\u300141 \u884C\uFF09\uFF0C\u65B9\u6CD5 become() \u63A5\u6536\u4E00\u4E2A Procedure \u53C2\u6570\u3002Procedure \u5728\u8FD9\u91CC\u53EF\u4EE5\u8868\u793A\u4E00\u79CD Actor \u7684\u72B6\u6001\uFF0C\u66F4\u91CD\u8981\u7684\u662F\u5B83\u5C01\u88C5\u4E86\u5728\u8FD9\u79CD\u72B6\u6001\u4E0B\u7684\u6D88\u606F\u5904\u7406\u903B\u8F91\u3002</p><p>\u5728\u8FD9\u4E2A BabyActor \u4E2D\u5B9A\u4E49\u4E86\u4E24\u4E2A Procedure\uFF0C\u4E00\u4E2A\u662F angry\uFF08\u7B2C 7 \u884C\uFF09\uFF0C\u53E6\u4E00\u4E2A\u662F happy\uFF08\u7B2C 21 \u884C\uFF09\u3002</p><p>\u5728\u521D\u59CB\u72B6\u6001\u4E0B\uFF0CBabyActor \u65E2\u4E0D\u662F\u751F\u6C14\u72B6\u6001\u4E5F\u4E0D\u662F\u5F00\u5FC3\u72B6\u6001\u3002\u56E0\u6B64 angry \u5904\u7406\u51FD\u6570\u548C happy \u5904\u7406\u51FD\u6570\u90FD\u4E0D\u4F1A\u5DE5\u4F5C\u3002\u5F53 BabyActor \u63A5\u6536\u5230\u6D88\u606F\u65F6\uFF0C\u7CFB\u7EDF\u4F1A\u8C03\u7528 onReceive() \u65B9\u6CD5\u6765\u5904\u7406\u8FD9\u4E2A\u6D88\u606F\u3002</p><p>\u5F53 onReceive() \u51FD\u6570\u5904\u7406 SLEEP \u6D88\u606F\u65F6\uFF0C\u5B83\u4F1A\u5207\u6362\u5F53\u524D Actor \u7684\u72B6\u6001\u4E3A angry\uFF08\u7B2C 39 \u884C\uFF09\u3002\u5982\u679C\u662F PLAY \u6D88\u606F\uFF0C\u5219\u5207\u6362\u72B6\u6001\u4E3A happy\u3002</p><p>\u4E00\u65E6\u5B8C\u6210\u72B6\u6001\u5207\u6362\uFF0C\u5F53\u540E\u7EED\u6709\u65B0\u7684\u6D88\u606F\u9001\u8FBE\u65F6\uFF0C\u5C31\u4E0D\u4F1A\u518D\u7531 onReceive() \u51FD\u6570\u5904\u7406\u4E86\u3002\u7531\u4E8E angry \u548C happy \u672C\u8EAB\u5C31\u662F\u6D88\u606F\u5904\u7406\u51FD\u6570\uFF0C\u56E0\u6B64\u540E\u7EED\u7684\u6D88\u606F\u5C31\u76F4\u63A5\u4EA4\u7531\u5F53\u524D\u72B6\u6001\u5904\u7406\uFF08angry \u6216\u8005 happy\uFF09\uFF0C\u4ECE\u800C\u5F88\u597D\u5730\u5C01\u88C5\u4E86 Actor \u7684\u591A\u4E2A\u4E0D\u540C\u5904\u7406\u903B\u8F91\u3002</p><p>\u4E0B\u9762\u7684\u4EE3\u7801\u5411\u5A74\u513F Actor \u53D1\u9001\u4E86\u51E0\u6761 PLAY \u548C SLEEP \u7684\u6D88\u606F\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ActorSystem</span> system <span class="token operator">=</span> <span class="token class-name">ActorSystem</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;become&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ConfigFactory</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;samplehello.conf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ActorRef</span> child <span class="token operator">=</span> system<span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">BabyActor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;baby&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
system<span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">WatchActor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> child<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;watcher&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
child<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">BabyActor<span class="token punctuation">.</span>Msg</span><span class="token punctuation">.</span>PLAY<span class="token punctuation">,</span> <span class="token class-name">ActorRef</span><span class="token punctuation">.</span><span class="token function">noSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
child<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">BabyActor<span class="token punctuation">.</span>Msg</span><span class="token punctuation">.</span>SLEEP<span class="token punctuation">,</span> <span class="token class-name">ActorRef</span><span class="token punctuation">.</span><span class="token function">noSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
child<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">BabyActor<span class="token punctuation">.</span>Msg</span><span class="token punctuation">.</span>PLAY<span class="token punctuation">,</span> <span class="token class-name">ActorRef</span><span class="token punctuation">.</span><span class="token function">noSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
child<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">BabyActor<span class="token punctuation">.</span>Msg</span><span class="token punctuation">.</span>PLAY<span class="token punctuation">,</span> <span class="token class-name">ActorRef</span><span class="token punctuation">.</span><span class="token function">noSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

child<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">PoisonPill</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ActorRef</span><span class="token punctuation">.</span><span class="token function">noSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5176\u8F93\u51FA\u5982\u4E0B\uFF08\u8FDB\u884C\u8FC7\u9002\u91CF\u88C1\u526A\uFF09\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>onReceive<span class="token operator">:</span>PLAY
happyApply<span class="token operator">:</span>SLEEP
<span class="token class-name">I</span> don&#39;t want <span class="token keyword">to</span> <span class="token namespace">sleep</span>
angryApply<span class="token operator">:</span>PLAY
<span class="token class-name">I</span> like playing
happyApply<span class="token operator">:</span>PLAY
<span class="token class-name">I</span> am already happy <span class="token operator">:</span><span class="token operator">-</span><span class="token punctuation">)</span>
akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>become<span class="token operator">/</span>user<span class="token operator">/</span>baby has terminated<span class="token punctuation">,</span> shutting down system
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>become<span class="token operator">/</span>watcher<span class="token punctuation">]</span> akka<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>become<span class="token operator">/</span>user<span class="token operator">/</span>baby has terminated<span class="token punctuation">,</span> shutting down system
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u5F53\u7B2C\u4E00\u4E2A PLAY \u6D88\u606F\u5230\u6765\u65F6\uFF0C\u662F\u7531 onReceive() \u51FD\u6570\u8FDB\u884C\u5904\u7406\u7684\uFF0C\u5728 onReceive() \u51FD\u6570\u4E2D\uFF0C\u5C06 Actor \u5207\u6362\u4E3A happy \u72B6\u6001\u3002\u56E0\u6B64\uFF0C\u5F53 SLEEP \u6D88\u606F\u8FBE\u5230\u65F6\uFF0C\u7531 happy.apply() \u51FD\u6570\u5904\u7406\uFF0C\u63A5\u7740 Actor \u5207\u6362\u4E3A angry \u72B6\u6001\u3002\u5F53 PLAY \u6D88\u606F\u518D\u6B21\u5230\u8FBE\u65F6\uFF0C\u7531 angry.apply() \u51FD\u6570\u5904\u7406\u3002\u7531\u6B64\u53EF\u89C1\uFF0CAkka \u4E3A Actor \u63D0\u4F9B\u4E86\u7075\u6D3B\u7684\u72B6\u6001\u5207\u6362\u673A\u5236\uFF0C\u5904\u4E8E\u4E0D\u540C\u72B6\u6001\u7684 Actor \u53EF\u4EE5\u7ED1\u5B9A\u4E0D\u540C\u7684\u6D88\u606F\u5904\u7406\u51FD\u6570\u8FDB\u884C\u6D88\u606F\u5904\u7406\uFF0C\u8FD9\u5BF9\u6784\u9020\u7ED3\u6784\u5316\u5E94\u7528\u6709\u7740\u91CD\u8981\u7684\u5E2E\u52A9\u3002</p><h2 id="_7-10-\u8BE2\u95EE\u6A21\u5F0F-actor-\u4E2D\u7684-future" tabindex="-1"><a class="header-anchor" href="#_7-10-\u8BE2\u95EE\u6A21\u5F0F-actor-\u4E2D\u7684-future" aria-hidden="true">#</a> 7.10 \u8BE2\u95EE\u6A21\u5F0F\uFF1AActor \u4E2D\u7684 Future</h2><p>\u7531\u4E8E Actor \u4E4B\u95F4\u90FD\u662F\u901A\u8FC7\u5F02\u6B65\u6D88\u606F\u901A\u4FE1\u7684\u3002\u5F53\u4F60\u53D1\u9001\u4E00\u6761\u6D88\u606F\u7ED9\u4E00\u4E2A Actor \u540E\uFF0C\u4F60\u901A\u5E38\u53EA\u80FD\u7B49\u5F85 Actor \u7684\u8FD4\u56DE\u3002\u4E0E\u540C\u6B65\u65B9\u6CD5\u4E0D\u540C\uFF0C\u5728\u4F60\u53D1\u9001\u5F02\u6B65\u6D88\u606F\u540E\uFF0C\u63A5\u53D7\u6D88\u606F\u7684 Actor \u53EF\u80FD\u6839\u672C\u6765\u4E0D\u53CA\u5904\u7406\u4F60\u7684\u6D88\u606F\uFF0C\u8C03\u7528\u65B9\u5C31\u5DF2\u7ECF\u8FD4\u56DE\u4E86\u3002</p><p>\u8FD9\u79CD\u6A21\u5F0F\u4E0E\u6211\u4EEC\u4E4B\u524D\u63D0\u5230\u7684 Future \u6A21\u5F0F\u975E\u5E38\u76F8\u50CF\u3002\u4E0D\u540C\u4E4B\u5904\u53EA\u662F\u5728\u4F20\u7EDF\u7684\u5F02\u6B65\u8C03\u7528\u4E2D\uFF0C\u6211\u4EEC\u8FDB\u884C\u7684\u662F\u51FD\u6570\u8C03\u7528\uFF0C\u4F46\u5728\u8FD9\u91CC\uFF0C\u6211\u4EEC\u53D1\u9001\u4E86\u4E00\u6761\u6D88\u606F\u3002</p><p>\u7531\u4E8E\u4E24\u8005\u7684\u884C\u4E3A\u65B9\u5F0F\u5982\u6B64\u76F8\u50CF\uFF0C\u56E0\u6B64\u6211\u4EEC\u5C31\u4F1A\u5F88\u81EA\u7136\u5730\u60F3\u5230\uFF0C\u5F53\u6211\u4EEC\u9700\u8981\u4E00\u4E2A\u6709\u8FD4\u56DE\u503C\u7684\u8C03\u7528\u65F6\uFF0CActor \u662F\u4E0D\u662F\u4E5F\u5E94\u8BE5\u7ED9\u6211\u4EEC\u4E00\u4E2A\u5951\u7EA6\uFF08Future\uFF09\u5462\uFF1F\u8FD9\u6837\uFF0C\u5C31\u7B97\u6211\u4EEC\u5F53\u4E0B\u6CA1\u6709\u529E\u6CD5\u7ACB\u5373\u83B7\u5F97 Actor \u7684\u5904\u7406\u7ED3\u679C\uFF0C\u5728\u5C06\u6765\uFF0C\u901A\u8FC7\u8FD9\u4E2A\u5951\u7EA6\u8FD8\u662F\u53EF\u4EE5\u8FFD\u8E2A\u5230\u6211\u4EEC\u7684\u8BF7\u6C42\u7684\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">akka<span class="token punctuation">.</span>pattern<span class="token punctuation">.</span></span><span class="token class-name">Patterns</span><span class="token punctuation">.</span><span class="token static">ask</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">akka<span class="token punctuation">.</span>pattern<span class="token punctuation">.</span></span><span class="token class-name">Patterns</span><span class="token punctuation">.</span><span class="token static">pipe</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AskMain</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">ActorSystem</span> system <span class="token operator">=</span> <span class="token class-name">ActorSystem</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;askdemo&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ConfigFactory</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;samplehello.conf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ActorRef</span> worker <span class="token operator">=</span> system<span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">MyWorker</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;worker&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ActorRef</span> printer <span class="token operator">=</span> system<span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Pinter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;printer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        system<span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">WatchActor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> worker<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;watcher&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u7B49\u5F85 Future \u8FD4\u56DE</span>
        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> f <span class="token operator">=</span> <span class="token function">ask</span><span class="token punctuation">(</span>worker<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> re <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token class-name">Await</span><span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;return:&quot;</span> <span class="token operator">+</span> re<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u76F4\u63A5\u5BFC\u5411\u5176\u4ED6 Actor\uFF0Cpipe \u4E0D\u4F1A\u7B49\u5F85</span>
        f <span class="token operator">=</span> <span class="token function">ask</span><span class="token punctuation">(</span>worker<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">pipe</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> system<span class="token punctuation">.</span><span class="token function">dispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>printer<span class="token punctuation">)</span><span class="token punctuation">;</span>

        worker<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">PoisonPill</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ActorRef</span><span class="token punctuation">.</span><span class="token function">noSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u7ED9\u51FA\u4E86\u4E24\u5904\u5728 Actor \u4EA4\u4E92\u4E2D\u4F7F\u7528 Future \u7684\u4F8B\u5B50\u3002</p><p>\u7B2C 13 \u884C\u4F7F\u7528 ask() \u65B9\u6CD5\u7ED9 worker \u53D1\u9001\u6D88\u606F\uFF0C\u6D88\u606F\u5185\u5BB9\u662F 5\uFF0C\u4E5F\u5C31\u8BF4 worker \u4F1A\u63A5\u6536\u5230\u4E00\u4E2A Integer \u6D88\u606F\uFF0C\u503C\u4E3A 5\u3002\u5F53 worker \u63A5\u6536\u5230\u6D88\u606F\u540E\uFF0C\u5C31\u53EF\u4EE5\u8FDB\u884C\u8BA1\u7B97\u5904\u7406\uFF0C\u5E76\u4E14\u5C06\u7ED3\u679C\u8FD4\u56DE\u7ED9\u53D1\u9001\u8005\u3002\u5F53\u7136\uFF0C\u8FD9\u4E2A\u5904\u7406\u8FC7\u7A0B\u53EF\u80FD\u9700\u8981\u82B1\u8D39\u4E00\u70B9\u65F6\u95F4\u3002</p><p>ask() \u65B9\u6CD5\u4E0D\u4F1A\u7B49\u5F85 worker \u5904\u7406\uFF0C\u4F1A\u7ACB\u5373\u8FD4\u56DE\u4E00\u4E2A Future \u5BF9\u8C61\uFF08\u7B2C 13 \u884C\uFF09\u3002\u5728\u7B2C 14 \u884C\uFF0C\u6211\u4EEC\u4F7F\u7528 Await \u65B9\u6CD5\u7B49\u5F85 worker \u7684\u8FD4\u56DE\uFF0C\u5728\u7B2C 15 \u884C\u6253\u5370\u8FD4\u56DE\u7ED3\u679C\u3002</p><p>\u5728\u8FD9\u79CD\u65B9\u6CD5\u4E2D\uFF0C\u6211\u4EEC\u95F4\u63A5\u5730\u5C06\u4E00\u4E2A\u5F02\u6B65\u8C03\u7528\u8F6C\u4E3A\u540C\u6B65\u963B\u585E\u8C03\u7528\u3002\u867D\u7136\u6BD4\u8F83\u5BB9\u6613\u7406\u89E3\uFF0C\u4F46\u662F\u5728\u6709\u4E9B\u573A\u5408\u53EF\u80FD\u4F1A\u51FA\u73B0\u6027\u80FD\u95EE\u9898\u3002\u53E6\u5916\u4E00\u79CD\u66F4\u4E3A\u6709\u6548\u7684\u65B9\u6CD5\u662F\u4F7F\u7528 pipe() \u51FD\u6570\u3002</p><p>\u4EE3\u7801\u7B2C 18 \u884C\u4F7F\u7528 ask() \u65B9\u6CD5\u518D\u6B21\u8BE2\u95EE worker\uFF0C\u5E76\u4F20\u9012\u6570\u503C 6 \u7ED9 worker\u3002\u63A5\u7740\u5E76\u4E0D\u8FDB\u884C\u7B49\u5F85\uFF0C\u800C\u662F\u4F7F\u7528 pipe() \u51FD\u6570\u5C06\u8FD9\u4E2A Future \u91CD\u5B9A\u5411\u5230\u53E6\u5916\u4E00\u4E2A\u540D\u4E3A printer \u7684 Actor \u4E0A\u3002pipe() \u51FD\u6570\u4E0D\u4F1A\u963B\u585E\u7A0B\u5E8F\uFF0C\u5B83\u4F1A\u7ACB\u5373\u8FD4\u56DE\u3002</p><p>\u8FD9\u4E2A printer \u7684\u5B9E\u73B0\u53EA\u662F\u7B80\u5355\u5730\u8F93\u51FA\u5F97\u5230\u7684\u6570\u636E\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">Integer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Printer:&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token class-name">Msg</span><span class="token punctuation">.</span>DONE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Stop working&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token class-name">Msg</span><span class="token punctuation">.</span>CLOSE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;I will shutdown&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">getSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">Msg</span><span class="token punctuation">.</span>CLOSE<span class="token punctuation">,</span> <span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> 
        <span class="token function">unhandled</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u5C31\u662F Printer Actor \u7684\u5B9E\u73B0\uFF0C\u5B83\u4F1A\u901A\u8FC7 pipe() \u65B9\u6CD5\u5F97\u5230 worker \u7684\u8F93\u51FA\u7ED3\u679C\uFF0C\u5E76\u6253\u5370\u5728\u63A7\u5236\u53F0\u4E0A\uFF08\u7B2C 4 \u884C\uFF09\u3002</p><p>\u5728\u672C\u4F8B\u4E2D\uFF0Cworker Actor \u63A5\u6536\u4E00\u4E2A\u6574\u6570\uFF0C\u8BA1\u7B97\u5B83\u7684\u5E73\u65B9\u5E76\u7ED9\u4E88\u8FD4\u56DE\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">Integer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
        <span class="token function">getSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span> i <span class="token operator">*</span> i<span class="token punctuation">,</span> <span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token class-name">Msg</span><span class="token punctuation">.</span>DONE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Stop working&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token class-name">Msg</span><span class="token punctuation">.</span>CLOSE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;I will shutdown&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">getSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token class-name">Msg</span><span class="token punctuation">.</span>CLOSE<span class="token punctuation">,</span> <span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span>
        <span class="token function">unhandled</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u7B2C 5 ~ 7 \u884C\u6A21\u62DF\u4E86\u4E00\u4E2A\u8017\u65F6\u7684\u8C03\u7528\uFF0C\u4E3A\u4E86\u66F4\u660E\u663E\u5730\u8BF4\u660E ask() \u548C pipe() \u65B9\u6CD5\u7684\u7528\u9014\u3002\u7B2C 8 \u884C worker \u8BA1\u7B97\u4E86\u7ED9\u5B9A\u6570\u503C\u7684\u5E73\u65B9\uFF0C\u5E76\u628A\u5B83 \u201C\u544A\u8BC9\u201D \u8BF7\u6C42\u8005\u3002</p><h2 id="_7-11-\u591A\u4E2A-actor-\u540C\u65F6\u4FEE\u6539\u6570\u636E-agent" tabindex="-1"><a class="header-anchor" href="#_7-11-\u591A\u4E2A-actor-\u540C\u65F6\u4FEE\u6539\u6570\u636E-agent" aria-hidden="true">#</a> 7.11 \u591A\u4E2A Actor \u540C\u65F6\u4FEE\u6539\u6570\u636E\uFF1AAgent</h2><p>\u5728 Actor \u7684\u7F16\u7A0B\u6A21\u578B\u4E2D\uFF0CActor \u4E4B\u95F4\u4E3B\u8981\u901A\u8FC7\u6D88\u606F\u8FDB\u884C\u4FE1\u606F\u4F20\u9012\u3002\u56E0\u6B64\uFF0C\u5F88\u5C11\u53D1\u751F\u591A\u4E2A Actor \u9700\u8981\u8BBF\u95EE\u540C\u4E00\u4E2A\u5171\u4EAB\u53D8\u91CF\u7684\u60C5\u51B5\u3002\u4F46\u5728\u5B9E\u9645\u5F00\u53D1\u4E2D\uFF0C\u8FD9\u79CD\u60C5\u51B5\u5F88\u96BE\u5B8C\u5168\u907F\u514D\u3002\u5982\u679C\u591A\u4E2A Actor \u9700\u8981\u5BF9\u540C\u4E00\u4E2A\u5171\u4EAB\u53D8\u91CF\u8FDB\u884C\u8BFB\u5199\u65F6\uFF0C\u5982\u4F55\u4FDD\u8BC1\u7EBF\u7A0B\u5B89\u5168\u5462\uFF1F</p><p>\u5728 Akka \u4E2D\uFF0C\u4F7F\u7528\u4E00\u79CD\u53EB\u4F5C Agent \u7684\u7EC4\u4EF6\u6765\u5B9E\u73B0\u8FD9\u4E2A\u529F\u80FD\u3002\u4E00\u4E2A Agent \u63D0\u4F9B\u4E86\u5BF9\u4E00\u4E2A\u53D8\u91CF\u7684\u5F02\u6B65\u66F4\u65B0\u3002\u5F53\u4E00\u4E2A Actor \u5E0C\u671B\u6539\u53D8 Agent \u7684\u503C\u65F6\uFF0C\u5B83\u4F1A\u5411 Agent \u4E0B\u53D1\u4E00\u4E2A\u52A8\u4F5C\uFF08action\uFF09\u3002\u5F53\u591A\u4E2A Actor \u540C\u65F6\u6539\u53D8 Agent \u65F6\uFF0C\u8FD9\u4E9B action \u5C06\u4F1A\u5728 ExecutionContext \u4E2D\u88AB\u5E76\u53D1\u8C03\u5EA6\u6267\u884C\u3002\u5728\u4EFB\u610F\u65F6\u523B\uFF0C\u4E00\u4E2A Agent \u6700\u591A\u53EA\u80FD\u6267\u884C\u4E00\u4E2A action\uFF0C\u5BF9\u4E8E\u67D0\u4E00\u4E2A\u7EBF\u7A0B\u6765\u8BF4\uFF0C\u5B83\u6267\u884C action \u7684\u987A\u5E8F\u4E0E\u5B83\u7684\u53D1\u751F\u987A\u5E8F\u4E00\u81F4\uFF0C\u4F46\u5BF9\u4E8E\u4E0D\u540C\u7EBF\u7A0B\u6765\u8BF4\uFF0C\u8FD9\u4E9B action \u53EF\u80FD\u4F1A\u4EA4\u7EC7\u5728\u4E00\u8D77\u3002</p><p>Agent \u7684\u4FEE\u6539\u53EF\u4EE5\u4F7F\u7528\u4E24\u79CD\u65B9\u6CD5\uFF1Asend() \u548C alter()\u3002\u5B83\u4EEC\u90FD\u53EF\u4EE5\u5411 Agent \u53D1\u9001\u4E00\u4E2A\u4FEE\u6539\u52A8\u4F5C\u3002\u4F46\u662F send() \u65B9\u6CD5\u6CA1\u6709\u8FD4\u56DE\u503C\uFF0C\u800C alter() \u65B9\u6CD5\u4F1A\u8FD4\u56DE\u4E00\u4E2A Future \u5BF9\u8C61\uFF0C\u4FBF\u4E8E\u8DDF\u8E2A Agent \u7684\u6267\u884C\u3002</p><p>\u4E0B\u9762\u8BA9\u6211\u4EEC\u6A21\u62DF\u8FD9\u4E48\u4E00\u4E2A\u573A\u666F\uFF1A\u6709 10 \u4E2A Actor\uFF0C\u5B83\u4EEC\u4E00\u8D77\u5BF9\u4E00\u4E2A Agent \u6267\u884C\u7D2F\u52A0\u64CD\u4F5C\uFF0C\u6BCF\u4E2A Agent \u7D2F\u52A0 10000 \u6B21\uFF0C\u5982\u679C\u6CA1\u6709\u610F\u5916\uFF0C\u90A3\u4E48 Agent \u6700\u7EC8\u7684\u503C\u5C06\u662F 100000\uFF1B\u5982\u679C Actor \u95F4\u7684\u8C03\u5EA6\u51FA\u73B0\u95EE\u9898\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u503C\u53EF\u80FD\u5C0F\u4E8E 100000\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CounterActor</span> <span class="token keyword">extends</span> <span class="token class-name">UntypedActor</span> <span class="token punctuation">{</span>
    <span class="token class-name">Mapper</span> addMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">Integer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u6211\u5E0C\u671B\u80FD\u591F\u77E5\u9053 Future \u4F55\u65F6\u7ED3\u675F</span>
                <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> f <span class="token operator">=</span> <span class="token class-name">AgentDemo</span><span class="token punctuation">.</span>counterAgent<span class="token punctuation">.</span><span class="token function">alter</span><span class="token punctuation">(</span>addMapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">AgentDemo</span><span class="token punctuation">.</span>futures<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span>
            <span class="token function">unhandled</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u5B9A\u4E49\u4E86\u4E00\u4E2A\u7D2F\u52A0\u7684 Actor\uFF1ACounterActor\u3002\u7B2C 2 ~ 7 \u884C\u5B9A\u4E49\u4E86\u7D2F\u8BA1\u52A8\u4F5C action addMapper\u3002\u5B83\u7684\u4F5C\u7528\u662F\u5BF9 Agent \u7684\u503C\u8FDB\u884C\u4FEE\u6539\uFF0C\u8FD9\u91CC\u7B80\u5355\u5730\u52A0 1\u3002</p><p>\u5728 CounterActor \u7684\u6D88\u606F\u5904\u7406\u51FD\u6570 onReceive() \u4E2D\uFF0C\u5BF9\u5168\u5C40\u7684 counterAgent \u8FDB\u884C\u7D2F\u52A0\u64CD\u4F5C\uFF0Calter() \u65B9\u6CD5\u6307\u5B9A\u4E86\u7D2F\u52A0\u52A8\u4F5C addMapper\uFF08\u7B2C 14 \u884C\uFF09\u3002\u7531\u4E8E\u6211\u4EEC\u5E0C\u671B\u5728\u5C06\u6765\u77E5\u9053\u7D2F\u52A0\u884C\u4E3A\u662F\u5426\u5B8C\u6210\uFF0C\u56E0\u6B64\u5728\u8FD9\u91CC\u5C06\u8FD4\u56DE\u7684 Future \u5BF9\u8C61\u8FDB\u884C\u6536\u96C6\uFF08\u7B2C 15 \u884C\uFF09\u3002\u5B8C\u6210\u4EFB\u52A1\u540E\uFF0CActor \u4F1A\u81EA\u884C\u9000\u51FA\uFF08\u7B2C 17 \u884C\uFF09\u3002</p><p>\u7A0B\u5E8F\u7684\u4E3B\u51FD\u6570\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AgentDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Agent</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> counterAgent <span class="token operator">=</span> <span class="token class-name">Agent</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionContexts</span><span class="token punctuation">.</span><span class="token function">global</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">ConcurrentLinkedQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> futures <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentLinkedQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ActorSystem</span> system <span class="token operator">=</span> <span class="token class-name">ActorSystem</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;agentdemo&quot;</span><span class="token punctuation">,</span>
                                                <span class="token class-name">ConfigFactory</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;samplehello.conf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ActorRef</span><span class="token punctuation">[</span><span class="token punctuation">]</span> counter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActorRef</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> counter<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            counter<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> system<span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">CounterActor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;counter_&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">final</span> <span class="token class-name">Inbox</span> inbox <span class="token operator">=</span> <span class="token class-name">Inbox</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> counter<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            inbox<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>counter<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            inbox<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>counter<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">int</span> closeCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token comment">// \u7B49\u5F85\u6240\u6709 Actor \u5168\u90E8\u7ED3\u675F</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Object</span> msg <span class="token operator">=</span> inbox<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">Terminated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                closeCount<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>closeCount <span class="token operator">==</span> counter<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// \u7B49\u5F85\u6240\u6709\u7684\u7D2F\u52A0\u7EBF\u7A0B\u5B8C\u6210\uFF0C\u56E0\u4E3A\u5B83\u4EEC\u90FD\u662F\u5F02\u6B65\u7684</span>
        <span class="token class-name">Futures</span><span class="token punctuation">.</span><span class="token function">sequence</span><span class="token punctuation">(</span>futures<span class="token punctuation">,</span> system<span class="token punctuation">.</span><span class="token function">dispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onComplete</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">OnComplete</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Iterable</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> failure<span class="token punctuation">,</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> success<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;counterAgent=&quot;</span> <span class="token operator">+</span> counterAgent<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    system<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> system<span class="token punctuation">.</span><span class="token function">dispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u4E0A\u8FF0\u4EE3\u7801\u4E2D\uFF0C\u7B2C 8 ~ 11 \u884C\u521B\u5EFA\u4E86 10 \u4E2A CounterActor \u5BF9\u8C61\u3002\u7B2C 12 ~ 16 \u884C\u4F7F\u7528 Inbox \u4E0E CounterActor \u8FDB\u884C\u901A\u4FE1\u3002\u7B2C 14 \u884C\u7684\u6D88\u606F\u5C06\u89E6\u53D1 CounterActor \u8FDB\u884C\u7D2F\u52A0\u64CD\u4F5C\u3002\u7B2C 20 ~ 30 \u884C\u7CFB\u7EDF\u5C06\u7B49\u5F85 10 \u4E2A CounterActor \u8FD0\u884C\u7ED3\u675F\u3002\u6267\u884C\u5B8C\u6210\u540E\uFF0C\u6211\u4EEC\u4FBF\u5DF2\u7ECF\u6536\u96C6\u4E86\u6240\u6709\u7684 Future\u3002\u5728\u7B2C 32 \u884C\uFF0C\u5C06\u6240\u6709\u7684 Future \u8FDB\u884C\u4E32\u884C\u7EC4\u5408\uFF08\u4F7F\u7528 sequence() \u65B9\u6CD5\uFF09\uFF0C\u6784\u9020\u4E86\u4E00\u4E2A\u6574\u4F53\u7684 Future\uFF0C\u5E76\u4E3A\u5B83\u521B\u5EFA onComplete() \u56DE\u8C03\u51FD\u6570\u3002\u5728\u6240\u6709\u7684 Agent \u64CD\u4F5C\u6267\u884C\u5B8C\u6210\u540E\uFF0ConComplete() \u65B9\u6CD5\u5C31\u4F1A\u88AB\u8C03\u7528\uFF08\u7B2C 35 \u884C\uFF09\u3002\u5728\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\uFF0C\u6211\u4EEC\u7B80\u5355\u5730\u8F93\u51FA\u6700\u7EC8\u7684 counterAgent \u503C\uFF08\u7B2C 36 \u884C\uFF09\uFF0C\u5E76\u5173\u95ED\u7CFB\u7EDF\uFF08\u7B2C 37 \u884C\uFF09\u3002</p><p>\u6267\u884C\u4E0A\u8FF0\u7A0B\u5E8F\uFF0C\u6211\u4EEC\u5C06\u770B\u5230\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>counterAgent<span class="token operator">=</span><span class="token number">100000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_7-12-\u50CF\u6570\u636E\u5E93\u4E00\u6837\u64CD\u4F5C\u5185\u5B58\u6570\u636E-\u8F6F\u4EF6\u4E8B\u52A1\u5185\u5B58" tabindex="-1"><a class="header-anchor" href="#_7-12-\u50CF\u6570\u636E\u5E93\u4E00\u6837\u64CD\u4F5C\u5185\u5B58\u6570\u636E-\u8F6F\u4EF6\u4E8B\u52A1\u5185\u5B58" aria-hidden="true">#</a> 7.12 \u50CF\u6570\u636E\u5E93\u4E00\u6837\u64CD\u4F5C\u5185\u5B58\u6570\u636E\uFF1A\u8F6F\u4EF6\u4E8B\u52A1\u5185\u5B58</h2><p>\u5728\u4E00\u4E9B\u51FD\u6570\u5F0F\u7F16\u7A0B\u8BED\u8A00\u4E2D\uFF0C\u652F\u6301\u4E00\u79CD\u53EB\u4F5C\u8F6F\u4EF6\u4E8B\u52A1\u5185\u5B58\uFF08STM\uFF09\u7684\u6280\u672F\u3002\u4EC0\u4E48\u662F\u8F6F\u4EF6\u4E8B\u52A1\u5185\u5B58\u5462\uFF1F\u8FD9\u91CC\u7684\u4E8B\u52A1\u548C\u6570\u636E\u5E93\u4E2D\u6240\u8BF4\u7684\u4E8B\u52A1\u975E\u5E38\u7C7B\u4F3C\uFF0C\u5177\u6709\u9694\u79BB\u6027\u3001\u539F\u5B50\u6027\u548C\u4E00\u81F4\u6027\u3002\u4E0E\u6570\u636E\u5E93\u4E8B\u52A1\u4E0D\u540C\u7684\u662F\uFF0C\u5185\u5B58\u4E8B\u52A1\u4E0D\u5177\u5907\u6301\u4E45\u6027\uFF08\u5F88\u663E\u7136\u5185\u5B58\u6570\u636E\u4E0D\u4F1A\u4FDD\u5B58\u4E0B\u6765\uFF09\u3002</p><p>\u5728\u5F88\u591A\u573A\u5408\uFF0C\u67D0\u4E00\u9879\u5DE5\u4F5C\u53EF\u80FD\u8981\u7531\u591A\u4E2A Actor \u534F\u4F5C\u5B8C\u6210\u3002\u5728\u8FD9\u79CD\u534F\u4F5C\u4E8B\u52A1\u4E2D\uFF0C\u5982\u679C\u4E00\u4E2A Actor \u5904\u7406\u5931\u8D25\uFF0C\u90A3\u4E48\u6839\u636E\u4E8B\u52A1\u7684\u539F\u5B50\u6027\uFF0C\u5176\u4ED6 Actor \u6240\u8FDB\u884C\u7684\u64CD\u4F5C\u5FC5\u987B\u8981\u56DE\u6EDA\u3002\u4E0B\u9762\u5C31\u8BA9\u6211\u4EEC\u6765\u770B\u4E00\u4E2A\u7B80\u5355\u7684\u6848\u4F8B\u3002</p><p>\u5047\u8BBE\u6709\u4E00\u4E2A\u516C\u53F8\u8981\u7ED9\u5458\u5DE5\u53D1\u653E\u798F\u5229\uFF0C\u516C\u53F8\u8D26\u6237\u91CC\u6709 100 \u5143\u3002\u6BCF\u6B21\u516C\u53F8\u8D26\u6237\u4F1A\u7ED9\u5458\u5DE5\u8D26\u6237\u8F6C\u4E00\u7B14\u94B1\uFF0C\u5047\u8BBE\u8F6C\u8D26 10 \u5143\uFF0C\u90A3\u4E48\u516C\u53F8\u8D26\u6237\u4E2D\u5E94\u8BE5\u51CF\u53BB 10 \u5143\uFF0C\u540C\u65F6\uFF0C\u5458\u5DE5\u8D26\u6237\u4E2D\u5E94\u8BE5\u589E\u52A0 10 \u5143\u3002\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u5FC5\u987B\u540C\u65F6\u5B8C\u6210\uFF0C\u6216\u8005\u540C\u65F6\u4E0D\u5B8C\u6210\u3002</p><p>\u9996\u5148\uFF0C\u8BA9\u6211\u4EEC\u770B\u4E00\u4E0B\u4E3B\u51FD\u6570\u4E2D\u662F\u5982\u4F55\u542F\u52A8\u4E00\u4E2A\u5185\u5B58\u4E8B\u52A1\u7684\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">STMDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ActorRef</span> company <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ActorRef</span> employee <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">ActorSystem</span> system <span class="token operator">=</span> <span class="token class-name">ActorSystem</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;transactionDemo&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ConfigFactory</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;samplehello.conf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        company <span class="token operator">=</span> system<span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">CompanyActor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;company&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        employee <span class="token operator">=</span> system<span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">EmployeeActor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;employee&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Timeout</span> timeout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timeout</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            company<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Coordinated</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ActorRef</span><span class="token punctuation">.</span><span class="token function">noSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Integer</span> companyCount <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> <span class="token class-name">Await</span><span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span>
                    <span class="token function">ask</span><span class="token punctuation">(</span>company<span class="token punctuation">,</span> <span class="token string">&quot;GetCount&quot;</span><span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">,</span> timeout<span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Integer</span> employeeCount <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> <span class="token class-name">Await</span><span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span>
                    <span class="token function">ask</span><span class="token punctuation">(</span>employee<span class="token punctuation">,</span> <span class="token string">&quot;GetCount&quot;</span><span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">,</span> timeout<span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;company count=&quot;</span> <span class="token operator">+</span> companyCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;employee count=&quot;</span> <span class="token operator">+</span> employeeCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u4E2D CompanyActor \u548C EmployeeActor \u5206\u522B\u7528\u4E8E\u7BA1\u7406\u516C\u53F8\u8D26\u6237\u548C\u96C7\u5458\u8D26\u6237\u3002\u5728\u7B2C 12 ~ 23 \u884C\u4E2D\uFF0C\u6211\u4EEC\u5C1D\u8BD5\u8FDB\u884C\u4E86 19 \u6B21\u6C47\u6B3E\uFF0C\u7B2C\u4E00\u6B21\u6C47\u6B3E\u989D\u5EA6\u4E3A 0 \u5143\uFF0C\u7B2C\u4E8C\u6B21\u4E3A 2 \u5143\uFF0C\u4F9D\u6B64\u7C7B\u63A8\uFF0C\u6700\u540E\u4E00\u7B14\u6C47\u6B3E\u4E3A 19 \u5143\u3002</p><p>\u5728\u7B2C 13 \u884C\u65B0\u5EFA\u4E00\u4E2A Coordinated \u534F\u8C03\u8005\uFF0C\u5E76\u4E14\u5C06\u8FD9\u4E2A\u534F\u8C03\u8005\u5F53\u4F5C\u6D88\u606F\u53D1\u9001\u7ED9 company\u3002\u5F53 company \u6536\u5230\u8FD9\u4E2A\u534F\u8C03\u8005\u6D88\u606F\u540E\uFF0C\u81EA\u52A8\u6210\u4E3A\u8FD9\u4E2A\u4E8B\u52A1\u7684\u7B2C\u4E00\u4E2A\u6210\u5458\u3002</p><p>\u7B2C 15 ~ 18 \u884C\u8BE2\u95EE\u516C\u53F8\u8D26\u6237\u548C\u96C7\u5458\u8D26\u6237\u7684\u5F53\u524D\u4F59\u989D\uFF0C\u5E76\u5728\u7B2C 20 ~ 21 \u884C\u8FDB\u884C\u8F93\u51FA\u3002</p><p>\u4E0B\u9762\u662F\u4EE3\u8868\u516C\u53F8\u8D26\u6237\u7684 Actor\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompanyActor</span> <span class="token keyword">extends</span> <span class="token class-name">UntypedActor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Ref<span class="token punctuation">.</span>View</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> count <span class="token operator">=</span> STM<span class="token punctuation">.</span><span class="token function">newRef</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">Coordinated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token class-name">Coordinated</span> c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Coordinated</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> downCount <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> c<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">STMDemo</span><span class="token punctuation">.</span>employee<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">coordinate</span><span class="token punctuation">(</span>downCount<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                c<span class="token punctuation">.</span><span class="token function">atomic</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>count<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> downCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;less than &quot;</span> <span class="token operator">+</span> downCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        STM<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token operator">-</span>downCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;GetCount&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">getSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">unhandled</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728 CompanyActor \u4E2D\uFF0C\u9996\u5148\u5224\u65AD\u63A5\u6536\u7684 msg \u662F\u5426\u662F Coordinated\u3002\u5982\u679C\u662F Coordinated\uFF0C\u5219\u8868\u793A\u8FD9\u662F\u4E00\u4E2A\u65B0\u4E8B\u52A1\u7684\u5F00\u59CB\u3002\u5728\u7B2C 8 \u884C\u83B7\u5F97\u4E8B\u52A1\u7684\u53C2\u6570\uFF0C\u4E5F\u5C31\u662F\u9700\u8981\u8F6C\u8D26\u7684\u91D1\u989D\u3002\u63A5\u7740\u5728\u7B2C 9 \u884C\u8C03\u7528 Coordinated.coordinate() \u65B9\u6CD5\uFF0C\u5C06 employee \u52A0\u5165\u5F53\u524D\u4E8B\u52A1\u4E2D\uFF0C\u8FD9\u6837\u8FD9\u4E2A\u4E8B\u52A1\u4E2D\u5C31\u6709\u4E24\u4E2A\u53C2\u4E0E\u8005\u4E86\u3002</p><p>\u7B2C 11 \u884C\u8C03\u7528 Coordinated.atomic() \u51FD\u6570\u5B9A\u4E49\u539F\u5B50\u6267\u884C\u5757\u4F5C\u4E3A\u8FD9\u4E2A\u4E8B\u52A1\u7684\u4E00\u90E8\u5206\u3002\u5728\u8FD9\u4E2A\u6267\u884C\u5757\u4E2D\uFF0C\u5BF9\u516C\u53F8\u8D26\u6237\u8FDB\u884C\u4F59\u989D\u8C03\u6574\uFF08\u7B2C 17 \u884C\uFF09\uFF0C\u4F46\u662F\u5F53\u6C47\u6B3E\u989D\u5EA6\u5927\u4E8E\u53EF\u7528\u4F59\u989D\u65F6\uFF0C\u5C31\u4F1A\u629B\u51FA\u5F02\u5E38\uFF0C\u5BA3\u544A\u5931\u8D25\u3002</p><p>\u7B2C 25 \u884C\u7528\u4E8E\u5904\u7406 GetCount \u6D88\u606F\uFF0C\u8FD4\u56DE\u5F53\u524D\u8D26\u6237\u4F59\u989D\u3002</p><p>\u4F5C\u4E3A\u8F6C\u8D26\u63A5\u6536\u65B9\u7684\u96C7\u5458\u8D26\u6237\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmployeeActor</span> <span class="token keyword">extends</span> <span class="token class-name">UntypedActor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Ref<span class="token punctuation">.</span>View</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> count <span class="token operator">=</span> STM<span class="token punctuation">.</span><span class="token function">newRef</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">Coordinated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token class-name">Coordinated</span> c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Coordinated</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> downCount <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> c<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                c<span class="token punctuation">.</span><span class="token function">atomic</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        STM<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> downCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;GetCount&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">getSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">unhandled</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u7B2C 2 \u884C\u8BBE\u7F6E\u96C7\u5458\u8D26\u6237\u521D\u59CB\u91D1\u989D\u662F 50 \u5143\u3002\u7B2C 6 \u884C\u5224\u65AD\u6D88\u606F\u662F\u5426\u4E3A Coordinated\uFF0C\u5982\u679C\u662F\uFF0C\u5219\u5F53\u524D Actor \u4F1A\u81EA\u52A8\u52A0\u5165 Coordinated \u6307\u5B9A\u7684\u4E8B\u52A1\u3002\u7B2C 10 \u884C\u5B9A\u4E49\u539F\u5B50\u64CD\u4F5C\uFF0C\u5728\u8FD9\u4E2A\u64CD\u4F5C\u4E2D\u5C06\u4FEE\u6539\u96C7\u5458\u8D26\u6237\u4F59\u989D\u3002\u5728\u8FD9\u91CC\uFF0C\u6211\u4EEC\u5E76\u6CA1\u6709\u7ED9\u51FA\u5F02\u5E38\u60C5\u51B5\u7684\u5224\u65AD\uFF0C\u53EA\u8981\u63A5\u6536\u5230\u8F6C\u5165\u91D1\u989D\uFF0C\u4E00\u5F8B\u5C06\u5176\u589E\u52A0\u5230\u96C7\u5458\u8D26\u6237\u4E2D\u3002</p><p>\u5927\u5BB6\u53EF\u80FD\u5C31\u4F1A\u4EA7\u751F\u7591\u95EE\uFF0C\u5982\u679C\u516C\u53F8\u8D26\u6237\u7531\u4E8E\u4F59\u989D\u4E0D\u8DB3\u5BFC\u81F4\u8F6C\u8D26\u5931\u8D25\u4E86\uFF0C\u90A3\u4E48\u5728\u8FD9\u4E2A\u96C7\u5458\u8D26\u6237\u4E2D\u4E0D\u8FD8\u662F\u6B63\u5E38\u589E\u52A0\u4E86\u91D1\u989D\u5417\uFF1F\u8FD9\u6837\u5C82\u4E0D\u662F\u94B1\u591A\u51FA\u6765\u4E86\uFF1F</p><p>\u8FD9\u4E2A\u62C5\u5FC3\u5B8C\u5168\u662F\u591A\u4F59\u7684\u3002\u56E0\u4E3A\u5728\u8FD9\u91CC\uFF0C\u4E24\u4E2A Actor \u90FD\u5DF2\u7ECF\u52A0\u5165\u540C\u4E00\u4E2A\u534F\u8C03\u4E8B\u52A1 Coordinated \u4E2D\u4E86\uFF0C\u56E0\u6B64\u5F53\u516C\u53F8\u8D26\u6237\u51FA\u73B0\u5F02\u5E38\u540E\uFF0C\u96C7\u5458\u8D26\u6237\u7684\u4F59\u989D\u5C31\u4F1A\u56DE\u6EDA\u3002</p><p>\u6267\u884C\u4E0A\u8FF0\u7A0B\u5E8F\uFF0C\u90E8\u5206\u8F93\u51FA\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
company count<span class="token operator">=</span><span class="token number">85</span>
employee count<span class="token operator">=</span><span class="token number">65</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>RuntimeExcepetion</span><span class="token operator">:</span> less then <span class="token number">14</span>
company count<span class="token operator">=</span><span class="token number">9</span>
employee count<span class="token operator">=</span><span class="token number">141</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>RuntimeExcepetion</span><span class="token operator">:</span> less then <span class="token number">19</span>
    \u7701\u7565\u5806\u6808\u4FE1\u606F\uFF0C\u5B9E\u5728\u592A\u591A\u4E86
    at <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span>concurrnent<span class="token punctuation">.</span>forkjoin<span class="token punctuation">.</span></span>ForkJoinWorkerThread</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ForkJoinWorkerThread</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">107</span><span class="token punctuation">)</span>
company count<span class="token operator">=</span><span class="token number">9</span>
employee count<span class="token operator">=</span><span class="token number">141</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u65E0\u8BBA\u8F6C\u8D26\u64CD\u4F5C\u662F\u5426\u6210\u529F\uFF0C\u516C\u53F8\u8D26\u6237\u548C\u96C7\u5458\u8D26\u6237\u7684\u91D1\u989D\u603B\u662F\u4E00\u81F4\u7684\u3002\u5F53\u8F6C\u8D26\u5931\u8D25\u65F6\uFF0C\u96C7\u5458\u8D26\u6237\u7684\u4F59\u989D\u5E76\u4E0D\u4F1A\u589E\u52A0\u3002\u8FD9\u5C31\u662F\u8F6F\u4EF6\u4E8B\u52A1\u5185\u5B58\u7684\u4F5C\u7528\u3002</p><h2 id="_7-13-\u4E00\u4E2A\u6709\u8DA3\u7684\u4F8B\u5B50-\u5E76\u53D1\u7C92\u5B50\u7FA4\u7684\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_7-13-\u4E00\u4E2A\u6709\u8DA3\u7684\u4F8B\u5B50-\u5E76\u53D1\u7C92\u5B50\u7FA4\u7684\u5B9E\u73B0" aria-hidden="true">#</a> 7.13 \u4E00\u4E2A\u6709\u8DA3\u7684\u4F8B\u5B50\uFF1A\u5E76\u53D1\u7C92\u5B50\u7FA4\u7684\u5B9E\u73B0</h2><p>\u7C92\u5B50\u7FA4\u7B97\u6CD5\uFF08PSO\uFF09\u662F\u4E00\u79CD\u8FDB\u5316\u7B97\u6CD5\u3002\u5B83\u4E0E\u5927\u540D\u9F0E\u9F0E\u7684\u9057\u4F20\u7B97\u6CD5\u975E\u5E38\u7C7B\u4F3C\uFF0C\u53EF\u4EE5\u7528\u6765\u89E3\u51B3\u4E00\u4E9B\u4F18\u5316\u95EE\u9898\u3002\u5927\u5BB6\u77E5\u9053\uFF0C\u4E00\u4E9B\u4F18\u5316\u95EE\u9898\uFF08\u6BD4\u5982\u65C5\u884C\u5546\u95EE\u9898 TSP\uFF09\u90FD\u5C5E\u4E8E NP \u95EE\u9898\u3002\u5B83\u4EEC\u7684\u65F6\u95F4\u590D\u6742\u5EA6\u53EF\u80FD\u4F1A\u8FBE\u5230 O(n!) \u6216\u8005 O(2n)\uFF0C\u8FD9\u79CD\u5728\u591A\u9879\u5F0F\u65F6\u95F4\u5185\u4E0D\u53EF\u89E3\u7684\u95EE\u9898\u603B\u662F\u4F1A\u8BA9\u4EBA\u671B\u800C\u751F\u754F\u3002\u800C\u4EE5 PSO \u7B97\u6CD5\u4E3A\u4EE3\u8868\u7684\u8FDB\u5316\u8BA1\u7B97\uFF0C\u5F80\u5F80\u53EF\u4EE5\u5C06\u8FD9\u4E9B NP \u95EE\u9898\u8F6C\u53D8\u4E3A\u4E00\u4E2A\u591A\u9879\u5F0F\u95EE\u9898\u3002\u4F46\u8FD9\u79CD\u8F6C\u53D8\u662F\u6709\u4EE3\u4EF7\u7684\uFF0C\u8FDB\u5316\u7B97\u6CD5\u5F80\u5F80\u90FD\u4E0D\u4FDD\u8BC1\u4F60\u53EF\u4EE5\u4ECE\u7ED3\u679C\u4E2D\u5F97\u5230\u6700\u4F18\u89E3\u3002\u4E5F\u8BB8\u5C31\u6709\u4EBA\u4F1A\u95EE\u4E86\uFF0C\u8FD9\u4E2A\u7B97\u6CD5\u90FD\u4E0D\u80FD\u4FDD\u8BC1\u5F97\u5230\u6700\u4F18\u89E3\uFF0C\u6709\u4EC0\u4E48\u7528\u5462\uFF1F\u5176\u5B9E\uFF0C\u5728\u751F\u6D3B\u4E2D\u7684\u5F88\u591A\u573A\u666F\u4E0B\uFF0C\u5E76\u4E0D\u662F\u7279\u522B\u9700\u8981\u6700\u4F18\u89E3\uFF0C\u6211\u4EEC\u66F4\u52A0\u5E0C\u671B\u5F97\u5230\u7684\u662F\u4E00\u4E2A\u6EE1\u610F\u89E3\u3002\u6BD4\u5982\uFF0C\u53BB\u6C34\u679C\u5E97\u4E70\u897F\u74DC\uFF0C\u5E97\u91CC\u53EF\u80FD\u653E\u7740\u4E00\u5927\u5806\u897F\u74DC\uFF0C\u6BCF\u4E2A\u4EBA\u90FD\u60F3\u6311\u4E00\u4E2A\u6700\u597D\u7684\u3002\u4F46\u4F60\u60F3\u62FF\u5230\u6700\u597D\u7684\u90A3\u4E2A\u897F\u74DC\u5FC5\u987B\u5F97\u6328\u4E2A\u68C0\u67E5\u8FC7\u53BB\uFF0C\u5E76\u4E14\u8FD8\u5F97\u8BA4\u771F\u505A\u597D\u8BB0\u5F55\u624D\u884C\u3002\u6211\u76F8\u4FE1\uFF0C\u6CA1\u6709\u4E00\u4E2A\u4EBA\u4F1A\u8FD9\u4E48\u4E70\u897F\u74DC\uFF0C\u56E0\u4E3A\u6210\u672C\u592A\u9AD8\u4E86\u3002\u5BF9\u4E8E\u5927\u90E8\u5206\u4EBA\u6765\u8BF4\uFF0C\u66F4\u503E\u5411\u4E8E\u5728\u8868\u9762\u4E0A\u6311\u51E0\u4E2A\u987A\u773C\u7684\u770B\u770B\uFF0C\u5982\u679C\u8FD8\u8FC7\u5F97\u53BB\uFF0C\u4E5F\u5C31\u4E70\u4E86\u3002\u8FD9\u4E5F\u5C31\u662F\u8BF4\u53EA\u8981\u8FD9\u4E2A\u7ED3\u679C\u4E0D\u8981\u5DEE\u5F97\u592A\u79BB\u8C31\u5C31\u884C\u4E86\u3002</p><p>\u65E2\u7136\u6700\u4F18\u7684\u65B9\u6848\u5F88\u96BE\u5F97\u5230\uFF0C\u90A3\u4E48\u6211\u4EEC\u5C31\u60F3\u529E\u6CD5\u4EE5\u5F88\u4F4E\u7684\u6210\u672C\u83B7\u5F97\u4E00\u4E2A\u8FD8\u7B97\u8FC7\u5F97\u53BB\u7684\u65B9\u6848\uFF0C\u4E5F\u4E0D\u5931\u4E3A\u826F\u7B56\u3002\u5728\u540E\u9762\u7ED9\u51FA\u7684\u5C0F\u6848\u4F8B\u4E2D\u5927\u5BB6\u4E5F\u53EF\u4EE5\u770B\u5230\uFF0C\u5728\u5F88\u591A\u60C5\u51B5\u4E0B\uFF0C\u867D\u7136\u8FDB\u5316\u7B97\u6CD5\u65E0\u6CD5\u8BA9\u4F60\u83B7\u5F97\u6700\u4F18\u89E3\uFF0C\u4E5F\u65E0\u6CD5\u8BC1\u660E\u5B83\u5F97\u5230\u7684\u89E3\u4E0E\u6700\u4F18\u89E3\u5230\u5E95\u6709\u591A\u5C11\u5DEE\u8DDD\uFF0C\u4F46\u5728\u5B9E\u9645\u751F\u6D3B\u4E2D\uFF0C\u901A\u8FC7\u8FDB\u5316\u7B97\u6CD5\u641C\u7D22\u5230\u7684\u6EE1\u610F\u89E3\u5F88\u53EF\u80FD\u4E0E\u6700\u4F18\u89E3\u5DF2\u7ECF\u975E\u5E38\u63A5\u8FD1\u4E86\u3002</p><h3 id="_7-13-1-\u4EC0\u4E48\u662F\u7C92\u5B50\u7FA4\u7B97\u6CD5" tabindex="-1"><a class="header-anchor" href="#_7-13-1-\u4EC0\u4E48\u662F\u7C92\u5B50\u7FA4\u7B97\u6CD5" aria-hidden="true">#</a> 7.13.1 \u4EC0\u4E48\u662F\u7C92\u5B50\u7FA4\u7B97\u6CD5</h3><p>\u7C92\u5B50\u7FA4\u7B97\u6CD5\u662F\u4E00\u79CD\u8FDB\u5316\u8BA1\u7B97\u6280\u672F\uFF0C\u6700\u65E9\u7531 Kenny \u4E0E Eberhart \u4E8E 1995 \u5E74\u63D0\u51FA\u3002\u5B83\u6E90\u4E8E\u5BF9\u9E1F\u7FA4\u6355\u98DF\u884C\u4E3A\u7684\u7814\u7A76\uFF0C\u4E0E\u9057\u4F20\u7B97\u6CD5\u76F8\u4F3C\uFF0C\u662F\u4E00\u79CD\u57FA\u4E8E\u8FED\u4EE3\u7684\u4F18\u5316\u7B97\u6CD5\uFF0C\u5E7F\u6CDB\u5E94\u7528\u4E8E\u51FD\u6570\u4F18\u5316\u548C\u795E\u7ECF\u7F51\u7EDC\u8BAD\u7EC3\u7B49\u65B9\u9762\u3002\u4E0E\u9057\u4F20\u7B97\u6CD5\u76F8\u6BD4\uFF0CPSO \u7684\u5B9E\u73B0\u7B80\u5355\u5F97\u591A\uFF0C\u53C2\u6570\u914D\u7F6E\u4E5F\u76F8\u5BF9\u8F83\u5C11\uFF0C\u5BF9\u4F7F\u7528\u4EBA\u5458\u7684\u7ECF\u9A8C\u8981\u6C42\u4E0D\u9AD8\uFF0C\u56E0\u6B64\u66F4\u52A0\u6613\u4E8E\u5728\u5B9E\u9645\u5DE5\u7A0B\u4E2D\u5E94\u7528\u3002</p><p>\u4ECE\u5BF9\u65E5\u5E38\u751F\u6D3B\u7684\u89C2\u5BDF\u4E2D\u53EF\u4EE5\u77E5\u9053\uFF0C\u9E1F\u7C7B\u7684\u89C5\u98DF\u5F80\u5F80\u4F1A\u8868\u73B0\u51FA\u7FA4\u4F53\u7279\u6027\u3002\u5982\u679C\u5728\u5730\u4E0A\u6709\u4E00\u5806\u98DF\u7269\uFF0C\u90A3\u4E48\u9E1F\u7FA4\u5F88\u53EF\u80FD\u5C31\u4F1A\u805A\u96C6\u5728\u8FD9\u4E00\u5806\u98DF\u7269\u65C1\u8FB9\u3002\u5982\u679C\u5176\u4E2D\u4E00\u53EA\u5C0F\u9E1F\u53D1\u73B0\u4E86\u53E6\u5916\u4E00\u5806\u66F4\u4E30\u76DB\u7684\u98DF\u7269\uFF0C\u90A3\u4E48\u5B83\u53EF\u80FD\u4F1A\u79BB\u7FA4\u98DE\u5411\u66F4\u4E30\u76DB\u7684\u98DF\u7269\uFF0C\u800C\u8FD9\u6709\u53EF\u80FD\u5E26\u52A8\u6574\u4E2A\u9E1F\u7FA4\u4E00\u8D77\u98DE\u5411\u65B0\u7684\u5730\u70B9\u3002\u5F53\u7136\u4E86\uFF0C\u5728\u6574\u4E2A\u79CD\u7FA4\u4E2D\uFF0C\u96BE\u514D\u4F1A\u51FA\u73B0\u51E0\u53EA\u7279\u522B\u6709 \u201C\u4E2A\u6027\u201D \u7684\u5C0F\u9E1F\uFF0C\u5B83\u4EEC\u4E0D\u559C\u6B22\u592A\u70ED\u95F9\u7684\u5730\u65B9\uFF0C\u5F53\u6574\u4E2A\u79CD\u7FA4\u8FC1\u79FB\u65F6\uFF0C\u5B83\u4EEC\u4E0D\u4F1A\u8DDF\u7740\u79CD\u7FA4\u8D70\u3002</p><p>\u7C92\u5B50\u7FA4\u7B97\u6CD5\u6B63\u662F\u5BF9\u4E0A\u8FF0\u8FC7\u7A0B\u7684\u6A21\u62DF\u3002\u5728\u7A0B\u5E8F\u4E2D\uFF0C\u6211\u4EEC\u53EF\u4EE5\u6A21\u62DF\u5927\u91CF\u7684\u5C0F\u9E1F\uFF0C\u5C0F\u9E1F\u7684\u89C5\u98DF\u70B9\u6B63\u662F\u95EE\u9898\u7684\u89E3\u3002\u89E3\u8D8A\u4F18\u79C0\uFF0C\u610F\u5473\u7740\u98DF\u7269\u8D8A\u662F\u4E30\u76DB\uFF0C\u56E0\u6B64\uFF0C\u6A21\u62DF\u7684\u5C0F\u9E1F\u4F1A\u4ECE\u81EA\u5DF1\u7684\u4F4D\u7F6E\u51FA\u53D1\u4EE5\u4E00\u5B9A\u7684\u901F\u5EA6\u5411\u6700\u4F18\u70B9\u7684\u65B9\u5411\u79FB\u52A8\u3002\u5728\u79FB\u52A8\u8FC7\u7A0B\u4E2D\uFF0C\u4EFB\u4F55\u4E00\u53EA\u5C0F\u9E1F\u90FD\u6709\u53EF\u80FD\u53D1\u73B0\u66F4\u597D\u7684\u89E3\uFF0C\u8FD9\u53C8\u4F1A\u8FDB\u4E00\u6B65\u5F71\u54CD\u7FA4\u4F53\u7684\u884C\u4E3A\u3002\u5C31\u8FD9\u6837\u53CD\u590D\u8FED\u4EE3\uFF0C\u6700\u7EC8\u5C06\u5F97\u5230\u4E00\u4E2A\u4E0D\u9519\u7684\u7B54\u6848\u3002</p><h3 id="_7-13-2-\u7C92\u5B50\u7FA4\u7B97\u6CD5\u7684\u8BA1\u7B97\u8FC7\u7A0B" tabindex="-1"><a class="header-anchor" href="#_7-13-2-\u7C92\u5B50\u7FA4\u7B97\u6CD5\u7684\u8BA1\u7B97\u8FC7\u7A0B" aria-hidden="true">#</a> 7.13.2 \u7C92\u5B50\u7FA4\u7B97\u6CD5\u7684\u8BA1\u7B97\u8FC7\u7A0B</h3><p>\u7C92\u5B50\u7FA4\u7B97\u6CD5\u7684\u6B65\u9AA4\u5982\u4E0B\u3002</p>`,196),k=n("ol",null,[n("li",null,[n("p",null,"\u521D\u59CB\u5316\u6240\u6709\u7C92\u5B50\uFF0C\u7C92\u5B50\u7684\u4F4D\u7F6E\u968F\u673A\u751F\u6210\u3002\u8BA1\u7B97\u6BCF\u4E2A\u7C92\u5B50\u5F53\u524D\u7684\u9002\u5E94\u5EA6\uFF0C\u5E76\u5C06\u6B64\u8BBE\u4E3A\u5F53\u524D\u7C92\u5B50\u7684\u4E2A\u4F53\u6700\u4F18\u89E3\uFF08\u8BB0\u4E3A pBest\uFF09\u3002")]),n("li",null,[n("p",null,"\u6240\u6709\u7C92\u5B50\u5C06\u81EA\u5DF1\u7684\u4E2A\u4F53\u6700\u4F18\u503C\u53D1\u9001\u7ED9\u7BA1\u7406\u8005 Master\u3002Master \u83B7\u5F97\u6240\u6709\u7C92\u5B50\u7684\u4FE1\u606F\u540E\uFF0C\u7B5B\u9009\u51FA\u5168\u5C40\u6700\u4F18\u89E3\uFF08\u8BB0\u4E3A gBest\uFF09\u3002")]),n("li",null,[n("p",null,"Master \u5C06 gBest \u901A\u77E5\u6240\u6709\u7C92\u5B50\uFF0C\u6240\u6709\u7C92\u5B50\u4FBF\u77E5\u9053\u5168\u5C40\u6700\u4F18\u70B9\u7684\u4F4D\u7F6E\u3002")]),n("li",null,[n("p",null,"\u6240\u6709\u7C92\u5B50\u6839\u636E\u81EA\u5DF1\u7684\u4E2A\u4F53\u6700\u4F18\u89E3\u548C\u5168\u5C40\u6700\u4F18\u89E3\uFF0C\u66F4\u65B0\u81EA\u5DF1\u7684\u901F\u5EA6\uFF0C\u5728\u6709\u4E86\u901F\u5EA6\u540E\uFF0C\u518D\u66F4\u65B0\u81EA\u5DF1\u7684\u4F4D\u7F6E\u3002"),n("p",{class:"katex-block"},[n("span",{class:"katex-display"},[n("span",{class:"katex"},[n("span",{class:"katex-mathml"},[n("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[n("semantics",null,[n("mrow",null,[n("mi",null,"v"),n("mi",null,"k"),n("mo",null,"+"),n("mn",null,"1"),n("mo",null,"="),n("mi",null,"c"),n("mn",null,"0"),n("mo",null,"\xD7"),n("mi",null,"r"),n("mi",null,"a"),n("mi",null,"n"),n("mi",null,"d"),n("mo",{stretchy:"false"},"("),n("mo",{stretchy:"false"},")"),n("mo",null,"\xD7"),n("mi",null,"v"),n("mi",null,"k"),n("mo",null,"+"),n("mi",null,"c"),n("mn",null,"1"),n("mo",null,"\xD7"),n("mi",null,"r"),n("mi",null,"a"),n("mi",null,"n"),n("mi",null,"d"),n("mo",{stretchy:"false"},"("),n("mo",{stretchy:"false"},")"),n("mo",null,"\xD7"),n("mo",{stretchy:"false"},"("),n("mi",null,"p"),n("mi",null,"B"),n("mi",null,"e"),n("mi",null,"s"),n("mi",null,"t"),n("mi",null,"k"),n("mo",null,"\u2212"),n("mi",null,"x"),n("mi",null,"k"),n("mo",{stretchy:"false"},")"),n("mo",null,"+"),n("mi",null,"c"),n("mn",null,"2"),n("mo",null,"\xD7"),n("mi",null,"r"),n("mi",null,"a"),n("mi",null,"n"),n("mi",null,"d"),n("mo",{stretchy:"false"},"("),n("mo",{stretchy:"false"},")"),n("mo",null,"\xD7"),n("mo",{stretchy:"false"},"("),n("mi",null,"g"),n("mi",null,"B"),n("mi",null,"e"),n("mi",null,"s"),n("mi",null,"t"),n("mi",null,"k"),n("mo",null,"\u2212"),n("mi",null,"x"),n("mi",null,"k"),n("mo",{stretchy:"false"},")")]),n("annotation",{encoding:"application/x-tex"},"vk+1=c0\xD7rand()\xD7vk+c1\xD7rand()\xD7(pBestk-xk)+c2\xD7rand()\xD7(gBestk-xk) ")])])]),n("span",{class:"katex-html","aria-hidden":"true"},[n("span",{class:"base"},[n("span",{class:"strut",style:{height:"0.7778em","vertical-align":"-0.0833em"}}),n("span",{class:"mord mathnormal",style:{"margin-right":"0.03588em"}},"v"),n("span",{class:"mord mathnormal",style:{"margin-right":"0.03148em"}},"k"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),n("span",{class:"mbin"},"+"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"0.6444em"}}),n("span",{class:"mord"},"1"),n("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),n("span",{class:"mrel"},"="),n("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"0.7278em","vertical-align":"-0.0833em"}}),n("span",{class:"mord mathnormal"},"c"),n("span",{class:"mord"},"0"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),n("span",{class:"mbin"},"\xD7"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),n("span",{class:"mord mathnormal",style:{"margin-right":"0.02778em"}},"r"),n("span",{class:"mord mathnormal"},"an"),n("span",{class:"mord mathnormal"},"d"),n("span",{class:"mopen"},"("),n("span",{class:"mclose"},")"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),n("span",{class:"mbin"},"\xD7"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"0.7778em","vertical-align":"-0.0833em"}}),n("span",{class:"mord mathnormal",style:{"margin-right":"0.03588em"}},"v"),n("span",{class:"mord mathnormal",style:{"margin-right":"0.03148em"}},"k"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),n("span",{class:"mbin"},"+"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"0.7278em","vertical-align":"-0.0833em"}}),n("span",{class:"mord mathnormal"},"c"),n("span",{class:"mord"},"1"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),n("span",{class:"mbin"},"\xD7"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),n("span",{class:"mord mathnormal",style:{"margin-right":"0.02778em"}},"r"),n("span",{class:"mord mathnormal"},"an"),n("span",{class:"mord mathnormal"},"d"),n("span",{class:"mopen"},"("),n("span",{class:"mclose"},")"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),n("span",{class:"mbin"},"\xD7"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),n("span",{class:"mopen"},"("),n("span",{class:"mord mathnormal",style:{"margin-right":"0.05017em"}},"pB"),n("span",{class:"mord mathnormal"},"es"),n("span",{class:"mord mathnormal"},"t"),n("span",{class:"mord mathnormal",style:{"margin-right":"0.03148em"}},"k"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),n("span",{class:"mbin"},"\u2212"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),n("span",{class:"mord mathnormal"},"x"),n("span",{class:"mord mathnormal",style:{"margin-right":"0.03148em"}},"k"),n("span",{class:"mclose"},")"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),n("span",{class:"mbin"},"+"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"0.7278em","vertical-align":"-0.0833em"}}),n("span",{class:"mord mathnormal"},"c"),n("span",{class:"mord"},"2"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),n("span",{class:"mbin"},"\xD7"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),n("span",{class:"mord mathnormal",style:{"margin-right":"0.02778em"}},"r"),n("span",{class:"mord mathnormal"},"an"),n("span",{class:"mord mathnormal"},"d"),n("span",{class:"mopen"},"("),n("span",{class:"mclose"},")"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),n("span",{class:"mbin"},"\xD7"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),n("span",{class:"mopen"},"("),n("span",{class:"mord mathnormal",style:{"margin-right":"0.03588em"}},"g"),n("span",{class:"mord mathnormal",style:{"margin-right":"0.05017em"}},"B"),n("span",{class:"mord mathnormal"},"es"),n("span",{class:"mord mathnormal"},"t"),n("span",{class:"mord mathnormal",style:{"margin-right":"0.03148em"}},"k"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),n("span",{class:"mbin"},"\u2212"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),n("span",{class:"mord mathnormal"},"x"),n("span",{class:"mord mathnormal",style:{"margin-right":"0.03148em"}},"k"),n("span",{class:"mclose"},")")])])])])]),n("p",{class:"katex-block"},[n("span",{class:"katex-display"},[n("span",{class:"katex"},[n("span",{class:"katex-mathml"},[n("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[n("semantics",null,[n("mrow",null,[n("mi",null,"x"),n("mi",null,"k"),n("mo",null,"+"),n("mn",null,"1"),n("mo",null,"="),n("mi",null,"x"),n("mi",null,"k"),n("mo",null,"+"),n("mi",null,"v"),n("mi",null,"k"),n("mo",null,"+"),n("mn",null,"1")]),n("annotation",{encoding:"application/x-tex"},"xk+1=xk + vk+1 ")])])]),n("span",{class:"katex-html","aria-hidden":"true"},[n("span",{class:"base"},[n("span",{class:"strut",style:{height:"0.7778em","vertical-align":"-0.0833em"}}),n("span",{class:"mord mathnormal"},"x"),n("span",{class:"mord mathnormal",style:{"margin-right":"0.03148em"}},"k"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),n("span",{class:"mbin"},"+"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"0.6444em"}}),n("span",{class:"mord"},"1"),n("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),n("span",{class:"mrel"},"="),n("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"0.7778em","vertical-align":"-0.0833em"}}),n("span",{class:"mord mathnormal"},"x"),n("span",{class:"mord mathnormal",style:{"margin-right":"0.03148em"}},"k"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),n("span",{class:"mbin"},"+"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"0.7778em","vertical-align":"-0.0833em"}}),n("span",{class:"mord mathnormal",style:{"margin-right":"0.03588em"}},"v"),n("span",{class:"mord mathnormal",style:{"margin-right":"0.03148em"}},"k"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),n("span",{class:"mbin"},"+"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"0.6444em"}}),n("span",{class:"mord"},"1")])])])])]),n("p",null,"\u5176\u4E2D\uFF0Crand() \u51FD\u6570\u4EA7\u751F\u4E00\u4E2A (0, 1) \u4E4B\u95F4\u7684\u968F\u673A\u6570\u3002c0 = 1\u3001c1 = 2\u3001c2 = 2\uFF0Ck \u8868\u793A\u8FDB\u5316\u7684\u4EE3\u6570\u3002vk \u8868\u793A\u5F53\u524D\u901F\u5EA6\uFF0CpBestk \u548C gBestk \u8868\u793A\u4E2A\u4F53\u6700\u4F18\u89E3\u548C\u5168\u5C40\u6700\u4F18\u89E3\u3002\u5F53\u7136\uFF0C\u5BF9\u4E8E\u6BCF\u4E00\u4E2A\u7EF4\u5EA6\u4E0A\u7684\u901F\u5EA6\u5206\u91CF\uFF0C\u6211\u4EEC\u90FD\u53EF\u4EE5\u9650\u5B9A\u4E00\u4E2A\u6700\u5927\u503C\u3002\u786E\u4FDD \u201C\u5C0F\u9E1F\u201D \u4E0D\u4F1A\u98DE\u5F97\u592A\u5FEB\uFF0C\u9519\u8FC7\u4E86\u91CD\u8981\u7684\u4FE1\u606F\u3002")]),n("li",null,[n("p",null,"\u5982\u679C\u7C92\u5B50\u4EA7\u751F\u4E86\u65B0\u7684\u4E2A\u4F53\u6700\u4F18\u89E3\uFF0C\u5219\u53D1\u9001\u7ED9 Master\uFF0C\u5728\u6B64\u8F6C\u5230\u6B65\u9AA4 2\u3002")])],-1),r=n("p",null,"\u6574\u4F53\u8FC7\u7A0B\u7684\u793A\u610F\u56FE\u5982\u56FE7.2 \u6240\u793A\u3002",-1),d=n("img",{src:c,alt:"\u56FE7-2",style:{zoom:"100%"}},null,-1),m=n("p",null,"\u56FE7.2 PSO \u7B97\u6CD5\u793A\u610F\u56FE",-1),v=n("p",null,"\u4ECE\u8FD9\u4E2A\u8BA1\u7B97\u6B65\u9AA4\u4E2D\u53EF\u4EE5\u770B\u5230\uFF0C\u8BA1\u7B97\u8FC7\u7A0B\u62E5\u6709\u4E00\u5B9A\u7684\u968F\u673A\u6027\u3002\u4F46\u7531\u4E8E\u6211\u4EEC\u53EF\u4EE5\u542F\u7528\u5927\u91CF\u7684\u4F8B\u5B50\uFF0C\u56E0\u6B64\u5176\u8BA1\u7B97\u6548\u679C\u5728\u7EDF\u8BA1\u5B66\u610F\u4E49\u4E0A\u662F\u7A33\u5B9A\u7684\u3002\u5728\u8FD9\u4E2A\u6807\u51C6\u7684\u7C92\u5B50\u7FA4\u7B97\u6CD5\u4E2D\uFF0C\u7531\u4E8E\u6240\u6709\u7C92\u5B50\u90FD\u4F1A\u5411\u5168\u5C40\u6700\u4F18\u9760\u62E2\uFF0C\u56E0\u6B64\u5176\u8DF3\u51FA\u5C40\u90E8\u6700\u4F18\u7684\u80FD\u529B\u5E76\u4E0D\u7B97\u592A\u5F3A\u3002\u56E0\u6B64\uFF0C\u6211\u4EEC\u4E5F\u53EF\u4EE5\u60F3\u529E\u6CD5\u5BF9\u6807\u51C6\u7684\u7C92\u5B50\u7FA4\u7B97\u6CD5\u8FDB\u884C\u4E00\u4E9B\u4F18\u5316\u3002\u6BD4\u5982\uFF0C\u5141\u8BB8\u5404\u4E2A\u7C92\u5B50\u968F\u673A\u79FB\u52A8\uFF0C\u751A\u81F3\u9006\u5411\u79FB\u52A8\u6765\u8BD5\u56FE\u7A81\u7834\u5C40\u90E8\u6700\u4F18\u3002\u4E3A\u7B80\u5355\u8D77\u89C1\uFF0C\u6211\u4E0D\u6253\u7B97\u505A\u8FD9\u4E9B\u590D\u6742\u7684\u5B9E\u73B0\u3002",-1),b=n("h3",{id:"_7-13-3-\u7C92\u5B50\u7FA4\u7B97\u6CD5\u80FD\u505A\u4EC0\u4E48",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_7-13-3-\u7C92\u5B50\u7FA4\u7B97\u6CD5\u80FD\u505A\u4EC0\u4E48","aria-hidden":"true"},"#"),s(" 7.13.3 \u7C92\u5B50\u7FA4\u7B97\u6CD5\u80FD\u505A\u4EC0\u4E48")],-1),g=n("p",null,"\u7C92\u5B50\u7FA4\u7B97\u6CD5\u80FD\u4E3A\u6211\u4EEC\u505A\u4E9B\u4EC0\u4E48\u5462\uFF1F\u5B83\u5E94\u7528\u6700\u591A\u7684\u573A\u666F\u662F\u8FDB\u884C\u6700\u4F18\u5316\u8BA1\u7B97\u3002\u5B9E\u9645\u4E0A\uFF0C\u4EE5\u7C92\u5B50\u7FA4\u7B97\u6CD5\u4E3A\u4EE3\u8868\u7684\u8FDB\u5316\u8BA1\u7B97\uFF0C\u53EF\u4EE5\u8BF4\u662F\u6700\u4F18\u5316\u8BA1\u7B97\u4E2D\u7684\u901A\u7528\u65B9\u6CD5\u3002\u51E0\u4E4E\u4E00\u5207\u6700\u4F18\u5316\u95EE\u9898\u90FD\u53EF\u4EE5\u901A\u8FC7\u8FD9\u79CD\u968F\u673A\u641C\u7D22\u7684\u6A21\u5F0F\u89E3\u51B3\uFF0C\u5176\u6210\u672C\u4F4E\u3001\u96BE\u5EA6\u5C0F\u3001\u6548\u679C\u597D\uFF0C\u56E0\u6B64\u9887\u53D7\u6B22\u8FCE\u3002",-1),y=n("p",null,"\u4E0B\u9762\uFF0C\u5C31\u8BA9\u6211\u4EEC\u6765\u63A2\u8BA8\u4E00\u4E2A\u5178\u578B\u7684\u4F18\u5316\u95EE\u9898\u3002",-1),f=n("p",null,[s("\u5047\u8BBE\u73B0\u5728\u6709 400 \u4E07\u5143\uFF0C\u8981\u6C42 4 \u5E74\u5185\u4F7F\u7528\u5B8C\u3002\u82E5\u5728\u7B2C 1 \u5E74\u4F7F\u7528 x \u4E07\u5143\uFF0C\u5219\u53EF\u4EE5\u5F97\u5230\u7684\u6536\u76CA\u4E3A "),n("span",{class:"katex"},[n("span",{class:"katex-mathml"},[n("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[n("semantics",null,[n("mrow",null,[n("msqrt",null,[n("mi",null,"x")])]),n("annotation",{encoding:"application/x-tex"},"\\sqrt{x}")])])]),n("span",{class:"katex-html","aria-hidden":"true"},[n("span",{class:"base"},[n("span",{class:"strut",style:{height:"1.04em","vertical-align":"-0.2397em"}}),n("span",{class:"mord sqrt"},[n("span",{class:"vlist-t vlist-t2"},[n("span",{class:"vlist-r"},[n("span",{class:"vlist",style:{height:"0.8003em"}},[n("span",{class:"svg-align",style:{top:"-3em"}},[n("span",{class:"pstrut",style:{height:"3em"}}),n("span",{class:"mord",style:{"padding-left":"0.833em"}},[n("span",{class:"mord mathnormal"},"x")])]),n("span",{style:{top:"-2.7603em"}},[n("span",{class:"pstrut",style:{height:"3em"}}),n("span",{class:"hide-tail",style:{"min-width":"0.853em",height:"1.08em"}},[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"400em",height:"1.08em",viewBox:"0 0 400000 1080",preserveAspectRatio:"xMinYMin slice"},[n("path",{d:`M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z`})])])])]),n("span",{class:"vlist-s"},"\u200B")]),n("span",{class:"vlist-r"},[n("span",{class:"vlist",style:{height:"0.2397em"}},[n("span")])])])])])])]),s(" \u4E07\u5143\uFF08\u6536\u76CA\u4E0D\u518D\u4F7F\u7528\uFF09\uFF0C\u5F53\u5E74\u4E0D\u7528\u7684\u8D44\u91D1\u53EF\u5B58\u5165\u94F6\u884C\uFF0C\u5E74\u5229\u7387\u4E3A 10%\u3002\u5C1D\u8BD5\u5236\u8BA2\u8D44\u91D1\u7684\u4F7F\u7528\u89C4\u5212\uFF0C\u4F7F 4 \u5E74\u6536\u76CA\u4E4B\u548C\u6700\u5927\u3002")],-1),w=n("p",null,[s("\u5F88\u660E\u663E\uFF0C\u5BF9\u4E8E\u8FD9\u7C7B\u95EE\u9898\uFF0C\u4E0D\u540C\u7684\u65B9\u6848\u5F97\u5230\u7684\u7ED3\u679C\u53EF\u80FD\u4F1A\u6709\u5F88\u5927\u7684\u5DEE\u5F02\u3002\u6BD4\u5982\uFF0C\u82E5\u7B2C\u4E00\u5E74\u628A 400 \u4E07\u5143\u5168\u90E8\u7528\u5B8C\uFF0C\u5219\u603B\u6536\u76CA\u4E3A "),n("span",{class:"katex"},[n("span",{class:"katex-mathml"},[n("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[n("semantics",null,[n("mrow",null,[n("msqrt",null,[n("mn",null,"400")])]),n("annotation",{encoding:"application/x-tex"},"\\sqrt{400}")])])]),n("span",{class:"katex-html","aria-hidden":"true"},[n("span",{class:"base"},[n("span",{class:"strut",style:{height:"1.04em","vertical-align":"-0.1328em"}}),n("span",{class:"mord sqrt"},[n("span",{class:"vlist-t vlist-t2"},[n("span",{class:"vlist-r"},[n("span",{class:"vlist",style:{height:"0.9072em"}},[n("span",{class:"svg-align",style:{top:"-3em"}},[n("span",{class:"pstrut",style:{height:"3em"}}),n("span",{class:"mord",style:{"padding-left":"0.833em"}},[n("span",{class:"mord"},"400")])]),n("span",{style:{top:"-2.8672em"}},[n("span",{class:"pstrut",style:{height:"3em"}}),n("span",{class:"hide-tail",style:{"min-width":"0.853em",height:"1.08em"}},[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"400em",height:"1.08em",viewBox:"0 0 400000 1080",preserveAspectRatio:"xMinYMin slice"},[n("path",{d:`M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z`})])])])]),n("span",{class:"vlist-s"},"\u200B")]),n("span",{class:"vlist-r"},[n("span",{class:"vlist",style:{height:"0.1328em"}},[n("span")])])])])])])]),s(" \u4E07\u5143\uFF1B\u82E5\u524D 3 \u5E74\u5747\u4E0D\u7528\uFF0C\u5B58\u5165\u94F6\u884C\uFF0C\u7B2C 4 \u5E74\u628A\u672C\u91D1\u548C\u5229\u606F\u5168\u90E8\u7528\u5B8C\uFF0C\u5219\u603B\u6536\u76CA\u4E3A "),n("span",{class:"katex"},[n("span",{class:"katex-mathml"},[n("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[n("semantics",null,[n("mrow",null,[n("msqrt",null,[n("mrow",null,[n("mn",null,"400"),n("mo",null,"\xD7"),n("mn",null,"1."),n("msup",null,[n("mn",null,"1"),n("mn",null,"3")])])])]),n("annotation",{encoding:"application/x-tex"},"\\sqrt{400\\times1.1^{3}}")])])]),n("span",{class:"katex-html","aria-hidden":"true"},[n("span",{class:"base"},[n("span",{class:"strut",style:{height:"1.04em","vertical-align":"-0.1266em"}}),n("span",{class:"mord sqrt"},[n("span",{class:"vlist-t vlist-t2"},[n("span",{class:"vlist-r"},[n("span",{class:"vlist",style:{height:"0.9134em"}},[n("span",{class:"svg-align",style:{top:"-3em"}},[n("span",{class:"pstrut",style:{height:"3em"}}),n("span",{class:"mord",style:{"padding-left":"0.833em"}},[n("span",{class:"mord"},"400"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),n("span",{class:"mbin"},"\xD7"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),n("span",{class:"mord"},"1."),n("span",{class:"mord"},[n("span",{class:"mord"},"1"),n("span",{class:"msupsub"},[n("span",{class:"vlist-t"},[n("span",{class:"vlist-r"},[n("span",{class:"vlist",style:{height:"0.7401em"}},[n("span",{style:{top:"-2.989em","margin-right":"0.05em"}},[n("span",{class:"pstrut",style:{height:"2.7em"}}),n("span",{class:"sizing reset-size6 size3 mtight"},[n("span",{class:"mord mtight"},[n("span",{class:"mord mtight"},"3")])])])])])])])])])]),n("span",{style:{top:"-2.8734em"}},[n("span",{class:"pstrut",style:{height:"3em"}}),n("span",{class:"hide-tail",style:{"min-width":"0.853em",height:"1.08em"}},[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"400em",height:"1.08em",viewBox:"0 0 400000 1080",preserveAspectRatio:"xMinYMin slice"},[n("path",{d:`M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z`})])])])]),n("span",{class:"vlist-s"},"\u200B")]),n("span",{class:"vlist-r"},[n("span",{class:"vlist",style:{height:"0.1266em"}},[n("span")])])])])])])]),s(" = 23.07 \u4E07\u5143\uFF0C\u663E\u7136\u4F18\u4E8E\u7B2C\u4E00\u79CD\u65B9\u6848\u3002")],-1),h=a('<p>\u5982\u679C\u6211\u4EEC\u5C06\u6B64\u95EE\u9898\u8F6C\u4E3A\u4E00\u822C\u5316\u7684\u4F18\u5316\u95EE\u9898\uFF0C\u5219\u53EF\u4EE5\u5F97\u5230\u4EE5\u4E0B\u65B9\u7A0B\u7EC4\uFF0C\u5982\u56FE7.3 \u6240\u793A\u3002</p><img src="'+l+`" alt="\u56FE7-3" style="zoom:100%;"><p>\u56FE7.3 \u4E00\u822C\u5316\u7684\u4F18\u5316\u95EE\u9898</p><p>\u5176\u4E2D\uFF0Cx<sub>1</sub>\u3001x<sub>2</sub>\u3001x<sub>3</sub>\u3001x<sub>4</sub> \u5206\u522B\u8868\u793A\u7B2C 1\u30012\u30013\u30014 \u5E74\u4F7F\u7528\u7684\u8D44\u91D1\u3002\u4F7F\u7528\u62C9\u683C\u6717\u65E5\u4E58\u5B50\u6CD5\u5BF9\u6B64\u65B9\u7A0B\u7EC4\u8FDB\u884C\u6C42\u89E3\uFF0C\u53EF\u4EE5\u5F97\u5230\u7B2C\u4E00\u5E74\u4F7F\u7528 86.19 \u4E07\u5143\u3001\u7B2C 2 \u5E74\u4F7F\u7528 104.29 \u4E07\u5143\u3001\u7B2C 3 \u5E74\u4F7F\u7528 126.19 \u4E07\u5143\u3001\u7B2C 4 \u5E74\u4F7F\u7528 152.69 \u4E07\u5143\u4E3A\u8FD9\u4E2A\u95EE\u9898\u7684\u6700\u4F18\u89E3\uFF0C\u6B64\u65F6\u603B\u6536\u76CA\u8FBE 43.09 \u4E07\u5143\u3002</p><p>\u7531\u4E8E\u6C42\u89E3\u8FC7\u7A0B\u8FC7\u4E8E\u590D\u6742\uFF0C\u4F7F\u7528\u62C9\u683C\u6717\u65E5\u4E58\u5B50\u6CD5\u65F6\uFF0C\u9700\u8981\u5BF9\u5148\u540E 12 \u4E2A\u672A\u77E5\u6570\u548C\u65B9\u7A0B\u8FDB\u884C\u8054\u7ACB\u6C42\u89E3\uFF0C\u6BD4\u8F83\u96BE\u4EE5\u5B9E\u73B0\u3002\u7531\u4E8E\u6C42\u89E3\u8FC7\u7A0B\u4E0E\u6211\u4EEC\u8BA8\u8BBA\u7684\u4E3B\u9898\u65E0\u5173\uFF0C\u6240\u4EE5\u5728\u8FD9\u91CC\u4E0D\u518D\u7ED9\u51FA\u3002</p><p>\u5BF9\u4E8E\u7C7B\u4F3C\u7684\u4F18\u5316\u95EE\u9898\uFF0C\u6B63\u662F\u7C92\u5B50\u7FA4\u7B97\u6CD5\u7684\u6D89\u730E\u8303\u56F4\u3002\u5F53\u4F7F\u7528\u7C92\u5B50\u7FA4\u7B97\u6CD5\u65F6\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5148\u968F\u673A\u7ED9\u51FA\u82E5\u5E72\u4E2A\u6EE1\u8DB3\u63D0\u4EA4\u7684\u8D44\u91D1\u89C4\u5212\u65B9\u6848\u3002\u63A5\u7740\uFF0C\u6839\u636E\u7C92\u5B50\u7FA4\u7684\u6F14\u5316\u516C\u5F0F\uFF0C\u4E0D\u65AD\u8C03\u6574\u5404\u4E2A\u7C92\u5B50\u7684\u4F4D\u7F6E\uFF08\u7C92\u5B50\u7684\u6BCF\u4E00\u4E2A\u4F4D\u7F6E\u4EE3\u8868\u4E00\u5957\u65B9\u6848\uFF09\uFF0C\u9010\u6B65\u63A2\u7D22\u66F4\u4F18\u7684\u65B9\u6848\u3002</p><h3 id="_7-13-4-\u4F7F\u7528-akka-\u5B9E\u73B0\u7C92\u5B50\u7FA4" tabindex="-1"><a class="header-anchor" href="#_7-13-4-\u4F7F\u7528-akka-\u5B9E\u73B0\u7C92\u5B50\u7FA4" aria-hidden="true">#</a> 7.13.4 \u4F7F\u7528 Akka \u5B9E\u73B0\u7C92\u5B50\u7FA4</h3><p>\u73B0\u5728\uFF0C\u6211\u4EEC\u5DF2\u7ECF\u77E5\u9053\u7C92\u5B50\u7FA4\u7684\u539F\u7406\uFF0C\u5E76\u4E14\u6709\u4E86\u4E00\u4E2A\u8F83\u4E3A\u590D\u6742\u7684\u4F18\u5316\u95EE\u9898\u7B49\u5F85\u6211\u4EEC\u6C42\u89E3\u3002\u63A5\u4E0B\u6765\uFF0C\u5C31\u9700\u8981\u5F00\u52A8\u8111\u7B4B\uFF0C\u4F7F\u7528 Akka \u6765\u5B9E\u73B0\u4E00\u4E2A\u7B80\u5355\u7684\u7C92\u5B50\u7FA4\u89E3\u51B3\u8FD9\u4E2A\u4F18\u5316\u95EE\u9898\u4E86\u3002</p><p>\u4F7F\u7528 Actor \u7684\u6A21\u5F0F\u4E0E\u7C92\u5B50\u7FA4\u7B97\u6CD5\u4E4B\u95F4\u6709\u7740\u5929\u751F\u5339\u914D\u5EA6\u3002\u7C92\u5B50\u7FA4\u7B97\u6CD5\u7531\u4E8E\u6D89\u53CA\u591A\u4E2A\u751A\u81F3\u662F\u6781\u5176\u5927\u91CF\u7684\u7C92\u5B50\u53C2\u4E0E\u8FD0\u7B97\uFF0C\u56E0\u6B64\u5B83\u9690\u542B\u7740\u5E76\u884C\u8BA1\u7B97\u7684\u6A21\u5F0F\u3002\u4ECE\u76F4\u89C2\u4E0A\u770B\uFF0C\u7C92\u5B50\u7FA4\u7B97\u6CD5\u7684\u6C42\u89E3\u7CBE\u5EA6\u6216\u8005\u8BF4\u6C42\u89E3\u7684\u8D28\u91CF\uFF0C\u4E0E\u53C2\u4E0E\u8FD0\u7B97\u7684\u7C92\u5B50\u6570\u91CF\u6709\u76F4\u63A5\u7684\u5173\u7CFB\u3002\u53C2\u4E0E\u8FD0\u7B97\u7684\u7C92\u5B50\u6570\u91CF\u8D8A\u591A\uFF0C\u5F97\u5230\u7684\u89E3\u81EA\u7136\u4E5F\u5C31\u8D8A\u7CBE\u786E\u3002</p><p>\u5982\u679C\u6211\u4EEC\u4F7F\u7528\u4F20\u7EDF\u7684\u591A\u7EBF\u7A0B\u65B9\u5F0F\u5B9E\u73B0\u7C92\u5B50\u7FA4\uFF0C\u4E00\u4E2A\u6700\u5927\u7684\u95EE\u9898\u5C31\u662F\u7EBF\u7A0B\u7684\u6570\u91CF\u53EF\u80FD\u662F\u975E\u5E38\u6709\u9650\u7684\u3002\u5728\u5F53\u524D\u8FD9\u79CD\u5E94\u7528\u573A\u666F\u4E2D\uFF0C\u6211\u4EEC\u5E0C\u671B\u53EF\u4EE5\u62E5\u6709\u6570\u4E07\uFF0C\u751A\u81F3\u6570\u5341\u4E07\u7684\u7C92\u5B50\uFF0C\u4EE5\u63D0\u9AD8\u8BA1\u7B97\u7CBE\u5EA6\uFF0C\u4F46\u4F17\u6240\u5468\u77E5\uFF0C\u5728\u4E00\u53F0\u8BA1\u7B97\u673A\u4E0A\u8FD0\u884C\u6570\u4E07\u4E2A\u7EBF\u7A0B\u57FA\u672C\u662F\u4E0D\u53EF\u80FD\u7684\uFF0C\u5C31\u7B97\u53EF\u4EE5\uFF0C\u7CFB\u7EDF\u7684\u6027\u80FD\u4E5F\u4F1A\u5927\u6253\u6298\u6263\u3002\u56E0\u6B64\uFF0C\u4F7F\u7528\u591A\u7EBF\u7A0B\u7684\u6A21\u578B\u65E0\u6CD5\u5F88\u597D\u5730\u548C\u7C92\u5B50\u7FA4\u7684\u5B9E\u73B0\u76F8\u878D\u5408\u3002</p><p>\u4F46 Akka \u7684 Actor \u6A21\u578B\u5219\u4E0D\u540C\u3002\u7531\u4E8E\u591A\u4E2A Actor \u53EF\u4EE5\u590D\u7528\u4E00\u4E2A\u7EBF\u7A0B\uFF0C\u800C Actor \u672C\u8EAB\u4F5C\u4E3A\u8F7B\u91CF\u7EA7\u7684\u5E76\u53D1\u6267\u884C\u5355\u5143\u53EF\u4EE5\u6709\u6781\u5176\u5927\u91CF\u7684\u5B58\u5728\u3002\u56E0\u6B64\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528 Actor \u6765\u6A21\u62DF\u6574\u4E2A\u7C92\u5B50\u7FA4\u8BA1\u7B97\u7684\u573A\u666F\u3002\u4E0B\u9762\u5C31\u8BA9\u6211\u4EEC\u4ED4\u7EC6\u770B\u4E00\u4E0B\u7CFB\u7EDF\u7684\u5B9E\u73B0\u3002</p><p>\u9996\u5148\uFF0C\u6211\u4EEC\u9700\u8981\u4E24\u4E2A\u8868\u793A pBest \u548C gBest \u7684\u6D88\u606F\u7C7B\u578B\uFF0C\u7528\u4E8E\u5728\u591A\u4E2A Actor \u4E4B\u95F4\u4F20\u9012\u4E2A\u4F53\u6700\u4F18\u89E3\u548C\u5168\u5C40\u6700\u4F18\u89E3\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">GBestMsg</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">PsoValue</span> value<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">GBestMsg</span><span class="token punctuation">(</span><span class="token class-name">PsoValue</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value <span class="token operator">=</span> v<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">PsoValue</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">PBestMsg</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">PsoValue</span> value<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">PBestMsg</span><span class="token punctuation">(</span><span class="token class-name">PsoValue</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value <span class="token operator">=</span> v<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">PsoValue</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u4E0A\u8FF0\u4EE3\u7801\u4E2D\uFF0CGBestMsg\uFF08\u4EE3\u7801\u7B2C 1 \u884C\uFF09\u8868\u793A\u643A\u5E26\u5168\u5C40\u6700\u4F18\u89E3\u7684\u6D88\u606F\uFF0CPBestMsg\uFF08\u4EE3\u7801\u7B2C 11 \u884C\uFF09\u8868\u793A\u643A\u5E26\u4E2A\u4F53\u6700\u4F18\u89E3\u7684\u6D88\u606F\u3002\u5B83\u4EEC\u90FD\u4F7F\u7528 PsoValue \u6765\u8868\u793A\u4E00\u4E2A\u53EF\u884C\u7684\u89E3\u3002</p><p>\u5728 PsoValue \u4E2D\uFF0C\u4E3B\u8981\u5305\u62EC\u4E24\u4E2A\u4FE1\u606F\uFF0C\u7B2C\u4E00\u662F\u8868\u793A\u6295\u8D44\u89C4\u5212\u7684\u65B9\u6848\uFF0C\u5373\u6BCF\u4E00\u5E74\u5206\u522B\u9700\u8981\u6295\u8D44\u591A\u5C11\u94B1\uFF1B\u7B2C\u4E8C\u662F\u8FD9\u4E2A\u6295\u8D44\u65B9\u6848\u7684\u603B\u6536\u76CA\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">PsoValue</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token keyword">double</span> value<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span> x<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">PsoValue</span><span class="token punctuation">(</span><span class="token keyword">double</span> v<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value <span class="token operator">=</span> v<span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        b<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableList</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span> <span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StringBuffer</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;value:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\\n&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u7684\u6570\u7EC4 x \u4E2D\uFF0Cx[1]\u3001x[2]\u3001x[3]\u3001x[4] \u5206\u522B\u8868\u793A\u7B2C 1 \u5E74\u3001\u7B2C 2 \u5E74\u3001\u7B2C 3 \u5E74\u548C\u7B2C 4 \u5E74\u7684\u6295\u8D44\u989D\u3002\u8FD9\u91CC\u4E3A\u4E86\u65B9\u4FBF\u8D77\u89C1\uFF0C\u6211\u5FFD\u7565\u4E86 x[0]\uFF08\u5B83\u5728\u6211\u4EEC\u7684\u7A0B\u5E8F\u4E2D\u662F\u6CA1\u6709\u4F5C\u7528\u7684\uFF09\u3002\u6210\u5458\u53D8\u91CF value \u8868\u793A\u8FD9\u7EC4\u6295\u8D44\u65B9\u6848\u7684\u6536\u76CA\u503C\u3002</p><p>\u56E0\u6B64\uFF0C\u6839\u636E\u9700\u6C42 x \u4E0E value \u4E4B\u95F4\u7684\u5173\u7CFB\u4EE3\u7801\u5982\u4E0B\u6240\u793A\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Fitness</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">fitness</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">double</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> x<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sum <span class="token operator">+=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,19),A=n("p",null,[s("\u4E0A\u8FF0\u4EE3\u7801\u5B9A\u4E49\u7684 fitness() \u51FD\u6570\u8FD4\u56DE\u4E86\u7ED9\u5B9A\u6295\u8D44\u65B9\u6848\u7684\u9002\u5E94\u5EA6\u3002\u9002\u5E94\u5EA6\u4E5F\u5C31\u662F\u6295\u8D44\u7684\u6536\u76CA\uFF0C\u6211\u4EEC\u81EA\u7136\u5E94\u8BE5\u66F4\u503E\u5411\u4E8E\u9009\u62E9\u9002\u5E94\u5EA6\u66F4\u9AD8\u7684\u6295\u8D44\u65B9\u6848\u3002\u5728\u8FD9\u91CC\u9002\u5E94\u5EA6 = "),n("span",{class:"katex"},[n("span",{class:"katex-mathml"},[n("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[n("semantics",null,[n("mrow",null,[n("msqrt",null,[n("mrow",null,[n("mi",null,"x"),n("mn",null,"1")])]),n("mo",null,"+"),n("msqrt",null,[n("mrow",null,[n("mi",null,"x"),n("mn",null,"2")])]),n("mo",null,"+"),n("msqrt",null,[n("mrow",null,[n("mi",null,"x"),n("mn",null,"3")])]),n("mo",null,"+"),n("msqrt",null,[n("mrow",null,[n("mi",null,"x"),n("mn",null,"4")])])]),n("annotation",{encoding:"application/x-tex"},"\\sqrt{x1}+\\sqrt{x2}+\\sqrt{x3}+\\sqrt{x4}")])])]),n("span",{class:"katex-html","aria-hidden":"true"},[n("span",{class:"base"},[n("span",{class:"strut",style:{height:"1.04em","vertical-align":"-0.1328em"}}),n("span",{class:"mord sqrt"},[n("span",{class:"vlist-t vlist-t2"},[n("span",{class:"vlist-r"},[n("span",{class:"vlist",style:{height:"0.9072em"}},[n("span",{class:"svg-align",style:{top:"-3em"}},[n("span",{class:"pstrut",style:{height:"3em"}}),n("span",{class:"mord",style:{"padding-left":"0.833em"}},[n("span",{class:"mord mathnormal"},"x"),n("span",{class:"mord"},"1")])]),n("span",{style:{top:"-2.8672em"}},[n("span",{class:"pstrut",style:{height:"3em"}}),n("span",{class:"hide-tail",style:{"min-width":"0.853em",height:"1.08em"}},[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"400em",height:"1.08em",viewBox:"0 0 400000 1080",preserveAspectRatio:"xMinYMin slice"},[n("path",{d:`M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z`})])])])]),n("span",{class:"vlist-s"},"\u200B")]),n("span",{class:"vlist-r"},[n("span",{class:"vlist",style:{height:"0.1328em"}},[n("span")])])])]),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),n("span",{class:"mbin"},"+"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"1.04em","vertical-align":"-0.1328em"}}),n("span",{class:"mord sqrt"},[n("span",{class:"vlist-t vlist-t2"},[n("span",{class:"vlist-r"},[n("span",{class:"vlist",style:{height:"0.9072em"}},[n("span",{class:"svg-align",style:{top:"-3em"}},[n("span",{class:"pstrut",style:{height:"3em"}}),n("span",{class:"mord",style:{"padding-left":"0.833em"}},[n("span",{class:"mord mathnormal"},"x"),n("span",{class:"mord"},"2")])]),n("span",{style:{top:"-2.8672em"}},[n("span",{class:"pstrut",style:{height:"3em"}}),n("span",{class:"hide-tail",style:{"min-width":"0.853em",height:"1.08em"}},[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"400em",height:"1.08em",viewBox:"0 0 400000 1080",preserveAspectRatio:"xMinYMin slice"},[n("path",{d:`M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z`})])])])]),n("span",{class:"vlist-s"},"\u200B")]),n("span",{class:"vlist-r"},[n("span",{class:"vlist",style:{height:"0.1328em"}},[n("span")])])])]),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),n("span",{class:"mbin"},"+"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"1.04em","vertical-align":"-0.1328em"}}),n("span",{class:"mord sqrt"},[n("span",{class:"vlist-t vlist-t2"},[n("span",{class:"vlist-r"},[n("span",{class:"vlist",style:{height:"0.9072em"}},[n("span",{class:"svg-align",style:{top:"-3em"}},[n("span",{class:"pstrut",style:{height:"3em"}}),n("span",{class:"mord",style:{"padding-left":"0.833em"}},[n("span",{class:"mord mathnormal"},"x"),n("span",{class:"mord"},"3")])]),n("span",{style:{top:"-2.8672em"}},[n("span",{class:"pstrut",style:{height:"3em"}}),n("span",{class:"hide-tail",style:{"min-width":"0.853em",height:"1.08em"}},[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"400em",height:"1.08em",viewBox:"0 0 400000 1080",preserveAspectRatio:"xMinYMin slice"},[n("path",{d:`M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z`})])])])]),n("span",{class:"vlist-s"},"\u200B")]),n("span",{class:"vlist-r"},[n("span",{class:"vlist",style:{height:"0.1328em"}},[n("span")])])])]),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),n("span",{class:"mbin"},"+"),n("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"1.04em","vertical-align":"-0.1328em"}}),n("span",{class:"mord sqrt"},[n("span",{class:"vlist-t vlist-t2"},[n("span",{class:"vlist-r"},[n("span",{class:"vlist",style:{height:"0.9072em"}},[n("span",{class:"svg-align",style:{top:"-3em"}},[n("span",{class:"pstrut",style:{height:"3em"}}),n("span",{class:"mord",style:{"padding-left":"0.833em"}},[n("span",{class:"mord mathnormal"},"x"),n("span",{class:"mord"},"4")])]),n("span",{style:{top:"-2.8672em"}},[n("span",{class:"pstrut",style:{height:"3em"}}),n("span",{class:"hide-tail",style:{"min-width":"0.853em",height:"1.08em"}},[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"400em",height:"1.08em",viewBox:"0 0 400000 1080",preserveAspectRatio:"xMinYMin slice"},[n("path",{d:`M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z`})])])])]),n("span",{class:"vlist-s"},"\u200B")]),n("span",{class:"vlist-r"},[n("span",{class:"vlist",style:{height:"0.1328em"}},[n("span")])])])])])])]),s("\u3002")],-1),x=a(`<p>\u6709\u4E86\u8FD9\u4E9B\u57FA\u7840\u5DE5\u5177\uFF0C\u6211\u4EEC\u5C31\u53EF\u4EE5\u6765\u5B9E\u73B0\u7B80\u5355\u7684\u7C92\u5B50\uFF08\u8FD9\u91CC\u6211\u628A\u5B83\u53EB\u4F5C Bird\uFF09\u4E86\u3002</p><p>\u5BF9\u4E8E\u57FA\u672C\u7C92\u5B50\uFF0C\u6211\u4EEC\u9700\u8981\u5B9A\u4E49\u4EE5\u4E0B\u6210\u5458\u53D8\u91CF\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Bird</span> <span class="token keyword">extends</span> <span class="token class-name">UntypedActor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">LoggingAdapter</span> log <span class="token operator">=</span> <span class="token class-name">Logging</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">PsoValue</span> pBest <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">PsoValue</span> gBest <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span> velocity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span> x <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Random</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u4E2D\uFF0CpBest \u548C gBest \u5206\u522B\u8868\u793A\u4E2A\u4F53\u6700\u4F18\u89E3\u548C\u5168\u5C40\u6700\u4F18\u89E3\uFF0Cvelocity \u8868\u793A\u7C92\u5B50\u5728\u5404\u4E2A\u7EF4\u5EA6\u4E0A\u7684\u901F\u5EA6\uFF08\u5728\u5F53\u524D\u6848\u4F8B\u4E2D\uFF0C\u6BCF\u4E00\u5E74\u7684\u6295\u8D44\u989D\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E00\u4E2A\u7EF4\u5EA6\uFF0C\u56E0\u6B64\u7CFB\u7EDF\u6709 4 \u4E2A\u7EF4\u5EA6\uFF09\u3002x \u8868\u793A\u6295\u8D44\u65B9\u6848\uFF0C\u5373\u6BCF\u4E00\u5E74\u7684\u6295\u8D44\u989D\u3002\u7531\u4E8E\u5728\u7C92\u5B50\u7FA4\u7B97\u6CD5\u4E2D\uFF0C\u9700\u8981\u4F7F\u7528\u968F\u673A\u6570\uFF0C\u56E0\u6B64\uFF0C\u8FD9\u91CC\u5B9A\u4E49\u4E86 r\u3002</p><p>\u5F53\u4E00\u4E2A\u7C92\u5B50\u88AB\u521B\u5EFA\u65F6\uFF0C\u6211\u4EEC\u9700\u8981\u521D\u59CB\u5316\u7C92\u5B50\u7684\u5F53\u524D\u4F4D\u7F6E\u3002\u7C92\u5B50\u7684\u6BCF\u4E00\u4E2A\u4F4D\u7F6E\u90FD\u4EE3\u8868\u4E00\u4E2A\u6295\u8D44\u65B9\u6848\uFF0C\u4E0B\u9762\u7684\u4EE3\u7801\u5C55\u793A\u4E86\u7C92\u5B50\u7684\u521D\u59CB\u5316\u903B\u8F91\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">preStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        velocity<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">.</span>NEGATIVE_INFINITY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        x<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">.</span>NEGATIVE_INFINITY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// x1 &lt;= 400</span>
    x<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span> r<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// x2 &lt;= 440 - 1.1 * x1</span>
    <span class="token keyword">double</span> max <span class="token operator">=</span> <span class="token number">440</span> <span class="token operator">-</span> <span class="token number">1.1</span> <span class="token operator">*</span> x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>max <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    x<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token function">nextDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// x3 &lt;= 484 - 1.21 * x1 - 1.1 * x2</span>
    max <span class="token operator">=</span> <span class="token number">484</span> <span class="token operator">-</span> <span class="token number">1.21</span> <span class="token operator">*</span> x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1.1</span> <span class="token operator">*</span> x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>max <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    x<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token function">nextDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// x4 &lt;= 532.4 - 1.331 * x1 - 1.21 * x2 - 1.1 * x3</span>
    max <span class="token operator">=</span> <span class="token number">532.4</span> <span class="token operator">-</span> <span class="token number">331</span> <span class="token operator">*</span> x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1.21</span> <span class="token operator">*</span> x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1.1</span> <span class="token operator">*</span> x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>max <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    x<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token function">nextDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">double</span> newFit <span class="token operator">=</span> <span class="token class-name">Fitness</span><span class="token punctuation">.</span><span class="token function">fitness</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    pBest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PsoValue</span><span class="token punctuation">(</span>newFit<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">PBestMsg</span> pBestMsg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PBestMsg</span><span class="token punctuation">(</span>pBest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ActorSelection</span> selection <span class="token operator">=</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">actorSelection</span><span class="token punctuation">(</span><span class="token string">&quot;/user/masterbird&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    selection<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span>pBestMsg<span class="token punctuation">,</span> <span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7531\u4E8E\u5728\u5F53\u524D\u6848\u4F8B\u4E2D\uFF0C\u6BCF\u4E00\u5E74\u7684\u6295\u8D44\u989D\u5EA6\u662F\u6709\u6761\u4EF6\u7EA6\u675F\u7684\uFF0C\u6BD4\u5982\u7B2C\u4E00\u5E74\u7684\u6295\u8D44\u989D\u4E0D\u80FD\u8D85\u8FC7 400 \u4E07\uFF08\u7B2C 7 ~ 8 \u884C\uFF09\uFF0C\u800C\u7B2C 2 \u5E74\u7684\u6295\u8D44\u4E0A\u9650\u662F 440 \u4E07\uFF08\u5047\u8BBE\u7B2C\u4E00\u5E74\u5168\u90E8\u5B58\u94F6\u884C\uFF0C\u4EE3\u7801\u7B2C 10 ~ 13 \u884C\uFF09\uFF0C\u4F9D\u6B64\u7C7B\u63A8\u3002\u7C92\u5B50\u521D\u59CB\u5316\u65F6\uFF0C\u968F\u673A\u751F\u6210\u4E00\u7EC4\u6EE1\u8DB3\u57FA\u672C\u7EA6\u675F\u6761\u4EF6\u7684\u6295\u8D44\u7EC4\u5408\uFF0C\u5E76\u8BA1\u7B97\u5B83\u7684\u9002\u5E94\u5EA6\uFF08\u7B2C 25 \u884C\uFF09\u3002\u521D\u59CB\u7684\u6295\u8D44\u65B9\u6848\u81EA\u7136\u4E5F\u5C31\u4F5C\u4E3A\u5F53\u524D\u7684\u4E2A\u4F53\u6700\u4F18\u89E3\uFF0C\u5E76\u53D1\u9001\u7ED9 Master\uFF08\u7B2C 29 \u884C\uFF09\u3002</p><p>\u5F53 Master \u8BA1\u7B97\u51FA\u5F53\u524D\u5168\u5C40\u6700\u4F18\u89E3\u540E\uFF0C\u4F1A\u5C06\u5168\u5C40\u6700\u4F18\u89E3\u53D1\u9001\u7ED9\u6BCF\u4E00\u4E2A\u7C92\u5B50\uFF0C\u7C92\u5B50\u6839\u636E\u5168\u5C40\u6700\u4F18\u89E3\u66F4\u65B0\u81EA\u5DF1\u7684\u8FD0\u884C\u901F\u5EA6\uFF0C\u4EE5\u53CA\u5F53\u524D\u4F4D\u7F6E\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">GBestMsg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        gBest <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">GBestMsg</span><span class="token punctuation">)</span> msg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u66F4\u65B0\u901F\u5EA6</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> velocity<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">updateVelocity</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// \u66F4\u65B0\u4F4D\u7F6E</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> x<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">updateX</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">validateX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> newFit <span class="token operator">=</span> <span class="token class-name">Fitness</span><span class="token punctuation">.</span><span class="token function">fitness</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newFit <span class="token operator">&gt;</span> pBest<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            pBest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PsoValue</span><span class="token punctuation">(</span>newFit<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">PBestMsg</span> pBestMsg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PBestMsg</span><span class="token punctuation">(</span>pBest<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">getSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span>pBestMsg<span class="token punctuation">,</span> <span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> 
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">unhandled</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u4E0A\u8FF0\u4EE3\u7801\u4E2D\uFF0C\u7C92\u5B50\u63A5\u6536\u5230\u4E86\u5168\u5C40\u6700\u4F18\u89E3\uFF08\u7B2C 4 \u884C\uFF09\u540E\uFF0C\u6839\u636E\u7C92\u5B50\u7FA4\u7684\u6807\u51C6\u516C\u5F0F\u66F4\u65B0\u81EA\u5DF1\u7684\u901F\u5EA6\uFF08\u7B2C 6 ~ 8 \u884C\uFF09\u3002\u63A5\u7740\uFF0C\u6839\u636E\u901F\u5EA6\u66F4\u65B0\u81EA\u5DF1\u7684\u4F4D\u7F6E\uFF08\u7B2C 10 ~ 12 \u884C\uFF09\u3002\u7531\u4E8E\u5F53\u524D\u95EE\u9898\u662F\u6709\u7EA6\u675F\u7684\uFF0C\u4E5F\u5C31\u662F\u8BF4\u89E3\u7A7A\u95F4\u5E76\u4E0D\u662F\u968F\u610F\u7684\u3002\u7C92\u5B50\u5F88\u53EF\u80FD\u5728\u66F4\u65B0\u4F4D\u7F6E\u540E\uFF0C\u8DD1\u51FA\u4E86\u5408\u7406\u7684\u8303\u56F4\uFF0C\u56E0\u6B64\uFF0C\u8FD8\u6709\u5FC5\u8981\u8FDB\u884C\u6709\u6548\u6027\u68C0\u67E5\uFF08\u7B2C 13 \u884C\uFF09\u3002</p><p>\u66F4\u65B0\u5B8C\u6210\u540E\u5C31\u53EF\u4EE5\u8BA1\u7B97\u65B0\u4F4D\u7F6E\u7684\u9002\u5E94\u5EA6\uFF0C\u5982\u679C\u4EA7\u751F\u4E86\u65B0\u7684\u4E2A\u4F53\u6700\u4F18\u89E3\uFF0C\u5C31\u5C06\u5176\u53D1\u9001\u7ED9 Master\uFF08\u7B2C 15 ~ 19 \u884C\uFF09\u3002</p><p>\u5728\u5F53\u524D\u6848\u4F8B\u4E2D\uFF0C\u901F\u5EA6\u548C\u4F4D\u7F6E\u7684\u66F4\u65B0\u662F\u4F9D\u636E\u6807\u51C6\u7684\u7C92\u5B50\u7FA4\u5B9E\u73B0\u7684\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">double</span> <span class="token function">updateVelocity</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">double</span> v <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> velocity<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>pBest<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">-</span> x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>gBest<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">-</span> x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v <span class="token operator">=</span> v <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    velocity<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> v<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">double</span> <span class="token function">updateX</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">double</span> newX <span class="token operator">=</span> x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> velocity<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    x<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> newX<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> newX<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u4E2D updateVelocity() \u548C updateX() \u65B9\u6CD5\u5206\u522B\u66F4\u65B0\u4E86\u7C92\u5B50\u7684\u901F\u5EA6\u548C\u4F4D\u7F6E\u3002\u4F4D\u7F6E\u7684\u66F4\u65B0\u4F9D\u8D56\u4E8E\u5F53\u524D\u7684\u901F\u5EA6\uFF08\u7B2C 11 \u884C\uFF09\u3002</p><p>\u7531\u4E8E\u6BCF\u4E00\u5E74\u7684\u6295\u8D44\u90FD\u662F\u6709\u9650\u989D\u7684\uFF0C\u56E0\u6B64\u8981\u907F\u514D\u7C92\u5B50\u8DD1\u5230\u5408\u7406\u7A7A\u95F4\u4E4B\u5916\uFF0C\u4E0B\u9762\u7684\u4EE3\u7801\u5F3A\u5236\u5C06\u7C92\u5B50\u7EA6\u675F\u5728\u5408\u7406\u7684\u533A\u95F4\u4E2D\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">validateX</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        x<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span> r<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// x2</span>
    <span class="token keyword">double</span> max <span class="token operator">=</span> <span class="token number">440</span> <span class="token operator">-</span> <span class="token number">1.1</span> <span class="token operator">*</span> x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> max <span class="token operator">||</span> x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        x<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token function">nextDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// x3</span>
    max <span class="token operator">=</span> <span class="token number">484</span> <span class="token operator">-</span> <span class="token number">1.21</span> <span class="token operator">*</span> x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1.1</span> <span class="token operator">*</span> x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> max <span class="token operator">||</span> x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        x<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token function">nextDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// x4</span>
    max <span class="token operator">=</span> <span class="token number">532.4</span> <span class="token operator">-</span> <span class="token number">1.331</span> <span class="token operator">*</span> x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1.21</span> <span class="token operator">*</span> x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1.1</span> <span class="token operator">*</span> x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> max <span class="token operator">||</span> x<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        x<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token function">nextDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u5206\u522B\u5BF9 x<sub>1</sub>\u3001x<sub>2</sub>\u3001x<sub>3</sub>\u3001x<sub>4</sub> \u8FDB\u884C\u7EA6\u675F\uFF0C\u4E00\u65E6\u53D1\u73B0\u7C92\u5B50\u8DD1\u51FA\u4E86\u5B9A\u4E49\u8303\u56F4\u5C31\u5C06\u5B83\u8FDB\u884C\u968F\u673A\u5316\u3002</p><p>\u6B64\u5916\uFF0C\u6211\u4EEC\u8FD8\u9700\u8981 MasterBird \u7528\u4E8E\u7BA1\u7406\u548C\u901A\u77E5\u5168\u5C40\u6700\u4F18\u89E3\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MasterBird</span> <span class="token keyword">extends</span> <span class="token class-name">UntypedActor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">LoggingAdapter</span> log <span class="token operator">=</span> <span class="token class-name">Logging</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">PsoValue</span> gBest <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">PBestMsg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">PsoValue</span> pBest <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">PBestMsg</span><span class="token punctuation">)</span> msg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>gBest <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> gBest<span class="token punctuation">.</span>value <span class="token operator">&lt;</span> pBest<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u66F4\u65B0\u5168\u5C40\u6700\u4F18\u89E3\uFF0C\u901A\u77E5\u6240\u6709\u7C92\u5B50</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg <span class="token operator">+</span> <span class="token string">&quot;\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                gBest <span class="token operator">=</span> pBest<span class="token punctuation">;</span>
                <span class="token class-name">ActorSelection</span> selection <span class="token operator">=</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">actorSelection</span><span class="token punctuation">(</span><span class="token string">&quot;/user/bird_*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                selection<span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GBestMsg</span><span class="token punctuation">(</span>gBest<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> 
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">unhandled</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u5B9A\u4E49\u4E86 MasterBird\u3002\u5F53\u5B83\u6536\u5230\u4E00\u4E2A\u4E2A\u4F53\u6700\u4F18\u89E3\u65F6\uFF0C\u4F1A\u5C06\u5176\u4E0E\u5168\u5C40\u6700\u4F18\u89E3\u8FDB\u884C\u6BD4\u8F83\uFF0C\u5982\u679C\u4EA7\u751F\u4E86\u65B0\u7684\u5168\u5C40\u6700\u4F18\u89E3\uFF0C\u5C31\u66F4\u65B0\u8FD9\u4E2A\u5168\u5C40\u6700\u4F18\u89E3\u5E76\u901A\u77E5\u6240\u6709\u7684\u7C92\u5B50\uFF08\u7B2C 12 ~ 14 \u884C\uFF09\u3002</p><p>\u597D\u4E86\uFF0C\u73B0\u5728\u4E07\u4E8B\u4FF1\u5907\u53EA\u6B20\u4E1C\u98CE\u3002\u4E0B\u9762\u5C31\u662F\u4E3B\u51FD\u6570\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PSOMain</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> BIRD_COUNT <span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ActorSystem</span> system <span class="token operator">=</span> <span class="token class-name">ActorSystem</span>
                <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;psoSystem&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ConfigFactory</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;samplehello.conf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        system<span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">MasterBird</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;masterbird&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BIRD_COUNT<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            system<span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Bird</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;bird_&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u5B9A\u4E49\u4E86\u7C92\u5B50\u603B\u6570\uFF0C\u8FD9\u91CC\u662F 10 \u4E07\u4E2A\u7C92\u5B50\uFF0C\u521B\u5EFA\u4E00\u4E2A MasterBird Actor\uFF08\u7B2C 6 \u884C\uFF09\u548C 10 \u4E07\u4E2Abird\uFF08\u7B2C 7 ~ 9 \u884C\uFF09\u3002</p><p>\u6267\u884C\u4E0A\u8FF0\u4EE3\u7801\uFF0C\u8FD0\u884C\u4E00\u5C0F\u6BB5\u65F6\u95F4\uFF0C\u4F60\u5C31\u53EF\u4EE5\u5F97\u5230\u5982\u4E0B\u8F93\u51FA\uFF08\u622A\u53D6\u90E8\u5206\uFF09\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>va1ue<span class="token operator">:</span><span class="token number">36.15412875487459</span>
<span class="token punctuation">[</span><span class="token operator">-</span><span class="token class-name">Infinity</span><span class="token punctuation">,</span> <span class="token number">168.0</span><span class="token punctuation">,</span><span class="token number">18.786423873345715</span><span class="token punctuation">,</span> <span class="token number">102.1742923174793</span><span class="token punctuation">,</span> <span class="token number">76.5657638235272</span><span class="token punctuation">]</span>
va1ue<span class="token operator">:</span><span class="token number">37.88452477135976</span>
<span class="token punctuation">[</span><span class="token operator">-</span><span class="token class-name">Infinity</span><span class="token punctuation">,</span> <span class="token number">64.0</span><span class="token punctuation">,</span> <span class="token number">87.66774733441137</span><span class="token punctuation">,</span> <span class="token number">37.976681047619195</span><span class="token punctuation">,</span> <span class="token number">206.17791816445362</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
va1ue<span class="token operator">:</span><span class="token number">42.240797528048176</span>
<span class="token punctuation">[</span><span class="token operator">-</span><span class="token class-name">Infinity</span><span class="token punctuation">,</span> <span class="token number">113.0</span><span class="token punctuation">,</span> <span class="token number">42.37168995110633</span><span class="token punctuation">,</span> <span class="token number">141.70570102409184</span><span class="token punctuation">,</span> <span class="token number">174.16812834843475</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
va1ue<span class="token operator">:</span><span class="token number">43.01934824083668</span>
<span class="token punctuation">[</span><span class="token operator">-</span><span class="token class-name">Infinity</span><span class="token punctuation">,</span> <span class="token number">76.0</span><span class="token punctuation">,</span> <span class="token number">112.89557345993592</span><span class="token punctuation">,</span> <span class="token number">133.29270155682005</span><span class="token punctuation">,</span> <span class="token number">147.16289926594942</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u8F93\u51FA\u8868\u793A\uFF0C\u5F53\u7C92\u5B50\u7FA4\u968F\u673A\u521D\u59CB\u5316\u65F6\uFF0C\u6700\u4F18\u89E3\u4E3A 36.15 \u4E07\u5143\uFF0C\u4F46\u968F\u7740\u7C92\u5B50\u7684\u641C\u7D22\uFF0C\u8FD9\u4E2A\u6295\u8D44\u65B9\u6848\u88AB\u9010\u6B65\u4F18\u5316\uFF0C\u7531 37.88 \u4E07\u5143\u4E00\u76F4\u4E0A\u5347\u5230 43.02 \u4E07\u5143\u3002\u6839\u636E\u524D\u9762\u7684\u6C42\u89E3\uFF0C\u6211\u4EEC\u77E5\u9053\u8FD9\u4E2A\u6295\u8D44\u65B9\u6848\u7684\u6700\u4F18\u7ED3\u679C\u662F 43.09 \u4E07\u5143\uFF0C\u53EF\u89C1\u7C92\u5B50\u7FA4\u7684\u641C\u7D22\u7ED3\u679C\u548C\u5168\u5C40\u6700\u4F18\u89E3\u5DF2\u7ECF\u975E\u5E38\u63A5\u8FD1\u4E86\u3002</p><p>\u5F53\u7136\u4E86\uFF0C\u7531\u4E8E\u7C92\u5B50\u7FA4\u7B97\u6CD5\u7684\u968F\u673A\u6027\uFF0C\u6BCF\u6B21\u6267\u884C\u7ED3\u679C\u53EF\u80FD\u5E76\u4E0D\u4E00\u6837\uFF0C\u8FD9\u610F\u5473\u7740\u6709\u65F6\u5019\u4F60\u53EF\u80FD\u4F1A\u6C42\u5F97\u66F4\u597D\u7684\u89E3\uFF0C\u6709\u65F6\u5F97\u5230\u4E00\u4E2A\u7A0D\u5DEE\u4E00\u4E9B\u7684\u89E3\uFF0C\u4F46\u5B83\u4EEC\u4E4B\u95F4\u4E0D\u4F1A\u76F8\u5DEE\u592A\u8FDC\u3002</p>`,27),S=[i,k,r,d,m,v,b,g,y,f,w,h,A,x];function M(q,j){return p(),e("div",null,S)}var C=t(u,[["render",M],["__file","\u7B2C7\u7AE0\u4F7F\u7528Akka\u6784\u5EFA\u9AD8\u5E76\u53D1\u7A0B\u5E8F.html.vue"]]);export{C as default};
